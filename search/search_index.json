{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>For the self-improvement and independency!\ud83c\udf7b</p>"},{"location":"administrator/infrastructure/","title":"Infrastructure","text":""},{"location":"administrator/infrastructure/#air-gapped-vs-restricted-network","title":"Air-gapped VS Restricted Network","text":"\u5bf9\u6bd4\u9879 Air-gapped Network Restricted Network With Network Customization \u662f\u5426\u80fd\u8bbf\u95ee\u4e92\u8054\u7f51 \u274c \u5b8c\u5168\u4e0d\u80fd \u26a0 \u53d7\u9650\uff0c\u53ef\u901a\u8fc7 Proxy \u6216\u7279\u5b9a\u767d\u540d\u5355 \u53ef\u4ee5\u8bbf\u95ee\u4e92\u8054\u7f51 \u9700\u8981 Proxy Server \u5426 \u5fc5\u987b \u53ef\u9009 \u662f\u5426\u5fc5\u987b\u7528\u672c\u5730 Registry \u662f\uff0c\u9700\u8981\u624b\u52a8\u4e0b\u8f7d\u5e76\u5bfc\u5165 \u5426\uff0c\u53ef\u80fd\u9700\u8981 Proxy \u8bbf\u95ee\u955c\u50cf\u4ed3\u5e93 \u5426\uff0c\u4ece\u7f51\u7edc\u4e0b\u8f7d\uff0c\u65e0\u9700\u672c\u5730registry \u9002\u7528\u573a\u666f \u9ad8\u5b89\u5168\u6027\u3001\u519b\u4e8b\u3001\u653f\u5e9c\u3001\u4f01\u4e1a\u5185\u7f51 \u53d7\u63a7\u4f01\u4e1a\u7f51\u7edc\u3001\u79c1\u6709\u4e91\u73af\u5883 \u516c\u6709\u4e91\u3001\u6df7\u5408\u4e91\u3001\u4f01\u4e1a\u5b9a\u5236 SDN"},{"location":"administrator/infrastructure/#openshift","title":"\u5728 OpenShift \u90e8\u7f72\u4e2d\u7684\u5f71\u54cd","text":"<p>Air-gapped \u90e8\u7f72\uff1a</p> <ul> <li>\u9700\u8981 \u672c\u5730 Registry\uff08\u955c\u50cf\u4ed3\u5e93\uff09\uff0c\u5982 \u955c\u50cf\u955c\u50cf (mirror registry)\u3002</li> <li>\u9700\u624b\u52a8\u4e0b\u8f7d OpenShift \u5b89\u88c5\u5305\u3001Operator\u3001\u66f4\u65b0\u5305\uff0c\u5e76\u624b\u52a8\u5bfc\u5165\u3002</li> <li>\u65e0\u6cd5\u5728\u7ebf\u62c9\u53d6\u5bb9\u5668\u955c\u50cf\uff0c\u6240\u6709\u7ec4\u4ef6\u5fc5\u987b\u672c\u5730\u5316\u3002</li> </ul> <p>Restricted Network \u90e8\u7f72\uff1a</p> <ul> <li>\u53ef\u80fd\u9700\u8981\u914d\u7f6e http_proxy\u3001https_proxy \u8ba9\u96c6\u7fa4\u8bbf\u95ee\u7279\u5b9a\u7684\u5916\u90e8\u8d44\u6e90\u3002</li> <li>\u53ef\u4ee5\u8bbe\u7f6e\u9632\u706b\u5899\u89c4\u5219\uff0c\u5141\u8bb8\u8bbf\u95ee Red Hat \u955c\u50cf\u4ed3\u5e93\uff08\u5982 quay.io\uff09\u3002</li> <li>\u4ecd\u7136\u53ef\u4ee5\u4f7f\u7528 OpenShift Disconnected Registry\uff0c\u4ee5\u51cf\u5c11\u5bf9\u5916\u90e8\u8bbf\u95ee\u7684\u4f9d\u8d56\u3002</li> </ul>"},{"location":"administrator/linux/","title":"Linux","text":"\u540d\u79f0 \u9002\u7528\u573a\u666f \u53ef\u53d8\u6027 \u8f6f\u4ef6\u7ba1\u7406 \u4e3b\u8981\u7528\u9014 Red Hat Enterprise Linux  (RHEL, CentOS) \u901a\u7528\u4f01\u4e1a Linux\uff0c\u9002\u7528\u4e8e\u5404\u79cd\u670d\u52a1\u5668\u548c\u4e91\u8ba1\u7b97 \u53ef\u53d8\uff08Mutable\uff09 dnf/yum \u4f20\u7edf\u670d\u52a1\u5668\u3001\u4e91\u3001\u865a\u62df\u5316\u3001\u6570\u636e\u5e93\u7b49 Red Hat Entprise Linux CoreOS  (RHCOS, CoreOS) \u4e13\u95e8\u7528\u4e8e OpenShift \u7684\u5bb9\u5668\u64cd\u4f5c\u7cfb\u7edf \u4e0d\u53ef\u53d8\uff08Immutable\uff09 OSTree\uff08\u81ea\u52a8\u66f4\u65b0\uff09 Kubernetes \u548c OpenShift \u8282\u70b9\u64cd\u4f5c\u7cfb\u7edf <p>| dnf | yum|</p>"},{"location":"administrator/hardware/disk/","title":"Disk","text":""},{"location":"administrator/hardware/disk/#types","title":"Types","text":"<p>Computer has two types of memory:</p> <ul> <li>Primary memory is temporary - RAM</li> <li>Secondary memory is permanent - Drive/Disk -  \u5373\u4f7f\u7535\u8111\u5173\u673a\u91cd\u542f\uff0c\u6570\u636e\u4e5f\u59cb\u7ec8\u5b58\u5728</li> </ul>"},{"location":"administrator/hardware/disk/#1-hddmagnetic-hard-disk-drive","title":"1. \u673a\u68b0\u786c\u76d8\uff08HDD\uff0c(Magnetic) Hard Disk Drive\uff09","text":"<ul> <li>introduced by IBM in 1956</li> <li>\u901a\u8fc7\u78c1\u5934\u5728\u9ad8\u901f\u65cb\u8f6c\u7684\u78c1\u6027\u76d8\u7247\u4e0a\u8bfb\u5199\u6570\u636e\u3002</li> <li>rotating magnetic disk</li> <li>\u8f6c\u901f\u7528 RPM \u6d4b - Revolutions Per Minute: a measure of the speed at which a computer's hard drive spins.</li> <li>\u901f\u5ea6\u7ea6100~200 MB/s</li> </ul>"},{"location":"administrator/hardware/disk/#2-ssdsolid-state-drive","title":"2. \u56fa\u6001\u786c\u76d8\uff08SSD\uff0cSolid State Drive\uff09","text":"<ul> <li>no \"rotating\" part</li> <li>\u57fa\u4e8e\u95ea\u5b58\u82af\u7247\uff08NAND Flash\uff09\u5b58\u50a8\uff0c\u65e0\u673a\u68b0\u90e8\u4ef6\u3002</li> <li>\u901f\u5ea6\u53ef\u8fbe500MB/s~7GB/s</li> </ul>"},{"location":"administrator/hardware/disk/#3-sshdsolid-state-hybrid-drive","title":"3. \u6df7\u5408\u786c\u76d8\uff08SSHD\uff0cSolid-State Hybrid Drive\uff09","text":"<ul> <li>\u7ed3\u5408HDD\u7684\u5927\u5bb9\u91cf\u548cSSD\u7684\u9ad8\u901f\u7f13\u5b58\uff08\u5c0f\u5bb9\u91cf\u95ea\u5b58\u52a0\u901f\u5e38\u7528\u6570\u636e\uff09\u3002</li> </ul>"},{"location":"administrator/hardware/disk/#4","title":"4. \u65b0\u5174\u5b58\u50a8\u6280\u672f","text":""},{"location":"architect/%20concepts/","title":"concepts","text":""},{"location":"architect/%20concepts/#serverless","title":"Serverless","text":"<p>\u201cServerless\u201d\uff08\u65e0\u670d\u52a1\u5668\uff09\u8fd9\u4e2a\u8bcd\u5728\u4e91\u8ba1\u7b97\u4e2d\u5e38\u5e38\u4f1a\u5f15\u8d77\u8bef\u89e3\u3002\u5b83\u5e76\u4e0d\u662f\u771f\u7684\u201c\u6ca1\u6709\u670d\u52a1\u5668\u201d\uff0c\u800c\u662f\u6307\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u7ba1\u7406\u670d\u52a1\u5668\u3002\u4e0b\u9762\u662f\u5bf9\u8fd9\u4e2a\u8bcd\u7684\u8be6\u7ec6\u89e3\u91ca\uff1a</p> <p>\ud83d\udccc Serverless \u7684\u771f\u6b63\u542b\u4e49\uff1a</p> <p>\u4e0d\u662f\u6ca1\u6709\u670d\u52a1\u5668\uff1a\u5b9e\u9645\u4e0a\uff0cServerless \u67b6\u6784\u4ecd\u7136\u4f9d\u8d56\u670d\u52a1\u5668\uff0c\u4f46\u8fd9\u4e9b\u670d\u52a1\u5668\u662f\u7531\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\uff08\u6bd4\u5982 AWS\u3001Azure\u3001Google Cloud\uff09\u7ba1\u7406\u7684\u3002 \u5f00\u53d1\u8005\u4e0d\u9700\u8981\u5173\u5fc3\u670d\u52a1\u5668\uff1a\u4f60\u4e0d\u9700\u8981\u914d\u7f6e\u3001\u7ef4\u62a4\u6216\u6269\u5c55\u670d\u52a1\u5668\u3002\u53ea\u5173\u6ce8\u4ee3\u7801\u672c\u8eab\u3002</p> <p>\u2705 Serverless \u7684\u7279\u70b9\uff1a</p> \u7279\u70b9 \u63cf\u8ff0 \u6309\u9700\u8fd0\u884c \u4ee3\u7801\u53ea\u5728\u88ab\u89e6\u53d1\u65f6\u6267\u884c\uff08\u5982 HTTP \u8bf7\u6c42\u3001\u6570\u636e\u5e93\u53d8\u66f4\u3001\u961f\u5217\u4e8b\u4ef6\u7b49\uff09 \u81ea\u52a8\u6269\u5c55 \u4e0d\u7528\u8bbe\u7f6e\u6269\u5bb9\uff0c\u5e73\u53f0\u4f1a\u6839\u636e\u8d1f\u8f7d\u81ea\u52a8\u4f38\u7f29 \u65e0\u9700\u670d\u52a1\u5668\u7ba1\u7406 \u4e91\u5e73\u53f0\u7ba1\u7406\u64cd\u4f5c\u7cfb\u7edf\u3001\u6253\u8865\u4e01\u3001\u76d1\u63a7\u3001\u8d44\u6e90\u914d\u7f6e\u7b49 \u8ba1\u8d39\u6a21\u5f0f \u6309\u8bf7\u6c42\u548c\u8fd0\u884c\u65f6\u95f4\u8ba1\u8d39\uff08\u4e0d\u662f\u6309\u670d\u52a1\u5668\u5c0f\u65f6\u6570\uff09"},{"location":"architect/%20concepts/#multi-tenant","title":"Multi-tenant","text":"<p>Multi-tenant service\uff08\u591a\u79df\u6237\u670d\u52a1\uff09 \u662f\u4e00\u79cd\u8f6f\u4ef6\u67b6\u6784\u6a21\u5f0f\uff0c\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff1a\u591a\u4e2a\u5ba2\u6237\uff08\u79df\u6237\uff0ctenants\uff09\u5171\u4eab\u540c\u4e00\u4e2a\u5e94\u7528\u5b9e\u4f8b\uff0c\u4f46\u6570\u636e\u548c\u914d\u7f6e\u5f7c\u6b64\u9694\u79bb\u3002</p> <p>\ud83c\udfe2 \u60f3\u8c61\u8fd9\u6837\u4e00\u4e2a\u573a\u666f\uff1a</p> <p>\u4f60\u5728\u4f7f\u7528\u4e00\u4e2a SaaS \u670d\u52a1\uff08\u6bd4\u5982 Notion\u3001Slack \u6216 Zoom\uff09\u3002\u4f60\u548c\u5176\u4ed6\u516c\u53f8\u90fd\u5728\u7528\u540c\u4e00\u4e2a\u5e73\u53f0\uff0c\u4f46\u4f60\u4eec\u7684\u6570\u636e\u5f7c\u6b64\u9694\u79bb\u3001\u770b\u4e0d\u5230\u5bf9\u65b9\uff0c\u8fd9\u5c31\u662f \u591a\u79df\u6237\u670d\u52a1\u7684\u5178\u578b\u4f8b\u5b50\u3002</p> <p>\ud83e\uddf1 \u6838\u5fc3\u7279\u70b9</p> \u7279\u6027 \u63cf\u8ff0 \u5171\u4eab\u8d44\u6e90 \u540c\u4e00\u4e2a\u5e94\u7528\u5b9e\u4f8b\u670d\u52a1\u591a\u4e2a\u79df\u6237\uff0c\u5171\u4eab\u8ba1\u7b97\u8d44\u6e90\u3001\u6570\u636e\u5e93\u5b9e\u4f8b\u7b49 \u6570\u636e\u9694\u79bb \u6bcf\u4e2a\u79df\u6237\u7684\u6570\u636e\u5f7c\u6b64\u9694\u79bb\uff0c\u9632\u6b62\u8d8a\u6743\u8bbf\u95ee \u7edf\u4e00\u7ef4\u62a4 \u5f00\u53d1\u8005\u53ea\u7ef4\u62a4\u4e00\u5957\u4ee3\u7801\u3001\u90e8\u7f72\u4e00\u6b21\uff0c\u5373\u53ef\u670d\u52a1\u591a\u4e2a\u5ba2\u6237 \u914d\u7f6e\u7075\u6d3b \u6bcf\u4e2a\u79df\u6237\u53ef\u6709\u81ea\u5df1\u7684\u8bbe\u7f6e\u3001\u54c1\u724c\u3001\u8bed\u8a00\u3001\u6743\u9650\u7b49\u4e2a\u6027\u5316\u914d\u7f6e"},{"location":"architect/system_design/","title":"System design","text":""},{"location":"architect/system_design/#mastering-system-design-interview","title":"Mastering System Design Interview","text":"<p>Slides</p>"},{"location":"architect/architectural_thinking/","title":"Architectural Thinking","text":""},{"location":"architect/architectural_thinking/#1-course-goals","title":"1. Course Goals","text":"<ul> <li>Learning a variety of architecture styles &amp; approaches</li> <li>Avoiding \"golden hammer\" anti-pattern</li> <li>Not rushing to a solution</li> <li>Understanding that fixing one problem often casuse another</li> <li>Looking for unconventional solutions</li> </ul> <p>Golden Hammer</p> <p>When you have a preferred solution style (a \"golden hammer\"), every problem begins to look the same, like a silver nail.</p>"},{"location":"architect/architectural_thinking/#2-what-is-architecture","title":"2. What is Architecture","text":"<ul> <li>Architecture (as an artefact): The architecture of a system describes its overall static structure and dynamic behaviour. It models the system's elements (which for IT systems are software, hardware, and its human users), the externally manifested properties of those elements, and the static and dynamic relationships among them.</li> <li>Architecture (as a discipline): Architecture is an engineering discipline That studies methods of designing IT systems that provide a solution to a business problem. The solution must satisfy functional and non-functional requirements in a way that best balances competing stakeholders' concerns and must take constraints into account.</li> <li>Architecture can be at any scale:<ul> <li>'Above the scale': the requirements of the world in which the system sits</li> <li>'At the scale': the Architecture between the elements of the system</li> <li>'Below the scale': the design insides of the elements of the system</li> </ul> </li> </ul> <p>Architecture vs Design</p> <p>Architecture: Creating the structure Design: Detailing the Content</p>"},{"location":"architect/architectural_thinking/#perspectives-to-be-consider","title":"Perspectives to be consider","text":"<ul> <li>Solution blueprint(\u67b6\u6784\u56fe) that can be reviewed and validated<ul> <li>show different level of blueprint to different stakeholders</li> </ul> </li> <li>Communication tool for stakeholders and teams (business, IT delivery and BAU - IT Operations), future reference for maintenance and change, developing neighbouring systems and integration</li> <li>Delivery Environments: Input into the delivery environments' design and specification, tools and platforms of choice for solution delivery</li> <li>Delivery Planning: Starting point for developing the project plan (Traditional delivery), solution and feature backlog (Agile delivery), resource requirements and team structure</li> <li>Estimates: Starting point for cost estimation (labour, licences, platform costs, etc)</li> <li>Enable parallel development: by understanding how inter-component dependencies can and should be managed</li> <li>Foundation for commercial agreements (i.e. \"This is what you get for the price we have agreed on'\")</li> <li>Foundation for DOU and segregation of responsibilities between various parties - e.g. Client and Solution Provider, Solution Provider and Partner(s)/Subcontractors) (e.g. RACI matrices)</li> </ul> <p>Architecture guidance includes</p> <ul> <li>Good things<ul> <li>Tried and tested parts</li> <li>Tried and tested structures of parts (reference architectures)</li> </ul> </li> <li>Good ways of doing things<ul> <li>Principles and patterns that help ensure the architecture is created in a good</li> </ul> </li> </ul>"},{"location":"architect/architectural_thinking/#why-is-architect-important","title":"Why is Architect important?","text":"<ul> <li>ppl can validate it in advance</li> <li>for documentation purpose</li> <li>the whole team take it as guidance</li> </ul> <p>How detail should the Documentation be?</p> <p>Take 80:20 Principle, try to document the things with high priorities:</p> <ul> <li>things that cover 80% requirements</li> <li>critical ones ...</li> </ul>"},{"location":"architect/architectural_thinking/#architecture-types","title":"Architecture Types","text":"<p>As Architect, you need to be standing in different areas. </p> <ul> <li>Business Architecture(BA): understands the business intention and motivation</li> <li>IT Architecture(ITA): do ITA, at SA level. Includes the following perspectives:<ul> <li>Application level</li> <li>Technical level</li> <li>Physical perspective</li> <li>Logical perspective</li> <li>Functional aspect</li> <li>Operational aspect</li> </ul> </li> <li>Enterprise Architecture(EA): enterprise level, across BA and ITA, also offer guidance at SA level</li> <li>Solution Architect(SA): create solutions to business problems(BA), typically within ITA</li> </ul> <p></p>"},{"location":"architect/architectural_thinking/#architect-aspects","title":"Architect Aspects","text":"<p>Architect takes Technology, Process and People into consideration and asks questions from different aspects</p>"},{"location":"architect/architectural_thinking/#architect-work","title":"Architect Work","text":"At the front At the back - Listening to clients - Understanding business requirements - Negotiating feasible requirements and scope - Forming detailed definitions of solution structures - During construction - Serving as a customer advocate - Guiding the team  <p>IT Architect vs IT Specialist</p> <ul> <li>IT Architect: more high level, needs to understand the Business Problem</li> <li>IT Specialist: received detailed Task from IT Architect, is able to focus on its own speciality(e.g. DevOps)</li> </ul>"},{"location":"architect/architectural_thinking/#3-requirements","title":"3. Requirements","text":"<p>why requirements are important?</p> <ul> <li>only 39% projects are successful</li> <li>among the failed projects, 37% are mainly caused by inaccurate requirements</li> <li>15%-20% Software development fee are wasted due to bad requirement </li> </ul> <p>The requirements need to be SMART:</p> <ul> <li>Specific: Unambiguous, consistent, and at the appropriate level of detail</li> <li>Measurable: Possible to verify that a requirement has been met, so include success criteria</li> <li>Attainable: Technically feasible and within the art of the possible</li> <li>Realizable: Realistic given all the constraints (e.g., resources, skills, time, infrastructure)</li> <li>Traceable: Linked from conception through specification, design, implementation, and test</li> </ul> <p>As a group, requirements have to be non-conflicting and prioritzed.</p> <p>what makes a good requirement</p> <ol> <li>a complete sentence</li> <li>avoid abbreviation unless defined</li> <li>consistent in verbs: will/shall/must=mandatory, should/might=optional, could/would=desirable</li> <li>must contain the success criteria and be measurable and testable.</li> <li>has a unique reference ID</li> <li>Refer to supporting material without duplication</li> <li>avoid ambiguity, rambling and inrealistic thinking (e.g.: 100% up-time)</li> </ol> <p>Warning</p> <ul> <li>Requirements must be prioritized</li> <li>Requirements should be able to traced - to answer how far did it go?</li> </ul>"},{"location":"architect/architectural_thinking/#stakeholders","title":"Stakeholders","text":"<p>Definition: A stakeholder in a solution architecture is someone with interest in or concerns about the realization of the architecture. </p>"},{"location":"architect/architectural_thinking/#tool-system-context-diagram","title":"Tool - System Context Diagram","text":"<p>The System Context Diagram</p> <ul> <li>it carifies the environment on which the system operates</li> <li>captures boundary of the system</li> <li>identifies the external interfaces</li> <li>clarifies the personal that will use the system</li> <li>define use cases &amp; data flows</li> </ul> <p>Example</p> <p>The Diagram doesn't have a fixed form, but it has some conventions, you must have:</p> <ul> <li>the personal</li> <li>the System under Construction - the one you are gonna build</li> <li>set of external systems that you will integrate with</li> </ul> <p></p> <p>Note</p> <p>One can use System Context Diagram to analyse an existing system too.</p>"},{"location":"architect/architectural_thinking/#requirement-types","title":"Requirement Types","text":"<p>There are usually LOOOOTS OF requirements, we start with categorizing them into the following 4 types:</p> <ol> <li>Functional Requirements (FRs): capabilities need to be delivered, answer the question \"What does user need?\"<ul> <li>Example: User is able to login</li> </ul> </li> <li>Non-Functional Requirements (NFRs): expectations and chracteristics the the IT system should have<ul> <li>Example of runtime expectations: performance, availability</li> <li>Example of non-runtime expectations: scalability, maintainability</li> </ul> </li> <li>Constraints: immutable<ul> <li>Example: existing environments, available skills, budget, oprational limitations</li> </ul> </li> <li>Future Requirements: how system might change in the future, could be functional or non-functional<ul> <li>Example: legislation</li> </ul> </li> </ol>"},{"location":"architect/architectural_thinking/#1-functional-requirements-frs","title":"1. Functional Requirements (FRs)","text":"<p>Functional requirements describe what the system will do from a number of perspectives. In the Agile world, the Functional requirements are hidden behind those concepts: Epics, User Stories</p> <p>activities</p> Activities from Business perspective: Activities from User perspective: - Business Process Model - Use Case Model - Use Case Specification: e.g. The user supplies the address and phone number - Design Thinking Methodology <p>Use Cases vs User Stories</p> <p>User Stories are a way to describe requirements. Use Cases can be used as a way to detail the User Stories.</p>"},{"location":"architect/architectural_thinking/#2-nonfunctional-requirements-nfrs","title":"2. Nonfunctional Requirements (NFRs)","text":"<p>Non-Functional Requirements (NFRs) define \u201chow good\u201d the solution should be.</p> <p>NFR Types</p> <ol> <li>Runtime NFRs - value to the user<ul> <li>Performance</li> <li>Volumetrics</li> <li>Security</li> <li>Usability</li> <li>Availability</li> <li>Manageability</li> </ul> </li> <li>Non-runtime NFRs - value to the operator<ul> <li>Can it scale?</li> <li>Is it compliant?</li> <li>Can it be maintained?</li> <li>Can it be managed?</li> <li>Is it environmentally sound?</li> <li>Is it portable?</li> <li>Is it reliable?</li> </ul> </li> </ol> <p>Runtime NFR - Performance</p> <p>You need to find a balance between:</p> <ul> <li>Cost &amp; Effort</li> <li>How accurate it needs to be </li> </ul> <p>Runtime NFR - Availability</p> <p>Important concepts for Availability: </p> <ul> <li>High Availability (HA): System is always available whenever it\u2019s expected to be.</li> <li>Continuous operations (CO): System is intended to be available all the time, no scheduled outages</li> <li>Continuous availability (= HA + CO): System is always available all the time.</li> </ul> <p>Important metrics for Availability: </p> <ul> <li>Mean time to repair (MTTR): The average time something is \u201cdown\u201d (\u201c1\u201d)</li> <li>Mean time to failure (MTTF) \u2013 The average time something is \u201cup\u201d (\u201c99\u201d)</li> <li>Mean time between failures (MTBF) \u2013 The average time between \u201cgoing down\u201d (\u201c100\u201d)</li> </ul> <p>To measure the \"unavailability\", we use percentage to describe the Uptime. However, ONLY using percentage is a BAD IDEA:</p> <ul> <li>99 days \u201cup,\u201d 1 day \u201cdown\u201d</li> <li>99 hours \u201cup,\u201d 1 hour \u201cdown\u201d</li> <li>99 seconds \u201cup,\u201d 1 second \u201cdown\u201d --&gt; almost no time for MTTR, which is impossible!</li> </ul> <p>\u26a0\ufe0f Consider both Percentage and Context</p> <p>Runtime NFR - Security</p> <p>The ability to protect an IT system against malicious use while at the same time allowing legitimate use. It has the following categories:</p> <ul> <li>Authentication</li> <li>Authorization</li> <li>Integrity: immutability of data</li> <li>Confidentiality</li> <li>Non-repudiation: certified sender</li> </ul> <p>Non-runtime NFR - Scalability</p> <p>A system\u2019s ability to increase (or decrease) in size according to changing workloads, such as an increase in user numbers. There are 2 approaches:</p> <ul> <li>Vertical scaling (\u201cscaling up\u201d)</li> <li>Horizontal scaling (\u201cscaling out\u201d): Spreading the load across more machines</li> </ul>"},{"location":"architect/architectural_thinking/#3-constraints","title":"3. Constraints","text":"<p>Constraints are limitations imposed upon a solution. What we CANNOT change. Examples:</p> <ul> <li>Regulatory</li> <li>Organizational</li> <li>Geographic</li> <li>Risk taking willingness</li> <li>Project: time, resource, scope</li> <li>Development skills</li> <li>Existing infrastructure: hard- and software</li> <li>Technology leadership</li> <li>IT architectural standards</li> </ul>"},{"location":"architect/architectural_thinking/#4-future-requirements","title":"4. Future Requirements","text":"<p>Describe how the system might change in the future, whether these are functional or nonfunctional enhancements. Aspects:</p> <ul> <li>New and modified business processes and goals</li> <li>Adaptation of the system to new technologies</li> <li>Changes in the profiles of the average user</li> <li>Changes in the integration needs with other systems</li> </ul>"},{"location":"architect/architectural_thinking/#managing-requirements","title":"Managing Requirements","text":"<p>Determine significant requirements that most likely affect the architecture. considering aspects:</p> <ul> <li>Early pre-project sizing?</li> <li>Proposal development?</li> <li>Outline solution architecture?</li> <li>Focused functional or operational design?</li> </ul>"},{"location":"architect/architectural_thinking/#changes","title":"Changes","text":"<p>Requirements are dynamic and require careful management throughout a project\u2019s life cycle</p> <p>How to manage the changes?</p> <ul> <li>Iterative documentation</li> <li>well-defined change mgmg procedure - V model</li> <li>Ongoing evaluation</li> </ul> <p>Activity - Joint Application Design (JAD)</p> <p>JAD is similar to brainstorming sessions, can be short or long (several days). Results:</p> <ul> <li>Service portfolio candidates</li> <li>User \u201cstories\u201d</li> <li>Use cases</li> <li>Assumptions</li> </ul>"},{"location":"architect/architectural_thinking/#4-architectural-decisions-and-principles","title":"4. Architectural Decisions and Principles","text":""},{"location":"architect/architectural_thinking/#documenting-the-decision","title":"Documenting the Decision","text":"<p>Architectural decisions should be formally documented, each decision should include the following elements:</p> <p>Example</p> <p>2.2 AD02: Choice of Integration</p> An unique identifier AD02 Design decision how to integrate into the exisiting systems? Issue/problem there are existing systems... Assumption with a interface Alternatives (1) FIle trasfer  (2) Messaging Decision Alternative (2) is better Justification together with the client I made the decision, because (2) Messaging provides reliable, asynchronous program-to-program communication Implications an integration server node will be required Parties Agreeing to the  Decision Person 1 (Representing the solution architecture team) Person 2 (representing the client) <p>Difference</p> Architectural Decisions Architectural Principles are made within the context of the development of the solution\u2019s architecture. are imposed from outside the context of the solution architecture; they are often part of the enterprise\u2019s Enterprise Architecture. <p>other concepts</p> <p>| Policy | Lets protect the data| | Principle| use SSO to protect the data.  Define Principle with <code>Name</code>, <code>Statement</code>, <code>Motivation</code> and <code>Implication</code> | | Guideline| ...|</p>"},{"location":"architect/architectural_thinking/#best-practise","title":"Best Practise","text":"<p>How to get a good architectural decision? There are 11 Solution Patterns that you can follow:</p>"},{"location":"architect/architectural_thinking/#value-proposition","title":"Value Proposition","text":""},{"location":"architect/architectural_thinking/#1-check-value-proposition","title":"1. Check Value Proposition","text":"<ul> <li>Confirming the customer wants and needs</li> <li>Identify your differentiators of your Design</li> </ul>"},{"location":"architect/architectural_thinking/#simplification","title":"Simplification","text":""},{"location":"architect/architectural_thinking/#2-simplify-the-architecture","title":"2. Simplify the Architecture","text":"<p>Simplify complex architectures and excessive infrastructure layers.</p>"},{"location":"architect/architectural_thinking/#3-breakthrough-the-design","title":"3. Breakthrough the Design","text":""},{"location":"architect/architectural_thinking/#4-integrate-the-facilities","title":"4 Integrate the Facilities","text":""},{"location":"architect/architectural_thinking/#5-rightshape-the-platforms-processors","title":"5 Rightshape the Platforms &amp; Processors","text":"<p>Dont sale Cloud just because you want to sale it, the Client's Requirements have the highest priority.</p>"},{"location":"architect/architectural_thinking/#assets","title":"Assets","text":""},{"location":"architect/architectural_thinking/#6-re-use-existing-assets","title":"6 Re-use Existing Assets","text":""},{"location":"architect/architectural_thinking/#7-recycle-existing-code","title":"7 Recycle Existing Code","text":""},{"location":"architect/architectural_thinking/#8-apply-frameworks-skeletons","title":"8 Apply Frameworks / Skeletons","text":""},{"location":"architect/architectural_thinking/#delievery","title":"Delievery","text":""},{"location":"architect/architectural_thinking/#9-optimize-the-application-development-environment","title":"9 Optimize the Application Development environment","text":""},{"location":"architect/architectural_thinking/#10-optimize-the-delivery-model","title":"10 Optimize the Delivery Model","text":""},{"location":"architect/architectural_thinking/#11-rationalize-swhw-license-lifecycle","title":"11. Rationalize SW/HW License Lifecycle","text":""},{"location":"architect/architectural_thinking/#5-architecture-overview","title":"5. Architecture Overview","text":"<p>The Architecture Overview Diagram is a part of Architecture Overview. The goals:</p> <ul> <li>to communicate a conceptual understanding of the intended IT system with the stakeholders</li> <li>to explore and evaluate alternative architectural options</li> <li>to enable early recognition and validation of the implication</li> <li>to facilitate orientation for new people who join the project</li> </ul> <p>\u26a0\ufe0f Like a house floor plan!</p> <p>where does Architecture Overview sit?</p> <p>Requirements (NFRs + FRs) --&gt; Architecture Overview --&gt; Component Model + Operational Model</p>"},{"location":"architect/architectural_thinking/#best-practises","title":"Best Practises","text":"<ol> <li>For who are you drawing this Diagram for? Considering drawing different Diagrams for different stakeholders</li> <li>No information overflow</li> <li>Use the language of your client</li> <li>Use colors - but be consistent</li> </ol>"},{"location":"architect/architectural_thinking/#anti-patterns","title":"Anti-patterns","text":"<p>Bad things to avoid:</p> <ul> <li>Information overload</li> <li>Information underload</li> <li>too many acronyms -&gt; solution: to annotate them</li> <li>Providing more technical details than required for a business audience</li> </ul>"},{"location":"architect/architectural_thinking/#6-component-model","title":"6. Component Model","text":"<p>We use Component Model to describe theh Functional Aspect of a IT Achitecture.</p> <p>why Model?</p> <ul> <li>Models break down complex system to smaller parts - the Components</li> <li>components, that have well understood functional responsibilities.</li> <li>Models visualize the system</li> </ul> <p>Component Model is a formal representation of:</p> <ul> <li>the internal Structure of the solution - shows the relationships between the component</li> <li>a next step from the System Context Diagram that aligns with the Black Box engineering principle to the White Box principle</li> <li>provides the necessary input for the Operational model:<ul> <li>where run the component</li> <li>where should the component's data be</li> <li>Where should the component be installed?</li> <li>How will the components communicate with each other?</li> </ul> </li> </ul>"},{"location":"architect/architectural_thinking/#61-functional-aspect-modeling","title":"6.1 Functional Aspect Modeling","text":"<p>The Functional Aspect of an IT system has various Modelling Types:</p> <ul> <li>Component(service) modeling: functionalities</li> <li>Data modelling: data that make the functionality works</li> </ul>"},{"location":"architect/architectural_thinking/#why-component-model","title":"Why Component Model","text":"<p>we use Component Model as input for the following:</p> In application development In the operational aspect In operations - Work allocation - Version control - Design strategy - Reuse - Testing - Project management - Product or Package selection - The things that have to be deployed - Systems management and so on"},{"location":"architect/architectural_thinking/#component","title":"Component","text":"<p>A Component is a modular unit of functionality. It makes its functionality and state available through one or more interfaces. </p> <p>A Component is not just a programming-level concept such as an Oracle\uf0e2 EJB or .NET component. It can be at different Levels: - At Application Level: a component can be Account Manager component - At the technical level, a component can be security service</p> <p>Black Box engineering principle</p> <p>Using a Black Box engineering principle, we focus on what the components\u2019 interfaces (or APIs) offer - rather than how the requested function is realized</p> <p>Components &amp; Services</p> <p>Components and Services are interrelated:</p> <ul> <li>Components offer and request Services via their Service Interfaces or APIs</li> <li>Services are satisfied by Components, which, if necessary, request Services from other Components.</li> </ul> <p></p>"},{"location":"architect/architectural_thinking/#step-by-step-how-to-create-a-component","title":"Step-by-step: how to create a Component?","text":"<p>1. Component identification: </p> <ul> <li>Partition the system into subsystems and components</li> <li>Use a reference architecture</li> <li>Ensure the components are: <ol> <li>Highly cohesive: high dependencies within a component</li> <li>Loosely coupled: low dependencies between components</li> <li>Well isolated: high isolation of prodcut/technology dependencies</li> <li>Of the right granularity: suitable functionality amount assigned to a component, not too many, not too little</li> <li>Layered according to their generality --&gt; Layering provides a logical partitioning of components into a number of sets or layers.</li> </ol> </li> </ul> <p>Doc: Software Architecture Documentation in Practice: Documenting Architectural Layers</p> <p>2. Component specification:  For each interface, specifying:</p> <ul> <li>their operations = parameters passed</li> <li>their signatures = return values</li> <li>contract of behavior</li> <li>pre-/post-conditions</li> </ul> <p>Approaches: use Use Case Model or Data Model</p> <p>3. Component implementation:  implementation approach.</p> <ul> <li>For commercial-off-the-shelf (COTS) products: map the specified-level components to the appropriate products or packages.</li> <li>For components to be built, identify the approach to implementation by defining the physical-level components. </li> </ul> <p>During component implementation, the logical-level model is transformed into 1 or more physical-level model. The transformation involves:     - Selecting products and packages     - Identifying frameworks and patterns     - Deciding what components have to be developed     - Making choices about what technology should be used to realize the components</p> <p>Note</p> <p>[logical-level model] -&gt; Technology Selection -&gt; [Physical Level Model] -&gt; Development -&gt; Code</p> <p>Enterprise Architectures Guideline</p> <p>Reuse &gt; Customise &gt; Buy &gt; Build</p> <p></p> <p>Info</p> <p>Components may be Grouped into Subsystems</p>"},{"location":"architect/architectural_thinking/#notation","title":"Notation","text":"<p>Unified Modeling Language (UML) is one of the notations used. There are 2 types of UML:</p> <ol> <li>[STATIC] Structural Diagram: on the system\u2019s internal structure</li> <li>[DYNAMIC] Behavior Diagram: as well as, its behavior</li> </ol> <p></p>"},{"location":"architect/architectural_thinking/#component-classification","title":"Component Classification","text":"<p>Application vs Technical:</p> <ul> <li>Application Components implement a specific business function, e.g. <code>Payment Component</code></li> <li>Technical Components are NOT associated with a specific business function. They play a technical role that supports realization, e.g. <code>Hypervisor</code> or <code>Web Server</code></li> </ul> <p>Logical vs Physical:</p> <ul> <li>Logical: focuses on the functional responsibility and purpose of the of the solution components without being concerned of their implementation</li> <li>Physical: Represents actual concrete software or hardware technology, a product/package used for component implementation. These are decision usually made during the Component Implementation stage</li> </ul>"},{"location":"architect/architectural_thinking/#62-operational-aspect-modeling","title":"6.2 Operational Aspect Modeling","text":"<p>Functional vs Operational</p> Functional Operational Content: - the structure of components (of all kinds) related to actual functionality - their dynamic behavior (collaboration) - their interfaces - Embodied in the Component Model work product - what runs where (component placement) - includes the network topology (hardware nodes, locations, etc.), - ensures the achievement of the solution's service level characteristics (performance, availability), - describes the management and operation of the IT system. - Embodied in the Operational Model work product <p>\ud83c\udfd4\ufe0f The design of Operational Aspect might be challenging, because:</p> <ul> <li>Many competing concerns:<ul> <li>NFR's: for example, performance, availability, manageability, security</li> <li>Constraints: for example, affordability, standards compliance, existing infrastructure</li> </ul> </li> <li>Many coordinating activities:<ul> <li>Detailed design: capacity planning, software and data distribution, network, hardware, service management</li> <li>Commercial: planning, pricing, procurement, service level agreement</li> </ul> </li> </ul>"},{"location":"architect/architectural_thinking/#step-by-step","title":"Step-by-step","text":"<p>to create Operational Aspect Modeling, we can follow these steps:</p> <ol> <li>Understand NFRs</li> <li>Conceptualize from an application perspective - Application Logical Operational Model (ALOM)<ul> <li>identify application level nodes and their placement</li> </ul> </li> <li>Conceptualize the Logical Operational Model (LOM)<ul> <li>determine the logical application \u53ea\u662f\u903b\u8f91\u7ec4\u4ef6 components </li> </ul> </li> <li>Transform into the Physical Operational Model (POM) <ul> <li>determine the technologies \u771f\u6b63\u7684\u6280\u672f\u9009\u62e9</li> </ul> </li> </ol>"},{"location":"architect/architectural_thinking/#3-lom","title":"3. LOM","text":"<ul> <li>Step 1: The overall structure of the LOM is largely based on the locations over which the solution will be deployed.</li> <li>Step 2: Then identify Candidate Logical Nodes</li> <li>Step 3: We have to understand what it is we need to deploy, via the DEPLOYMENT UNIT Model</li> <li>Step 4: Operational Modeling helps ensure the system\u2019s non-functional requirements are delivered, within all constraints\u2026</li> </ul>"},{"location":"architect/architectural_thinking/#4-transform-lom-into-pom","title":"4. Transform LOM into POM","text":"<p>(1) Identifying your role in the product selection process and the definition of the selection criteria (2) Performing the necessary product selections for the nodes and connections (3) Defining the solution details and describing how technologies will be put together to deliver the specific SLAs (4) Rationalizing the solution architecture to get to a sized POM</p> <p>what is captured in a POM?</p> <ul> <li>Physical Nodes: <ul> <li>Hardware: processor speed, memory, disk configuration</li> <li>Software: WebSphere Application</li> </ul> </li> <li>Physical Connections: Physical networks protocols, network bandwidth, latency</li> <li>Cloud Services:<ul> <li>Deployment Model: Public, Private(Managed or Hosted), Hybrid</li> <li>Services Model: <ul> <li><code>IaaS</code>: provides raw infra</li> <li><code>PaaS</code>: provides a container/runtime env</li> <li><code>SaaS</code>: provides application functionality</li> <li><code>BPaaS</code>: provides Business Process to automate runtime</li> </ul> </li> </ul> </li> </ul> <p>Best Practise</p> <p>Its easier to first design Unsized POM, then a Sized POM with quantitative details</p>"},{"location":"architect/architectural_thinking/#elements","title":"Elements","text":"<p>Elements in Operational Modeling</p> <p>Deployed System includes:</p> <ul> <li>Location/Border</li> <li>Node: in the Location</li> <li>Deployment Unit: Deployment Units represent all the bits required to bring an application component to life within the operational model</li> <li>Connection: between Nodes</li> <li>Zones</li> </ul> <p>OM also documents:</p> <ul> <li>The overall physical configuration </li> <li>Sizing and other hardware specifications </li> </ul>"},{"location":"architect/architectural_thinking/#notations","title":"Notations","text":"Notation Naming Example === ACTORS &amp; INFRAS === Location <code>LL_xxx</code> <code>LL_Office</code>, <code>LL_Cloud_0</code> Node <code>LN_xxx</code> <code>LN_Apple Laptop</code> Human Actor  System Actor <code>A_xxx</code> <code>A_Staff</code><code>A_Respondent PC</code> === CLOUD === Offering <code>On-premises</code><code>IaaS</code> <code>SaaSM</code> Software Managed<code>SaaSH Hosted</code><code>External/Web Resource</code> Support <code>SS</code>: Standard Service Level Agreement(s) <code>CS</code>: Custom Service Level Agreement(s) Data <code>_xxx</code> <code>E</code>: Encrypted<code>NE</code>: Non-Encrypted<code>AU</code>: Audited<code>AR</code>: Archiving Required === DEPLOYMENT UNITS (DU) === Presentation <code>U_xxx</code> <code>U_CRM</code>: a CRM interface Execution <code>E_xxx</code> <code>E_Update_CRM_ Data</code>, <code>E_Consult_CRM_ Data</code> Installation <code>I_xxx</code> `` Data <code>D_xxx</code> <code>D_CRM_Data</code> Technical <code>T_xxx</code> ``"},{"location":"architect/architectural_thinking/#7-validation-viability","title":"7. Validation &amp; Viability","text":"<p>motivatin</p> <p>to ensure the designed architecture:</p> <ul> <li>can be implemented and delivered - Validation</li> <li>satisfies the FR and NRFs - Viablity</li> </ul> <p>\u26a0\ufe0f The earlier the better &amp; cheaper &amp; easier!</p> <p>Common Causes of Troubled Projects</p> Project Design Project Delivery - Fixed price for combined phases - Vague or misunderstood completion criteria - Customer responsibilities not clearly identified and documented - Assumptions not clearly identified and documented - Concessions during negotiations - Pricing concessions, \u201clow-balling\u201d - Poorly written proposals or SOWs - Inaccurate project estimates - Not performing QA reviews - Lack of transition, marketing to delivery - Project skills deficiencies - Lack of, or inadequate, project mgmt - Not performing QA reviews and action plans - Lack of line mgmt oversight and support - Not implementing or exercising change control - Starting a phase before completing the preceding phase - Unplanned turnover of key project team members"},{"location":"architect/architectural_thinking/#validation-assessment","title":"Validation Assessment","text":"<p>to ensure that the proposed solution is acceptable to the various stakeholders - use Requirements Traceability and Verification Matrix (RTVM). --&gt; RTVM is used throughout the whole project, not just at the end.</p> <p>RTVM</p> <ul> <li>ensure the completeness of FR and NFR</li> <li>Provides the basis for test</li> <li>Provides a framework for risk </li> <li>Provides the basis of clear and timely client communication with regard to schedule, risk, and financial impacts</li> </ul>"},{"location":"architect/architectural_thinking/#viability-assessment","title":"Viability Assessment","text":"<ul> <li>assess: as-is to to-be</li> <li>confirm the solution is operable and maintainable</li> <li>context of the architecture are the key NFs &amp; NFRs</li> <li>enough resource to impolement the solution:<ul> <li>team availability</li> <li>infrastructure</li> </ul> </li> <li>identify the risks</li> </ul>"},{"location":"architect/architectural_thinking/#approach-cvm","title":"Approach - CVM","text":"<p>Client Value Method (CVM):</p> <ol> <li>UNDERSTAND the client\u2019s business and needs  </li> <li>EXPLORE options and approach  </li> <li>DEVELOP and agree to client solution  </li> <li>IMPLEMENT client solution  </li> <li>CONFIRM client value and experience </li> </ol> <p>Three Quality Checkpoints</p> <p>TDA and ITR (for complex, cross-LOB, and/or cross-IOT deals) are quality checkpoints:</p> <ol> <li>Technical and Delivery Assessment (TDA)</li> <li>Integrated Technical Review (ITR)</li> <li>Proposal Baseline Assessment (PBA)</li> </ol> <p>RAID</p> <p>Risks, Assumptions, Issues, and Dependencies (RAID) should also be addressed</p>"},{"location":"architect/architectural_thinking/#8-agile","title":"8. Agile","text":""},{"location":"architect/architectural_thinking/#concepts","title":"Concepts","text":"<p>Key roles:</p> <p>\u25aa Product owner: voice of customers \u25aa Delivery team: multidisciplinary, self-organising, three to 9 members \u25aa Scrum master \u2013 facilitator and roadblock remover</p> <p>Workflow</p> <p>\u25aa Sprint\u2013 Time-boxed unit of development \u2013 one week to one month \u25aa Sprint planning \u2013 scrum team discuss and agree on the scope of work \u25aa Daily scrum (or stand-up) \u2013 What was done yesterday / plan for today / any roadblocks \u25aa Sprint review\u2013 playback to stakeholders \u25aa Sprint retrospective \u2013 reflection / lessons learnt / improvement plan</p> <p>Artefacts</p> <p>\u25aa Product backlog \u2013 ordered list of requirements in form of user stories, use cases or any other form the team decides to be useful \u25aa Sprint Backlog - list of work the development team must address during the next sprint \u25aa Scrum Board \u2013 means of tracking sprint status \u25aa Product Increment \u2013 potentially releasable increment is the sum of all the product backlog items completed during a sprint, integrated with the work of all previous sprints.</p>"},{"location":"architect/architectural_thinking/#scaling","title":"Scaling","text":"<p>Challenges of scaling up Agile from MVP towards an Agile enterprise?</p> <ul> <li>Team size: Under 10 developers -&gt; 1000\u2019s of developers</li> <li>Geographical distribution: Co-located -&gt; Global</li> <li>Enterprise discipline: Project focus -&gt; Enterprise focus</li> <li>Organisational complexity: Flexible -&gt; Rigid</li> <li>Compliance requirement: Low risk -&gt; Critical,Audited</li> <li>Domain Complexity: Straight-forward -&gt; Intricate/Emerging</li> <li>Organisation distribution (outsourcing, partnerships): Collaborative -&gt; Contractual</li> <li>Technical complexity: Homogenous -&gt; Heterogeneous, Legacy</li> </ul> <p>Solution: SAFe\u00ae 4.6 for Lean Enterprises</p>"},{"location":"architect/architectural_thinking/#architecture-in-agile","title":"Architecture in Agile","text":"<p>Architecture in Agile is benefitial to the project. Create \u201cfit for purpose\u201d architecture - avoid gold plating --&gt; Initial Architecture</p> <p>Intentional Architecture</p> <p>Intentional Architecture involves creating a deliberate, strategic blueprint for a system's structure and components to guide development from the start.</p> <p>Emerging Design</p> <p>Emerging Design is an iterative approach where a system's design evolves over time through continuous refactoring and adaptation to changing requirements</p>"},{"location":"architect/architectural_thinking/#initial-architecture","title":"Initial Architecture","text":"<p>\u25aa Identify high-level scope \u25aa Identify initial requirements \u25aa Identify and architecture vision</p> <p>Activities:</p> <ol> <li>Design Thinking / Scoping Workshops: 2-3 days     1.1 Initial Requirements: Capture key non-functional requirements: Capacity, Performance, Reliability &amp; Recovery, Security     1.2 Architecture-on-a-page with annotations         - (main) users         - components         - Integration         - Detail: logical and/or physical boundary</li> <li>Project Initiation / Feasibility / Sprint 0: 1 \u2013 2 weeks<ul> <li>Initial Architecture: <ul> <li>Component Model</li> <li>Environments</li> <li>Redundancy</li> <li>Connectivity</li> <li>Security Architecture: key steps for authentication and identity</li> </ul> </li> </ul> </li> </ol>"},{"location":"architect/architectural_thinking/#how-agile-impact-architect","title":"how Agile impact Architect","text":"<p>Architecture Styles based on Microservices and APIs lead to development, deployment and operations:</p> <ol> <li>development agility: Decentralized Ownership</li> <li>deployment agility: Fine grained deployment: better agility &amp; scalability &amp; resilience</li> <li>operational agility: Cloud native infrastructure<ul> <li>Elastic scalability: horizontally or vertically</li> <li>Disposable and re-creatable</li> <li>Starts and stops in seconds</li> <li>Minimal Interdependencies</li> <li>Infrastructure as Code</li> </ul> </li> </ol> <p>Service Mesh (in Microservices application)</p> <p>A Service Mesh is an infrastructure layer in microservices applications that manages service-to-service communication, providing features like load balancing, service discovery, traffic management, security (e.g., mTLS), observability, and resilience (e.g., retries, circuit breaking) without requiring changes to the application code.</p> <p>Service Granularity: monoliths &lt;--&gt; nano-services</p> <p>Its important to find the proper Granularity, not too mono, not too modular!!</p>"},{"location":"architect/architectural_thinking/#agile-devops","title":"Agile &amp; DevOps","text":"<p>DevOps is the practice, culture of Development and Operations engineers participating together in the entire service lifecycle, from design through the development process to production support.</p>"},{"location":"architect/architectural_thinking/#deployment-pipeline","title":"Deployment pipeline","text":"<p>Continuous delivery is enabled through the deployment pipeline that provides:</p> <ul> <li>Visibility</li> <li>Feedback</li> <li>Continually deploy</li> </ul>"},{"location":"architect/architectural_thinking/#devops-tools","title":"DevOps tools","text":"<p>Main categories of DevOps tools:</p> <ol> <li>Version control</li> <li>Build and deploy</li> <li>Functional and non-functional testing</li> <li>Platform provisioning and change management</li> </ol> <p>Selecting DevOps tools is hard\u2026</p> <p>How to choose? - tools that can be used by broad user types - tools with APIs - those can start small - Encourage learning: hold learning sessions among peers - Avoid special 'singleton' tools \u2013 for example avoid \u201cproduction only\u201d tool due to high licencing costs</p>"},{"location":"architect/aws/cp/","title":"Cloud Practitioner","text":""},{"location":"architect/aws/cp/#cloud-practitioner-clf-c02","title":"Cloud Practitioner (CLF-C02)","text":"<p>AWS Certification Page Stephane Maarek (15h)</p> <ul> <li>covers 40/200+ AWS services</li> <li>hands-on labs</li> </ul>"},{"location":"architect/aws/saa/","title":"Solution Architect Associate","text":""},{"location":"architect/aws/saa/#solutions-architect-associate-saa","title":"Solutions Architect - Associate (SAA)","text":"<ul> <li>AWS Certification Page</li> <li>Udemy course (27.5h)</li> <li>Udemy 6 practice Exams</li> </ul>"},{"location":"architect/aws/sap/","title":"Solution Architect Professional","text":""},{"location":"architect/aws/sap/#solutions-architect-professional-sap","title":"Solutions Architect - Professional (SAP)","text":""},{"location":"architect/bpmn/","title":"Index","text":""},{"location":"architect/bpmn/#bpmn","title":"BPMN","text":"<p>Person is an Actor</p> <p>https://www.lucidchart.com/pages/uml-sequence-diagram#:~:text=A%20sequence%20diagram%20is%20a,to%20document%20an%20existing%20process.</p> <p>Actors:  Objects:  Lifelines: vertical Messages: (Label) Return Message: Dash lines (Label) - from a Receiving-Obejct to Requesting-Object Alternative Frames: mutually exclusive options Activation Boxes: when &amp; how long an Object is performing a process</p>"},{"location":"architect/design_patterns/2_creational/","title":"2. Creational DP","text":""},{"location":"architect/design_patterns/2_creational/#factory-method","title":"Factory Method","text":""},{"location":"architect/design_patterns/2_creational/#abstract-factory","title":"Abstract Factory","text":""},{"location":"architect/design_patterns/2_creational/#builder","title":"Builder","text":""},{"location":"architect/design_patterns/2_creational/#prototype","title":"Prototype","text":""},{"location":"architect/design_patterns/2_creational/#singleton","title":"Singleton","text":""},{"location":"architect/design_patterns/3_structural/","title":"3. Structural DP","text":""},{"location":"architect/design_patterns/3_structural/#adapter","title":"Adapter","text":""},{"location":"architect/design_patterns/3_structural/#bridge","title":"Bridge","text":""},{"location":"architect/design_patterns/3_structural/#composite","title":"Composite","text":""},{"location":"architect/design_patterns/3_structural/#decorator","title":"Decorator","text":""},{"location":"architect/design_patterns/3_structural/#facade","title":"Facade","text":""},{"location":"architect/design_patterns/3_structural/#flyweight","title":"Flyweight","text":""},{"location":"architect/design_patterns/3_structural/#proxy","title":"Proxy","text":""},{"location":"architect/design_patterns/4_behavioral/","title":"4. Behavioral DP","text":""},{"location":"architect/design_patterns/4_behavioral/#chain-of-responsibility","title":"Chain of Responsibility","text":""},{"location":"architect/design_patterns/4_behavioral/#command","title":"Command","text":""},{"location":"architect/design_patterns/4_behavioral/#iterator","title":"Iterator","text":""},{"location":"architect/design_patterns/4_behavioral/#mediator","title":"Mediator","text":""},{"location":"architect/design_patterns/4_behavioral/#memento","title":"Memento","text":""},{"location":"architect/design_patterns/4_behavioral/#observer","title":"Observer","text":""},{"location":"architect/design_patterns/4_behavioral/#state","title":"State","text":""},{"location":"architect/design_patterns/4_behavioral/#strategy","title":"Strategy","text":""},{"location":"architect/design_patterns/4_behavioral/#template-method","title":"Template Method","text":""},{"location":"architect/design_patterns/4_behavioral/#visitor","title":"Visitor","text":""},{"location":"architect/design_patterns/others/","title":"Others","text":""},{"location":"architect/design_patterns/others/#hub-and-spoke-architectual-pattern","title":"hub-and-spoke Architectual Pattern","text":"<p>\u201cHub-and-Spoke \u67b6\u6784\u6a21\u5f0f\u201d\u662f\u4e00\u79cd\u5e38\u7528\u4e8e\u7f51\u7edc\u3001\u4e91\u57fa\u7840\u67b6\u6784\u548c\u7cfb\u7edf\u96c6\u6210\u4e2d\u7684\u67b6\u6784\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5b83\u6a21\u4eff\u4e86 \u8f6e\u6bc2\u548c\u8f90\u6761\uff08hub-and-spoke\uff09\u7684\u7ed3\u6784\uff1a</p> <p>\u4e00\u4e2a\u4e2d\u5fc3\u8282\u70b9\uff08Hub\uff09\u8fde\u63a5\u591a\u4e2a\u5916\u56f4\u8282\u70b9\uff08Spokes\uff09\uff0c\u800c\u5916\u56f4\u8282\u70b9\u4e4b\u95f4\u901a\u5e38\u4e0d\u76f4\u63a5\u901a\u4fe1\u3002</p> <pre><code>           Spoke A\n              |\n              |\nSpoke B \u2014\u2014\u2014 Hub \u2014\u2014\u2014 Spoke C\n              |\n              |\n           Spoke D\n</code></pre> <ul> <li>Hub\uff08\u4e2d\u5fc3\uff09\uff1a\u8d1f\u8d23\u534f\u8c03\u3001\u7ba1\u7406\u3001\u8def\u7531\u6216\u63a7\u5236\u6574\u4e2a\u7cfb\u7edf\u3002</li> <li>Spokes\uff08\u8f90\u6761\uff09\uff1a\u5916\u56f4\u8282\u70b9\uff0c\u6267\u884c\u5177\u4f53\u7684\u529f\u80fd\u6216\u670d\u52a1\uff0c\u53ea\u4e0e Hub \u901a\u4fe1\u3002</li> </ul> <p>\ud83e\uddf0 2. \u5e94\u7528\u573a\u666f\u4e3e\u4f8b</p> \u573a\u666f \u63cf\u8ff0 \u7f51\u7edc\u62d3\u6251 \u4e91\u4e2d\u5e38\u89c1\u7684\u7f51\u7edc\u8bbe\u8ba1\uff1a\u4e2d\u5fc3\u865a\u62df\u7f51\u7edc\uff08Hub VNet/VPC\uff09\u8fde\u63a5\u591a\u4e2a\u5b50\u7f51\uff08Spokes\uff09 \u5fae\u670d\u52a1\u96c6\u6210 \u4f7f\u7528\u6d88\u606f\u603b\u7ebf\uff08Hub\uff09\u8fde\u63a5\u591a\u4e2a\u5fae\u670d\u52a1\uff08Spokes\uff09\uff0c\u5b9e\u73b0\u89e3\u8026 \u6570\u636e\u96c6\u6210 \u4e2d\u5fc3\u6570\u636e\u5e73\u53f0\u805a\u5408\u591a\u4e2a\u6765\u6e90\u7684\u6570\u636e \u591a\u79df\u6237\u4e91\u67b6\u6784 \u4e00\u4e2a\u4e2d\u592e\u7ba1\u7406\u5e73\u53f0\u4e3a\u591a\u4e2a\u79df\u6237\u63d0\u4f9b\u670d\u52a1\u652f\u6301"},{"location":"architect/gcp/1.preparation/","title":"1. Preparation","text":"<p>1/18</p> <p>Through an understanding of cloud architecture and Google technology, this individual designs, develops, and manages robust, secure, scalable, highly available, and dynamic solutions to drive business objectives.</p> <p>The Professional Cloud Architect should be proficient in all aspects of:</p> <ul> <li>enterprise cloud strategy</li> <li>solution design</li> <li>architectural best practices</li> <li>software dev methodologies, including distributed app that span multicloud or hybrid environments.</li> </ul> <p>associate VS professional</p> <p>The professional level certification expects the exam taker to know how to evaluate case studies and design solutions to meet business requirements\u2014in addition to knowing about technical requirements\u2014for customer implementation.</p> <p></p> <p>Docs: cloud.google.com/docs</p>"},{"location":"architect/gcp/1.preparation/#exam-guide","title":"Exam Guide","text":"<p>The exam guide for the Professional Cloud Architect Certification is divided into 6 sections that contain one or more objectives.</p> <p>Info</p> <ul> <li>the person who designs the course is not the same as the one who designs the exam!</li> <li>your exam might be different to everyone else\u2019s.</li> </ul> <p>TBC: https://partner.cloudskillsboost.google/paths/77/course_templates/78/video/517336</p>"},{"location":"architect/ibm/security/","title":"Security","text":""},{"location":"architect/ibm/security/#cloud-internet-service-cis","title":"Cloud Internet Service (CIS)","text":"<p>CIS protects web applications from internet-based attacks using Cloudflare's Global Points of Presence (PoP). Its NOT for:</p> <ul> <li>applicatinos connected through VPN</li> <li>applications connected through IBM Cloud's Direct Link service</li> </ul> <p>Three major capabilities:</p> <ol> <li>reliability: to boost the reliability, highly recommended to set up DNS configuration and global load balancers</li> <li>security: prevents DDoS attacks, data theft, and bot attacks. </li> <li>performance: provides the fastest experience by:<ul> <li>optimizes multimedia and stores web content as near as possible to end-users</li> <li>Proxied edge servers</li> </ul> </li> </ol> <p>Proxied edge servers</p> <p>often part of a Content Delivery Network (CDN), act as intermediaries between the client (user's device) and the origin server (where the actual web content is hosted). These servers are strategically positioned at the \"edge\" of the network, close to the user's geographic location. They store cached copies of the web content and handle requests from users on behalf of the origin server.</p> <p>* The term <code>proxied</code> means that these edge servers act as a gateway or intermediary. They receive incoming requests from clients, check if they have the requested content, and, if available, serve it directly without reaching the origin server.</p>"},{"location":"architect/ibm/security/#1-global-load-balancer-glb","title":"1. Global Load Balancer (GLB)","text":"<p>A global load balancer manages traffic across server resources located in multiple regions, like all load balancers, automatically distribute traffic with a goal to minimize impact on users. It offers high availability and geographical distribution of traffic, based on the health of origin servers and the geographical region where the request originates. </p> <p>Features:</p> <ul> <li>Proxy and non-proxy options for load balancing</li> <li>Origin pools and health checks</li> </ul> <p>GLB Types:</p> <ul> <li>geographically-based</li> <li>performance-based: distributes traffics by weights</li> </ul>"},{"location":"architect/ibm/security/#2-domain-network-system-dns","title":"2. Domain Network System (DNS)","text":"<p>DNS within CIS has the following features:</p> <ul> <li>DNS management: manage DNS records, control proxying, and enable DNS security.</li> <li>DNSSEC: DNS security cryptographically signs a zone to ensure that the DNS records provided to the user are the same as the DNS records published on the DNS server.</li> <li>Root record CNAME flattening: to overcome the IETF RFC restriction that if a root record is a CNAME, it cannot have any other records for that domain.</li> <li>Proxying DNS records and global load balancers:<ul> <li>HTTP Proxy mode</li> <li>DNS only mode</li> </ul> </li> </ul> <p>in CIS, we recommend you to configure both 1. Global Load Balancer (GLB) and 2. Domain Network System (DNS). \ud83d\udc47</p> <p></p> <p>CDN</p> <p>CDN endpoints are placed in as many locations around the world where clients exist. With the CDN in place, clients are able to retrieve content directly from the CDN, drastically reducing the response time. </p> <p>Caching</p> <p>CIS uses file extensions to cache content. CIS does not cache by MIME type or HTML. Some examples of the file extensions that are cached automatically by CIS include: bmp, css, doc, docx, gif, jpg, pdf, png, ppt, pptx, tif, webp, and more.</p> <p>When an Internet client requests static content, the GLB does not have to send the request to the application. Instead, it can return cached content from the CDN in CIS.</p>"},{"location":"architect/ibm/security/#3-page-rules","title":"3. Page Rules","text":"<p>CIS configurations can be customized on a page-by-page basis. Enterprise version also enables:</p> <ul> <li>sorting query strings</li> <li>minifying web content: by removing unnecessary content</li> </ul> <p>Summary</p> <p>Global load balancer offers high availability and geographical distribution of traffic, based on the health of origin servers and the geographical region where the request originates.</p> <p>Caching is the process of storing files on edge servers to improve response time for clients.</p> <p>Page rules ensures efficient security, performance, and reliability based on each individual URL.</p> <p>CDN is a network of servers that is geographically dispersed to enable faster web performance.</p>"},{"location":"architect/ibm/security/#4-web-application-firewall-waf","title":"4. Web Application Firewall (WAF)","text":"<p>Features:</p> <ul> <li>Easy setup: The CIS WAF is part of IBM's overall service, which takes just a few minutes to set up. After the client redirects their DNS to IBM CIS, they can switch on the WAF and set up the rules they need. </li> <li>Detailed reporting: See greater detail in the reporting, for example, threats blocked by rule/rule group.</li> </ul>"},{"location":"architect/ibm/security/#5-transport-layer-security-tls","title":"5. Transport Layer Security (TLS)","text":"<p>TLS options let clients control whether visitors can browse their website over a secure connection, and when they do, how CIS connects to the origin server.</p> <p>TLS Encryption Modes:</p> <ul> <li>Off (not recommended)    </li> <li>Client-to-Edge (edge to origin not encrypted, self-signed certificates are not supported)    </li> <li>End-to-End flexible (edge to origin certificates can be self-signed)    </li> <li>End-to-End CA signed (default and recommended)    </li> <li>HTTPS only origin pull (Enterprise only)</li> </ul>"},{"location":"architect/ibm/security/#6-range","title":"6. Range","text":"<p>Range is a global TCP proxy running on CIS edge nodes that extends the power of CIS DDoS, TLS, and IP firewall to web servers and TCP-based services, keeping applications online and secure. </p> <p>Range Limitations</p> <p>users can create a maximum of 10 Range applications with unique origins. Each Range application with a unique origin must have a unique IP address allocated, and IP addresses are a limited resource.</p>"},{"location":"architect/ibm/storage/","title":"Storage","text":""},{"location":"architect/ibm/storage/#1-object-storage","title":"1. Object Storage","text":""},{"location":"architect/ibm/storage/#11-cloud-object-storage","title":"1.1 Cloud Object Storage","text":"<p>Provides flexible, cost-effective, and scalable cloud storage for unstructured data.</p>"},{"location":"architect/ibm/storage/#12-minio-by-minio","title":"1.2 MinIO (By MinIO)","text":"<p>MinIO offers high-performance, S3 compatible object storage. Native to Kubernetes, compatible with every public cloud.</p>"},{"location":"architect/ibm/storage/#13-filemage-gateway-by-filemage-llc","title":"1.3 FileMage Gateway (By Filemage LLC)","text":"<p>FileMage Gateway is an SFTP &amp; FTP server backed by IBM Cloud Object Storage, featuring permission management and more.</p>"},{"location":"architect/ibm/storage/#2-file-storage","title":"2. File Storage","text":""},{"location":"architect/ibm/storage/#21-file-storage-for-classic","title":"2.1 File Storage for Classic","text":"<p>Fast and flexible NFS-based file storage with capacity options from 20GB to 12TB.</p>"},{"location":"architect/ibm/storage/#22-file-storage-for-vpc","title":"2.2 File Storage for VPC","text":"<p>Create a shared storage that you can share across multiple Virtual Servers within your VPC.</p>"},{"location":"architect/ibm/storage/#23-ibm-storage-scale","title":"2.3 IBM Storage Scale","text":"<p>Automate HPC cluster deployments on IBM Cloud with BYOL IBM Storage Scale, a clustered file system.</p>"},{"location":"architect/ibm/storage/#3-block-storage","title":"3. Block Storage","text":""},{"location":"architect/ibm/storage/#31-block-storage-for-classic","title":"3.1 Block Storage for Classic","text":"<p>Persistent iSCSI based storage with high-powered performance and capacity up to 12TB.</p>"},{"location":"architect/ibm/storage/#32-block-storage-for-vpc","title":"3.2 Block Storage for VPC","text":"<p>Persistent storage for use as boot and data storage for Virtual Servers in a VPC network.</p>"},{"location":"architect/ibm/storage/#33-block-storage-snapshots-for-vpc","title":"3.3 Block Storage Snapshots for VPC","text":"<p>Back up block storage volumes to IBM Cloud Object Storage with this regional snapshot service.</p>"},{"location":"architect/memi/memi-1/","title":"1. Welcome","text":"<ul> <li>Newsletter</li> <li>FB Group</li> </ul>"},{"location":"architect/memi/memi-10/","title":"10. Design Patterns","text":"<p>Design Patterns is a collection of general, reusable solutions to Common Problems in software design. We use Patterns to design consistent, flexible, readable and easy to maintain software.</p> <p>Common Problems</p> <p>Examples:</p> <ul> <li>How to communicate between classes</li> <li>How to initialize interface implementations</li> <li>How to access data stores</li> <li>And more\u2026</li> </ul> <p>Benefits:</p> <ul> <li>Popular: tested and used by other developers</li> <li>Make your code more readable and easy to modify</li> <li>Avoid strong coupling</li> </ul>"},{"location":"architect/memi/memi-10/#factory-pattern","title":"Factory Pattern","text":"<p>Creating objects without specifying the exact class of the object. Goal is to avoid strong coupling between classes.</p> <p></p>"},{"location":"architect/memi/memi-10/#repository-pattern","title":"Repository Pattern","text":"<p>Modules not handling the actual work with the datastore should be oblivious to the datastore type.</p> <p>More advanced implementations: - Generic classes - Inheritance - Extension Frameworks</p>"},{"location":"architect/memi/memi-10/#facade-pattern","title":"Facade Pattern","text":"<p>Creating a layer of abstraction to mask multiple complex actions. </p>"},{"location":"architect/memi/memi-10/#command-pattern","title":"Command Pattern","text":"<p>All the action\u2019s information is encapsulated within an object</p>"},{"location":"architect/memi/memi-11/","title":"11. System Architecture","text":"<p>Its about \"The Big Picture\". To answers the questions:</p> <ul> <li>How will the system work under heavy load?</li> <li>What will happen if the system will crash at this exact moment in the business flow?</li> <li>How complicated can be the update process?</li> <li>And more\u2026</li> </ul> <p>System Architecture should define:</p> <ul> <li>Software Components (Services)</li> <li>Communication between Components</li> <li>System capabilities: scalability, redundancy, performance etc.</li> </ul>"},{"location":"architect/memi/memi-11/#loose-coupling","title":"Loose Coupling","text":"<p>Prevents: - platform coupling - URL coupling: e.g. an exposed Java Remote Method Invocation (RMI) can only be called by another Java App</p>"},{"location":"architect/memi/memi-11/#the-spiderweb","title":"The Spiderweb","text":"<p>If your services map looks like a spider web, be ready for a nasty surprise when even one of the URL is changed. The spider web is a sure sign of a strong coupling system.</p> <p></p> <p>Solution 1 - Directory</p> <p>Services only need to know the Directory\u2019s URL </p> <p>Solution 2 - Gateway</p> <p>Services only need to know the Gateway\u2019s URL </p>"},{"location":"architect/memi/memi-11/#stateless","title":"Stateless","text":"<p>The application\u2019 s state is stored in only two places \u2013 the data store and the user interface. No state should be stored in the application code.</p> <p>State = Application's data</p> <p>This is a \"stateFUL\" example: the User will not be identified by the system if the next request is sent to the Service Nr.2 by the Load Balancer!</p> <p></p> <ul> <li>Always use stateless architecture</li> <li>Supports Scalability and Redundancy</li> </ul>"},{"location":"architect/memi/memi-11/#scalability","title":"Scalability","text":"<ul> <li>Grow and shrink as needed</li> <li>Scale Out &gt; Scale Up</li> </ul>"},{"location":"architect/memi/memi-11/#redundancy","title":"Redundancy","text":"<p>Allows the system to function properly when resource is not working. E.g.: A system with more than one server, when a server goes down, the other continue working.</p> <p></p>"},{"location":"architect/memi/memi-11/#caching","title":"Caching","text":"<p>Bring data closer to its consumer so that its retrieval will be faster. Data that saved in Cache should be:</p> <ul> <li>frequently accessed: fast, optimal UX</li> <li>rarely modified: syncing cache and DB is a challenge</li> </ul> <p></p>"},{"location":"architect/memi/memi-11/#types","title":"Types","text":""},{"location":"architect/memi/memi-11/#messaging","title":"Messaging","text":"<p>Communication between the various services. Messaging Criteria:</p> <ul> <li>Performance</li> <li>Message Size</li> <li>Execution Model</li> <li>Feedback &amp; Reliability</li> <li>Complexity</li> </ul> <p></p>"},{"location":"architect/memi/memi-11/#1-rest-api","title":"1. REST API","text":""},{"location":"architect/memi/memi-11/#2-http-push-websocket","title":"2. HTTP Push (WebSocket)","text":"<ul> <li>Uses advanced web techniques (ie. Web Sockets)</li> <li>Very popular in chats</li> </ul>"},{"location":"architect/memi/memi-11/#3-queue","title":"3. Queue","text":"<ul> <li>Messages will be handled once and only once</li> <li>Messages will be handled in order</li> </ul>"},{"location":"architect/memi/memi-11/#4-file-based-database-based","title":"4. File-based &amp; Database-based","text":""},{"location":"architect/memi/memi-11/#logging-monitoring","title":"Logging &amp; Monitoring","text":"<p>Central Logging Service: The logs of the entire system must be accessible from a central point and must be present as a single format.</p> <p>Correlation ID</p> <p>Correlation ID is an identifier that is assigned to a flow at the beginning of it and is passed from service to service.  It is included in every log record and enable us to track the flow from start to end.  The correlation ID itself can be whatever identifier you will want to use. </p>"},{"location":"architect/memi/memi-12/","title":"12. Additional Considerations","text":""},{"location":"architect/memi/memi-12/#deadlines","title":"Deadlines","text":"<p>How long does it need to implement the Achitecture? What will impact the schedule?</p> <ol> <li>Technology Stack choice: <code>Queue</code> takes longer than <code>REST API</code></li> <li>Devloper's Skill: unknown technologies might result in:</li> <li>Delay</li> <li>Low Quality</li> </ol> <p>Note</p> <p>Do not include products in the architecture that have no one assigned for taking care of them. Always prefer products that IT department knows and support.</p>"},{"location":"architect/memi/memi-12/#cost","title":"Cost","text":"<p>Cost Mgmt can MAKE or BREAK a project!</p> <ol> <li>Buy vs Build: always estimate cost vs value</li> </ol>"},{"location":"architect/memi/memi-13/","title":"13. Architecture Document","text":""},{"location":"architect/memi/memi-13/#table-of-contents","title":"Table of Contents","text":"<ol> <li>Background: to dscribe the system from a Business POV<ul> <li>System\u2019s role</li> <li>Reasons for replacing the old system</li> <li>Expected business impact</li> </ul> </li> <li> <p>Requirements: to validate your understanding</p> <ul> <li> <p>Functional: What the system should do? </p> <p><code>The system should allow adding, removing and updating employee's data</code></p> </li> <li> <p>Non-functional: With what should the system deal? Should be extremely accurate. </p> <p><code>The system will have 150 users, with expected load of 20 concurrent user</code></p> </li> </ul> </li> </ol> <p>3.Executive Summary: should be NON-technical, to provide high-level view for the CXOs and boost confidence of your work. Some tips:       - Use charts &amp; diagram       - write it AFTER the rest of document -&gt; because its a summary 4. Architecture Overview: to provide high-level view of the architecture, no deep-dive to specific components. It should includes:        -  General descriptino        -  High-level diagram        -  Diagram walkthrough 5. Components Drill-down: For each component we need to describe:        - Component;s role        - technology stack        - Component\u2019s Architecture</p> <p>Warning</p> <p>No development before documentation!</p>"},{"location":"architect/memi/memi-13/#goal","title":"Goal","text":"<ul> <li>Describe what should be developed and how</li> <li>Lay out the requirements (functional &amp; non-functional)</li> </ul>"},{"location":"architect/memi/memi-13/#audience","title":"Audience","text":"<p>Almost everyone involved - Project Manager - CTO - QA Leader - Developers</p>"},{"location":"architect/memi/memi-13/#format-tool","title":"Format / Tool","text":""},{"location":"architect/memi/memi-13/#uml","title":"UML","text":"<ul> <li>Modeling Language</li> <li>Visualizes system\u2019s design</li> <li>Consists of Concepts and Diagrams</li> </ul> <p>Cons:</p> <ul> <li>requires a lot of time for explaining</li> <li>the audience is usually NOT familiar with it</li> </ul>"},{"location":"architect/memi/memi-13/#visualization","title":"Visualization","text":"<p>PPT, Keynote or plain English, make it as simple as possible</p>"},{"location":"architect/memi/memi-15/","title":"15. Advanced Architecture Topics","text":""},{"location":"architect/memi/memi-15/#micro-services","title":"Micro-Services","text":"<p>An architecture in which various functionalities are implemented as separate, loosely coupled services that interact with each other using standard, lightweight protocol.</p>"},{"location":"architect/memi/memi-15/#event-sourcing","title":"Event Sourcing","text":"<p>Comparison:</p> <p></p> <p>Pros:</p> <ul> <li>Tracing</li> <li>Simple Data Model</li> <li>Performance</li> <li>Reporting</li> </ul> <p>Cons:</p> <ul> <li>No Unified View</li> <li>Storage Usage</li> </ul> <p>Use Event Sourcing DB when history matters!</p>"},{"location":"architect/memi/memi-15/#cqrs","title":"CQRS","text":"<p>CQRS = Command, Query, Responsibility, Segregation</p> <p></p>"},{"location":"architect/memi/memi-16/","title":"16. Soft Skills","text":"<ol> <li>Listening</li> <li>Always assume you are NOT the smartest person in the room</li> <li>Collective wisdom is always better</li> <li>Dealing with Criticism</li> <li>DON\u2019T Attack Back</li> <li>Be smart, not right</li> <li>Careful about Organizational Politics, don't get involved</li> <li>Prepare youself for Public Speaking</li> <li>Keep learning</li> <li>Its a  \"ppl\" job</li> </ol>"},{"location":"architect/memi/memi-2/","title":"2. What is a Software Architect","text":""},{"location":"architect/memi/memi-2/#types-of-architect","title":"Types of Architect","text":"<p>Infrastructure Architect:</p> <ul> <li>Design the Infrastructure: Servers, VMs, Network, Storage, etc</li> <li>Familiar with Requirements</li> <li>Career Path: Infrastructure Expert</li> </ul> <p>Software Architect (Solution Architect or System Architect):</p> <ul> <li>all will be explained in this course</li> </ul> <p>Enterprise Architect:</p> <ul> <li>Works with top-level mgmt: CEO, CIO</li> <li>Streamlines the IT to support business</li> <li>No development-oriented tasks</li> <li>Career Path: Senior Software Architect / Project Manager</li> </ul>"},{"location":"architect/memi/memi-2/#compare","title":"Compare","text":"<p>Senior Developer vs Architect</p> <ul> <li>Developer knows what can be done</li> <li>Architect knows what should be done.</li> </ul> Developer Architect Level micro macro Main goal to implement the functionality in the best way to design the software"},{"location":"architect/memi/memi-2/#definition","title":"Definition","text":"<p>a software architect is someone who designs the system to be fast, secure, reliable and easy to maintain, and select the optimal technology, platforms and patterns to achieve these goal.</p>"},{"location":"architect/memi/memi-2/#role-in-the-org","title":"Role in the Org","text":"<p>Architect is a professional role, should not be responble to manage ppl, discuss compensation, hire ppl.</p>"},{"location":"architect/memi/memi-2/#why-an-architect-should-code","title":"Why an Architect should code","text":"<ol> <li>Architecture's trustworthiness: so that you can try the technologies by yourself before telling the poor developer to do that</li> <li>Support the developer: in order to make sure the architect is implemented, to support the developer when they are stuck</li> <li>Respect: gain respect of the developers</li> </ol>"},{"location":"architect/memi/memi-2/#architect-academy","title":"Architect &amp; Academy","text":"<p>There is no dedicated degree, its a matter of experience!</p>"},{"location":"architect/memi/memi-2/#careeer-path","title":"Careeer Path","text":"<p>The most senior technological role you have had, the more chance you have to be an Architect. Here are some examples:</p> <p>Developer -&gt; Architect</p> <ul> <li>&gt;3 years</li> <li>small company</li> </ul> <p>Developer -&gt; Team Leader -&gt; Architect / Project Manager</p> <ul> <li>Team leader should does a great mix of technical work and managerial work.</li> </ul> <p>Developer -&gt; Team Leader -&gt; Dev Mgr/CTO -&gt; Senior Architect</p> <ul> <li>can become Enterprise Architect</li> <li>no tech bg, not recommended</li> </ul> <p>Developer -&gt; System Analyst</p> <ul> <li>lack tech experience</li> </ul>"},{"location":"architect/memi/memi-3/","title":"3. The Architect's Mindset","text":""},{"location":"architect/memi/memi-3/#mindset","title":"Mindset","text":"<p>As an architect, you should consider both perspective for deveoper and foreign for a developer.</p>"},{"location":"architect/memi/memi-3/#1-understand-the-business","title":"1. Understand the business","text":"<p>Note</p> <p>What does the company do? Knowing Microsoft is producing and selling software is not enough, you should also know: founder, revenue, benefit and competitors.</p> <p>Summary: you need to understand what keeps the CEO wake at the night</p> <p>Make yourself familiar with:</p> <ul> <li>Weaknesses</li> <li>Strengths</li> <li>Competition</li> <li>Grouwth Strategy</li> </ul> <p>Warning</p> <p>An architect shouldn't think her system as a standalone system, it should integrate into the eco-system of the company.</p>"},{"location":"architect/memi/memi-3/#2-the-systems-goal","title":"2. The System's Goal","text":"<p>Goals are not Requirements, not \"what the system should do\", goals describe the effect on the organization --&gt; always think about the big system.</p> <p>Example</p> <p>I once had a client that asked me to design the architecture of a specific system for him. The system specifications were clear. The value services and screens were already defined and it looked like an easy task. However, when we began discussing the place of the system in the organization, we found out almost no one was going to use the system as it is. There were many other systems which performed similar tasks, albeit in a less comfortable manner, but the users were already used to those systems and there was simply not a strong enough incentive for them to move to the new one.</p> <p>We ended up changing almost all of the systems scope and functionality, and the final product was a much smaller, but much more focused and effective system.</p>"},{"location":"architect/memi/memi-3/#3-your-clients-client","title":"3. Your client's client","text":"<p>Commonly:</p> <ul> <li>Client: IT department who hires you</li> <li>Client's client: the end user</li> </ul> <p>Your client's client is prioritized over the comfort of your client.</p>"},{"location":"architect/memi/memi-3/#4-watch-your-language","title":"4. Watch your language","text":"<p>Always keep in mind what is the thing that really matters to the person you are talking to.</p> <p>example</p> <ul> <li>Project manager: only cares about Project Sucess</li> <li>Tech team leader: programming</li> <li>CEO: Financial botton line, NEVER technical buzzwords</li> </ul>"},{"location":"architect/memi/memi-4/","title":"4. The Architecture Process","text":""},{"location":"architect/memi/memi-4/#0-understand-the-systems-goal","title":"0. Understand the system's goal","text":"<p>We've discussed it in the last chapter, its a preparation phrase, the real architect process starts with 1.</p>"},{"location":"architect/memi/memi-4/#1-understand-the-functional-requirements-with-system-analyst","title":"1. Understand the functional requirements (with @System analyst)","text":"<p>Requirements = what the system should do, they usually begin with a high-level task, such as </p> <ul> <li>allow end users to view telemetry data</li> <li>workflows</li> <li>logical services</li> <li>user interface elements</li> </ul> <p>Requiremenets are usually defined by the system analyst, who works directly with the client.</p>"},{"location":"architect/memi/memi-4/#2-understand-the-non-functional-requirements","title":"2. Understand the non-functional requirements","text":"<p>Non-functional requirements: are a special kind of requirements that define some technical and service level attributes of the system. For example:</p> <ul> <li>concurrent number of users</li> <li>heavy loads</li> <li>volumes of data and performance</li> </ul> <p>The client and the system analyst are usually not aware of the non-functional requirements, it's the architect's job to help them formulate those requirements. </p> <p>Warning</p> <p>For the architects, the non-functional requirements are much more important than the regular requirements.</p> <p>Never begin to work on a system before knowing exactly what its non-functional requirements are</p>"},{"location":"architect/memi/memi-4/#3-map-the-components","title":"3. Map the components","text":"<p>The components = various tasks of the system, functional as well as non-functional. </p> <p>In this step, we map the various software units and define what each of them does. The component map serves two goals:</p> <ol> <li>To help you understand the system and its various parts. </li> <li>To communicate to the client your understanding of the system, thus making sure you are not missing anything. </li> </ol> <p>Note</p> <p>The component map is completely non-technical. You are yet to decide on the platform, the development tool, the database type. This is just a map that displays the various capabilities of the system. Here is an example:     </p>"},{"location":"architect/memi/memi-4/#4-select-the-technology-stack","title":"4. Select the technology stack","text":"<ul> <li>one of the most important steps</li> <li>together with the development team</li> <li>usually you will have to select backend, frontend and data store</li> </ul>"},{"location":"architect/memi/memi-4/#5-design-the-architecture-with-developers","title":"5. Design the architecture (with @Developers)","text":"<p>We glue </p> <ul> <li>the functional requirements</li> <li>the non-functional requirements</li> <li>the components mapping</li> <li>the technology stack</li> </ul> <p>together and will result in a system that is fast, secure, reliable, and easy to maintain.</p>"},{"location":"architect/memi/memi-4/#6-write-the-architecture-document","title":"6. Write the architecture document","text":"<p>We formalize the architecture design by writing the document. The architecture document describes the whole process you have been through and gives a full picture of the system. </p> <p>A good architecture document is relevant for all the levels in the organization:</p> <ul> <li>the CEO</li> <li>the CIO</li> <li>the project manager</li> <li>the developers</li> </ul> <p>They will all find great value in it. We'll talk a lot about the structure and the content of the document in the relevant section and explain how to maximize its value.</p>"},{"location":"architect/memi/memi-4/#7-support-the-development-team","title":"7. Support the development team","text":"<p>Architect's job is not done when the document is done.</p> <p>Subtle architecture is a living, breathing creature, and it changes all the time. You have to be there for the developers to help them to make sure they're developing according to the architecture and to be part of the dilemmas that are going to be raised. And there are going to be a lot of dilemmas, arguments, and talks, and the architecture will be changed and not only once. </p> <p>So you have to support the team if you don't want the documents to become a glorified paperweight. And remember, you are not done until the system is in production, and even then, you probably will have a lot to do.</p>"},{"location":"architect/memi/memi-5/","title":"5. Working with System Requirements","text":""},{"location":"architect/memi/memi-5/#functional-requirements","title":"Functional requirements","text":"<p>Functional requirements = What the system should do</p> <ul> <li>business flows: example, login, storing photos, receiving and crunching telemetry data</li> <li>business services: login service, data access service, telemetry receiver, telemetry credential.</li> <li>user interface: the look and feel, general guidance, responsiveness</li> </ul> <p>Note</p> <p>For Architect: </p> <ul> <li>Functional requirements should not be ignored</li> <li>but Non-functional requirements has even a higher priority</li> </ul>"},{"location":"architect/memi/memi-5/#non-functional-requirements","title":"Non-functional requirements","text":"<p>Non-functional requirements = What should the system deal with? </p> <p>Non-functional requirements describe the various aspects of the system's operation, and are not tied to a specific behavior or logic. The most common 5 non-functional requirements are:</p> <ol> <li>Performance</li> <li>Load</li> <li>Data volume</li> <li>Concurrent users</li> <li>SLA </li> </ol> <p>Non-functional requirements basically describe what is expected environment for the system, with emphasis on edge cases, e.g.:</p> <ul> <li>Large number of concurrent users</li> <li>Server crash</li> <li>Extremely high load of requests</li> </ul>"},{"location":"architect/memi/memi-5/#1-performance-latency-throughput","title":"1. Performance: Latency &amp; Throughput","text":"<p>Tipps</p> <p>Its important to always talk in numbers: E.g.: How fast is fast? less than 1 sec or 1 ms</p> <ol> <li>Latency: How much time does it take to perform a single task in the application?<ul> <li>E.g.: How much time does it need for the API to save the user data in the database?</li> </ul> </li> <li>Throughput: How many tasks can be performed in a given time unit?<ul> <li>E.g.: How many users can be saved in the database in a minute?</li> <li>E.g.: How many files can be read in a second?</li> </ul> </li> </ol> <p>Note</p> <p>For human, one second or 700 milliseconds looks almost the same.</p> <p>Latency VS Throughput</p> <p>Let's say the latency of saving user data is one second. (This is quite slow.)</p> <p>Now, what would be the throughput? Can we know how many users can be saved in one minute? The answer is NO. </p> <ul> <li>If the application is well-designed, deployed on a strong hardware and knows its way around threads, it might have a throughput of 1000 users saved in one minute. </li> <li>If the code is buggy and there are a lot of memory leaks and no concurrency at all, we want to be able to reach a throughput of 60, which is a latency multiplied by 60, the number of seconds in a minute. </li> </ul>"},{"location":"architect/memi/memi-5/#2-load","title":"2. Load","text":"<p>Quantity of work without crashing, it can be understood \"approximately\" as maximal Thoughput the system can handle. </p> <p>E.g.: for a web API-based application, the load will usually be defined as how many concurrent requests are going to be received by the system without crashing. </p> <p>Load VS Throughput</p> <p>For example, the performance requirement can dictate throughput of 100requests/s, but the system should be able to handle 500 concurrent requests without crashing --&gt; even if those requests will take more than a second to complete.</p> <p>This definition is important, because the worst thing that can happen to a system is to crash under heavy load.</p> <p>Example</p> <p>for an e-commerce website, the regular load might be up to 200 concurrent requests, but on Black Friday, we are looking at more than 2000 concurrent requests. In that case, Load = 2000</p>"},{"location":"architect/memi/memi-5/#3-data-volume","title":"3. Data volume","text":"<p>This requirement defines how much data in gigabytes or terabytes our system will _accumulate over tim_e. It's important for helping us to decide:</p> <ul> <li>what kind of database? since not all databases can handle large quantities of data equally. </li> <li>what type of queries? because a query in a table of 100,000 rows will be completely different from a query in a table of 100 million rows.</li> <li>its helpful to plan ahead the storage we need to allocate.</li> </ul> <p>The data volume usually has two aspects:</p> <ol> <li>how much data is required on day one </li> <li>what is a forecasted data growth? For example, a system might need 500MB on its first day and is expected to grow by 2TB annually. </li> </ol>"},{"location":"architect/memi/memi-5/#4-concurrent-users","title":"4. Concurrent users","text":"<p>This requirement defines how many users will be using the system simultaneously. There is a big difference between Concurrent users and load. </p> <p>The concurrent users requirement describes how many users will be using the system, not how many users will be performing requests. </p> <p>This distinction is important. When a user is using a system, there are a lot of dead times when no action is actually taken.</p> <p>For example, a user is asking the system to display all the data. The system executes an API that goes to the database and retrieves the data. This is an actual action. Now, the user is looking at the data. During this time, the system is doing nothing. The API is not working. The database just sits there and the network is silent.</p> <p>The rule of thumb</p> <p>Concurrent users = 10 * Concurrent request</p>"},{"location":"architect/memi/memi-5/#5-sla-service-level-agreement","title":"5. SLA (Service Level Agreement)","text":"<p>describes what is the required uptime for this system in percentage.</p> <p>For example, Azure Cosmos DB takes pride with its 99.99% SLA. This is translated to less than an hour of downtime in a year.</p> <p>Tip</p> <p>One important thing to note about SLA is client expectations. </p> <p>If you'll ask the client what is a required SLA for the system, he will usually give you an answer along the lines of 100% or the famous five nines, which is 99.999%. </p> <p>When this happens, I usually tell him, no problem. For this, we'll need to build at least 3 data centers in different continents with independent and dual power stations and automatic failover between them. What do you say? This generally brings him down to earth and we discuss more realistic SLA goals. </p>"},{"location":"architect/memi/memi-5/#who-defines-the-requirements","title":"Who defines the requirements?","text":"<p>Usually, we expect the client, together with the system analyst, to define the functional requirements. But the client has no idea about non-functional requirements, during the discussion, you as architect should:</p> <ul> <li>Framining the realistic requirements' boundaries: no 100% uptime, its not realistic and probably also not necessary</li> <li>always using numbers</li> </ul>"},{"location":"architect/memi/memi-6/","title":"6. Types of Applications","text":"<p>After defining functional requirements and non-functional requirements, you need to determine the application type. Be aware, once this decision is made, its not easy to switch to other types.</p>"},{"location":"architect/memi/memi-6/#1-web-app","title":"1. Web App","text":"<p>It consists of:</p> <ul> <li>web server (ususally more than 1)</li> <li>web browser</li> </ul> <p>* Those two communicate with each other via HTTP protocol</p> <p>Web App are best for systems that require:</p> <ul> <li>User interface</li> <li>User-initiated actions: meaning the user is the one making the request to do something, such as viewing all their data, saving username and so on. </li> <li>Large scale: with a large number of users and a lot of data. </li> <li>Short, focused action: as opposed to long-running processes. For example, web apps are not a good fit for a process that should crunch billions of numbers and produce business intelligence.</li> </ul> <p>Rule of thumb</p> <p>if the system you are working on can be described as a request-response application, then you are probably looking at a web app.</p>"},{"location":"architect/memi/memi-6/#2-webapi","title":"2. WebAPI","text":"<p>Web API is quite similar to web app with two important differences:</p> <ol> <li>it does not serve HTML pages but JSON data </li> <li>instead of web browsers, other applications are calling it</li> </ol> <p>Web API exposes an API, application programming interface, which allows other programs to access it and execute various actions. The most popular API is definitely the REST API. </p> <p>WebAPI is a combination of:</p> <ul> <li>URL (<code>https://api.thecatapi.com/v1/images/search</code>)</li> <li>Parameter (<code>has_breeds=true&amp;order=RANDOM</code>)</li> <li>HTTP Verb (<code>GET</code>)</li> </ul> <p>I believe that almost every language can access web API and use it!</p> <p>WebAPI Apps are best for systems that require: - Data retrieval and store - though not huge amount of data in each action, - Client initiated actions: meaning the caller is the one making the request to do something, such as getting all the data, saving username and so on.  - Large scale: with a large number of users and a lot of data - short, focused action: as opposed to long running processes. </p> <p>Web API and web apps are both based on the request-response model and should be avoid for Long running processes.</p>"},{"location":"architect/memi/memi-6/#3-mobile","title":"3. Mobile","text":"<p>Mobile Apps on Android or Apple, they always uses WebAPI</p> <p>Mobile Apps are best for systems that require: - User interaction (games, social apps) - Frontend for WebAPI (news) - Location sensitive - will benefit from phone's GPS</p>"},{"location":"architect/memi/memi-6/#4-console","title":"4. Console","text":"<p>Console App, pr command line applications, often called CLI, are applications that run inside the command line of the operating system. </p> <ul> <li>No fancy UI: the only thing the end user sees are the lines of text displayed in the command line window.</li> <li>Requires some level of technical knowledge: normal end users who are accustomed to point-and-click applications will have a hard time working with these applications. </li> <li>Limited interaction</li> <li>Long or short running Processes</li> </ul> <p>Console App are best for systems that require:</p> <ul> <li>Long or short running Processes</li> <li>short, focused actions such as exporting data</li> </ul>"},{"location":"architect/memi/memi-6/#5-service","title":"5. Service","text":"<p>Service is like Console, but:</p> <ul> <li>no UI at all</li> <li>manages by Service Manager in the OS </li> </ul> <p>Service Manager</p> <p>Service Manager is a system tool responsible for managing services, daemons, and other background processes. For example <code>systemd</code> in Ubuntu, Fedora, CentOS, and Debian system.</p> <p>Services App are best for systems that require:</p> <ul> <li>long running processes (monitoring folder on the disc) - when no user intervention is required.</li> </ul>"},{"location":"architect/memi/memi-6/#6desktop-application","title":"6.Desktop Application","text":"<p>a poor kid in the application world, usually you dont encounter it:</p> <ul> <li>has all resources on the PC &lt;--&gt; not the Rich Client App that access WebAPI</li> <li>Might connect to the web (for some arbitrary task such as validating license or sending activity logs), but it's still be fully-functional when its offline</li> </ul> <p>Example</p> <p>Microsoft word</p> <p>is suitable for:</p> <ul> <li>user-centric actions (word processing or calculations, and heavy gaming)</li> </ul>"},{"location":"architect/memi/memi-6/#other-types","title":"Other types","text":"<p>AWS Lambda or Azure Functions, which allows the developer to write a short focused code segments and not worry about servers, scale, or SLA.</p>"},{"location":"architect/memi/memi-6/#summary","title":"Summary","text":"<ul> <li>App type should be set early</li> <li>App types can be more than one</li> </ul> <p>WebApp + Service</p> <p>In addition to the main application, many web apps have also a service that run continuously and performs maintenance tasks such as removing all data records, monitoring various processes, and so on.</p>"},{"location":"architect/memi/memi-7/","title":"7. Selecting Technology Stack","text":"<p>Why is it important?</p> <ul> <li>Irreversible</li> <li>Emotional</li> </ul> <p>Decision must be:</p> <ul> <li>made with clear mind (very rational)</li> <li>heavily documented</li> <li>group effort (discuss with your developers)</li> </ul> <p>Technology Stack Considerations</p> <ol> <li>Can perform the required tasks?</li> <li>Community (stackoverflow tags)</li> <li>Popularity (google trend)</li> </ol>"},{"location":"architect/memi/memi-7/#frontend","title":"Frontend","text":""},{"location":"architect/memi/memi-7/#web","title":"Web","text":"<p>Frontend app consists of HTML, CSS and JS. There are some popular JS Frameworks, including ReactJS and AngularJS </p>"},{"location":"architect/memi/memi-7/#mobile","title":"Mobile","text":"<p>There are 3 types of mobile app:</p> <ol> <li>Native: Native apps are developed for a specific mobile operating system (OS) using the platform's native programming languages and tools. --&gt; Such as Swift for iOS, Kotlin for Android</li> <li>Hybrid: Hybrid apps are built using web technologies (HTML, CSS, JavaScript) and are wrapped in a native container for deployment. --&gt; Such as Ionic</li> <li>Cross-Platform: Cross-platform development uses frameworks or technologies that allow developers to write code once and deploy it on multiple platforms. --&gt; Such as Flutter, React Native</li> </ol> <p></p>"},{"location":"architect/memi/memi-7/#desktop","title":"Desktop","text":""},{"location":"architect/memi/memi-7/#backend","title":"Backend","text":"<p>WebApps, WebAPI, Console and Service could all be counted as Backend. Here are some popular backend applications:</p>"},{"location":"architect/memi/memi-7/#1-net-classic","title":"1. .NET Classic","text":"<ul> <li>founded by Microsoft in 2001 as a response for Java</li> <li>General purpose</li> <li>Object-oriented</li> <li>Statically-typed </li> <li>IDE: Visual Studio</li> <li>Windows only</li> <li>Performance okish</li> <li>Very mature</li> <li>Blurred roadmap</li> </ul> <p>It is default choice for Windows-based application.</p> <p>Statically-typed vs Dynamically-typed</p> <p>In statically-typed languages, the data types of variables are known and checked at compile-time, before the program is run. Suitable for large-scale projects where errors can have severe consequences, because it enables error detection and ensures type safety. E.g.: C, C++, Java, C#, Swift, Go</p> <p>In contrast, dynamically-typed languages where type checking is done at runtime. Suitable for prototyping and development, or when data types may change during runtime. E.g.: Python, JS, TS, PHP, R</p>"},{"location":"architect/memi/memi-7/#2-net-core","title":"2. .NET Core","text":"<ul> <li>Next generation of .NET,</li> <li>Cross-platform support and performance.</li> <li>a flexible and fast platform</li> <li>but not fully baked yet</li> <li>fast growing community</li> </ul>"},{"location":"architect/memi/memi-7/#3-java","title":"3. Java","text":"<ul> <li>founded in 1995 by Sun Microsystems</li> <li>very popular</li> <li>General purpose</li> <li>Object-oriented</li> <li>Statically-typed </li> <li>Huge community</li> </ul>"},{"location":"architect/memi/memi-7/#4-nodejs","title":"4. node.js","text":"<ul> <li>founded on 2009 by Ryan Dahl</li> <li>optimized for highly concurrent Web Apps.</li> <li>JavaScript-based</li> <li>dynamically typed</li> <li>large community</li> <li>great performance</li> </ul> <p>As mentioned, Node.js is NOT targeted for long running processes so don't try to build services with it. But for Web Apps that require a lot of short, concurrent I/O operations, its the best choice.</p>"},{"location":"architect/memi/memi-7/#5-php","title":"5. PHP","text":"<ul> <li>founded in 1994 by Rasmus Lerdof</li> <li>Messy</li> <li>easy to learn</li> <li>not polished enough.</li> <li>large community.</li> </ul> <p>PHP is focused on Web Apps and Web API, not suitable for long running component</p>"},{"location":"architect/memi/memi-7/#6-python","title":"6. Python","text":"<ul> <li>Founded on 1989 by Guido van Rossum</li> <li>scripting language</li> <li>the easiest language to learn</li> <li>large community</li> <li>can perform almost any task</li> </ul> <p>You can consider Python for almost any type of application including Web App, Web API, console, or service.</p> <p></p>"},{"location":"architect/memi/memi-7/#data-store","title":"Data Store","text":""},{"location":"architect/memi/memi-7/#sql-database","title":"SQL Database","text":"<p>SQL database or relational database. The most popular relation databases are Microsoft SQL Server, Oracle and MySQL, postgresql.</p> <ul> <li>Stores data in tables</li> <li>Tables have concrete set of columns</li> <li>Tables can have relationships with each other --&gt; hence the \"relational\" in the name.</li> <li>Transaction(TA): use SQL, ACID Structured Query Language</li> </ul> <p>ACID!</p> <ul> <li>Atomicity: ALL or NONE changes of the Transaction is made</li> <li>Consistency: follows all pre-defined rules, such as primary key not empty etc</li> <li>Isolation: 2 parallel Transaction should not effect each other</li> <li>Durability: once changes have been made in the DB, it should always be there</li> </ul>"},{"location":"architect/memi/memi-7/#nosql-database","title":"NoSQL Database","text":"<p>not SQL or not only SQL. MongoDB, CouchDB</p> <ul> <li>Emphasis on scale and performance</li> <li>Schema-less: SQL databases store the data in a well-defined table with well-defined columns, which defines an actual schema for the entities, NoSQL database do not force any schema. They can store completely different entities with completely different fields in the same table.</li> <li>Data usually stored in JSON format</li> <li>Transaction(TA): no standard, can be frustrating, every DB has its own language.</li> </ul> <p>Data in NoSQL can be temporarily inconsistent, but \"Eventual Consistency\", which means that the database guarantees that the action will be performed, but it will not guarantee when exactly it will be performed. (partially ACID) --&gt; usually less than 1 second</p> <p>Usage</p> <p>This is great if your application is going to store semi-structured or unstructured data, which does not have a concrete schema.</p> <p>ACID?</p> <p>Each NoSQL database fulfills partially ACID, but differently. It's important to look closely at the transaction support of the NoSQL database you are going to work with.</p> <p>BUT, MongoDB is fully ACID-compliant with ACID transactions!</p> SQL NoSQL Storage Not huge, &lt; 10 Terabytes Huge Type of Data Structured unstructured <p>Data size</p> Name Equal To Bit 1 Bit Byte 8 Bits Kilobyte 1024 Bytes Megabyte 1024 Kilobytes Gigabyte 1024 Megabytes Terabyte 1024 Gigabytes Petabyte 1024 Terabytes Exabyte 1024 Petabytes Zettabyte 1024 Exabytes Yottabyte 1024 Zettabytes"},{"location":"architect/memi/memi-7/#new-technology","title":"New technology","text":"<p>PostgreSQL is an advanced, enterprise-class open-source relational (SQL) database that supports both SQL (relational) and JSON (non-relational) querying.</p>"},{"location":"architect/memi/memi-8/","title":"8. Meet the *-ilities","text":"<ul> <li>-ilities = Quality Attributes. Technical capabilities that should be used in order to fulfill the non-functional requirements</li> </ul> Non-Functional requirement Quality Attribute The system must work under heavy load, but should not waste money on unused resources Scalability"},{"location":"architect/memi/memi-8/#scalability","title":"Scalability","text":"<p>Adding computing resources without any interruption.</p> Non-Scalable System Scalable System 1. Look for non-scalable code  2. Rewrite non-scalable code  3. Reinforce VM 1. Add VM  2. Notify the Load Balancer"},{"location":"architect/memi/memi-8/#scalability-types","title":"Scalability Types","text":"<ol> <li>Scale Up: make 1 server bigger</li> <li>Scale out: take 2 or 3 server with a Load Balancer</li> </ol>"},{"location":"architect/memi/memi-8/#manageability","title":"Manageability","text":"<p>Know what\u2019s going on and take actions accordingly. The question to ask is: Who reports the problem?</p> <ul> <li>If it's the end user, then the system is NOT manageable, and as a side effect, we have made your users a QA team, which is bad.</li> <li>If the system itself report problems, the experience is much better.</li> </ul> <p></p> <p>Example</p> <p>For example, a mass of request is received in a very short time and the response time degradates substantially. As a result, the system alerts the monitoring agent about it and the operator decides to add more VMs to support that load.</p>"},{"location":"architect/memi/memi-8/#modularity","title":"Modularity","text":"<p>A system that is built from building blocks, that can be changed or replaced without affecting the whole system.</p>"},{"location":"architect/memi/memi-8/#extensibility","title":"Extensibility","text":"<p>A system that its functionality can be extended without modifying its existing code.</p> <p></p>"},{"location":"architect/memi/memi-8/#testability","title":"Testability","text":"<p>How easy it to test the application with Unit Testing and Integration Testing</p> <ul> <li>Manual: he actual tester is sitting in front of the screen and test various functions of the system using the user interface it provides. --&gt; has nothing to do with testability</li> <li>Unit Testing</li> <li>Integration Testing: With integration test, we don't test a specific method but a whole model or flow. We execute a method that will trigger a chain of actions that will result in a specific outcome. For example, a new record in the database should be created from the UI.</li> </ul> <p>Testability\u2019s Characteristics</p> <ul> <li>Independent modules and methods --&gt; achieve with Dependency Injection (DI)</li> <li>Single responsibility --&gt; achieve with the single responsibility principle</li> </ul> <p>More *-ilities: https://en.wikipedia.org/wiki/List_of_system_quality_attributes</p>"},{"location":"architect/memi/memi-9/","title":"9. Components' Architecture","text":""},{"location":"architect/memi/memi-9/#important-concepts","title":"Important Concepts","text":"<p>Software Component: A piece of code that runs in a single process Distributed Systems:</p> <ul> <li>Composed of independent Software Components</li> <li>Deployed on<ul> <li>separate processes</li> <li>or containers</li> <li>or servers</li> </ul> </li> </ul> <p>Distributed Systems</p> <p>You have probably heard about microservices application, server application, and more. </p> <p>All these systems are distributed systems that have components or services deployed independently and which communicate via some kind of network protocol, usually HTTP.</p> <p></p>"},{"location":"architect/memi/memi-9/#two-levels-of-software-architecture","title":"Two Levels of Software Architecture","text":""},{"location":"architect/memi/memi-9/#low-components-architecture","title":"(LOW) Component\u2019s Architecture","text":"<ul> <li>Inner Components</li> <li>Interaction between them</li> <li>Make the code fast and easy to maintain</li> </ul> <p>Design Pattern - Layers</p> <ul> <li>Forces well formed and focused code</li> <li>Modular</li> <li>Rules:<ul> <li>Direction: From top to bottom</li> <li>NO backwards calling!</li> <li>NO skipping layers</li> <li>Loose Coupling, a.k.a. use DI</li> <li>Proper Exception handlung: give needed but limited information</li> </ul> </li> </ul> <p></p>"},{"location":"architect/memi/memi-9/#interface","title":"Interface","text":"<p>A contract that declares the signatures of an implementation. Interface in an OO language = Abstract classes in python</p> <pre><code>interface ICalculator \n{\n    double Add(double numi, double num2);\n\n    double Subtract(double numi, double num2);\n\n    double Multiply(double numi, double num2);\n\n    double Divide(double numi, double num2);\n}\n</code></pre> <p>Using interface allows us to make our code loosely coupled, meaning we do not tie one class to other. </p> <p>For example, we want to replace a Calculator with an advanced Calculator. We'll have to change the code in the Main class and recompile it, and that means that the classes are tied and strongly coupled.</p> <p>Without Interface: <pre><code>// Before:\npublic Main()\n{\n    Calculator calc = new Calculator();\n    double result = calc.Add(5,2)\n}\n\n// After:\npublic Main()\n{\n    AdvancedCalculator calc = new AdvancedCalculator();\n    double result = calc.Add(5,2)\n}\n</code></pre></p> <p>Warning</p> <p>\"new\" is glue!</p> <p>With Interface: <pre><code>public Main()\n{   \n    // calc: the Dependency\n    // GetCalculatorInstance(): the Middleman\n    ICalculator calc = GetCalculatorInstance();\n    double result = calc.Add(5,2)\n}\n</code></pre></p>"},{"location":"architect/memi/memi-9/#dependency-injection","title":"Dependency Injection","text":"<p>A technique whereby one object \u2026 supplies the dependencies of another object</p> <p>The \"middleman\", or to say the factory method, simply executes some logic and decides which class should be injected. <pre><code>private ICalculator GetCalculatorInstance()\n{  \n    // Its common to define the parameter in a configuration file, instead of receiving as input parameter\n    var type = ConfigurationManager.AppSettings[\"calcType\"];\n\n    switch (type)\n    {  \n        case \"regular\":\n            return new Calculator();\n        case \"advanced\":\n            return new AdvancedCalculator();\n        default:\n            return new Calculator();\n    }\n}\n</code></pre></p> <p>The factory method is one way to implement DI, there is also another way called Constructor Injection. The main advantage of the constructive injection pattern over the traditional pattern is testability: <pre><code>public class HomeController : Controller\n{  \n    ILogger logging;\n    // instantiate with a real class through Interface ILogger\n    public HomeController (ILogger logging)\n    {  \n        this. logging = logging;\n    }\n}\n</code></pre></p>"},{"location":"architect/memi/memi-9/#high-system-architecture","title":"(HIGH) System Architecture","text":"<ul> <li>Bigger Picture</li> <li>Scalable, Reliable, Fast, Easy to maintain</li> </ul>"},{"location":"architect/memi/memi-9/#solid","title":"SOLID","text":"<p>Coined by Bob Martin in 2000</p> <p>Stands for: - Single Responsibility Principle: Each class, module or method should have one, and only one, responsibility - Open/Closed Principle - Liskov Substitution Principle - Interface Segregation Principle - Dependency Inversion Principle</p>"},{"location":"architect/security/","title":"Index","text":""},{"location":"architect/security/#web-application-firewall-waf","title":"Web Application Firewall (WAF)","text":"<p>WAF is an easy way to set up, manage, and customize security rules to protect web applications from common web threats such as cross-site forgery, cross-site-scripting (XSS), file inclusion, and SQL injection, among others. </p>"},{"location":"architect/security/#ddos","title":"DDoS","text":"<p>An attacker controls computers as bot. The attacker controls the group of bots, which is called a botnet.</p> <p>After establishing a botnet, the attacker commands the botnet to send requests to the targeted server, causes capacity overflow. --&gt; This creates a denial-of-service(DDoS) to normal traffic.</p>"},{"location":"architect/security/#ssltls-certification","title":"SSL/TLS Certification","text":"<p>to secure the communication between a web server and a client(like a web browser). They ensure that data transmitted over the internet is encrypted and secured.</p>"},{"location":"architect/security/#proxy","title":"Proxy","text":""},{"location":"automation/benthos/","title":"Benthos","text":"<ul> <li>What is Benthos</li> <li>Official documentation</li> <li>Git repo</li> </ul> <p>Benthos has been acquired by RedPanda. Now its known as Redpanda Connect.</p> <p>A streaming ETL service for Data Engineering:</p> <ul> <li>no runtime dependencies</li> <li>declarative config</li> <li>stateless</li> <li>payload agnostic: suitable for all format of data</li> <li>logs, metrics, tracing</li> </ul> <p></p>"},{"location":"automation/benthos/#start","title":"Start","text":"<pre><code># install\nbrew install benthos\n\n# make a config\nbenthos create nats/protobuf/aws-sqs &gt; ./config.yaml\n\n# run\nbenthos -c ./config.yaml\n</code></pre> <p>One can also use <code>benthos</code> as a Docker container.</p>"},{"location":"automation/benthos/#architecture","title":"Architecture","text":"<ul> <li>Inputs: wrap message in a so called Transaction</li> <li>Processors: one/multi Threads</li> <li>Outputs: to destinations</li> </ul> <p>Acknowledgement</p> <p>Only when the ALL tje Outputs successfully reached their goal, there will be a Acknowledgement send back to the data source - for instance Kafka</p> <p>Note</p> <p>By default, nothing get dropped - if sth happens, the message will be send over and over again until its acknowledged.</p>"},{"location":"automation/benthos/#features","title":"Features","text":"<ul> <li>Unit Test: execute by <code>benthos test .</code></li> <li>Bloblang: Benthos' native mapping language<ul> <li>example     </li> <li>subcommand:      <pre><code>benthos blobl 'this.(article | comment | share).content'\n</code></pre></li> <li>benthos blobl server: to test bloblang</li> </ul> </li> </ul>"},{"location":"automation/grafana/","title":"Grafana","text":"<ul> <li>Official site</li> <li>Intro</li> </ul> <p>Grafana is an open source web application commonly used for monitoring resources and data visualization</p>"},{"location":"automation/grafana/#infrastructure","title":"Infrastructure","text":"<pre><code>graph LR\n    A[Data producer] &lt;-- push to/pull from --&gt; B[Database]\n    B -- query data --&gt; C[Grafana]</code></pre> <ul> <li>Data producer: Jenkins CI server, Kubernetes pods, IoT Sensors, VM </li> <li>Database: Prometheus, mySQL</li> </ul>"},{"location":"automation/grafana/#data","title":"Data","text":"<p>There are 2 data categories: </p> <ul> <li>Metrics: CPU oad, current memory Usage, CPU temperature</li> <li>Logs: logs, warning, error</li> </ul>"},{"location":"automation/icalBuddy/","title":"icalBuddy","text":""},{"location":"automation/icalBuddy/#install","title":"install","text":"<pre><code>brew install ical-buddy\n</code></pre>"},{"location":"automation/icalBuddy/#list-calendars","title":"list calendars","text":"<pre><code>icalBuddy calendars\n</code></pre>"},{"location":"automation/icalBuddy/#export-events-to-csv","title":"export events to csv","text":""},{"location":"automation/icalBuddy/#per-calender-in-month-x","title":"per calender in month x","text":""},{"location":"automation/instana/clis/","title":"CLIs, Namespaces","text":""},{"location":"automation/instana/clis/#helm","title":"helm","text":"<p>for Custom Edition</p> <pre><code># Instana Installation: third-party data store operators\nhelm install cass-operator -n instana-cassandra\nhelm install strimzi-kafka-operator -n instana-kafka\nhelm install elastic-operator -n instana-elasticsearch\nhelm install postgres-operator -n instana-postgres\nhelm install zookeeper-operator -n instana-zookeeper\n\n# Instana agents: \nhelm install instana-agent -n instana-agent \n# - Synthetic PoP (Point of presence) is the agent where the Synthetic tests are run.\nhelm install synthetic-pop -n syn\n</code></pre> <p>Synthetic monitoring</p> <p>Synthetic Monitoring\uff08\u5408\u6210\u76d1\u63a7\uff09 \u662f\u4e00\u79cd\u4e3b\u52a8\u7684\u76d1\u63a7\u65b9\u5f0f\uff0c\u5b83\u901a\u8fc7\u6a21\u62df\u7528\u6237\u884c\u4e3a\u6216\u7f51\u7edc\u8bf7\u6c42\uff0c\u5b9a\u671f\u4ece\u9884\u5b9a\u4f4d\u7f6e\u5411\u7cfb\u7edf\u53d1\u8d77\u8bbf\u95ee\uff0c\u4ee5\u6d4b\u8bd5\u548c\u76d1\u63a7\u5e94\u7528\u7684\u53ef\u7528\u6027\u3001\u6027\u80fd\u548c\u529f\u80fd\u3002</p> <p>\u4e0e Real User Monitoring\uff08RUM\uff09\u7684\u533a\u522b:</p> Synthetic Monitoring Real User Monitoring (RUM) \u6765\u6e90 \u6a21\u62df\u811a\u672c \u5b9e\u9645\u7528\u6237\u64cd\u4f5c \u6d41\u91cf \u4eba\u5de5\u751f\u6210 \u6765\u81ea\u771f\u5b9e\u6d41\u91cf \u7528\u9014 \u53ef\u7528\u6027/\u529f\u80fd/\u5168\u7403\u6027\u80fd\u6d4b\u8bd5 \u771f\u5b9e\u7528\u6237\u4f53\u9a8c\u5206\u6790 \u4f9d\u8d56\u7528\u6237\u6d41\u91cf\uff1f \u274c \u4e0d\u4f9d\u8d56 \u2705 \u5fc5\u987b\u6709\u771f\u5b9e\u7528\u6237\u6d41\u91cf"},{"location":"automation/instana/clis/#unit-core","title":"Unit + Core","text":"<ul> <li>Core and Units must be installed in different namespaces. </li> <li>Each Core needs its own namespace. </li> <li>Multiple Units that belong to the same Core can be installed in the same namespace.</li> </ul> <p>Namespace names can be freely chosen. The namespaces <code>instana-core</code> and <code>instana-units</code> are the default NS in standard edition</p> <p>In both NS, a pull secret is needed for pulling the images for Core and Units resources</p> <pre><code>kubectl create secret docker-registry instana-registry \\\n    --namespace=&lt;namespace&gt; \\\n    --docker-username=_ \\\n    --docker-password=&lt;agent_key&gt; \\\n    --docker-server=artifact-public.instana.io\n</code></pre> <p>To see the specification for both Core and Unit resource, check the API Reference.</p>"},{"location":"automation/instana/clis/#namespaces","title":"Namespaces","text":"<p>namespace neutral CLIs:</p> <pre><code># Get events\nkubectl get event --sort-by .metadata.creationTimestamp -n [Namespace]\n\n# Get pods\nkubectl get pod -n [Namespace]\n# Get log of a pod\nkubectl logs pod/[PodName] -n [Namespace]\n# Execute clis in a pod\nkubectl exec -it pod/[PodName] -n [Namespace]\n\n\n# Get ALL resources\nkubectl get all -n [Namespace]\n</code></pre> <p>kubectl CLIs sorted by namespaces:</p>"},{"location":"automation/instana/clis/#instana-agent","title":"instana-agent","text":"<pre><code>kubectl edit agents.instana.io instana-agent -n instana-agent|\nkubectl logs -l app.kubernetes.io/name=instana-agent -n instana-agent -c instana-agent --max-log-requests 999\nkubectl logs -l app.kubernetes.io/component=k8sensor  -n instana-agent --max-log-requests 999 \n</code></pre>"},{"location":"automation/instana/clis/#instana-beeinstana","title":"instana-beeinstana","text":"<pre><code>kubectl edit instana-beeinstana instance -n instana-beeinstana\n</code></pre>"},{"location":"automation/instana/clis/#instana-cassandra","title":"instana-cassandra","text":""},{"location":"automation/instana/clis/#instana-clickhouse","title":"instana-clickhouse","text":"<pre><code>kubectl delete ClickHouseInstallation instana -n instana-clickhouse\nkubectl edit ClickHouseInstallation instana -n instana-clickhouse|\n\nkubectl get ClickHouseInstallation instana -n instana-clickhouse\n</code></pre>"},{"location":"automation/instana/clis/#instana-core","title":"\u26f0\ufe0f instana-core","text":"<p>A Core represents shared components and is responsible for configuring data store access. As a result, most configurations are going to happen here. - This is created using Core Images from the <code>artifact-public.instana.io</code>.</p> <p>A Core resource's YAML might look like this: <pre><code>apiVersion: instana.io/v1beta2\nkind: Core\nmetadata:\n  namespace: instana-core\n  name: instana-core\nspec:\n  ...\n</code></pre></p> <pre><code>kubectl create secret generic instana-core --namespace instana-core --from-file=config.yaml\n\nkubectl delete core instana-core -n instana-core\nkubectl delete secret instana-core -n instana-core\n\nkubectl edit core instana-core -n instana-core\nkubectl edit secret instana-core -n instana-core\n\nkubectl -n instana-core scale deployment --replicas \n\nkubectl describe core instana-core -n instana-core\nkubectl get core instana-core -n instana-core\n\nkubectl instana action reconcile --core instana-core -n instana-core\n</code></pre>"},{"location":"automation/instana/clis/#instana-elasticsearch","title":"instana-elasticsearch","text":"<pre><code>kubectl edit elasticsearches instana -n instana-elasticsearch\n</code></pre>"},{"location":"automation/instana/clis/#instana-kafka","title":"instana-kafka","text":"<pre><code>kubectl edit kafka/instana -n instana-kafka\n\nkubectl -n instana-kafka logs -l strimzi.io/cluster=instana,strimzi.io/component-type=kafka,strimzi.io/controller-name=instana-kafka\n</code></pre>"},{"location":"automation/instana/clis/#instana-operator","title":"instana-operator","text":"<pre><code>kubectl edit deployment instana-operator -n instana-operator\nkubectl -n instana-operator scale deployment instana-operator --replicas 2\n</code></pre>"},{"location":"automation/instana/clis/#instana-postgres","title":"instana-postgres","text":""},{"location":"automation/instana/clis/#instana-unit","title":"\u26f0\ufe0f instana-unit","text":"<p>web &amp; tenant. </p> <pre><code>kubectl create secret generic tenant2-unit2 --from-file=config.yaml -n instana-unit|\nkubectl edit unit bafin-apm -n instana-unit\nkubectl -n instana-unit scale deployment --replicas \n\nkubectl describe unit tenant0-unit0 -n instana-unit\nkubectl get unit tenant0-unit0 -n instana-unit\n</code></pre>"},{"location":"automation/instana/clis/#login-credential","title":"Login credential","text":"<p>The <code>username</code> &amp; <code>pw</code> to login to the Instana UI are stored in a secret <code>instana-unit</code> in this NS. Decode the secret to get the credential:</p> <pre><code>echo xxx | base64 -d\n</code></pre>"},{"location":"automation/instana/clis/#instana-zookeeper","title":"instana-zookeeper","text":""},{"location":"automation/instana/clis/#instana-gitops","title":"instana-gitops","text":""},{"location":"automation/instana/installation/","title":"Installation","text":""},{"location":"automation/instana/installation/#custom-edition","title":"Custom Edition","text":"<ul> <li>Instana Installation on OCP</li> <li>step-by-step</li> </ul>"},{"location":"automation/instana/installation/#what-you-need","title":"What you need","text":"<ul> <li><code>&lt;agent key&gt;</code></li> <li><code>&lt;sales key&gt;</code></li> </ul>"},{"location":"automation/instana/installation/#beeinstana-operator","title":"BeeInstana Operator","text":"<p>BeeInstana can be installed as an OC Operator.</p> <p>Warning</p> <p>Installation of BeeInstana is optional at installation time and it can be added later to an existing installation. However, adding BeeInstana to an existing Instana installation will result in a database migration to BeeInstana. The duration of this migration is dependent on the amount of already existing data.</p>"},{"location":"automation/instana/installation/#install","title":"Install","text":"<p>One needs <code>agent_key</code> to be able to access Helm repo. To install Instana properly, these are the steps you need to do:</p> <ol> <li>install <code>instana-kubectl</code> plugin</li> <li>using the plugin that installed in step 1, install Instana Operator</li> <li>create Instana License File</li> <li>create <code>secret</code> and collect them</li> <li>create CORE config file and create <code>secret</code> out of it</li> <li>create UNIT config file and create <code>secret</code> out of it</li> <li>create routes for both core and unit</li> </ol>"},{"location":"automation/instana/installation/#standard-edition","title":"Standard Edition","text":""},{"location":"automation/instana/installation/#single-node","title":"Single Node","text":""},{"location":"automation/instana/installation/#1-create-a-vm-on-fyre","title":"1. Create a VM on fyre","text":"<p>Create a machine on fyre with at least 16Core, 64 Memory CoreOS. </p> <p>Using the : and the fyre API request to create the machine. Use <code>ssh</code> to access the VM's console"},{"location":"automation/instana/installation/#2-preparing-for-a-single-node-deployment","title":"2. Preparing for a single-node deployment","text":"<p>Doc: https://www.ibm.com/docs/en/instana-observability/current?topic=cluster-preparing</p> <ul> <li>Follow the instructions until th \"Create the directories\"</li> <li>Step Add mount paths ensures the device names remain the same after reboot. Skipping it for now</li> <li><code>&lt;base_domain&gt;</code> is set to the fyre VM's public URL --&gt; this can be changed in the CRD also</li> </ul> <p>TO CHECK: - Firewall rules - Configuring an HTTP proxy</p>"},{"location":"automation/instana/installation/#3-installing","title":"3. Installing","text":"<p>Doc: https://www.ibm.com/docs/en/instana-observability/current?topic=edition-installing</p> <p>In this step, we basically use the command <code>stanctl up</code> to automatically set up everything. Required parameters:</p> <ul> <li>download key or an official agent key: from Instana</li> <li>sales key: from instana</li> <li>domain: fyre VM's public URL</li> <li>tenant: tenant0</li> <li>unit: unit0</li> <li>admin password: setup yourself</li> <li>TLS: auto generate</li> </ul> <p>Tipp: </p> <ul> <li>use <code>stanctl --help</code></li> <li>all configs are in the local directory <code>.stanctl/</code></li> </ul>"},{"location":"automation/instana/installation/#namespaces","title":"Namespaces","text":""},{"location":"automation/instana/installation/#install-instana-agent","title":"Install Instana Agent","text":"<p>One Agent for one Node!</p> <p></p>"},{"location":"automation/instana/installation/#deinstallation","title":"Deinstallation","text":"<p>https://www.ibm.com/docs/de/instana-observability/287?topic=edition-uninstalling</p>"},{"location":"automation/instana/installation/#instana-standard-installation-multi-nodes-airgap","title":"Instana Standard Installation - Multi Nodes - Airgap","text":"<p>Doc</p> instana0 instana1 instana2 Role backend datastore other Function - running backend workloads that require persistent volumes.- runs gateways, acceptors and UI backend - running data stores - running the rest of Instana workloads. Storage requirements Disks for directory <code>/objects</code> Disks for directory <code>/data</code>(500GB), <code>/metrics</code>(1000GB), <code>/analytics</code>(1200GB) - Private IP in LAN <code>10.0.0.0</code> <code>10.0.0.1</code> <code>10.0.0.2</code> <p>Tools</p> <ul> <li>check cpu: <code>lscpu | grep 'CPU(s)'</code></li> <li>check disk <code>lsblk</code></li> </ul> <p>Airgap Modes</p> <ol> <li>Airgap without mirror repo: then download all the images that related to instana</li> <li>Airgap with docker repo</li> </ol>"},{"location":"automation/instana/installation/#bastion-host","title":"Bastion host","text":"<p>This bastion host should have internet connection and is responsible for downloading the stanctl and the related packages. <pre><code># download stanctl rpm\nexport DOWNLOAD_KEY=&lt;instana-download-key&gt;\nexport INSTANA_VERSION=1.8.1-1\nwget https://_:$DOWNLOAD_KEY@artifact-public.instana.io/artifactory/rel-rpm-public-virtual/stanctl-$INSTANA_VERSION.x86_64.rpm\nsudo rpm -Uvh stanctl-$INSTANA_VERSION.x86_64.rpm\n\n# Verify the stanctl version\nstanctl --version\n\n# Check the available Instana version using the downloaded stanctl tool\nstanctl versions identify\n\n# Packing stanctl for air-gap environment, this might take a while\nstanctl air-gapped package\n</code></pre> Now I got a <code>instana-airgapped.tar.gz</code>, I copy it to <code>node0</code> using ssh: <pre><code>scp instana-airgapped.tar.gz root@node0:/root/instana-airgapped.tar.gz\n</code></pre></p>"},{"location":"automation/instana/installation/#node0","title":"node0","text":"<p>storage requirement</p> Description Default directory Min size Disk I use here Object directory <code>/mnt/instana/stanctl/objects</code> 1000 <code>sdb</code>"},{"location":"automation/instana/installation/#0-make-node-offline","title":"0. Make Node offline","text":"<p>to simulate airgap environment, I simply sabotage the gateway IP by <pre><code># 1. check the gateway IP\nip route show\n# default via 10.0.0.254 # &lt;-- this is the gateway IP\n\n# 2. Change the Gateway\nsudo ip route replace default via &lt;new-gateway-ip&gt;\nsudo ip route replace default via 10.0.0.250\n</code></pre></p>"},{"location":"automation/instana/installation/#1-configuration","title":"1. Configuration","text":"<pre><code># 1. Make file system\nfor disk in sdb; do\n    echo \"make filesystem for $disk\"\n    mkfs.xfs -f -i size=1024 -L $disk /dev/$disk\ndone\n\n\n# 2. Create the directories\nmkdir -p /mnt/instana/stanctl/objects\n\n\n# 3. Add mount path\n# Backup fstab file\ncp /etc/fstab /etc/fstab.backup\n# Find out disk uuid\nblkid\n# Append changes to `fstab`\necho \"UUID=&lt;UUID-DISK-sdb&gt;  /mnt/instana/stanctl/objects    xfs   discard,defaults,nofail    0 0\" &gt;&gt; /etc/fstab\nmount -a\nsystemctl daemon-reload\n# Check result\nlsblk\n\n\n# 4. Configure kernel parameters\nsh -c 'echo vm.swappiness=0 &gt;&gt; /etc/sysctl.d/99-stanctl.conf' &amp;&amp; sysctl -p /etc/sysctl.d/99-stanctl.conf\nsh -c 'echo fs.inotify.max_user_instances=8192 &gt;&gt; /etc/sysctl.d/99-stanctl.conf' &amp;&amp; sysctl -p /etc/sysctl.d/99-stanctl.conf\ngrubby --args=\"transparent_hugepage=never\" --update-kernel ALL\n# A system reboot is required for these changes to take effect.\nreboot\n# verfiy the change, you should see: always madvise [never]\ncat /sys/kernel/mm/transparent_hugepage/enabled\n\n\n# 5. Edit $PATH\n# echo 'export PATH=$PATH:/usr/local/bin' &gt;&gt; ~/.bashrc\n# source ~/.bashrc\n# echo $PATH\n\n\n\n# 6. Open ports with rules for Firewall\nsystemctl status firewalld\nfirewall-cmd --permanent --add-port=22/tcp\nfirewall-cmd --permanent --add-port=80/tcp\nfirewall-cmd --permanent --add-port=443/tcp\nfirewall-cmd --permanent --add-port=8443/tcp\nfirewall-cmd --new-zone=internal-access --permanent\n# \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f Replace the node IPs here!\nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node0-IP&gt; \nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node1-IP&gt;\nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node2-IP&gt;\nfirewall-cmd --permanent --zone=internal-access --add-port=22/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=6443/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=10250/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=2379/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=2380/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=5001/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=8472/udp\nfirewall-cmd --permanent --zone=internal-access --add-port=9443/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=53/udp\nfirewall-cmd --permanent --zone=internal-access --add-port=53/tcp\nfirewall-cmd --permanent --zone=trusted --add-source=10.42.0.0/16\nfirewall-cmd --permanent --zone=trusted --add-source=10.43.0.0/16\nfirewall-cmd --permanent --zone=trusted --add-interface=lo\nfirewall-cmd --reload\n</code></pre>"},{"location":"automation/instana/installation/#2-ssh-configuration","title":"2. SSH configuration","text":"<p>SSH configuration is required only in a multi-node cluster. The <code>node0</code> must be able to access <code>node1</code> and <code>node2</code> by using SSH.</p> <pre><code># generate ssh key pairs\nssh-keygen -t rsa\n\n# output the Public Key \n# copy the output to node1 and node2\n# cat /root/.ssh/id_rsa.pub\n\n# Copies your public SSH key to a remote host's authorized_keys file (/root/.ssh/authorized_keys)\nssh-copy-id -i /root/.ssh/id_rsa root@instana-1\nssh-copy-id -i /root/.ssh/id_rsa root@instana-2\n# Prompt will remind you to type in the ssh password to both hosts (instana-1 and instana-2)\n</code></pre>"},{"location":"automation/instana/installation/#3-stanctl","title":"3. stanctl","text":"<p>In a multi-node cluster, you must install stanctl on <code>node0</code>. I got <code>instana-airgapped.tar.gz</code> from a connected environment - in our case the <code>student</code> machine.</p> <pre><code># 1. Extracting archives to the target directory '/usr/local/bin'\ntar -xzf instana-airgapped.tar.gz -C /usr/local/bin --strip-components 1 airgapped/stanctl\n\n\n# 2. Extract air-gapped instana files: no mirror-repositories\nstanctl air-gapped import --file  instana-airgapped.tar.gz\n\n# 3. creating instana\nstanctl up --air-gapped --multi-node-enable\n# ? Select installation type for multi-node cluster installation: production\n# ? Enter the IP addresses for all three nodes, separated by commas. The first IP is for the backend, the second is for the datastore (e.g., 10.8.1.10,10.8.1.11,10.8.1.12): 10.0.0.30,10.0.0.31,10.0.0.32\n# ? Enter the download key or an official agent key: **********************\n# ? Enter the sales key: **********************\n# ? Enter the domain under which Instana will be reachable: prod.instana.training\n# ? Enter your tenant name: labs\n# ? Enter your unit name: student\n# ? Enter Instana admin password: ********\n# ? Confirm Instana admin password: ********\n# ? Enter TLS certificate file (hit ENTER to auto-generate):\n</code></pre> <p>domain</p> <p>the domain can be found in in the file <code>/etc/hosts</code>. The document contains content in the following format: <pre><code>&lt;IP Address&gt; &lt;Hostname&gt; [Alias...]\n</code></pre> I saw: <pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n10.0.0.30   instana-0 ... student-labs.prod.instana.training ...\n</code></pre></p> <p>Seeing <code>student-labs.prod.instana.training</code>, we make:</p> <ul> <li>base domain: <code>prod.instana.training</code></li> <li>unit: <code>student</code></li> <li>tenent: <code>labs</code></li> </ul> <p>UI URL of Instana Platform</p> <p>In this case the Instana URL is <code>student-labs.prod.instana.training</code></p>"},{"location":"automation/instana/installation/#install-agent","title":"Install agent","text":"<p>install agent, it will create pods for each nodes.</p> <pre><code>stanctl agent apply\n</code></pre>"},{"location":"automation/instana/installation/#node1","title":"node1","text":"<p>storage requirement</p> Description Default directory Min size Disk I use here Data directory <code>/mnt/instana/stanctl/data</code> 500 <code>sdb</code> Metrics directory <code>/mnt/instana/stanctl/metrics</code> 1000 <code>sdc</code> Analytics directory <code>/mnt/instana/stanctl/analytics</code> 1200 <code>sdd</code>"},{"location":"automation/instana/installation/#1-configuration_1","title":"1. Configuration","text":"<pre><code># 1. Make file system\nfor disk in sdb sdc sdd; do\n    echo \"make filesystem for $disk\"\n    mkfs.xfs -f -i size=1024 -L $disk /dev/$disk\ndone\n\n\n# 2. Create the directories\nmkdir -p /mnt/instana/stanctl/data\nmkdir -p /mnt/instana/stanctl/metrics\nmkdir -p /mnt/instana/stanctl/analytics\n\n\n# 3. Add mount path\n# Backup fstab file\ncp /etc/fstab /etc/fstab.backup\n# Find out disk uuid\nblkid\n# Append changes to `fstab`\necho \"UUID=&lt;UUID-DISK-500GB&gt;   /mnt/instana/stanctl/data       xfs   discard,defaults,nofail    0 0\" &gt;&gt; /etc/fstab\necho \"UUID=&lt;UUID-DISK-1000GB&gt;  /mnt/instana/stanctl/metrics    xfs   discard,defaults,nofail    0 0\" &gt;&gt; /etc/fstab\necho \"UUID=&lt;UUID-DISK-1200GB&gt;  /mnt/instana/stanctl/analytics  xfs   discard,defaults,nofail    0 0\" &gt;&gt; /etc/fstab\nmount -a\nsystemctl daemon-reload\n# Check result\nlsblk\n\n\n# 4. Configure kernel parameters\nsh -c 'echo vm.swappiness=0 &gt;&gt; /etc/sysctl.d/99-stanctl.conf' &amp;&amp; sysctl -p /etc/sysctl.d/99-stanctl.conf\nsh -c 'echo fs.inotify.max_user_instances=8192 &gt;&gt; /etc/sysctl.d/99-stanctl.conf' &amp;&amp; sysctl -p /etc/sysctl.d/99-stanctl.conf\ngrubby --args=\"transparent_hugepage=never\" --update-kernel ALL\n# A system reboot is required for these changes to take effect.\nreboot\n# verfiy the change, you should see: always madvise [never]\ncat /sys/kernel/mm/transparent_hugepage/enabled\n\n# 5. Edit $PATH\necho 'export PATH=$PATH:/usr/local/bin' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\necho $PATH\n\n\n# 6. Open ports with rules for Firewall\nsystemctl status firewalld\nfirewall-cmd --permanent --add-port=22/tcp\nfirewall-cmd --permanent --add-port=80/tcp\nfirewall-cmd --permanent --add-port=443/tcp\nfirewall-cmd --permanent --add-port=8443/tcp\nfirewall-cmd --new-zone=internal-access --permanent\n# \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f Replace the node IPs here!\nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node0-IP&gt; \nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node1-IP&gt;\nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node2-IP&gt;\nfirewall-cmd --permanent --zone=internal-access --add-port=22/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=6443/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=10250/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=2379/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=2380/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=5001/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=8472/udp\nfirewall-cmd --permanent --zone=internal-access --add-port=9443/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=53/udp\nfirewall-cmd --permanent --zone=internal-access --add-port=53/tcp\nfirewall-cmd --permanent --zone=trusted --add-source=10.42.0.0/16\nfirewall-cmd --permanent --zone=trusted --add-source=10.43.0.0/16\nfirewall-cmd --permanent --zone=trusted --add-interface=lo\nfirewall-cmd --reload\n</code></pre>"},{"location":"automation/instana/installation/#2-ssh-configuration_1","title":"2. SSH configuration","text":"<pre><code># Copy the public key content to the $HOME/.ssh/authorized_keys\necho \"&lt;Public-key&gt;\" &gt;&gt; /root/.ssh/authorized_keys\n</code></pre>"},{"location":"automation/instana/installation/#node3","title":"node3","text":""},{"location":"automation/instana/installation/#1-configuration_2","title":"1. Configuration","text":"<pre><code># 1. Configure kernel parameters\nsh -c 'echo vm.swappiness=0 &gt;&gt; /etc/sysctl.d/99-stanctl.conf' &amp;&amp; sysctl -p /etc/sysctl.d/99-stanctl.conf\nsh -c 'echo fs.inotify.max_user_instances=8192 &gt;&gt; /etc/sysctl.d/99-stanctl.conf' &amp;&amp; sysctl -p /etc/sysctl.d/99-stanctl.conf\ngrubby --args=\"transparent_hugepage=never\" --update-kernel ALL\n# A system reboot is required for these changes to take effect.\nreboot\n# verfiy the change, you should see: always madvise [never]\ncat /sys/kernel/mm/transparent_hugepage/enabled\n\n\n# 2. Edit $PATH\necho 'export PATH=$PATH:/usr/local/bin' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\necho $PATH\n\n\n# 3. Open ports with rules for Firewall\nsystemctl status firewalld\nfirewall-cmd --permanent --add-port=22/tcp\nfirewall-cmd --permanent --add-port=80/tcp\nfirewall-cmd --permanent --add-port=443/tcp\nfirewall-cmd --permanent --add-port=8443/tcp\nfirewall-cmd --new-zone=internal-access --permanent\n# \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f Replace the node IPs here!\nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node0-IP&gt; \nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node1-IP&gt;\nfirewall-cmd --permanent --zone=internal-access --add-source=&lt;node2-IP&gt;\nfirewall-cmd --permanent --zone=internal-access --add-port=22/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=6443/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=10250/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=2379/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=2380/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=5001/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=8472/udp\nfirewall-cmd --permanent --zone=internal-access --add-port=9443/tcp\nfirewall-cmd --permanent --zone=internal-access --add-port=53/udp\nfirewall-cmd --permanent --zone=internal-access --add-port=53/tcp\nfirewall-cmd --permanent --zone=trusted --add-source=10.42.0.0/16\nfirewall-cmd --permanent --zone=trusted --add-source=10.43.0.0/16\nfirewall-cmd --permanent --zone=trusted --add-interface=lo\nfirewall-cmd --reload\n</code></pre>"},{"location":"automation/instana/installation/#2-ssh-configuration_2","title":"2. SSH configuration","text":"<pre><code># Copy the public key content to the $HOME/.ssh/authorized_keys\necho \"&lt;Public-key&gt;\" &gt;&gt; /root/.ssh/authorized_keys\n</code></pre>"},{"location":"automation/instana/installation/#result","title":"result","text":"<p>you can access the UI from Bastion workstation.</p>"},{"location":"automation/instana/installation/#bug-documentation","title":"Bug Documentation","text":"<p>error</p> <p>Error: </p> <pre><code>running \"ssh [-o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -o NumberOfPasswordPrompts=0 -o LogLevel=ERROR root@10.0.0.31 systemctl start k3s]\" failed with exit code 1 (Job for k3s.service failed because the control process exited with error code.\nSee \"systemctl status k3s.service\" and \"journalctl -xeu k3s.service\" for details.\n</code></pre> <p>Reason: firewall setting is wrong, you might forgot to add the followings, check the firewall setting in this page:</p> <p>Solution: <pre><code>firewall-cmd --permanent --zone=internal-access --add-source=&lt;node0-IP&gt; ...\nfirewall-cmd --reload\n</code></pre></p> <p>error</p> <p>Error: </p> <pre><code>Executable k3s binary not found at /usr/local/bin/k3s\n\n# or\nError: stat /root/.stanctl/k3s/k3s: no such file or directory\n</code></pre> <p>Reason: k3s installation went wrong</p> <p>Solution: delete the cluster, clean up the installed stanctl and redo the <pre><code># remove k3s\nsource /usr/local/bin/k3s-uninstall.sh\nrm -rf /etc/rancher/k3s\nrm -rf /var/lib/rancher/k3s\nrm -rf /var/lib/kubelet\nrm -rf /etc/cni\nrm -rf /opt/cni\nrm -rf /var/lib/cni\nrm -rf ~/.kube \n\n\n# remove stanctl\nrm -rf /root/.stanctl\nrm -f /usr/local/bin/stanctl\n</code></pre></p> <p>then re-do the STANCTL step</p>"},{"location":"automation/instana/agents/on_linux/","title":"On linux","text":"<ul> <li>Install agent on Linux</li> <li>Instana agent types</li> </ul>"},{"location":"automation/instana/agents/on_linux/#agent-types","title":"agent types","text":"<ul> <li>dynamic agent = self-update agent, needs internet connection, use the Instana repository for updates.</li> <li>static agent = self-update agent, air-gap suitabke</li> </ul>"},{"location":"automation/instana/theory/1.jargons/","title":"Jargons","text":""},{"location":"automation/instana/theory/1.jargons/#intro","title":"Intro","text":"<p>Instana is AI powered APM(Application Performance Monitoring) solution that automatically monitors containerized, microservice applciations. It trys to automate much things as possible in the Application Lifecycle:</p> <p></p> <p>This is what Instana wants to archieve: </p>"},{"location":"automation/instana/theory/1.jargons/#key-concepts","title":"Key Concepts","text":""},{"location":"automation/instana/theory/1.jargons/#1-auto-discovery","title":"1. Auto Discovery","text":"<ul> <li>One agent, deployed once</li> <li>Continuous real-time inventory of all components</li> <li>Automatic tracing:<ul> <li>fully automatic (zero touch) for: Java, Scala, Python, PHP, .net</li> <li>requires Instana library inclusion: NodeJS, Golang, Ruby, Crystal</li> </ul> </li> <li>1 Second Granularity: big advantage in highly dynamic environment, if you have details that accurate to each seconds, you are able to see which problem comes first. </li> </ul>"},{"location":"automation/instana/theory/1.jargons/#2-dynamic-graph","title":"2. Dynamic Graph","text":"<p>Dynamic Graph is a depedency tree between all the infrastructures. It shows the connections between the services.</p> <p>Example</p> <p>In this Dynamic Graph, there are 5 hosts: 4 for ElasticSearch, 1 for SpringBoot </p> <p>Simplified Flow Diagram</p> <p>Instana Agent --&gt; Instana Backend --Slack--&gt; User:</p> <p></p>"},{"location":"automation/instana/theory/1.jargons/#3-data-collection","title":"3. Data Collection / \u6570\u636e\u6536\u96c6","text":"<p>\u6570\u636e\u6536\u96c6\u662f\u6307\u901a\u8fc7\u5404\u79cd\u65b9\u6cd5\u3001\u5de5\u5177\u548c\u6280\u672f\uff0c\u4ece\u8f6f\u4ef6\u7cfb\u7edf\u4e2d\u5b9e\u65f6\u63d0\u53d6\u4e0e\u6027\u80fd\u3001\u884c\u4e3a\u76f8\u5173\u7684\u6307\u6807\u3001\u65e5\u5fd7\u548c\u8ffd\u8e2a\u4fe1\u606f\u7684\u8fc7\u7a0b\u3002Instana\u6536\u96c64\u79cd\u4fe1\u606f\uff1a</p> <ol> <li>Metrics - Qualitative attributes of the technology that indicate performance. E.g.:<ul> <li>Process CPU</li> <li>Service latency</li> <li>Web Page load time</li> </ul> </li> <li>Events - Changes: Initial discovery and state changes, Built-In Events based on failing health rules and Custom Events based on the thresholds. E.g.:<ul> <li>Host offline</li> <li>Docker container offline</li> <li>JVM GC Suspension High</li> <li>Service Latency Slow</li> </ul> </li> <li>Configuration - Catalogs current settings and states in order to keep track of any configuration change</li> <li>Traces - Represent transactions and are captured based upon the programming language platform. Traces are made up of one or more Calls. Java, Scala, Net, PHP, Python, Node.js, Ruby, Go, others via SDK.</li> </ol>"},{"location":"automation/instana/theory/1.jargons/#4-data-retention","title":"4. Data Retention / \u6570\u636e\u4fdd\u7559","text":"<p>\u6570\u636e\u4fdd\u7559\u662f\u6307\u5b58\u50a8\u5df2\u6536\u96c6\u6570\u636e\u7684\u65f6\u95f4\u957f\u5ea6\u4ee5\u53ca\u5982\u4f55\u7ba1\u7406\u8fd9\u4e9b\u6570\u636e\u4ee5\u4f18\u5316\u5b58\u50a8\u6210\u672c\u3001\u6027\u80fd\u548c\u5408\u89c4\u6027\u3002\u6d89\u53ca\u65f6\u95f4\u7ef4\u5ea6\uff0c\u50a8\u5b58\u7b56\u7565\uff0c\u5408\u89c4\u6027\u8981\u6c42\u7b49\u7b49</p> <ol> <li>Metrics Data Retention<ul> <li>1 Second Granularity is stored for the last 24 hours</li> <li>5 Seconds for 24 hours</li> <li>60 seconds for 1 month</li> <li>5 minutes for 3 months</li> <li>1 hour for 13 months</li> </ul> </li> <li>Events Data Retention<ul> <li>Life of Contract</li> </ul> </li> <li>Dynamic Graph/Configuration Data Retention<ul> <li>Life of Contract</li> </ul> </li> <li>Traces Data Retention<ul> <li>100% Full Traces for last 7 days</li> <li>Significant Calls and KPIs for 1 year</li> </ul> </li> </ol>"},{"location":"automation/instana/theory/1.jargons/#5-built-in-intelligence","title":"5. Built-in Intelligence","text":"<ul> <li>Curated Knowledge Base<ul> <li>Health Signatures &amp; Thresholds for discovered technologies</li> </ul> </li> <li>Pattern Detection Algorithms<ul> <li>Edge Detection/\u8fb9\u7f18\u68c0\u6d4b\uff1a\u662f\u56fe\u50cf\u5904\u7406\u548c\u8ba1\u7b97\u673a\u89c6\u89c9\u4e2d\u7684\u57fa\u672c\u95ee\u9898\uff0c\u8fb9\u7f18\u68c0\u6d4b\u7684\u76ee\u7684\u662f\u6807\u8bc6\u6570\u5b57\u56fe\u50cf\u4e2d\u4eae\u5ea6\u53d8\u5316\u660e\u663e\u7684\u70b9\u3002\u56fe\u50cf\u5c5e\u6027\u4e2d\u7684\u663e\u8457\u53d8\u5316\u901a\u5e38\u53cd\u6620\u4e86\u5c5e\u6027\u7684\u91cd\u8981\u4e8b\u4ef6\u548c\u53d8\u5316\u3002</li> </ul> </li> <li>Dynamic Graph<ul> <li>Entity Relationships</li> </ul> </li> <li>Learning of Normal Patterns</li> </ul> <p>Ultimate Goal: to go faster: </p>"},{"location":"automation/instana/theory/1.jargons/#version-compability","title":"Version compability","text":"<p>docu</p> <p></p>"},{"location":"automation/instana/theory/2.agent_sensor/","title":"Agent, Sensor","text":"<p>Instana Bootcamp for EL: Replays</p>"},{"location":"automation/instana/theory/2.agent_sensor/#agent","title":"Agent","text":""},{"location":"automation/instana/theory/2.agent_sensor/#installation","title":"Installation","text":"<p>How to install Instana Agents in Instana itself. </p> <p> </p> <ul> <li>Mirror the technology in use<ul> <li>K8S: use the daemonset/operator/helm chart</li> <li>Docker: use the Instana Agent Docker container</li> <li>Host(e.g. Linux): use the host agent for the OS</li> </ul> </li> <li>In each case the result will be 1 agent on each host (or worker node)</li> </ul>"},{"location":"automation/instana/theory/2.agent_sensor/#agent-modes","title":"Agent Modes","text":"<p>The agent has the following modes: </p> <ul> <li>APM (Application Performance Monitoring) License:: FULL traces including application performance AND infrastructure(<code>INFRA</code>)</li> <li>INFRA (Infrastructure Monitoring) License: This mode focuses on collecting infrastructure-level metrics and entities, such as CPU usage, memory consumption, and disk I/O. It does not collect application traces.</li> <li>OFF: In this mode, the agent runs but does not collect any telemetry data. This is useful when you want to disable monitoring for specific hosts or environments.</li> </ul> <p>telemetry data</p> <p>\"telemetry data\"\uff08\u9065\u6d4b\u6570\u636e\uff09\u662f\u4e00\u4e2a\u603b\u79f0\uff0c\u6307\u7684\u662f\u76d1\u63a7\u7cfb\u7edf\u81ea\u52a8\u6536\u96c6\u7684\u5173\u4e8e\u7cfb\u7edf\u3001\u5e94\u7528\u7a0b\u5e8f\u548c\u57fa\u7840\u8bbe\u65bd\u8fd0\u884c\u72b6\u6001\u7684\u6570\u636e\u3002\u4e3e\u4f8b\uff1a</p> <ul> <li>Application telemetry: HTTP \u8bf7\u6c42\u5ef6\u8fdf\uff08latency\uff09\u3001\u541e\u5410\u91cf\uff08throughput\uff09\u3001\u9519\u8bef\u7387\uff08error rate\uff09, \u8c03\u7528\u94fe\uff08distributed traces / spans\uff09, \u6570\u636e\u5e93\u67e5\u8be2\u8017\u65f6, \u7b2c\u4e09\u65b9 API \u54cd\u5e94\u65f6\u95f4</li> <li>Infrastructure telemetry: CPU \u4f7f\u7528\u7387, \u5185\u5b58\u4f7f\u7528\u91cf, \u7f51\u7edc I/O\u3001\u78c1\u76d8 I/O, \u5bb9\u5668\u72b6\u6001\u3001Pod \u72b6\u6001</li> </ul> <p></p>"},{"location":"automation/instana/theory/2.agent_sensor/#agent-types","title":"Agent Types","text":"Agent Type Description Platforms/Targets Host Agents Collect and aggregate data from sensors; send to Instana backend.* Automatically installs most sensors; some require manual configuration. <code>VMs</code>, <code>physical hosts</code>, <code>Kubernetes</code>, <code>Cloud Foundry</code>, <code>VMware Tanzu</code>, etc.  --&gt; Install tutorial Cloud Service Agents Monitor cloud-managed services. e.g., <code>AWS RDS</code>, <code>Azure subscriptions</code> --&gt; Install tutorial Serverless Agents Monitor serverless platforms. e.g., <code>AWS Lambda</code> --&gt; Install tutorial Website &amp; Mobile Agents Monitor websites and mobile apps. Web and mobile platforms  --&gt; Install tutorial <p>Serverless</p> <p>\u201cServerless\u201d\uff08\u65e0\u670d\u52a1\u5668\uff09\u8fd9\u4e2a\u8bcd\u5728\u4e91\u8ba1\u7b97\u4e2d\u5e38\u5e38\u4f1a\u5f15\u8d77\u8bef\u89e3\u3002\u5b83\u5e76\u4e0d\u662f\u771f\u7684\u201c\u6ca1\u6709\u670d\u52a1\u5668\u201d\uff0c\u800c\u662f\u6307\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u914d\u7f6e\u3001\u7ef4\u62a4\u6216\u6269\u5c55\u670d\u52a1\u5668\u3002\u53ea\u5173\u6ce8\u4ee3\u7801\u672c\u8eab\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cServerless \u67b6\u6784\u4ecd\u7136\u4f9d\u8d56\u670d\u52a1\u5668\uff0c\u4f46\u8fd9\u4e9b\u670d\u52a1\u5668\u662f\u7531\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\uff08\u6bd4\u5982 AWS\u3001Azure\u3001Google Cloud\uff09\u7ba1\u7406\u7684\u3002</p>"},{"location":"automation/instana/theory/2.agent_sensor/#agent-deployment-options","title":"Agent Deployment Options","text":"<p>Instana Agent Deployment/Configuration Options:</p> Dynamic Static starts with minimal requirements, slowly loads other ONLY when necessary fixed size from the beginning, has everything - Agent Bootstrap - Sensors loaded dynamically from repository (Instana or Mirrored) - Configurable, scheduled updates - Always on the latest version of Instana + sensors - Can be pinned - Reinstall only required to update the Agent Bootstrap  - Package includes all sensors- Sensors are already present- Startup time is faster!- Upgrades need a more traditional approach- Perfect for air-gapped and more traditional environments- New install required to bump sensor or bootstrap versions <p>Bootstrap</p> <p>\u4f60\u53ef\u4ee5\u628a \u201cBootstrap\u201d \u7406\u89e3\u4e3a agent \u542f\u52a8\u65f6\u5fc5\u9700\u7684\u6700\u5c0f\u6838\u5fc3\u7ec4\u4ef6\u96c6\u5408\uff0c\u7528\u6765\u201c\u5f15\u5bfc\u201d\u6574\u4e2a\u4ee3\u7406\u7a0b\u5e8f\u8fd0\u884c\u8d77\u6765\u3002</p> <p>What to choose? Dynamic vs Static</p> <p>Treat this choice like any other software update strategy, ask yourself these questions:</p> <ul> <li>What type of environment is it?</li> <li>What are the characteristics of the environment?</li> <li>Is it change controlled?</li> <li>Should it be predictable?</li> </ul>"},{"location":"automation/instana/theory/2.agent_sensor/#agent-configuration","title":"Agent Configuration","text":""},{"location":"automation/instana/theory/2.agent_sensor/#1-method-configuration-files","title":"1. Method: configuration files","text":"<ul> <li>Handled using <code>configuration.yaml</code> and <code>configuration*.yaml</code>, eventually they will be parsed again automatically.</li> <li>Allows for modular configuration using existing automation tooling</li> </ul> <p>Sometimes the configuration file is too big, we could separate the configurations into dedicated files like this:</p> <p></p> <p>Example: in the directory <code>/opt/instana/agent/etc/instana</code> there are the configuration files. One of them <code>process-monitor.yaml</code> is printed here:</p> <p></p> <p>Example: other <code>*.cfg</code> files:</p> <ul> <li><code>com.instana.agent.main.conf ig.UpdateManager.crg</code>: configuration of update frequency</li> <li><code>com.instana.agent.bootstrap.AgentBootstrap.cfg</code>: version of the Instana Agent</li> </ul> <p></p> <p>*.cfg</p> <p>.cfg \u6587\u4ef6\u662f\u7a0b\u5e8f\u7528\u6765\u8bfb\u53d6\u521d\u59cb\u5316\u914d\u7f6e\u7684\u7eaf\u6587\u672c\u6587\u4ef6\uff0c\u5185\u5bb9\u683c\u5f0f\u548c\u7528\u9014\u53d6\u51b3\u4e8e\u5b83\u670d\u52a1\u7684\u7a0b\u5e8f\uff0c\u5e38\u89c1\u683c\u5f0f\u6709\uff1a</p> <ul> <li>key = value\uff08\u952e\u503c\u5bf9\uff09</li> <li>INI \u683c\u5f0f\uff08\u5305\u542b section \u7684\u7ed3\u6784\uff09</li> <li>JSON\u3001XML\u3001YAML \u7b49\u683c\u5f0f\uff08\u90e8\u5206\u9ad8\u7ea7\u573a\u666f\uff09</li> </ul>"},{"location":"automation/instana/theory/2.agent_sensor/#2-method-gitops-configurations","title":"2. Method: GitOps Configurations","text":"<p>Instana agents also support GitOps configuration mgmt. </p>"},{"location":"automation/instana/theory/2.agent_sensor/#sensors","title":"Sensors","text":"<p>Sensors are specific modules that are deployed on the agent to monitor particular technologies, services, or aspects of your environment. One Agent can have multiple Sensors</p> <p>To see which sensors are loaded, and their versions. </p> <p> </p> <p><code>xxx-Discovery</code> are the Sensors that detect whether changes about <code>xxx</code> happens. </p>"},{"location":"automation/instana/theory/2.agent_sensor/#sensors-configurations","title":"Sensors Configurations","text":"<ul> <li>Wherever possible, discovery and configuration is automated</li> <li>Further configuration is needed for some sensors<ul> <li>If locations or configuration cannot be automatically located</li> <li>If authentication is required to access stats or metrics</li> <li>If Instana's automated process does not work</li> </ul> </li> </ul>"},{"location":"automation/instana/theory/2.agent_sensor/#demo","title":"Demo","text":"<p>Spring Boot on K8S </p> <p>Breaking the stacks down:</p> <ul> <li>host: <code>gke-k8s-demo...internal</code> </li> <li>node: <code>gke-k8s-demo-...-3y6n</code></li> <li>pod: <code>robot-shop...</code></li> <li>container: <code>catalogue</code></li> <li>process: <code>java</code></li> <li>app: <code>Instana Demo - Catalogue app 0.0.1</code></li> </ul> <p>Somtimes you needs multiple Sensors for a particular Technology:</p> <ul> <li>The agent will reach out with its initial instrumentation via <code>docker exec</code> or <code>runc</code> commands</li> <li>Sensors will then be loaded in the target environment by the JVM, each with their own line of communication to the Instana agent, for example:<ul> <li><code>Spring boot sensor (inc. micrometer metrics)</code></li> <li><code>Java Sensor</code></li> <li><code>Java Profile Sensor</code></li> <li><code>Java Trace Sensor for instrumentation</code></li> </ul> </li> </ul>"},{"location":"automation/instana/theory/2.agent_sensor/#troubleshoting","title":"Troubleshoting","text":"<p>Check the following:</p> <ul> <li>Can the agent talk to the Instana backend?</li> <li>If the agent is dynamic, can it talk to the Instana repo (or your mirror)?</li> <li>Check proxy set up for both the repo and the backend</li> <li>Is the <code>&lt;agent key&gt;</code> is correct?</li> <li>Check the <code>agent.log</code> and use <code>DEBUG</code> Mode if needed</li> </ul>"},{"location":"automation/instana/theory/2.agent_sensor/#instana-backend","title":"Instana Backend","text":"<p>Instana backend architecture diagram:</p> <p></p> <ul> <li>EUM: End-user monitoring</li> </ul>"},{"location":"automation/instana/theory/2.agent_sensor/#infrastructure-map","title":"Infrastructure Map","text":"<p>This visual infrastructure map is one of the most important page of Instana </p>"},{"location":"automation/instana/theory/2.agent_sensor/#dynamic-focus-queries","title":"Dynamic Focus Queries","text":"<p>Instana uses Lucene query syntax to build complex queries. Tutorial can be found here.</p> <p></p> <ul> <li>Metadata from the monitored technology is indexed and made available for searching via Dynamic Focus.</li> <li>Dynamic Focus is available for Infrastructure and Events.</li> <li>The Lucene query syntax is used for the query language.</li> <li>Automatic completion is available in the UI.</li> </ul> <p>Examples</p> <ul> <li><code>entity.type:php</code>, <code>entity.type:java</code></li> <li><code>entity.tag:nonprod</code></li> <li><code>entity.zone:webtest</code></li> <li><code>entity.kubernetes.namespace:production</code></li> <li><code>entity.type:elasticsearch</code> OR <code>entity.type:cassandra</code> OR <code>entity.type:mongodb</code></li> </ul>"},{"location":"automation/instana/theory/2.agent_sensor/#other-resources","title":"Other Resources","text":"<p>https://instana.github.io/openapi/#section/Overview</p> <p>https://www.ibm.com/docs/en/instana-observability/current</p>"},{"location":"automation/instana/theory/2.agent_sensor/#glossary","title":"Glossary","text":"<ul> <li>FQDN: Fully Qualified Domain Name.  It is the fullest possible domain name of a host or a computer, on the internet.</li> </ul>"},{"location":"automation/instana/theory/3.trace/","title":"Trace, Call, Span","text":""},{"location":"automation/instana/theory/3.trace/#1-automatic-tracing","title":"1. Automatic Tracing","text":"<ul> <li>Fully automatic: Java, Scala, Python, PHP, .net/.net core*</li> <li>Only requires Instana library inclusion: NodeJS, Golang, Ruby, Crystal</li> </ul> <p>100% Tracing: We don't sample! We record all!</p> <p>Trace &amp; Call &amp; Span</p> <p></p>"},{"location":"automation/instana/theory/3.trace/#trace","title":"Trace","text":"<p>A Trace is composed of one or more calls.</p>"},{"location":"automation/instana/theory/3.trace/#trace-timing","title":"Trace Timing","text":"<ul> <li>Total Time: the total (clock) time of a call</li> <li>Wait Time: the amount of time the call spends waiting on all downstream calls to complete = Sum of all downstream calls Total Time</li> <li>Self Time: The difference between the caller's Exit Span Time and the call's Entry Span Time <pre><code>Self Time = Total Time - Wait Time - Network Time\n</code></pre></li> </ul> <p>Example</p> <p></p>"},{"location":"automation/instana/theory/3.trace/#calls","title":"Calls","text":"<p>A Call describes an activity within a monitored process, typically a request between two services. Every Call is comprised of one or more Spans</p>"},{"location":"automation/instana/theory/3.trace/#spans","title":"Spans","text":"<p>Types of Spans:</p> <ul> <li> <p>Entry Span: a request from an uninstrumented process to an instrumented process. </p> <p>Entry Span \u8868\u793a\u8bf7\u6c42\u8fdb\u5165\u4e0b\u4e00\u4e2a\u670d\u52a1\u6216\u7ec4\u4ef6\u65f6\u7684\u65f6\u95f4\u8de8\u5ea6\u3002It contains Source Details</p> <p>\ud83c\udf30 \u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7535\u5546\u7f51\u7ad9\uff0c\u5f53\u7528\u6237\u5728\u524d\u7aef\u9875\u9762\u70b9\u51fb\u201c\u4e0b\u5355\u201d\u6309\u94ae\u65f6\uff0c\u8fd9\u4e2a\u8bf7\u6c42\u88ab\u53d1\u9001\u5230\u540e\u7aef\u8ba2\u5355\u670d\u52a1\u3002\u6b64\u65f6\uff0c\u8ba2\u5355\u670d\u52a1\u4f1a\u4e3a\u8fd9\u4e2a\u8bf7\u6c42\u521b\u5efa\u4e00\u4e2a Entry Span\u3002\u8fd9\u4e2a Entry Span \u7684\u8d77\u70b9\u662f\u8ba2\u5355\u8bf7\u6c42\u5230\u8fbe\u8ba2\u5355\u670d\u52a1\u7684\u65f6\u95f4\uff0c\u7ec8\u70b9\u662f\u8ba2\u5355\u670d\u52a1\u5f00\u59cb\u5904\u7406\u8be5\u8bf7\u6c42\u7684\u65f6\u95f4\u3002</p> </li> <li> <p>Exit Span: a call from an instrumented process to an uninstrumented process. </p> <p>Exit Span \u8868\u793a\u8bf7\u6c42\u4ece\u5f53\u524d\u670d\u52a1\u6216\u7ec4\u4ef6\u53d1\u9001\u51fa\u53bb\u7684\u65f6\u95f4\u8de8\u5ea6\u3002It contains Destination Details</p> <p>\ud83c\udf30 \u7ee7\u7eed\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u5f53\u8ba2\u5355\u670d\u52a1\u5904\u7406\u5b8c\u7528\u6237\u7684\u8ba2\u5355\u8bf7\u6c42\u540e\uff0c\u9700\u8981\u8c03\u7528\u652f\u4ed8\u670d\u52a1\u6765\u5904\u7406\u4ed8\u6b3e\u3002\u6b64\u65f6\uff0c\u8ba2\u5355\u670d\u52a1\u4f1a\u521b\u5efa\u4e00\u4e2a Exit Span\u3002\u8fd9\u4e2a Exit Span \u7684\u8d77\u70b9\u662f\u8ba2\u5355\u670d\u52a1\u5f00\u59cb\u5411\u652f\u4ed8\u670d\u52a1\u53d1\u9001\u8bf7\u6c42\u7684\u65f6\u95f4\uff0c\u7ec8\u70b9\u662f\u8bf7\u6c42\u88ab\u6210\u529f\u53d1\u9001\u51fa\u53bb\u5e76\u7b49\u5f85\u652f\u4ed8\u670d\u52a1\u54cd\u5e94\u7684\u65f6\u95f4\u3002</p> </li> <li> <p>Exit+Entry Span - a request from an instrumented process to another instrumented process. There will be an exit span for the client process (caller) and an entry span for the process serving the response (callee). Example: An HTTP call that is called from another HTTP Call. </p> <p>\ud83c\udf30 Exit Span \u548c Entry Span \u7684\u7ec4\u5408\u901a\u5e38\u7528\u4e8e\u63cf\u8ff0\u8bf7\u6c42\u5728\u670d\u52a1\u4e4b\u95f4\u4f20\u9012\u65f6\u7684\u5b8c\u6574\u8def\u5f84\u3002\u8fd9\u79cd\u7ec4\u5408\u6709\u52a9\u4e8e\u5168\u9762\u4e86\u89e3\u8bf7\u6c42\u4ece\u4e00\u4e2a\u670d\u52a1\u4f20\u9012\u5230\u53e6\u4e00\u4e2a\u670d\u52a1\u7684\u6574\u4e2a\u8fc7\u7a0b\u3002\u901a\u8fc7\u7ed3\u5408 Exit Span \u548c Entry Span\uff0c\u53ef\u4ee5\u8ffd\u8e2a\u8bf7\u6c42\u5728\u7cfb\u7edf\u4e2d\u7684\u5b8c\u6574\u6d41\u5411\uff0c\u5e76\u8bc6\u522b\u53ef\u80fd\u7684\u6027\u80fd\u74f6\u9888\u6216\u5ef6\u8fdf\u4f4d\u7f6e\u3002</p> </li> </ul> <p>(un)instrumented process</p> <p>An instrumented process is one that has been set up with tools or mechanisms to collect data about its performance, status, and behavior.</p> <p>Trans/Spans</p> <p>The concept of Traces and Spans comes from:</p> <ul> <li>Google \"Dapper, a Large-Scale Distributed Systems Tracing Infrastructure</li> <li>The OpenTracing Semantic Specification</li> </ul> <p>They area also open source Tracing Technologies that Instana supports.</p>"},{"location":"automation/instana/theory/3.trace/#endpoints","title":"Endpoints","text":"<p>Endpoints define the API of a service. Every endpoint has a single, automatically discovered type: <code>BATCH</code>, <code>Database</code>, <code>HTTP</code>, <code>MESSAGING</code>, <code>RPC</code>, <code>GraphQL</code></p> <p></p>"},{"location":"automation/instana/theory/3.trace/#service","title":"Service","text":"<p>A service is a bucket of endpoints that typically maps to Infrastructure.</p> <ul> <li>If multiple instances of this e.g. container operate at the same time, they will all map to the same logical service.</li> <li>Service <code>types</code>(HTTP, Database, Messaging) &amp; <code>names</code> are assigned automatically through inheritance from endpoints.</li> </ul> <p></p> <p>Service in the UI:</p> <p></p> <p>Configure Custom Service Rule:</p> <p></p> <p>Service</p> <p>A bit like the <code>service</code> concept in OpenShift</p> <p>Latency</p> <p>Latency is a measure of delay, usually in milliseconds.     </p> <p>Endpoint Latency indicates how quickly an endpoint responds to incoming requests.</p>"},{"location":"automation/instana/theory/3.trace/#service-analyze-calls","title":"Service &gt; Analyze Calls","text":"<p>The Service <code>catalogue-demo</code> dashboard:</p> <p></p> <p>After you click Analyze Calls:</p> <p></p>"},{"location":"automation/instana/theory/3.trace/#2-application-perspective-ap","title":"2. Application Perspective (AP)","text":"<p>An Application Perspective represents a set of services and endpoints that are defined by a shared context and is declared by using tags.</p> <p>The Applications can be filtered by the following patterns:</p> <ul> <li>by Team: <code>Service=Cart|Payment|Checkout</code></li> <li>by Environment: <code>Tag=Production</code></li> <li>by Call Data:<ul> <li>HTTP Param: <code>WS_Name=Search</code></li> <li>HTTP header: <code>account_id=001</code></li> </ul> </li> </ul> <p>Example</p> <p></p> <p>Calls filtered after <code>service.name=\"Customer Care\"</code>:</p> <p></p> <p>Calls filtered after <code>service.name=\"Fleet Management\"</code> &amp; <code>http.parameters.tenant=\"Kiosk\"</code>:</p> <p></p> <p>Calls filtered after <code>service.name=\"Finance\"</code></p> <p></p> <p>Filter to get a new Application Perspective:</p> <p> </p>"},{"location":"automation/instana/theory/3.trace/#analyze-profile","title":"Analyze Profile","text":"<p>You can also analyze the profile of the request</p> <p></p>"},{"location":"automation/instana/theory/4.event/","title":"Event, Alert","text":""},{"location":"automation/instana/theory/4.event/#events","title":"Events","text":""},{"location":"automation/instana/theory/4.event/#events_1","title":"\u4e24\u79cdEvents","text":""},{"location":"automation/instana/theory/4.event/#custom-events","title":"Custom Events","text":"<p>Custom Event enables you to create issues or incidents based on an individual metric of any given entity.</p>"},{"location":"automation/instana/theory/4.event/#built-in-events","title":"Built-in Events","text":"<p>Built-in events are predefined health signatures based on integrated algorithms which help you to understand the health of your monitored system in real-time. You can DISABLE them under Settings &gt; Events --&gt; here you can find all the built-in Events</p> <p></p> <p>Info</p> <p>Built-in Events Reference</p> <p>For example, this \"Erroneous Call rate too high\" has a default value of <code>50%</code>. You might want to customize them by Create A New Event</p> <p></p> <p>Changes - A change is anything from a server start/stop, a deployment, a configuration change. E.g: - changed configuration of components - offline/online</p> <p>Issues - An Issue is created if an entity gets unhealthy. They are detected by machine learning algorithms and health signatures built to detect various unhealthy situations. E.g.:  - degradation of service - complex infrastructure issues - disk saturation</p> <p>Incidents - Incidents are the highest level of events. They are created when an edge service is impacted, and they correlate all relevant events by leveraging the Dynamic Graph to provide context.</p> <p>Urgency</p> <p>Incidents &gt; Issues &gt; Changes</p> <p>event-specific Dynamic Focus Queries</p> <ul> <li><code>event.state:open</code></li> <li><code>event.severity:10</code>   (10=Severe, 5=Warning)</li> <li><code>event.text:\"sudden increase in latency\"</code>: </li> <li><code>event.entity.label:shop</code></li> <li><code>event.state:open AND event.severity:10 AND NOT event.text:\"sudden increase in latency\"</code></li> </ul>"},{"location":"automation/instana/theory/4.event/#event-type","title":"Event type","text":"<p>\u5c06 Event \u6309\u7167\u5176\u4e25\u91cd\u7a0b\u5ea6\u5206\u7c7b\uff1a</p> <ul> <li>Critical incident - incident (critical).</li> <li>Warning incident - incident (warning).</li> <li>Critical issue - issue (critical).</li> <li>Warning issue - issue (warning).</li> </ul>"},{"location":"automation/instana/theory/4.event/#incidents","title":"Incidents","text":"<ul> <li>Multiple Issues correlated into one Incident</li> <li>Incident forwarded via various channels with deep link back to Instana Dashboard</li> </ul> <p>Analyse Incident with UI:</p> <p></p> <p>The Related Events are sorted by Dynamic Graph:</p> <p>e.g. the first 3 events are all related to the Incident <code>MySQL@3306 on demo-mysql</code></p> <p></p> <p>For each Event we can look into its detail by clicking the \"+\":</p> <p></p> <p>concept</p> <p>Triggering event: The event that triggered this Incident</p> <p>Service Impact: Service(s) impacted by this Incident.</p>"},{"location":"automation/instana/theory/4.event/#alert","title":"Alert","text":"<p>Workflow of the Alert:</p> <p></p> <p>Best Practise</p> <p></p>"},{"location":"automation/instana/theory/4.event/#alert-channels","title":"Alert Channels","text":"<p>\u5047\u5982\u5ba2\u6237\u5f53\u524d\u7684\u751f\u6001\u7cfb\u7edf\u4e2d\u5df2\u7ecf\u5728\u4f7f\u7528\u5176\u4ed6\u5de5\u5177\uff0c \u6bd4\u5982\u4ed6\u4eec\u4e60\u60ef\u4e8e\u7528 Email\u6216\u8005ServiceNow \u67e5\u770balert\uff0c\u90a3\u4e48 Instana \u63d0\u4f9b\u4e86\u53ef\u4ee5\u878d\u5165\u8fdb\u751f\u6001\u7cfb\u7edf\u7684\u5de5\u5177 - Alert Channels\u3002 \u6bd4\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 Alert Channels \u5c06 Instana \u4e2d\u7684 alerts \u53d1\u9001\u5230\u7279\u5b9a\u7684\u90ae\u7bb1\u4e2d\u53bb</p> <p></p>"},{"location":"automation/instana/theory/4.event/#smart-alerts","title":"Smart Alerts","text":"<p>they are templates for creating new alert. Workflow of the Smart Alert:</p> <p></p> <p>Add Smart Alert:</p> <p></p> <p></p> <p>Advantages:</p> <ul> <li>easy to create</li> <li>has revisions</li> <li>possible to duplicate it</li> <li>multiple contidtions possible</li> </ul>"},{"location":"automation/instana/theory/4.event/#custom-payload","title":"Custom Payload","text":"<p>Custom Payload is what content is sent out by the alert. The content is different depends on the Alert Channels. They are <code>key-value</code> pairs.</p> <p></p>"},{"location":"automation/instana/theory/4.event/#maintenance-windows","title":"Maintenance Windows","text":"<p>to create a window that mutes the alert during a certain time range. E.g. when software has a new release, we want to mute all the alert during the new deployment.</p> <p></p>"},{"location":"automation/instana/theory/5.api/","title":"Integration, SKD, API","text":"<p>Doc: Instana Integration, SDK, API</p>"},{"location":"automation/instana/theory/5.api/#api","title":"API","text":"<p>Instana REST API Doc</p> <p>Instana REST API (or called Web REST API) \u7528\u4e8e\u68c0\u7d22\u8ddf\u8e2a\u3001\u6307\u6807\u548c\u914d\u7f6e\u6570\u636e\uff0c\u4f8b\u5982\u670d\u52a1\u63d0\u53d6\u548c\u7528\u6237\u7ba1\u7406\u3002There are 2 ways to use it:</p> <ul> <li>Unit-specific API tokens: \u53ef\u4ee5\u63a7\u5236\u6743\u9650\u3002 Unit-specific tokens can be seen and modified by anyone with the correct permission.</li> <li>Personal API tokens\uff1aONLY require a name to be set</li> </ul>"},{"location":"automation/instana/theory/5.api/#usage","title":"Usage","text":"<ul> <li>The base URL is the same URL that is used to access the Instana user interface: <code>https://&lt;TENANT&gt;-&lt;UNIT&gt;.instana.io/api</code></li> <li>Authorization: Include your API token in the Authorization header by using the Bearer scheme.</li> </ul> <pre><code>curl -X GET https://&lt;TENANT&gt;-&lt;UNIT&gt;.instana.io/api/&lt;INSTANA_REST_API_ENDPOINT&gt; \\\n     -H \"Authorization: Bearer &lt;YOUR_API_TOKEN&gt;\"\n</code></pre> <p>Warning</p> <p>Be aware there is rate limits for the API!</p>"},{"location":"automation/instana/theory/5.api/#pagination","title":"Pagination","text":"<p>Pagination / limit / offset are referred as <code>pageSize</code> in Instana REST API, example:</p> <pre><code>{\n    \"page\": 2,\n    \"pageSize\": 50\n}\n</code></pre>"},{"location":"automation/instana/theory/6.ui/","title":"UI","text":""},{"location":"automation/instana/theory/6.ui/#menu","title":"Menu","text":""},{"location":"automation/instana/theory/6.ui/#infrastructure","title":"Infrastructure","text":"<p>In Infrastructure Map:</p> <ul> <li>zone: group of pillars<ul> <li>manual or automatic groupping -&gt;  \u914d\u7f6e agent \u7684\u65f6\u5019\u53ef\u8bbe\u7f6e</li> </ul> </li> <li>pillar: one agent</li> <li>block in the pillar: software components running on the system. <ul> <li>The color of the block refects the component's health</li> <li>a component can be: a JVM process, a TOMcat server within a JVM etc</li> </ul> </li> </ul>"},{"location":"automation/instana/theory/6.ui/#tenants","title":"Tenants","text":"<p>Each Account can have one or more Tenants which can be hosted either in the Instana SaaS environment or On Prem.</p> <ul> <li><code>prod-example.instana.io</code> -&gt; Saas</li> <li><code>pra-instana.example.com</code> -&gt; On Prem (Single Docker or K8S)</li> </ul>"},{"location":"automation/instana/theory/6.ui/#filters","title":"Filters","text":"<ul> <li>Time picker / Release</li> <li>Toggle visibility using the Legend</li> <li>Time correlation when interacting with Chart</li> <li>Diagram: Swipe mouse for more options</li> </ul> <p>SLI &amp; SLO</p> <p>Service Level Indicator (SLI)</p> <p>An SLI is a quantitative measure of a specific aspect of service performance. It indicates how well a service is performing based on certain key metrics. SLIs are typically tied to user experience and help identify how a system is functioning in real-time. Examples of SLIs:</p> <pre><code>- Availability: The percentage of time a service is up and accessible.\n- Latency: The time it takes for a service to respond to a request.\n- Error Rate: The percentage of failed requests out of total requests.\n- Throughput: The rate at which requests are successfully handled by the system.\n</code></pre> <p>Service Level Objective (SLO) An SLO is a target or goal set for an SLI over a specified time period. It defines the level of performance that a service must achieve to meet the expectations of users or stakeholders. SLOs help teams set realistic and measurable objectives to maintain service quality, acting as benchmarks for reliability. Examples of SLOs:</p> <pre><code>- Availability SLO: 99.9% uptime over a month.\n- Latency SLO: 95% of requests should respond within 200 milliseconds.\n- Error Rate SLO: Error rate should not exceed 1% of total requests.\n</code></pre>"},{"location":"automation/nodered/intro/","title":"Introduction","text":"<p>NodeRed is NodeJS based low-code programming for event-driven applications. Can run on:</p> <ul> <li>Local</li> <li>Docker</li> <li>Devices: Raspberry Pi, FlowFuse Device Agent ...</li> <li>Cloud: AWS, Azure ...</li> </ul> <p>Docs</p> <ul> <li>offcial doc</li> <li>Youtube Tutorial</li> </ul> <p>Each Node:</p> <ul> <li>performs an individuell function</li> <li>self-contained: a.k.a NO external dependencies</li> <li>modula</li> <li>reusable</li> </ul> <p>NodeRed uses flow-based programming, to start the flow, a msg need to be injected through a Input Node.</p>"},{"location":"automation/nodered/intro/#nodes","title":"Nodes","text":""},{"location":"automation/nodered/intro/#common-nodes","title":"Common Nodes","text":""},{"location":"automation/nodered/intro/#input-node","title":"Input Node","text":"<p>to inject messages</p>"},{"location":"automation/nodered/intro/#debug-node","title":"Debug Node","text":"<p>Attention: You need to activate the Node by click on the panel.</p> <p>You can log the whole <code>json</code> object and paste it directly where you needed it:</p> <p></p>"},{"location":"automation/nodered/intro/#function-node","title":"Function Node","text":"<p>the most powerful node, you can write custom JS code there.</p>"},{"location":"automation/nodered/intro/#exec-node","title":"Exec Node","text":"<p>another VERY power node that can execute CLIs. </p>"},{"location":"automation/nodered/intro/#js-variables","title":"JS Variables","text":"Variable <code>context</code> local variable ONLY for the current flow/line <code>flow</code> global variable for the current flow tab <code>global</code> global variable for ALL flow tab ``"},{"location":"automation/nodered/intro/#link-nodes-pair","title":"Link Nodes (Pair)","text":"<p>it has the following functionalities:</p> <ul> <li>Share data: it can pass Data through Flow in different tabs</li> <li>Triggers other flows</li> </ul>"},{"location":"automation/nodered/intro/#catch-node","title":"Catch Node","text":"<p>to catch errors in the flow</p>"},{"location":"automation/nodered/intro/#install-new-node","title":"Install new Node","text":"<p>There are more available Nodes on the market, you can install them by:</p> <p> </p>"},{"location":"automation/nodered/intro/#flow","title":"Flow","text":"<p>you can also import/export a Flow. You can do this for:</p> <ul> <li>selected Nodes</li> <li>current flow</li> <li>all flows</li> </ul> <p>in the format of:</p> <ul> <li>Clipboard</li> <li>Library: like a template that can be reused later</li> </ul>"},{"location":"automation/nodered/intro/#subflow","title":"Subflow","text":"<p>to create a Subflow, select a node, go to Setting &gt; Subflows &gt; Selection to Subflow.</p> <p>to edit the Subflow, double click &gt; Edit Subflow</p>"},{"location":"automation/nodered/intro/#flow-in-tab","title":"Flow in Tab","text":"<p>double click on the tab to rename/delete the flow</p>"},{"location":"automation/nodered/intro/#shortcuts","title":"Shortcuts","text":"<p>You can find all the shortcuts under Setting &gt; Keyboard</p> <ul> <li><code>ctrl+Z</code> undo</li> <li><code>ctrl+C</code> copy</li> <li><code>ctrl+V</code> paste</li> <li><code>ctrl+X</code> cut</li> </ul>"},{"location":"bash_script/","title":"Basics","text":"<p>Several shells are installed on your PC, do this at your root: <pre><code>cat /etc/shells\n</code></pre> You might see this:</p> <pre><code>/bin/bash\n/bin/csh\n/bin/dash\n/bin/ksh\n/bin/sh\n/bin/tcsh\n/bin/zsh\n</code></pre> <p>The current shell in usage can be found by: <pre><code>echo $SHELL\n</code></pre></p>"},{"location":"bash_script/#introductions","title":"Introductions","text":"<p>To get the helping doc: <pre><code>man [command]\n</code></pre></p>"},{"location":"bash_script/#grammar","title":"Grammar","text":"<pre><code># [Command] [Flags] [Arguments]\nls -lrt /home\n</code></pre> <ul> <li>Flags can be written together with one <code>-</code> in front</li> <li>Arguments should be separated by space</li> </ul>"},{"location":"bash_script/#script-file-sh","title":"Script file (<code>*.sh</code>)","text":"<p><pre><code>#!/bin/bash\nnpm -v\n</code></pre> The first line starts with <code>#!</code> is called shebang line and it indicates what shell to use.</p> <p>Warning</p> <p>In a script file, the commands will be executed \"line by line\".</p> <p>Semicolon (<code>;</code>)</p> <p>The semicolon (<code>;</code>) has the same funcitonality of a newline. <pre><code>echo \"hello\"; sleep 4; echo \"world\"\n</code></pre> is equal to: <pre><code>echo \"hello\"\nsleep 4\necho \"world\"\n</code></pre></p>"},{"location":"bash_script/#execution","title":"Execution","text":"<p>Shell Script is a sequence of commands pasted in a text file. The purpose is to automate repetitive tasks in our Unix/Linux environment. You can execute shell by:</p> <ol> <li> <p>Writing the command directly: <code>java -version</code></p> </li> <li> <p>Executing *.sh file: </p> <ul> <li><code>bash my_cmds.sh</code></li> <li> <p><code>./my_cmds.sh</code></p> <p>If you have permission issue, do <code>ls -lrt</code> to check the permissions, and use <code>chmod u+x my_cmds.sh</code> to add execution permission to the file</p> </li> </ul> </li> </ol> <p><code>bash</code> VS <code>.</code></p> <p><code>.</code> needs execution permission</p>"},{"location":"bash_script/#variables","title":"Variables","text":"<pre><code>#!bin/bash\na=2\nb=$((a+3))\nc=read\nd=/etc/shells\ne=$(hostname)\n</code></pre> <p>Grammar</p> <ul> <li><code>$(())</code> syntax is used for arithmetic evaluation </li> <li><code>$(command)</code> syntax is used to capture the output of a command</li> </ul>"},{"location":"bash_script/#types","title":"Types","text":"<p>There are 3 types:</p> <ol> <li>User defined variables</li> <li>System defined variables such as <code>${USER}</code><ul> <li>defined with CAPITAL LETTERS</li> <li>a list of variables set by bash can be found herer</li> </ul> </li> <li>Special variables such as <code>$$</code>, <code>$?</code>, <code>$@</code>...</li> </ol> <p>Info</p> <p>to see all set variables, run <code>set</code></p>"},{"location":"bash_script/#exit-status","title":"Exit Status","text":"<p>Many commands in bash follow this convention:</p> <ul> <li><code>0</code>: Successful execution.</li> <li><code>1</code>: Command executed but did not succeed in finding/matching/performing the desired task.</li> <li><code>2</code> or higher: An error occurred during the execution.</li> </ul> <p>check Exit Status</p> <p>To check Exit Status, you can run this direct after running a command line such as <code>echo \"1 3 2\" | grep  2</code>:</p> <pre><code>echo $?\n</code></pre>"},{"location":"bash_script/#naming","title":"Naming","text":"<ul> <li>0-9, A-Z and _ are allowed</li> <li>should NOT start with number</li> <li>case-sensitive</li> <li>NO space while defining a variable: <code>x = 4</code> will not work</li> <li>use <code>\"\"</code> if the values has space: <code>name=\"John Doe\"</code></li> </ul>"},{"location":"bash_script/#actions","title":"Actions","text":""},{"location":"bash_script/#to-print","title":"&gt; to print","text":"<pre><code># 1. `echo`\necho $a; echo $b; echo $c; echo $d; echo $e\n\n# 2. `cat`\ncat  &lt;&lt; EOF\na:\n${a}\nb:\n${b}\nEOF\n</code></pre> <p>Variable reference</p> <p>Both <code>$a</code> and <code>${a}</code> work, but <code>${a}</code> is more accurate.</p> <p>EOF</p> <p><code>EOF</code> is commonly used to signify the end of a Here Document (also called HereDoc), which is a way to provide multiline input to a command or output in a script.</p> <p><code>EOF</code> stands for End of File, but it\u2019s just a convention and doesn't hold any special meaning. You can use other terms like END or any other string as the delimiter - as long as there is the same word in both start and end.</p>"},{"location":"bash_script/#to-delete","title":"&gt; to delete","text":""},{"location":"bash_script/#a5-unset-a","title":"<pre><code>a=5\nunset a\n</code></pre>","text":""},{"location":"bash_script/#special-variables","title":"Special variables","text":""},{"location":"bash_script/#_1","title":":","text":"<p>a no-op command, \u7b49\u4ef7\u4e8e <code>true</code>\u3002\u5b83\u59cb\u7ec8\u8fd4\u56de\u9000\u51fa\u72b6\u6001\u7801 0\uff08\u6210\u529f\uff09\uff0c\u4f46\u4ec0\u4e48\u5b9e\u9645\u64cd\u4f5c\u4e5f\u4e0d\u505a\u3002\u5e38\u89c1\u7528\u6cd5:</p> <ol> <li>\u4f5c\u4e3a\u5360\u4f4d\u7b26\uff0c\u76f8\u5f53\u4e8epython\u7684pass\uff1a     <pre><code>if [ \"$condition\" ]; then\n    : # \u6761\u4ef6\u4e3a\u771f\uff0c\u4f46\u76ee\u524d\u8fd8\u6ca1\u6709\u5177\u4f53\u64cd\u4f5c\nfi\n</code></pre></li> <li>\u8d4b\u4e88\u53d8\u91cf\u9ed8\u8ba4\u503c\uff1a\u5982\u679c\u53d8\u91cf <code>NAME</code> \u6ca1\u6709\u88ab\u8bbe\u7f6e\u6216\u4e3a\u7a7a\uff0c\u5219\u5c06\u5176\u8d4b\u503c\u4e3a world     <pre><code>: ${NAME:=\"world\"}\necho \"Hello, $NAME\"\n\n# \u7b49\u540c\u4e8e\uff1a\nif [ -z \"$NAME\" ]; then\n    NAME=\"world\"\nfi\n</code></pre></li> <li>\u6e05\u7a7a\u6587\u4ef6     <pre><code>: &gt; file.text\n</code></pre></li> </ol>"},{"location":"bash_script/#_2","title":"&amp;&gt;","text":"<p><code>&amp;&gt;</code> \u662f\u4e00\u79cd \u91cd\u5b9a\u5411\u64cd\u4f5c\u7b26\uff0c\u7528\u4e8e\u540c\u65f6\u5c06 \u6807\u51c6\u8f93\u51fa\uff08stdout\uff09 \u548c \u6807\u51c6\u9519\u8bef\uff08stderr\uff09 \u91cd\u5b9a\u5411\u5230\u540c\u4e00\u4e2a\u76ee\u6807\u3002</p> <p>stdout &amp; stderr</p> <p>Shell \u4e2d\u7684\u6bcf\u4e2a\u547d\u4ee4\u6709\u4e24\u79cd\u4e3b\u8981\u8f93\u51fa\u6d41\uff1a</p> <ul> <li>\u6807\u51c6\u8f93\u51fa\uff08stdout\uff0c\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a <code>1</code>\uff09\uff1a\u7528\u4e8e\u6b63\u5e38\u8f93\u51fa\u3002</li> <li>\u6807\u51c6\u9519\u8bef\uff08stderr\uff0c\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a <code>2</code>\uff09\uff1a\u7528\u4e8e\u9519\u8bef\u6d88\u606f\u6216\u8bca\u65ad\u4fe1\u606f\u3002</li> </ul> <pre><code># \u4ee5\u4e0b\u4e24\u6761\u547d\u4ee4\u6548\u679c\u76f8\u540c\nls &amp;&gt; output.txt\nls &gt; output.txt 2&gt;&amp;1\n</code></pre> <p>\u5e38\u89c1\u7528\u6cd5:</p> <ol> <li>\u9759\u9ed8\u8fd0\u884c\u547d\u4ee4     <pre><code>ls nonexistentfile &amp;&gt; /dev/null\n# \u4e0d\u4f1a\u5728\u5c4f\u5e55\u4e0a\u8f93\u51fa\u9519\u8bef\u6d88\u606f\u3002\n</code></pre></li> <li>\u540c\u65f6\u8bb0\u5f55\u6807\u51c6\u8f93\u51fa\u548c\u9519\u8bef\u5230\u6587\u4ef6     <pre><code>ls existingfile nonexistentfile &amp;&gt; logfile.txt\n# \u628a\u6210\u529f\u7684\u8f93\u51fa\u548c\u9519\u8bef\u6d88\u606f\u90fd\u8bb0\u5f55\u5230 logfile.txt \u4e2d\u3002\n</code></pre>     \u5982\u8981\u5206\u5f00\u6253\u5370\uff1a\u5982\u6210\u529f\uff0c\u4fdd\u5b58\u7ed3\u679c\u5230<code>stdout.log</code>\uff0c\u5982\u5931\u8d25\uff0c\u4fdd\u5b58\u7ed3\u679c\u5230<code>stderr.log</code> <pre><code>command 1&gt; stdout.log 2&gt; stderr.log\n</code></pre></li> </ol>"},{"location":"bash_script/#condition","title":"Condition","text":"<pre><code>case &lt;variable&gt; in\n    &lt;pattern1&gt;) &lt;commands1&gt; ;;\n    &lt;pattern2&gt;) &lt;commands2&gt; ;;\n    ...\nesac\n</code></pre> <ul> <li><code>&lt;pattern1&gt;</code>, <code>&lt;pattern2&gt;</code>: The patterns to compare with the variable.<ul> <li>Wildcards like *, ?, and [...] can be used in patterns.</li> <li>Multiple patterns can be combined with | (logical OR).</li> </ul> </li> <li><code>)</code> Indicates the end of a pattern and the start of commands.</li> <li><code>;;</code> Ends the commands for a pattern.</li> </ul>"},{"location":"bash_script/#operators","title":"Operators","text":""},{"location":"bash_script/#arithmetic-operators","title":"Arithmetic Operators","text":"<p>Addition (+): Binary operation used to add two operands. Subtraction (-): Binary operation used to subtract two operands. Multiplication (*): Binary operation used to multiply two operands. Division (/): Binary operation used to divide two operands. Modulus (%): Binary operation used to find remainder of two operands. Increment Operator (++): Unary operator used to increase the value of operand by one. Decrement Operator (- -): Unary operator used to decrease the value of a operand by one</p>"},{"location":"bash_script/#numeric-comparison-operators","title":"Numeric Comparison Operators","text":"<p>-eq: Equal to. -ne: Not equal to. -lt: Less than. -le: Less than or equal to. -gt: Greater than. -ge: Greater than or equal to.</p>"},{"location":"bash_script/#relational-operators","title":"Relational Operators","text":"<p>\u2018==\u2019 Operator: Double equal to operator compares the two operands. Its returns true is they are equal otherwise returns false. \u2018!=\u2019 Operator: Not Equal to operator return true if the two operands are not equal otherwise it returns false. \u2018&lt;\u2018 Operator: Less than operator returns true if first operand is less than second operand otherwise returns false. \u2018&lt;=\u2019 Operator: Less than or equal to operator returns true if first operand is less than or equal to second operand otherwise returns false \u2018&gt;\u2019 Operator: Greater than operator return true if the first operand is greater than the second operand otherwise return false. \u2018&gt;=\u2019 Operator: Greater than or equal to operator returns true if first operand is greater than or equal to second operand otherwise returns false</p>"},{"location":"bash_script/#logical-operators","title":"Logical Operators","text":"<p>Logical AND (<code>&amp;&amp;</code>, <code>-a</code>): This is a binary operator, which returns true if both the operands are true otherwise returns false. Logical OR (<code>||</code>): This is a binary operator, which returns true if either of the operands is true or if both the operands are true. It returns false only if both operands are false. Not Equal to (<code>!</code>): This is a unary operator which returns true if the operand is false and returns false if the operand is true.</p>"},{"location":"bash_script/#bitwise-operators","title":"Bitwise Operators","text":"<p>Bitwise And (&amp;): Bitwise &amp; operator performs binary AND operation bit by bit on the operands. Bitwise OR (|): Bitwise | operator performs binary OR operation bit by bit on the operands. Bitwise XOR (^): Bitwise ^ operator performs binary XOR operation bit by bit on the operands. Bitwise complement (~): Bitwise ~ operator performs binary NOT operation bit by bit on the operand. Left Shift (&lt;&lt;): This operator shifts the bits of the left operand to left by number of times specified by right operand. Right Shift (&gt;&gt;): This operator shifts the bits of the left operand to right by number of times specified by right operand.</p>"},{"location":"bash_script/#file-test-operators","title":"File Test Operators","text":"<p>-b operator: returns true if the file is a block special file otherwise false. -c operator: returns true if it is a character special file otherwise false. -d operator: If given directory exists then operators returns true otherwise false. -e operator: If given file exits this operator returns true otherwise false. -r operator: If given file has read access then it returns true otherwise false. -w operator: If given file has write then it returns true otherwise false. -x operator: If given file has execute access then it returns true otherwise false. -s operator: If the size of given file is greater than 0 then it returns true otherwise it is false.</p> Operator Description <code>-a</code> AND `` `` `` `` <code>-ne</code> not equal -------"},{"location":"bash_script/#input","title":"Input","text":"<ol> <li> <p><code>read [-rp] Variable(s)</code></p> <p>Example: <pre><code>read -p \"Enter shell type and your name: \" myShell myName\n# in ZSH, it should be: \n#       read \"?Enter shell type and your name: \" myShell myName\n# The ? in zsh serves the same purpose as -p in bash\necho \"Your shell type is ${myShell}, Your name is ${myName}\"\n</code></pre></p> <p>Another example: add field separater: <pre><code>IFS=':' read -p \"Enter shell type and your name, separate them by ':': \" myShell myName\necho \"Your shell type is ${myShell}, Your name is ${myName}\"\n</code></pre></p> <p>IFS</p> <p>IFS = Internal Field Separator</p> </li> <li> <p><code>source</code></p> <p>Commonly used when the variables are shared between different environments <pre><code>vi [myfile]\nsource [myfile]\n</code></pre> Example: <pre><code># myfile: this file has no prefix\nname=JohnDoe\ncourse=Bash2Automation\n</code></pre></p> </li> <li> <p><code>export</code></p> <pre><code>export name=JohnDoe\n</code></pre> <p>Temporary variable</p> <p>The variable is temporary and is vanish once you close your Shell</p> <p>To see all the available variables, run: <pre><code>export -p\n</code></pre></p> </li> <li> <p>Input as command arguments     <pre><code># mybash.sh\necho \"${1}\"\necho \"${2}\"\necho \"${5}\"\n\necho \"Total amount: ${#}\"\necho \"The whole thing: ${*}\"\necho \"The whole thing: ${@}\"\n\necho \"your script was: ${0}\"\n</code></pre></p> <p>By execusing <code>./mybash.sh hello world how are you</code> you will get the following result: <pre><code>hello\nworld\nyou\nTotal amount: 5    \nThe whole thing: hello world how are you\nThe whole thing: hello world how are you\n\nmybash.sh\n</code></pre></p> <p>Special variables</p> <p>These are all special variables. <code>${1}</code> is positional special variables</p> <p>You can use <code>shift 1</code> to move the arguments <code>1</code> position to the left: <pre><code># mybash.sh\nshift 1\necho \"${1}\"\necho \"${3}\"\n</code></pre> By execusing <code>./mybash.sh hello world how are you</code> you will get the following result: <pre><code>world\nare\n</code></pre></p> </li> </ol> <p><code>$#</code>  number of positional parameters</p>"},{"location":"bash_script/#output","title":"Output","text":"<ol> <li> <p><code>echo [-neE] [argument]</code> <pre><code>echo hello world how are you\necho yourName\necho \"${yourName}\"\n</code></pre></p> <p>Colorful output: <code>-e \"[COLOR_CODE1]Hello [COLOR_CODE1] [COLOR_CODE2]World[COLOR_CODE2]\"</code>. Example: <pre><code>echo -e \"\\033[0;32mHello\\033[0;32m\\033[1;33m World\\033[1;33m\"\n</code></pre></p> </li> <li> <p><code>cat</code></p> </li> <li><code>printf</code></li> </ol>"},{"location":"bash_script/#string-operations","title":"String operations","text":"<p>We assign a variable first:  <pre><code>myStr=Iamacatperson\nyourStr=Iamadogperson\n</code></pre></p> Script Description <code>${myStr}</code> refer to the string <code>${#myStr}</code> length of the string <code>\"${myStr} ${yourStr}\"</code> Concatenation \u26a0\ufe0f Needs to add quotes <code>${myStr,,}</code> Lowercase <code>${myStr^^}</code> Uppercase <code>echo ${myStr} | tr '[a-z]' '[A-Z]'</code> use Transform function to switch between lower and upper cases <code>${myStr:3:2}</code> Slicing with index: from index 3, show 2 characters <code>echo ${myStr} | cut -c 3-5</code> Slicing with index, from 3 to 5 <code>echo ${myStr/One/Two}</code> replace <code>One</code> with <code>Two</code> <code>echo ${myStr}</code> sed 's/One/Two/g'<code>|replace</code>One<code>with</code>Two`"},{"location":"bash_script/#string-operations-on-paths","title":"String operations on Paths","text":"Script Function Description <code>dirname /documents/code/example.txt</code> print the path of the file result: <code>/documents/code</code> <code>basename /documents/code/example.txt</code> print the file name result: <code>example.txt</code>"},{"location":"bash_script/#arrays","title":"Arrays","text":"<p>Bash array = indexed array = list</p>"},{"location":"bash_script/#conditions","title":"Conditions","text":""},{"location":"bash_script/#ifelifelse","title":"if...elif...else","text":"<pre><code>read x \nread y\nif [ $x -gt $y ] \nthen \necho \"X is greater than Y\"\n\nelif [ $x -lt $y ]\nthen \necho \"X is less than Y\"\n\nelif [ $x -eq $y ]\nthen\necho \"X is equal to Y\"\nfi\n</code></pre> <p>Error</p> <p>Make sure there is space after <code>[</code> and before <code>]</code></p> <pre><code>\n</code></pre> <pre><code>\n</code></pre>"},{"location":"bash_script/exercises/","title":"Exercises","text":"<pre><code>docker --version | cut -d  ' ' -f3 | tr -d ','\n</code></pre> <ul> <li><code>|</code> (Pipe)</li> <li> <p><code>cut</code> is a command used to split a string into fields based on a specified delimiter and extract specific fields.</p> <ul> <li><code>-d ''</code> (Delimiter)</li> <li><code>-f3</code> (Field): -f option specifies which field to extract. -f3 means you want the third field based on the delimiter provided.</li> </ul> </li> <li> <p><code>tr</code> stands for \"translate\" and is used to delete or replace characters.</p> <ul> <li><code>-d</code> option tells tr to delete specific characters. In this case, -d ',' will delete any commas from the input.</li> </ul> </li> </ul> <pre><code>ansible --version | awk 'NR==1 {print $2}'\n</code></pre> <ul> <li><code>awk</code> is named after its three creators: Alfred Aho, Peter Weinberger, and Kenneth Thompson. The name itself doesn't directly describe its functionality, but it is a powerful text processing tool that works by dividing lines into fields (by default, fields are separated by spaces or tabs).<ul> <li><code>NR==1</code>: NR stands for \"Number of Records,\" which essentially means the line number. In this case, NR==1 means that this rule will apply only to the first line of input.</li> <li><code>{print $2}</code>: This tells awk to print the second field from the first line of input. In the output of docker --version, the fields are separated by spaces</li> </ul> </li> </ul>"},{"location":"cloud/docker/","title":"Docker","text":"<p>docker compose vs kubernetes/Openshift All of them are frameworks for container orchestration.</p>"},{"location":"cloud/docker/#frequently-used-clis","title":"Frequently used CLIs","text":"<pre><code>docker stop $(docker ps -a -q)\ndocker rm $(docker ps -a -q)\ndocker rmi $(docker images)\n</code></pre>"},{"location":"cloud/helm/helm-1/","title":"Helm","text":"<p>\ud83d\udc4d Helm \u547d\u4ee4\u6587\u6863</p> <p>Helm is a command-line application. It introduces the concept of charts. A chart is a package that describes a set of Kubernetes resources that you can deploy.</p> <p>The following diagram shows the structure of a minimal Helm chart:</p> <pre><code>sample/\n\u251c\u2500\u2500 Chart.yaml\n\u251c\u2500\u2500 templates\n|   |\u2500\u2500 example.yaml\n\u2514\u2500\u2500 values.yaml\n</code></pre> <ul> <li>The <code>Chart.yaml</code> contains chart <code>metadata</code>, such as name and version</li> <li>The <code>templates/</code> directory contains files that define application resources such as <code>deployments</code></li> <li>The <code>values.yaml</code> file contains default <code>values</code> for the chart</li> </ul>"},{"location":"cloud/helm/helm-1/#create-check","title":"create &amp; check","text":"\u547d\u4ee4 <code>helm create myChart</code> to create a new chart <code>helm pull xxx</code> download a chart from a repository\uff08\u5373charts\u7684\u6570\u636e\u5e93\uff09 <code>helm show chart myChart</code> show info of a chart  <code>helm show values myChart</code> show default values of a chart  use <code>--version</code> to choose a specific version"},{"location":"cloud/helm/helm-1/#_1","title":"\u4f9d\u8d56\u7ba1\u7406","text":"\u547d\u4ee4 <code>helm dependency update</code> \u6839\u636e Chart.yaml \u4e2d\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u4e0b\u8f7d\u6216\u66f4\u65b0\u4f9d\u8d56\u7684 Chart \u5230 charts/ \u76ee\u5f55\u3002 <code>helm dependency build</code> \u4f7f\u7528 Chart.lock \u6587\u4ef6\u4e2d\u7684\u7248\u672c\u4fe1\u606f\uff0c\u91cd\u65b0\u4e0b\u8f7d\u4f9d\u8d56\u7684 Chart\u3002 <code>helm dependency list</code> \u5217\u51fa\u5f53\u524d Chart \u7684\u6240\u6709\u4f9d\u8d56\u9879\u53ca\u5176\u72b6\u6001\u3002 <code>helm dependency prune</code> \u5220\u9664\u4e0d\u518d\u9700\u8981\u7684\u4f9d\u8d56 Chart\u3002"},{"location":"cloud/helm/helm-1/#deployment","title":"Deployment","text":"<ul> <li><code>[RELEASE]</code>: release/app</li> <li><code>[CHART]</code>: chart name</li> </ul> \u547d\u4ee4 <code>helm install [RELEASE] .</code> deploy the app from current directory <code>helm install myChartApp do280-repo/etherpad -f values.yaml --version 0.0.6</code> <code>helm uninstall [RELEASE]</code> delete deployment/release <code>helm list</code> list all deployment <code>helm status [RELEASE]</code> check status of named release <code>helm history [RELEASE]</code> check release history <code>helm rollback [RELEASE]</code> roll back to the previous release <code>helm upgrade [RELEASE] [CHART] [flags]</code> <code>helm upgrade myChartApp do280-repo/etherpad --version 0.0.7</code>  upgrade version to 0.0.7 <code>helm upgrade myChartApp do280-repo/etherpad -f values2.yaml</code>  upgrade values  Flags \u6bd4\u5982 <code>-f values.yaml</code> <code>helm template [RELEASE] helm-directory &gt; base/deployment.yaml</code> extract the object definition from Helm Chart into Kustomize's <code>/base/deployment.yaml</code> <p>Info</p> <p>to use <code>values.yaml</code> you can use either <code>--values</code> or <code>-f</code> </p>"},{"location":"cloud/helm/helm-1/#helm-repository","title":"Helm Repository","text":"<p>The distributed community Helm chart repository is located at Artifact Hub and welcomes participation.</p> <p>The following commands change only local configuration:</p> \u547d\u4ee4 <code>helm repo add openshift-helm-charts https://charts.openshift.io/</code> add a new Helm chart repository(named <code>openshift-helm-charts</code>) to your local Helm configuration. <code>helm repo list</code> List Helm chart repositories. <code>helm repo update</code> Update Helm chart repository. <code>helm search repo</code> List ALL available charts in the ALL repos- Add <code>--versions</code> flag to list all versions even though its the same chart <code>helm search repo openshift-helm-charts</code> search for available charts in the <code>openshift-helm-charts</code> repository <code>helm repo remove REPOSITORY1_NAME REPOSITORY2_NAME \u2026\u200b</code> Remove repositories <p>Example</p> <p>result of <code>helm search repo openshift-helm-charts</code>:</p> <p></p> <p>Note</p> <p>\u67d0\u4e2achart\u4e2d\u6709\u8fd9\u4e9bvalues\uff1a <pre><code>[student@workstation ~]$ helm show values do280-repo/etherpad --version 0.0.6\n\nreplicaCount: 1\ndefaultTitle: \"Labs Etherpad\"\ndefaultText: \"Assign yourself a user and share your ideas!\"\n\nimage:\n    repository: etherpad\n    name:\n    tag:\n</code></pre></p> <p>\u81ea\u5b9a\u4e49\u503c <code>values.yaml</code>\uff1a <pre><code>image:\n    repository: registry.ocp4.example.com:8443/etherpad\n    name: etherpad\n    tag: 1.8.18\n</code></pre></p>"},{"location":"cloud/k8s/cka/cka-0/","title":"Read before exam","text":""},{"location":"cloud/k8s/cka/cka-0/#resources","title":"Resources","text":"<ul> <li>CKA Certification</li> <li>KodeKloud git repo</li> <li>KodeKloud Community</li> </ul> <p>KodeKloud discount: <code>20KODE</code></p>"},{"location":"cloud/k8s/cka/cka-8/","title":"8.Storage","text":""},{"location":"cloud/k8s/cka/cka-8/#storage-in-docker","title":"Storage in Docker","text":"<p>Where and how does Docker store data? Background: when installing Docker on your system. you will see this on your host:</p> <pre><code>/var/lib/docker\n    \u251c\u2500\u2500 aufs\n    \u251c\u2500\u2500 containers\n    \u251c\u2500\u2500 image\n    \u2514\u2500\u2500 volumes\n</code></pre>"},{"location":"cloud/k8s/cka/cka-8/#storage","title":"Storage","text":""},{"location":"cloud/k8s/cka/cka-8/#docker-storage","title":"Docker Storage","text":"<p>Docker's Layered architecture</p> <p>Each line of instruction in Dockerfile creates a layer. Each Layer ONLY stores the changes comparing to the previous Layer. <pre><code>FROM Ubuntu\n\nRUN apt-get update &amp;&amp; apt-get -y install python\n\nRUN pip install flask flask-mysql\n\nCOPY \u2022 / opt/source-code\n\nENTRYPOINT FLASK_APP=/opt/source-code/app.py flask run\n</code></pre></p> <p>By building the image using <code>docker build Dockerfile -t myImage</code> we generate Layers. Notice the size of the Layer:</p> <p></p> <p>By building a Container from the Image, we ACTUALLY building another \"Container Layer\" -&gt; This Layer will only exist when it Container exists.</p> <p>Layers</p> <ul> <li>Image Layers: Read-only --&gt; The image Layer will only change if you rebuild the image</li> <li>Container Layer: Read &amp; Write, you can change the file inside the container. For example by <code>vi main.py</code> --&gt; The changes are temporary, they get delete as soon as Container is deleted</li> </ul>"},{"location":"cloud/k8s/cka/cka-8/#storage-driver","title":"Storage Driver","text":"<p>The Storage Driver enables Layered Architecture. It's responsible to:</p> <ul> <li>creating a writeable layer, moving files</li> <li>across layers to enable copy and write</li> </ul> <p>Common Storage Driver</p> <p>There are several Storage Drivers on the market, e.g.: - AUFS - ZFS - BTRFS - Device mapper  - Overlay - Overlay2</p> <p>The selection of the storage driver depends on the underlying OS being used. For example, with Ubuntu the default storage driver is AUFS</p>"},{"location":"cloud/k8s/cka/cka-8/#volume","title":"Volume","text":""},{"location":"cloud/k8s/cka/cka-8/#docker-volume","title":"Docker Volume","text":"<p>To have persistent volume that still exists even the Pod is dead, we can use Volume, there are 2 ways:</p> <ul> <li>Volume mounting: mount a folder under Host's Docker directory to Container     <pre><code>docker run -v data_volume:/var/lib/sql myContainer\n</code></pre></li> <li>Bind mounting: mount a random folder to Container     <pre><code>docker run -v /johndoe/sql:/var/lib/sql myContainer\n</code></pre></li> </ul> <p></p>"},{"location":"cloud/k8s/cka/cka-8/#volume-driver","title":"Volume Driver","text":"<p>Volumes are handled by Volume Driver Plugins, common plugins:</p> <ul> <li>Local: default Plugin, create volume on the Docker Host, and store data under <code>var/lib/docker</code></li> <li>Azure file storage</li> <li>Convoy</li> <li>DigitalOcean</li> <li>Block Storage</li> <li>Flocker</li> <li>Google Compute Persistent Disks</li> <li>Cluster FS</li> <li>NetApp</li> <li>REX-Ray</li> <li>Portworx </li> <li>VMware vSphere storage</li> </ul> <p>Multi-provider Driver</p> <p>Some of these Volume Drivers support different storage providers, for instance, REX-Ray storage driver can be used to provision storage on AWS EBS, S3, EMC storage arrays like Isilon and ScaleIO, or Google Persistent Disk, or OpenStack Cinder.</p> <p>You can choose the Volume Driver when starting a container, the following CLI will create a container and attach a volume from the AWS Cloud. When the container exits, your data is safe in the cloud: <pre><code>docker run -it \\\n    --name mysql \\\n    --volume-driver rexray/ebs \\\n    --mount src=ebs-vol, target=/var/lib/mysql \\\n    mysql\n</code></pre></p>"},{"location":"cloud/k8s/cka/cka-8/#container-storage-interface-csi","title":"Container Storage Interface (CSI)","text":"<p>CSI</p> <p>CSI is not a k8s/oc specific concept, but a universal standard that allows any container orchestration tool to work with any storage provider</p>"},{"location":"cloud/k8s/cka/cka-8/#history-development","title":"History &amp; Development","text":"<p>Previously, Runtime, Storage and Network code were all part of the Kubernetes source code:</p> <p></p> <p>The code is then extracted and defined as standard:</p> <p></p> <p>Now, when new storage solutions appear, all you have to do is writing a Standards-compliant Drivers\uff08\u6216\u8005\u53eb Adapter \u6216 Plugin\uff09 - without touching the Kubernetes code:</p> <p></p> <p>The Interfaces</p> <ul> <li>CRI = Container Runtime Interface</li> <li>CNI = Container Network Interface</li> <li>CSI = Container Storage Interface</li> </ul> <p></p>"},{"location":"cloud/k8s/cka/cka-8/#what-is-in-csi","title":"What is in CSI","text":"<p>The CSI Standard defines a set of RPCs(remote procedure calls), that will be called by the Container Orchestrator(Kubernetes or OpenShift), and these must be implemented by the CSI Drivers.</p> <p>RPC Implementation</p> <p>The CSI content can be find here in gitrepo <code>createVolume</code>, <code>deleteVolume</code>, <code>controllerPublishVolume</code>,</p>"},{"location":"cloud/k8s/cka/cka-8/#csi-driver","title":"CSI Driver","text":"<p>erm\u00f6glicht die Verbindung des OC-Clusters mit verschiedenen Speicherl\u00f6sungen.</p> <p>...</p> <p>other content are already taught in CKAD</p>"},{"location":"cloud/k8s/ckad/TODO/","title":"TODO","text":"<ol> <li>what does this command mean:</li> </ol> <p>command:  - sh  - -c  - echo hello</p> <p>sh -c is a way to run a shell command inside a container, and the -c option is used to pass a command string to the shell for execution.</p> <p>1.1 yaml file - command: easier to put them in json format:     command: [\"/bin/sh\", \"-c\", \"echo Hello, World!\"]</p> <ol> <li> <p>k run sega --image busybox --dry-run=client -o yaml &gt; sega.yaml -- sleep 3600</p> </li> <li> <p>force to replace: k replace --force -f=/tmp/xxx.yaml</p> </li> <li> <p>difference in pod.yaml file: .containers[0].args:</p> </li> <li>sleep</li> <li>\"3600\" .containers[0].command:</li> <li>sleep</li> <li> <p>\"3600\"</p> </li> <li> <p>k get svc: ports format :? <pre><code>NAME           TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\nblue-service   NodePort   10.43.145.169   &lt;none&gt;        8080:30082/TCP   2m24s\n</code></pre> <li> <p>..svc.cluster.local <li> <p>which sa is used in the current pod,\u5728deployment\u91cc\u9762\u53cd\u800c\u770b\u4e0d\u5230serviceaccount <pre><code>kubectl get pods/&lt;podname&gt; -o yaml\n</code></pre> \u7ed3\u679c\u5982\u4e0b\uff1a <pre><code>spec:\n    serviceAccount: default\n    serviceAccountName: default\n</code></pre></p> </li> <p>Question</p> <p>Deployment\u4e2d\u5982\u679c\u4e0d\u6ce8\u660eserviceAccount\u5219\u4ee3\u8868\u4f7f\u7528default\uff1f</p> <p>Docker recommends to always explicily specify your port mappings as strings because of the way YAML parses numbers.</p> <p>Practise these again: 1.Recap Core Concepts 1.2 RS: Nr 14: after editing RS, you need to manually delete the pods 1.4 imperative:  - (5) 2 ways to create svc: k expose vs k create svc - (6-9) expose pod or just define the port: <pre><code>k run custom-nginx --image=nginx --port=8080\nk run custom-nginx --image nginx --expose true --port 8080 # this will also create a SVC with same name, targetPort of this SVC is 8080\n</code></pre></p> <p>2.Configuration 2.1 Commands: 10 (diff between command and args in the yaml file!) 2.4 Security Context: 2 (securityContext in .spec.securityContext vs .spec.containers[0].securityContext) 2.5 Resource Limits?  2.6 SA node affinity if time!</p> <p>3.Mult-Container</p> <p>4.POD Design 4.1 Multi-contianer: nr.8 (namespace) 5.Services 5.2 Network Policies 5.3 Ingress-1: last task =&gt; due to rewrite annotation 5.4 Ingress-2: last task =&gt; didnt work, 503??</p> <p>6.State Persistaence 6.2 Storage Class: 4</p>"},{"location":"cloud/k8s/ckad/ckad-0/","title":"Read before exam","text":""},{"location":"cloud/k8s/ckad/ckad-0/#resources","title":"Resources","text":"<ul> <li>CKAD Certification</li> <li>KodeKloud git repo</li> <li>KodeKloud Community</li> </ul> <p>KodeKloud discount: <code>20KODE</code></p>"},{"location":"cloud/k8s/ckad/ckad-0/#exam-tipps","title":"Exam Tipps","text":"<ol> <li>Do NOT use Ctrl+W</li> <li>Terminal:</li> <li>Copy  = Ctrl+SHIFT+C (inside the terminal)</li> <li>Paste = Ctrl+SHIFT+V (inside the terminal) \u26a0\ufe0f SHIFT = \u21e7</li> <li> <p>Resource allowd in exam</p> </li> <li> <p>Curriculum</p> </li> </ol>"},{"location":"cloud/k8s/ckad/ckad-1/","title":"1.\u6838\u5fc3\u6982\u5ff5\u4ecb\u7ecd","text":""},{"location":"cloud/k8s/ckad/ckad-1/#1","title":"1. \u8003\u8bd5\u5f62\u5f0f","text":"<ul> <li>\u8fdc\u7a0b\uff0c\u8be6\u7ec6\u8981\u6c42\u53ef\u4ee5\u5728\u5b98\u7f51\u4e0a\u627e\u5230</li> <li>\u8003\u8bd5\u65f6\u53ef\u7528\u7684\u8d44\u6e90\uff1ak8s \u5b98\u65b9\u6587\u6863</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-1/#2","title":"2. \u57fa\u672c\u6982\u5ff5","text":"<ul> <li>\u5bb9\u5668\uff08container\uff09\uff1a\u5305\u542b\u4e86 App\uff0c\u548c\u8fd0\u884c App \u6240\u9700\u7684\u6240\u6709\u914d\u7f6e\u4e0e\u73af\u5883\u6bd4\u8d77\u865a\u62df\u673a\uff08VM\uff09\u6765\u66f4\u9ad8\u6548\uff0c\u66f4\u7075\u6d3b</li> <li> <p>Pod\uff1a\u662f k8s \u4e2d\u7684\u6700\u5c0f\u5355\u4f4d\uff0cPod \u4e2d\u7684\u5185\u5bb9\u5206\u4eab\u4e86\u540c\u6837\u7684\u7f51\u7edc\uff08Network\uff09\u548c\u5b58\u50a8\uff08Storage\uff09Pod \u5c01\u88c5\u4e86\u4e00\u4e2a\u6216\u591a\u4e2a container\uff08\u5982\u679c\u662f\u591a\u4e2a container\uff0c\u90a3\u4e48\u5927\u6982\u7387\u8fd9\u4e9b container \u5305\u542b\u4e86\u4e0d\u540c\u7684 App\uff0c\u6bd4\u5982\u4e00\u4e2a\u524d\u7aef App\uff0c\u4e00\u4e2a\u6570\u636e\u5e93 App\uff09\u8c46\u835a\u4e5f\u53ef\u7ffb\u8bd1\u6210 pod\uff0c\u6240\u4ee5\u53ef\u4ee5\u8054\u60f3\u5230\u56fe\u7247\u5982\u4e0b\uff1a</p> <p></p> <p>Note</p> <p>Pod \u5e38\u88ab\u7528\u4e8e\u6269\u5927\u5e94\u7528\u7684\u89c4\u6a21\uff0c\u5047\u8bbe\u4f60\u7684 App \u8bbf\u95ee\u4eba\u6570\u5728\u67d0\u4e2a\u8282\u5047\u65e5\u6fc0\u589e\uff0c\u90a3\u6211\u4eec\u5c31\u65b0\u5efa\u4e00\u4e2a pod\uff0c\u7136\u540e\u628a\u540c\u6837\u7684 App \u90e8\u7f72\u5230\u65b0\u5efa\u7684 pod \u4e0a\uff1b\u540c\u6837\u7684\uff0cPod \u4e5f\u53ef\u4ee5\u88ab\u7528\u4e8e\u964d\u4f4e App \u7684\u89c4\u6a21</p> </li> <li> <p>\u8282\u70b9\uff08node\uff09\uff1a\u5b89\u88c5\u4e86 k8s \u7684\u673a\u5668\uff0cPod \u5c31\u662f\u5728 node \u4e0a\u8dd1\u7684\uff08\u8282\u70b9\u51fa\u95ee\u9898\u88ab\u81ea\u52a8\u5173\u95ed\u7684\u65f6\u5019\uff0c\u5176\u4e0a\u9762\u7684\u5bb9\u5668\u4e2d\u7684 App \u81ea\u7136\u4e5f\u4f1a\u88ab\u5173\u95ed\uff0c\u6240\u4ee5\u4e00\u822c\u6211\u4eec\u4f1a\u591a\u8282\u70b9\u8fd0\u884c\uff09</p> </li> <li>\u5de5\u4f5c\u8282\u70b9\uff08worker node\uff09\uff1a\u771f\u6b63\u5b58\u653e\u5bb9\u5668\uff0c\u5e72\u6d3b\u7684\u8282\u70b9</li> <li>master \u8282\u70b9\uff08master node\uff09\uff1a\u4e5f\u88ab\u53eb\u505a \u63a7\u5236\u9762\u677f/Control plane\uff0c\u76d1\u89c6\u96c6\u7fa4\u4e2d\u7684 worker nodes\uff0c\u5e76\u8d1f\u8d23\u5bf9 worker nodes \u4e0a\u7684\u5bb9\u5668\u8fdb\u884c\u5b9e\u9645\u7f16\u6392\u4e00\u4e2a cluster \u4e2d\u53ef\u4ee5\u6709\u4e00\u4e2a\u6216\u8005\u591a\u4e2a master nodes</li> <li>\u96c6\u7fa4\uff08cluster\uff09\uff1a\u7531\u4e00\u7fa4 nodes \u7ec4\u6210</li> </ul> <p></p>"},{"location":"cloud/k8s/ckad/ckad-1/#master-node-vs-worker-node","title":"Master node VS Worker node","text":"\u7279\u6027 \u4e3b\u8282\u70b9 (Master Node) \u5de5\u4f5c\u8282\u70b9 (Worker Node) \u89d2\u8272 \u7ba1\u7406\u548c\u63a7\u5236\u96c6\u7fa4 \u8fd0\u884c\u5e94\u7528\u5de5\u4f5c\u8d1f\u8f7d\uff08\u5bb9\u5668\uff09 \u4e3b\u8981\u7ec4\u4ef6 - API Server- Scheduler (\u8c03\u5ea6\u5668)- Controller (\u63a7\u5236\u5668) - etcd - kubelet- kube-proxy- Container Runtime \u804c\u8d23 \u5904\u7406\u96c6\u7fa4\u72b6\u6001\u3001\u8c03\u5ea6\u548c\u7f16\u6392 \u6267\u884c\u5de5\u4f5c\u8d1f\u8f7d\u5e76\u7ef4\u62a4\u5bb9\u5668\u8fd0\u884c\u65f6 \u4ea4\u4e92 \u4e3a\u7528\u6237\u548c\u5de5\u5177\u63d0\u4f9b Kubernetes API \u63a5\u53e3 \u4e0e \u4e3b\u8282\u70b9 \u901a\u4fe1\u4ee5\u63a5\u6536\u5de5\u4f5c\u8d1f\u8f7d\u5206\u914d \u6269\u5c55\u6027 \u5c0f\u578b\u5230\u4e2d\u578b\u96c6\u7fa4\u901a\u5e38\u53ea\u9700\u5c11\u91cf \u4e3b\u8282\u70b9 \u4ee5\u786e\u4fdd\u9ad8\u53ef\u7528\u6027 \u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u9700\u6c42\u6269\u5c55 \u5de5\u4f5c\u8282\u70b9 \u6570\u91cf \u6570\u636e \u5c06\u96c6\u7fa4\u72b6\u6001\u5b58\u50a8\u5728 etcd \u4e2d \u4e0d\u5b58\u50a8\u6301\u4e45\u7684\u96c6\u7fa4\u72b6\u6001 \u5de5\u4f5c\u8d1f\u8f7d\u6267\u884c \u4e0d\u8fd0\u884c\u5e94\u7528\u5de5\u4f5c\u8d1f\u8f7d \u8fd0\u884c\u5e94\u7528\u5bb9\u5668 \u8282\u70b9\u6570\u91cf \u5c0f\u578b\u96c6\u7fa4\u901a\u5e38\u6709 1-3 \u4e2a \u4e3b\u8282\u70b9 \uff1b\u9ad8\u53ef\u7528\u6027\u573a\u666f\u9700\u8981\u66f4\u591a \u6839\u636e\u96c6\u7fa4\u89c4\u6a21\u53ef\u4ee5\u6709\u5f88\u591a \u5de5\u4f5c\u8282\u70b9"},{"location":"cloud/k8s/ckad/ckad-1/#3-k8s","title":"3. k8s \u7ec4\u4ef6","text":""},{"location":"cloud/k8s/ckad/ckad-1/#1-control-plane","title":"1. Control Plane \u7ec4\u4ef6","text":""},{"location":"cloud/k8s/ckad/ckad-1/#api-server","title":"API Server","text":"<p>The core component server that exposes the Kubernetes HTTP API</p>"},{"location":"cloud/k8s/ckad/ckad-1/#etcd","title":"ETCD","text":"<p>\uff08\u53d1\u97f3\u4e3aet-see-dee)\uff0c\u662f\u4e00\u4e2a\u5b58\u50a8\u952e\u503c\u5bf9\uff08key-value\uff09 \u7684\u6570\u636e\u5b58\u50a8\uff0c\u7528\u4e8e\u5b9e\u73b0node\u7684\u9501\uff0c\u4ee5\u9632\u6b62\u51b2\u7a81\u7684\u4ea7\u751f</p>"},{"location":"cloud/k8s/ckad/ckad-1/#scheduler","title":"Scheduler","text":"<p>\u8d1f\u8d23nodes\u4e4b\u95f4\u7684\u5de5\u4f5c\u5206\u914d\u548c\u8c03\u5ea6\u5982\u679c\u6709\u65b0\u5efa\u7684container\uff0cScheduler\u4f1a\u5c06container\u5206\u914d\u7ed9node</p>"},{"location":"cloud/k8s/ckad/ckad-1/#kube-controller-manager","title":"kube-controller-manager","text":"<p>\u63a7\u5236 controllers\uff0c\u4e3b\u8981\u7528\u6765\u7ef4\u62a4\u96c6\u7fa4\u5185\u7684\u8d44\u6e90\u72b6\u6001\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-1/#cloud-controller-manager-optional","title":"cloud-controller-manager (optional)","text":"<p>\u662f\u4e13\u95e8\u4e3a\u4e91\u73af\u5883\u8bbe\u8ba1\u7684\uff0c\u8d1f\u8d23\u4e0e\u5e95\u5c42\u4e91\u670d\u52a1\u63d0\u4f9b\u5546\uff08\u5982 AWS\u3001GCP\u3001Azure\uff09\u96c6\u6210\uff0c\u7ba1\u7406\u4e91\u76f8\u5173\u8d44\u6e90\uff0c\u5b83\u5c06\u4e91\u7279\u5b9a\u903b\u8f91\u4ece kube-controller-manager \u4e2d\u5206\u79bb\u51fa\u6765\uff0c\u4fbf\u4e8e Kubernetes \u66f4\u597d\u5730\u652f\u6301\u591a\u79cd\u4e91\u5e73\u53f0\u3002</p> <p>kube/cloud Controller Manager</p> <p>\u4e24\u4e2acontroller manager\u5408\u4f5c\uff0c\u4e00\u8d77\u8d1f\u8d23\u5bf9Controller\u7684\u63a7\u5236\u3002\u63a7\u5236\u5668\uff08Controllers\uff09\u8d1f\u8d23\u7f16\u6392\uff08orchestration\uff09\u8d1f\u8d23\u5728node\u3001container\u6216endpoint\u51fa\u73b0\u6545\u969c\u65f6\u8fdb\u884c\u901a\u77e5\u548c\u54cd\u5e94\uff08\u6bd4\u5982\uff0c\u5728\u7279\u5b9a\u60c5\u51b5\u4e0b\uff0cController\u4f1a\u51b3\u5b9a\u542f\u52a8\u65b0\u5bb9\u5668\uff09\u5728k8s\u4e2d\u6709\u591a\u4e2aControllers\uff0c\u6bcf\u4e2a\u8d1f\u8d23\u4e0d\u540c\u7684\u5de5\u4f5c:</p> kube-controller-manager cloud-controller-manager Node Controller \u8d1f\u8d23\u68c0\u6d4b\u8282\u70b9\u662f\u5426\u53ef\u7528\u3002\u5982\u679c\u8282\u70b9\u4e0d\u53ef\u8fbe\uff0c\u4f1a\u5728\u4e00\u5b9a\u65f6\u95f4\u540e\u5c06\u5176\u6807\u8bb0\u4e3a\u672a\u5c31\u7eea\uff0c\u5e76\u6e05\u7406\u76f8\u5173\u8d44\u6e90\u3002 - \u5728\u4e91\u73af\u5883\u4e2d\u68c0\u6d4b\u865a\u62df\u673a\u8282\u70b9\u662f\u5426\u88ab\u5220\u9664\u3002  - \u5982\u679c\u8282\u70b9\u5728\u4e91\u4e2d\u88ab\u5220\u9664\uff0c\u4f1a\u81ea\u52a8\u4ece Kubernetes \u96c6\u7fa4\u4e2d\u79fb\u9664\u8be5\u8282\u70b9\u3002  Replication Controller \u786e\u4fdd\u6307\u5b9a\u6570\u91cf\u7684 Pod \u526f\u672c\u59cb\u7ec8\u8fd0\u884c\uff08\u7ef4\u62a4\u526f\u672c\u6570\uff09\u3002\u5982\u679c Pod \u610f\u5916\u7ec8\u6b62\uff0c\u4f1a\u521b\u5efa\u65b0\u7684 Pod\u3002 - Endpoints Controller \u7ef4\u62a4\u670d\u52a1\u4e0e Pod \u7684\u6620\u5c04\u5173\u7cfb\uff08\u66f4\u65b0 Endpoints \u5bf9\u8c61\uff09\u3002 - ServiceAccount &amp; Token Controller \u4e3a\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u521b\u5efa\u9ed8\u8ba4\u7684\u670d\u52a1\u8d26\u6237\uff0c\u5e76\u7ba1\u7406\u5176\u5173\u8054\u7684\u8bbf\u95ee\u4ee4\u724c\u3002 - Route Controller - \u914d\u7f6e\u4e91\u63d0\u4f9b\u5546\u7684\u8def\u7531\u8868\uff0c\u4ee5\u4fbf Kubernetes Pod \u7f51\u7edc\u80fd\u591f\u8de8\u8282\u70b9\u901a\u4fe1\u3002 Service Controller - - \u7ba1\u7406\u4e0e\u4e91\u76f8\u5173\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u3002- \u5f53\u521b\u5efa\u4e00\u4e2a\u7c7b\u578b\u4e3a LoadBalancer \u7684\u670d\u52a1\u65f6\uff0c\u8be5\u63a7\u5236\u5668\u4f1a\u5728\u4e91\u5e73\u53f0\u4e0a\u521b\u5efa\u76f8\u5e94\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u3002 Volume Controller - \u7ba1\u7406\u4e91\u5b58\u50a8\u5377\u7684\u6302\u8f7d\u548c\u5378\u8f7d"},{"location":"cloud/k8s/ckad/ckad-1/#2-node","title":"2. Node \u7ec4\u4ef6","text":""},{"location":"cloud/k8s/ckad/ckad-1/#kubelet","title":"Kubelet","text":"<p>\u662f\u5728cluster\u4e2d\u6bcf\u4e2anode\u4e0a\u8fd0\u884c\u7684\u4ee3\u7406\uff08agent\uff09\u8d1f\u8d23\u786e\u4fdd\u6309\u9884\u671f\u5728\u8282\u70b9\u4e0a\u8fd0\u884c</p>"},{"location":"cloud/k8s/ckad/ckad-1/#container-runtime","title":"Container Runtime","text":"<p>\u662f\u7528\u4e8e\u8fd0\u884c\u5bb9\u5668\u7684\u5e95\u5c42\u8f6f\u4ef6\u901a\u5e38\u8fd9\u4e2a\u8f6f\u4ef6\u662f Docker\uff0c\u4f46\u4e5f\u6709\u5176\u4ed6\u5bb9\u5668\u6280\u672f\uff0c\u6bd4\u5982<code>cri-o</code>\uff0c<code>gRPC</code>\uff0c<code>containerd</code>\uff0c</p>"},{"location":"cloud/k8s/ckad/ckad-1/#kube-proxy-optional","title":"Kube-proxy (optional)","text":"<p>kube-proxy \u662f\u8fd0\u884c\u5728\u6bcf\u4e2a \u5de5\u4f5c\u8282\u70b9 (Worker Node) \u4e0a\u7684\u5173\u952e\u7ec4\u4ef6\uff0c\u8d1f\u8d23\u7ba1\u7406\u7f51\u7edc\u89c4\u5219\u548c\u670d\u52a1\u901a\u4fe1\u3002\u5b83\u662f Kubernetes \u96c6\u7fa4\u4e2d\u670d\u52a1\u53d1\u73b0\u548c\u7f51\u7edc\u8def\u7531\u7684\u6838\u5fc3\u90e8\u5206\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-1/#4-k8s-yaml","title":"4. k8s \u4e2d\u7684 YAML","text":"<p>k8s \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u7528<code>k</code>\u547d\u4ee4\u884c\u5de5\u5177\u6765\u90e8\u7f72\u5e94\u7528\uff0c\u4e5f\u53ef\u4ee5\u7528<code>YAML</code>\u6587\u4ef6\u5b9a\u4e49\u201d\u5982\u4f55\u90e8\u7f72\u5e94\u7528\u201c\uff0c\u7136\u540e\u518d\u4e00\u6b21\u6027\u5c06<code>YAML</code>\u6587\u4ef6\u6267\u884c\u5230 k8s \u96c6\u7fa4\u4e0a\u76f8\u6bd4<code>k</code>\uff0c\u4f7f\u7528<code>YAML</code>\u7684\u4f18\u70b9\u6709\uff1a</p> <ul> <li>Devops as code\uff1a\u53ef\u4ee5\u7528 git \u5bf9<code>YAML</code>\u8fdb\u884c\u7248\u672c\u63a7\u5236\uff0c\u50cf\u5199\u8f6f\u4ef6\u4ee3\u7801\u4e00\u6837\u5199 devops \u7684\u90e8\u7f72\uff0c\u4e14\u591a\u4e2a\u7a0b\u5e8f\u733f\u53ef\u540c\u65f6\u8fdb\u884c\u534f\u4f5c\uff0c\u4e0d\u4f1a\u51fa\u73b0\u4fe1\u606f\u4e0d\u540c\u6b65\u7684\u95ee\u9898</li> <li>Single source of truth\uff1a\u6240\u6709\u548c devops \u76f8\u5173\u7684\u4fe1\u606f\u90fd\u53ef\u4ee5\u67e5\u770b\u5bf9\u5e94\u7684<code>YAML</code>\u6587\u4ef6</li> <li>\u5bb9\u6613 debug</li> <li>\u5bb9\u6613\u8fdb\u884c\u9879\u76ee\u91cd\u5efa\uff1a\u5047\u8bbe\u4f60\u8981\u628a\u73b0\u6709\u7684\u90e8\u7f72\u632a\u5230\u53e6\u4e00\u4e2a\u4e91\u4f9b\u5e94\u5546\u5e73\u53f0\u4e0a\u53bb\uff0c\u53ea\u9700\u8981\u5728\u90e8\u7f72\u4e00\u904d<code>YAML</code>\u6587\u4ef6\u5373\u53ef</li> </ul> <p>\u5728 k8s \u4e2d\u7684<code>YAML</code>\u6587\u4ef6\u90fd\u9ed8\u8ba4\u5e94\u8be5\u6709\u56db\u4e2a\u5c5e\u6027\uff1a</p> <ul> <li><code>apiVersion</code>\uff1a\u7248\u672c\uff0c\u53ef\u4ee5\u662f v1 \u6216\u8005 apps/v1</li> <li><code>kind</code>\uff1a\u8d44\u6e90\u79cd\u7c7b\uff0c\u53ef\u4ee5\u662f Pod\uff0cService\uff0cReplicaSet \u6216 Deployment \u7b49</li> <li><code>metadata</code> \uff1a\u8be5\u8d44\u6e90\u7684\u5143\u6570\u636e\uff0c\u5305\u62ec name\uff0clabels \u7b49\u5b57\u5178\u7c7b\u578b\u6570\u636e\uff0c\u4e0d\u5141\u8bb8\u5176\u4ed6\u952e\u7684\u5b58\u5728</li> <li><code>spec</code>\uff1a\u914d\u7f6e\u4fe1\u606f\uff0c\u6bcf\u4e2a\u8d44\u6e90\u5e94\u6709\u7684 spec \u90fd\u4e0d\u4e00\u6837</li> </ul> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a Pod \u7684<code>YAML</code>\u6587\u4ef6\u7684\u4f8b\u5b50\uff1a</p> <pre><code># pod-definition.yml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: myapp-pod\n    labels:     # \u5728`lables`\u4e2d\uff0c\u53ef\u4ee5\u5b9a\u4e49\u4efb\u610f\u952e\u503c\u5bf9\uff0c\u4ee5\u4fbf\u5feb\u901f\u5730\u627e\u5230\u8d44\u6e90\n        app: myapp\n        type: frontend\n        author: chuuuing\nspec:\n    containers:\n        - name: nginx-container\n          image: nginx\n</code></pre> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5c06\u8be5<code>YAML</code>\u6587\u4ef6\u90e8\u7f72\u5230\u96c6\u7fa4\u4e0a\uff1a</p> <pre><code>kubectl create -f pod-definition.yml\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-1/#apiversion","title":"apiVersion","text":"<code>kind</code>\uff08\u8d44\u6e90\u79cd\u7c7b\uff09 <code>apiVersion</code>\uff08\u7248\u672c\uff09 <code>Pod</code> v1 <code>Service</code> v1 <code>ReplicaSet</code> apps/v1 <code>Deployment</code> apps/v1"},{"location":"cloud/k8s/ckad/ckad-1/#5-replication-controller","title":"5. Replication Controller","text":"<p><code>Replication Controller</code>\u662f Controller \u7ec4\u4ef6\u7684\u4e00\u79cd</p> <ul> <li>\u76d1\u63a7\u5e76\u786e\u4fdd\u81ea\u5df1\u8d1f\u8d23\u7684<code>Pod</code>\u6570\u91cf\u7b26\u5408\u8981\u6c42\uff08\u6bd4\u5982\uff1a<code>Pod</code>\u7684\u6570\u91cf\u591a\u4e86\u90a3\u5c31\u6740\u6389\u51e0\u4e2a\uff0c\u5c11\u4e86\u5c31\u81ea\u52a8\u751f\u6210\u51e0\u4e2a\uff09</li> <li>\u626e\u6f14\u4e00\u4e2a load balancer \u7684\u89d2\u8272\uff0c\u8de8 Node \u5e73\u8861\u8bbf\u95ee</li> </ul> <p>Note</p> <p><code>Replication Controller</code> vs <code>Replica Set</code>  \u4e24\u8005\u90fd\u6709\u4e0a\u8ff0\u63d0\u5230\u7684\u529f\u80fdReplica Set\u662f\u66f4\u65b0\u7684\u6982\u5ff5\uff0c\u591a\u4e00\u4e2a<code>.spec.selector</code>\u7684\u5c5e\u6027\uff0c\u80cc\u540e\u7684\u539f\u56e0\u662f\uff1a  </p> <ul> <li>\u9664\u4e86\u7531\u81ea\u5df1\u62f7\u8d1d\u7684<code>Pod</code>\u526f\u672c\uff0cReplica Set\u4e5f\u53ef\u4ee5\u7528\u4e8e\u7ba1\u7406\u5176\u4ed6<code>Pod</code>\uff1b  </li> <li>\u800cReplication Controller\u9ed8\u8ba4\u53ea\u80fd\u7ba1\u7406\u81ea\u5df1\u751f\u6210\u7684<code>Pod</code>\u526f\u672c </li> </ul> <pre><code>apiVersion: app/v1\nkind: ReplicaSet\nmetadata:\n    name: myapp-replicaset\n    labels:\n        app: myapp\n        type: frontend\nspec:\n    template:\n        metadata:\n            name: myapp-pod\n            labels:\n                app: myapp\n                type: frontend\n        spec:\n            containers:\n                - name: nginx-container\n                  image: nginx\n    replicas: 3\n\n    selector:           # ReplicaSet\u72ec\u6709\u7684\uff0cReplicationController\u6ca1\u6709\u7684\uff01\n        matchLabels:\n            type: frontend\n</code></pre> \u4e0d\u5e26`selector` \u5e26`selector` \u76d1\u89c6\u5668\u4ee3\u8868 ReplicationController\u53ea\u9ed8\u8ba4\u7ba1\u7406\u7531\u81ea\u5df1\u521b\u5efa\u7684Pod \u76d1\u89c6\u5668\u4ee3\u8868 ReplicaSet\u53ef\u4ee5\u7ba1\u7406\u6240\u6709\u5e26`matchLabels`\u7684Pod <p>\u5982\u4f55 scale up/down \u96c6\u7fa4\u4e2d<code>Pod</code>\u7684\u6570\u91cf\uff1f</p> <ul> <li>\u65b9\u6cd5\u4e00\uff1a<code>k edit replicaset</code>\u76f4\u63a5\u4fee\u6539 yaml \u683c\u5f0f</li> <li>\u65b9\u6cd5\u4e8c\uff1a <code>k scale --replicas=6 replicaset myapp-replicaset</code> \u53ea\u66f4\u65b0\u90e8\u7f72\uff0cYAML \u6587\u4ef6\u4e0d\u4f1a\u88ab\u81ea\u52a8\u4fee\u6539</li> <li>\u5176\u4ed6\uff1a \u6839\u636e\u7528\u6237\u6d41\u91cf\u81ea\u52a8 scale\uff0c\u6211\u4eec\u4e4b\u540e\u4f1a\u8bb2\u5230</li> </ul> <p>\u5982\u679c<code>ReplicaSet</code>\u4e2d\u7684 container template \u6709\u9519\uff0c\u6bd4\u5982 image \u7684\u540d\u5b57\u9519\u4e86\uff0c\u5982\u4f55\u4fee\u6539\uff1f</p> <ul> <li>\u65b9\u6cd5\u4e00\uff1a\u5220\u9664\u5e76\u91cd\u5efa<code>ReplicaSet</code>\uff08\u5220\u9664<code>ReplicaSet</code>\u4f1a\u81ea\u52a8\u5220\u9664\u5b83\u6240\u76d1\u63a7\u7684 Pod\uff09</li> <li>\u65b9\u6cd5\u4e8c\uff1a\u5148\u66f4\u65b0<code>ReplicaSet</code>\uff0c\u5220\u9664\u65e7\u7684 Pod\u3002\u5373\uff1a<ul> <li><code>k edit replicaset xxx</code> </li> <li><code>k delete pod -l name=busybox-pod</code></li> </ul> </li> </ul> <p>Note</p> <p>\u56e0\u4e3a<code>ReplicaSet</code>\u53ea\u68c0\u67e5\u6570\u91cf\uff0c\u4e0d\u68c0\u67e5 Pod \u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u8981\u628a\u65e7\u7684 Pod \u6740\u6389</p> <p>Warning</p> <p>ReplicaSet \u7684<code>apiVersion</code>\u7684\u503c\u662f<code>apps/v1</code>\uff0c\u4e0d\u662f<code>v1</code>\uff0c\u4e0d\u7136\u4f60\u4f1a\u770b\u5230\u4e00\u4e0b\u9519\u8bef\uff1a </p>"},{"location":"cloud/k8s/ckad/ckad-1/#6-deployment","title":"6. Deployment","text":"<p>\u8fc4\u4eca\u4e3a\u6b62\uff0c\u6211\u4eec\u77e5\u9053<code>Container</code>\u8dd1\u5728<code>Pod</code>\u4e0a\uff0c\u800c<code>Pod</code>\u7531<code>ReplicaSet</code>\u76d1\u63a7\uff0c<code>Deployment</code>\u88ab\u770b\u4f5c\u5728<code>ReplicaSet</code>\u5916\u7684\u53e6\u4e00\u5c42\u5916\u5957\u3002<code>Deployment</code>\u63d0\u4f9b\u4e86\u66f4\u65b0\uff0c\u64a4\u6d88\u66f4\u65b0\uff0c\u56de\u6eda\u5230\u65e7\u7248\u672c\uff08rolling\uff09\uff0c\u6682\u505c\uff0c\u548c\u6062\u590d\u66f4\u6539\u7b49\u529f\u80fd</p> <pre><code># deployment.yml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: myapp-deployment\n    labels:\n        app: myapp\n        type: frontend\nspec:\n    template:\n        metadata:\n            name: myapp-pod\n            labels:\n                app: myapp\n                type: frontend\n        spec:\n            containers:\n            - name: nginx-container\n              image: nginx\n    replicas: 3\n    selector:\n        matchLabels:\n            type: frontend\n</code></pre> <p>Deployment vs ReplicaSet</p> <p>\u6ce8\u610f\u5230\u4e86\u5417\uff0c\u9664\u4e86<code>kind</code>\uff0c\u5176\u4ed6\u5185\u5bb9\u548c<code>ReplicaSet</code>\u4e2d\u6ca1\u6709\u533a\u522b\uff01 \u8fd9\u65f6\u5019\u6211\u4eec\u7528<code>k create -f deployment.yml</code>\u521b\u5efa <code>Deployment</code>\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u96c6\u7fa4\u4e2d\u4f1a\u81ea\u52a8\u65b0\u5efa\u4ee5\u4e0b\u8d44\u6e90\uff1a</p> <pre><code>- Deployment\n- ReplicaSet\n- Pod\n</code></pre> <p>\ud83e\ude86 \u56e0\u4e3a\u4ed6\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\u4e00\u5c42\u5957\u4e00\u5c42\uff1a<code>Pod</code> &lt; <code>ReplicaSet</code> &lt; <code>Deployment</code>\uff0c\u50cf\u4fc4\u7f57\u65af\u5957\u5a03\u4e00\u6837\uff1a</p> <p></p> <p>\u7528 kubectl \u65b0\u5efa deployment\uff1a \u7528\u955c\u50cf\u65b0\u5efa\u4e00\u4e2a Deployment:</p> <pre><code>kubectl create deployment [DeploymentName] --image=[ImageName]\n</code></pre> <p>scale up:</p> <pre><code>kubectl scale deployment --replicas=3 [DeploymentName]\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-1/#7-namespace","title":"7. Namespace","text":"<p>\u5f53\u96c6\u7fa4\u5efa\u7acb\u8d77\u6765\u7684\u65f6\u5019\uff0ck8s \u4f1a\u81ea\u52a8\u751f\u6210\u4e09\u4e2a\u9ed8\u8ba4\u7684 Namespace\uff1a</p> <ol> <li><code>default</code>\uff1a\u9ed8\u8ba4\u7684 Namespace\uff0c\u5982\u679c\u4f60\u4e0d\u53e6\u5916\u521b\u5efa\u4e13\u95e8\u7ed9 App \u7684 Namespace \u7684\u8bdd\uff0c\u4e00\u8fdb\u96c6\u7fa4\u5c31\u9ed8\u8ba4\u4f7f\u7528<code>default</code></li> <li><code>kube-system</code>\uff1ak8s \u81ea\u52a8\u751f\u6210\u4e00\u4e9b\u4f9b\u5185\u90e8\u4f7f\u7528\u7684 Pods \u548c Service\uff0c\u6bd4\u5982 DNS \u670d\u52a1\u8fd9\u4e2a Namespace \u7684\u5b58\u5728\u4fdd\u8bc1\u4e86\u7528\u6237\u4e0d\u4f1a\u7834\u574f\u8fd9\u4e9b\u5185\u90e8\u8d44\u6e90</li> <li><code>kube-public</code>\uff1a\u8fd9\u91cc\u5e94\u8be5\u653e\u4e00\u4e9b \u6240\u6709 Namespace \u90fd\u6709\u6743\u9650\u8bbf\u95ee\u7684\u8d44\u6e90</li> </ol> <p>\u6bcf\u4e2a<code>Namespace</code>\u90fd\u6709\u81ea\u5df1\u7684\u53c2\u6570\u8bbe\u7f6e\u548c\u9650\u5236\uff0c\u80fd\u4fdd\u8bc1\u4e0d\u5360\u7528\u8fc7\u591a\u7684\u8d44\u6e90\uff08\u6bd4\u5982\u8bf4\u50a8\u5b58\u7a7a\u95f4\u7b49\uff09<code>Namespace</code>\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\u662f\uff1a\u4e00\u4e2a<code>dev</code>\u7ed9\u5f00\u53d1\uff0c\u4e00\u4e2a<code>prod</code>\u7684<code>Namespace</code>\u5728\u4f7f\u7528\u4e2d</p> <p>\u751f\u6210 pod.yaml \u65f6\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6307\u5b9a\u8be5 Pod \u6240\u5728\u7684 Namespace\uff1a</p> <pre><code>...\nmetadata:\n    name: myapp-pod\n    # \u6307\u5b9a Namespace\n    namespace: dev\n    labels:\n        app: myapp\n        type: frontend\n...\n</code></pre> <p>\u7528 YAML \u65b0\u5efa Namespace\uff1a</p> <pre><code>apiVersion: v1\nkind: Namespace\nmetadata:\n  name: dev\n</code></pre> <p>\u6216\u8005\uff0c\u7528<code>k</code>\u65b0\u5efa\uff1a<code>k create namespace dev</code></p> <p>\u5176\u4ed6\u76f8\u5173\u7684<code>k</code>\u7684\u547d\u4ee4</p> <ul> <li><code>k config current-context</code> \u67e5\u770b\u5f53\u524d context: <code>&lt;\u7528\u6237\u540d&gt;:&lt;cluster\u540d&gt;</code></li> <li><code>k get pods --namespace=xxx</code> \u6307\u5b9a\u770b Namespace <code>xxx</code> \u4e0b\u7684 Pod</li> <li><code>k get pods --all-namespaces</code> \u6216\u8005<code>k get pods -A</code> \u67e5\u770b\u6240\u6709 Namespace \u4e0b\u7684 Pod</li> <li><code>k config set-context --current --namespace=xxx</code> \u628a\u9ed8\u8ba4 namespace \u8bbe\u7f6e\u6210<code>xxx</code></li> </ul>"},{"location":"cloud/k8s/ckad/ckad-1/#ns-vs-ns","title":"ns\u5185\u90e8\u8bbf\u95ee vs \u8de8ns\u8bbf\u95ee","text":"<ol> <li>Namespace \u5185\u90e8\u670d\u52a1\u4e4b\u95f4\u7684\u670d\u52a1\u8bbf\u95ee: <code>mysql.connect(\"db-service\")</code></li> <li>\u8de8 Namespace \u7684\u670d\u52a1\u8bbf\u95ee - <code>default</code> \u8bbf\u95ee <code>dev</code> \u4e2d\u7684\u6570\u636e\u5e93\u670d\u52a1: <code>mysql.connect(\"db-service.dev.svc.cluster.local\")</code></li> </ol> <p>\u8de8 Namespace \u7684\u670d\u52a1\u8bbf\u95ee</p> <p>\u547d\u540d\u683c\u5f0f\u662f<code>[ServiceName].[Namespace].svc.cluster.local</code></p> <p>\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u8fd9\u6837\u8bbf\u95ee\u5230 Service \u5462\uff1f</p> <p>\u5f53\u4e00\u4e2aService\u88ab\u521b\u5efa\u7684\u65f6\u5019\uff0ck8s\u4f1a\u81ea\u52a8\u6dfb\u52a0\u5bf9\u5e94\u7684DNS: </p> <ul> <li><code>cluster.local</code>\u662fk8s\u96c6\u7fa4\u7684\u9ed8\u8ba4\u57df\u540d\uff08cluster domain\uff09</li> <li><code>svc</code>\u662f\u5b50\u57df\u540d </li> <li><code>[Namespace]</code>\u662f\u8be5Service\u6240\u5728\u7684Namespace </li> <li><code>[ServiceName]</code>\u662fService\u672c\u8eab\u7684\u540d\u5b57</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-1/#resourcequota","title":"ResourceQuota","text":"<p><code>ResourceQuota</code>\u7528\u4e8e\u7ed9 \u67d0\u4e2a<code>Namespace</code>\u7684\u603b\u8d44\u6e90 \u8bbe\u9650\u6bd4\u5982<code>Pod</code>\u7684\u6570\u91cf\uff0c<code>CPU</code>\u6570\u91cf\uff0c\u5185\u5b58\u5927\u5c0f\u7b49\u7b49\u3002</p> <p>Quotas's Types</p> <p>\u6709\u4e24\u79cd\u7c7b\u578b\u7684\u9650\u5236\uff1a</p> <p>1. Compute Resource Quotas</p> <ul> <li>Limit Quota: \u5bb9\u5668\u53ef\u4ee5\u4f7f\u7528\u7684 \u6700\u5927\u8d44\u6e90\u91cf\uff0c\u7528\u4e8e\u63a7\u5236\u5bb9\u5668\u7684\u8d44\u6e90\u4f7f\u7528\u4e0a\u9650\uff0c\u9632\u6b62\u5bb9\u5668\u4f7f\u7528\u8fc7\u591a\u8d44\u6e90\uff0c\u5f71\u54cd\u5176\u4ed6\u5bb9\u5668\u7684\u8fd0\u884c\u3002\uff08<code>limits.cpu</code>\uff0c<code>limits.memory</code>\uff09</li> <li>Request quotas: \u5bb9\u5668\u5e0c\u671b\u83b7\u5f97\u7684 \u6700\u5c0f\u8d44\u6e90\u91cf\u3002\u7528\u4e8e\u786e\u4fdd\u5bb9\u5668\u80fd\u591f\u83b7\u5f97\u81f3\u5c11\u4e00\u5b9a\u91cf\u7684\u8d44\u6e90\u3002\uff08<code>requests.cpu</code>\uff0c<code>requests.memory</code>\uff09</li> </ul> <p>2. Object Count Quotas: limit the number of resources. Pod, Service\u3001ConfigMap\u3001Secret\u3001LoadBalancer \u7b49</p> <p>\u4e3e\u4f8b\uff1a<code>limits.cpu: \"10\"</code> \u8868\u793a\u5f53\u524d Namespace \u4e2d\u6240\u6709 <code>non-terminal</code> \u72b6\u6001\u7684 Pod \u7684<code>.limits.cpu</code>\u8d44\u6e90\u7684\u603b\u548c\u6ca1\u6709\u8d85\u8fc7 10</p> <p>\u4ec0\u4e48\u662f terminal\u72b6\u6001\u7684Pod\uff1f</p> <p>Pod which has <code>.status==Failed</code> or <code>.status=succeeded</code></p> <p>Warning</p> <p>After setting any compute quota, all workloads must define the corresponding request or resource limit. For example, if you create a <code>limits.cpu</code> quota, then the workloads that you create require the <code>resources.limits.cpu</code> key.</p>"},{"location":"cloud/k8s/ckad/ckad-1/#resourcequota3","title":"\u521b\u5efaResourceQuota\u76843\u79cd\u65b9\u6cd5","text":""},{"location":"cloud/k8s/ckad/ckad-1/#1-yaml","title":"1. YAML","text":"<pre><code>apiVersion: v1\nkind: ResourceQuota\nmetadata:\n  name: compute-quota\n  namespace: dev    # \u6b64 ResourceQuota \u4f5c\u7528\u7684 Namespace\nspec:\n  hard:             # \u522b\u5fd8\u4e86\u8fd9\u4e2a\n    count/pods: \"10\"\n    requests.cpu: \"4\"\n    requests.memory: \"5Gi\"\n    limits.cpu: \"10\"\n    limits.memory: \"10Gi\"\n  scopes: {}        # \u7528 QoS \u7c7b\u522b\u9009\u62e9\uff0c \u6bd4\u5982 Terminating, BestEffort\n  scopeSelector: {} # \u66f4\u7075\u6d3b\u7684filter\uff0c\u53ef\u4f7f\u7528 matchExpressions \u6307\u5b9a\u5339\u914d\u89c4\u5219\n</code></pre> <p>spec.scopes</p> <ul> <li>\u5982\u679c\u4e0d\u6307\u5b9a\uff0cResourceQuota \u4f1a\u5e94\u7528\u4e8e\u547d\u540d\u7a7a\u95f4\u5185\u7684\u6240\u6709\u8d44\u6e90\u3002</li> <li>\u53ef\u8bbe\u7f6e\u591a\u4e2a <code>--scopes=BestEffort,NotTerminating</code></li> </ul> \u573a\u666f \u63a8\u8350 Scope \u9650\u5236\u65e0\u8d44\u6e90\u8bf7\u6c42\u7684 Pod, \u5373\u672a\u8bbe\u7f6e CPU/\u5185\u5b58\u8bf7\u6c42\u7684Pod --scopes=BestEffort \u9650\u5236\u957f\u671f\u8fd0\u884c\u7684 Pod, \u5373\u672a\u8bbe\u7f6e <code>activeDeadlineSeconds</code> \u7684 Pod --scopes=NotTerminating \u9650\u5236\u4f1a\u4e3b\u52a8\u7ec8\u6b62\u7684 Pod\uff08\u5982 Job\uff09, \u5373\u8bbe\u7f6e\u4e86 <code>activeDeadlineSeconds</code> \u7684 Pod --scopes=Terminating"},{"location":"cloud/k8s/ckad/ckad-1/#2-web-console","title":"2. Web Console","text":"<p>Administration &gt; ResourceQuotas</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-1/#3-cli","title":"3. CLI","text":"<pre><code>oc create quota example --hard=pods=1\noc create resourcequota example --hard=pods=1\noc create resourcequota example --hard=count/deployments.apps=1 # \u26a0\ufe0f \u4e0d\u662f count/deployment\n# --hard=pods=1,limits.cpu=10,requests.cpu=5 --&gt; seperate the constraints by \",\" - NO SPACE\n</code></pre> <p>Note</p> <p>The previous command is equivalent to creating a resource quota with the following definition:</p> <pre><code>apiVersion: v1\nkind: ResourceQuota\nmetadata:\n    name: example\nspec:\n    hard:\n        count/pods: \"1\"     # new version is pods: \"1\"\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-1/#resourcequota_1","title":"\u67e5\u770bResourceQuota","text":"<pre><code>oc get quota example -o yaml\n# or\noc get quota\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-1/#kubectl","title":"&gt;&gt;&gt; \u672c\u7ae0 kubectl \u547d\u4ee4\u6574\u7406","text":"<p>\u65b0\u5efa\u5bb9\u5668\uff1a</p> <p><code>k run my-new-pod --image nginx</code></p> <p>\u7528\u955c\u50cf nginx \u90e8\u7f72\u4e00\u4e2a\u5bb9\u5668\u5230 kubernetes \u96c6\u7fa4\u4e0a\u56e0\u4e3a k8s \u4e2d\u6700\u5c0f\u5355\u4f4d\u662f Pod\uff0c\u6240\u4ee5\u540c\u4e00\u65f6\u95f4\uff0c\u4e00\u4e2a Pod \u4e5f\u88ab\u751f\u6210</p> <p>\u5f69\u6392\uff0c\u8f93\u51fa yaml \u6587\u4ef6\uff1a</p> <p><code>k run my-new-pod --image nginx --dry-run=client -o yaml &gt; pod.yaml</code></p> <p>\u8be5\u547d\u4ee4\u4e0d\u4f1a\u9a6c\u4e0a\u6267\u884c\u201c\u65b0\u5efa\u5bb9\u5668\u201d\u7684\u64cd\u4f5c\uff0c<code>--dry-run=client</code>\u7684\u610f\u601d\u662f\uff1a\u6211\u5f69\u6392\u4e00\u4e0b\uff0c\u4e0d\u771f\u8dd1\uff0c\u53ea\u662f\u770b\u770b\u662f\u5426\u53ef\u4ee5\u521b\u5efa\u8d44\u6e90\uff0c\u4ee5\u53ca\u6240\u7528\u7684\u547d\u4ee4\u662f\u5426\u6b63\u786e\u7136\u540e\u518d\u7528<code>-o yaml &gt; pod.yaml</code>\u5c06\u5f69\u6392\u5f97\u5230\u7684\u5185\u5bb9\u4ee5<code>yaml</code>\u6587\u4ef6\u7684\u5f62\u5f0f\u8f93\u51fa</p> <p>\u4fe1\u606f</p> <p><code>k get all</code> \u67e5\u770b\u5f53\u524d\u96c6\u7fa4\u4e2d\u6240\u6709</p> <p><code>k cluster-info</code> \u67e5\u770b\u5f53\u524d\u96c6\u7fa4\u4fe1\u606f</p> <p><code>k get nodes</code> \u5217\u4e3e\u5f53\u524d\u96c6\u7fa4\u4e2d\u6240\u6709\u7684 nodes</p> <p>Pod \u76f8\u5173\uff1a</p> <p><code>k run yyy --image=xxx</code> \u7528\u955c\u50cf<code>xxx</code>\u521b\u5efa\u540d\u4e3a<code>yyy</code>\u7684\u5bb9\u5668\uff0c\u653e\u8fdb Pod \u4e2d\uff0c\u56e0\u4e3a k8s \u4e2d\u6700\u5c0f\u5355\u4f4d\u662f Pod\uff01\uff01\u6ca1\u6709\u529e\u6cd5\u628a Container \u5355\u72ec\u62ff\u51fa\u6765</p> <p><code>k get pods</code> \u5217\u4e3e\u5f53\u524d\u96c6\u7fa4\u4e2d\u6240\u6709\u7684 pods</p> <p><code>k describe pod xxx</code> \u6253\u5370\u540d\u4e3a<code>xxx</code>\u7684 pod \u7684\u5177\u4f53\u4fe1\u606f</p> <p><code>k edit pod xxx</code> \u5bf9\u5df2\u5b58\u5728\u7684 pod \u8fdb\u884c\u4fee\u6539</p> <p><code>k delete pod -l name=busybox-pod</code> \u5220\u9664\u6240\u6709\u6807\u7b7e\u4e3a<code>name=busybox-pod</code>\u7684 Pod</p> <p>ReplicaSet \u76f8\u5173\uff1a</p> <p><code>k get replicaset</code> \u67e5\u770b\u5f53\u524d\u96c6\u7fa4\u7684 replicaset</p> <p><code>k delete replicaset xxx</code> \u5220\u9664\u540d\u4e3a<code>xxx</code>\u7684 replicaset</p> <p><code>k edit replicaset xxx</code> \u4fee\u6539\u540d\u4e3a<code>xxx</code>\u7684 replicaset</p> <p>\u4fee\u6539 ReplicaSet \u4e2d Pod \u7684\u6570\u91cf\uff1a</p> <ul> <li>\u5148\u4fee\u6539<code>xxx.yml</code>\u6587\u4ef6\u4e2d\u7684 relicas \u7684\u6570\u91cf\uff0c\u518d\u7528<code>k replace -f xxx.yml</code> \u5c06\u66f4\u65b0\u90e8\u7f72\u5230\u96c6\u7fa4\u4e0a</li> <li><code>k scale replicaset --replicas=6  [ReplicaSetName]</code> \u6216 <code>k scale deployment --replicas=3 [DeploymentName]</code> \u53ea\u66f4\u65b0\u90e8\u7f72\uff0c\u6bcb\u9700 YAML \u6587\u4ef6</li> </ul> <p>TODO</p> <p>If I change <code>k scale replicaset --replicas=6  [ReplicaSetName]</code>, will the deployment also change its replica number?</p> <p>Deployment \u76f8\u5173</p> <p><code>k create deployment [DeploymentName] --image=[ImageName] --replicas=4</code></p> <p><code>k create -f xxx.yml</code> \u5c06\u5b9a\u4e49\u597d\u7684 yaml \u6587\u4ef6\u90e8\u7f72\u5230\u5f53\u524d\u96c6\u7fa4\u4e0a</p> <p>kubectl \u8f93\u51fa\u683c\u5f0f</p> <p><code>k [command] [TYPE] [NAME] -o &lt;output_format&gt;</code></p> <ul> <li><code>-o json</code> \u8f93\u51fa\u4e00\u4e2a JSON \u683c\u5f0f\u7684 API \u5bf9\u8c61</li> <li><code>-o name</code> \u4ec5\u6253\u5370\u8d44\u6e90\u540d\u79f0\uff0c\u4e0d\u6253\u5370\u5176\u4ed6\u5185\u5bb9</li> <li><code>-o wide</code> \u5e26\u9644\u52a0\u4fe1\u606f\u7684\u7eaf\u6587\u672c\u683c\u5f0f \u2757\ufe0f</li> <li><code>-o yaml</code> \u8f93\u51fa\u4e00\u4e2a YAML \u683c\u5f0f\u7684 API \u5bf9\u8c61</li> </ul> <p>namespace \u76f8\u5173</p> <p><code>k config current-context</code> \u67e5\u770b\u5f53\u524d namespace</p> <p><code>k get namespaces</code> \u6216<code>k get ns</code></p> <p><code>k create namespace xxx</code>\u7528<code>k</code>\u65b0\u5efa Namespace</p> <p><code>k get pods --namespace=xxx</code> \u6307\u5b9a\u770b<code>xxx</code>Namespace \u4e0b\u7684 Pod</p> <p><code>k get pods --all-namespaces</code> \u67e5\u770b\u6240\u6709 Namespace \u4e0b\u7684 Pod</p> <p><code>k config set-context --current --namespace=xxx</code> \u628a\u9ed8\u8ba4 namespace \u8bbe\u7f6e\u6210<code>xxx</code></p> <p>Service \u76f8\u5173</p> <p><code>k expose pod redis --port=6379 --name redis-service</code> \u4e3a Pod <code>redis</code> \u65b0\u5efa\u4e00\u4e2a\u540d\u4e3a<code>redis-service</code>\u7684 ClusterIP \u670d\u52a1\uff08<code>--type=ClusterIP</code>\u662f\u9ed8\u8ba4\u503c\uff09\uff0c\u8be5\u670d\u52a1\u672c\u8eab\u7684\u7aef\u53e3\u662f<code>6379</code>\uff0c\u8be5\u670d\u52a1\u4f1a\u7528 Pod <code>redis</code> \u7684\u6807\u7b7e\u8fdb\u884c\u8d44\u6e90\u7b5b\u9009</p> <p><code>k create service clusterip redis-service --tcp=6379:6379</code> \u65b0\u5efa\u4e00\u4e2a\u540d\u4e3a<code>redis-service</code>\u7684 ClusterIP \u670d\u52a1\uff0c\u8be5\u670d\u52a1\u5c06\u4f7f\u7528<code>6379</code>\u7aef\u53e3\u8be5\u670d\u52a1\u9ed8\u8ba4\u7528<code>app=redis-service</code>\u6807\u7b7e\u8fdb\u884c\u8d44\u6e90\u7b5b\u9009</p> <p>\u26a0\ufe0f \u76f4\u63a5\u66b4\u9732\u67d0\u4e2a Pod\uff1a</p> <p><code>k run XXX --image=XXX --port=80</code> \u53ea\u4f1a\u5b9a\u4e49 port\uff0c\u4e0d\u4f1a\u771f\u6b63\u7684 expose Pod\uff0c\u4e5f\u4e0d\u4f1a\u751f\u6210\u5bf9\u5e94\u7684 Service</p> <p><code>k run XXX --image=XXX --port=80 --expose=true</code> \u4f1a\u540c\u65f6\u751f\u6210 Pod \u548c\u5bf9\u5e94\u7684 Service (\u9ed8\u8ba4\u4e3a ClusterIP)</p>"},{"location":"cloud/k8s/ckad/ckad-1/#_1","title":"&gt;&gt;&gt; \u8bfe\u540e\u5c0f\u7b14\u8bb0","text":""},{"location":"cloud/k8s/ckad/ckad-1/#dns","title":"DNS","text":"<p>\u4eba\u7c7b\u7528\u59d3\u540d\u6765\u6807\u8bb0\u548c\u8bc6\u522b\u67d0\u4e2a\u4eba\uff0c\u7535\u8111\u5219\u7528 IP \u5730\u5740DNS\uff08Domain Name System\uff09\u662f\u5c06\u7f51\u5740\uff08<code>www.baidu.com</code>\uff09\u8f6c\u6362\u6210 IP \u5730\u5740\uff08<code>103.235.46.40</code>\uff09\u7684\u6865\u6881\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u7535\u8bdd\u7c3f\uff0c\u5b58\u7684\u59d3\u540d\u662f\u7f51\u5740\uff0c\u800c\u7535\u8bdd\u53f7\u7801\u5219\u662f IP \u5730\u5740\u3002</p> <p>\u7528 <code>dig</code> \u547d\u4ee4\u4f60\u53ef\u4ee5\u770b\u5230\u767e\u5ea6\u7f51\u5740\u7684 IP \u5730\u5740\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165<code>www.baidu.com</code>\u6216\u8005<code>103.235.46.40</code>\u5f97\u5230\u7684\u7ed3\u679c\u662f\u4e00\u6837\u7684\uff1a\u4f60\u90fd\u4f1a\u770b\u5230\u767e\u5ea6\u641c\u7d22\u5f15\u64ce\u9996\u9875</p> <pre><code>dig www.baidu.com\n</code></pre> <p>DNS</p> <p></p> <p>\u793a\u610f\u56fe\u4e2d\u53d1\u751f\u7684\u5bf9\u8bdd\u5982\u4e0b\uff1a</p> <ul> <li>Laptop\uff1a\u6211\u8981\u8bbf\u95ee<code>www.baidu.com</code>\uff0c\u8bf7\u95ee\u8fd9\u4e2a\u7f51\u5740\u7684IP\u5730\u5740\u662f\u4ec0\u4e48\uff1f</li> <li>Resolver\uff1a\u4f60\u597d\uff0c\u6211\u662f\u4f60\u7684\u672c\u5730\u7535\u8bdd\u7c3f\uff0c\u6211\u53bb\u770b\u770b\u6211\u6709\u6ca1\u6709\u5b58\u8fc7\u8fd9\u4e2a\u7f51\u5740\u6211\u6ca1\u6709\u5b58\u8fc7\uff0c\u4e0d\u77e5\u9053\u5b83\u7684IP\u662f\u4ec0\u4e48\uff0c\u6211\u5f97\u53bb\u95ee\u95ee\u5176\u4ed6\u4eba</li> <li>Resolver\uff1a\u4f60\u597dRoot Server\uff0c\u4f60\u77e5\u9053\u7f51\u5740<code>www.baidu.com</code>\u7684IP\u5730\u5740\u662f\u4ec0\u4e48\u5417\uff1f</li> <li>Root Server\uff1a\u6211\u4e0d\u77e5\u9053\uff0c\u4f46\u6211\u731cTLD\u5e94\u8be5\u77e5\u9053\uff0c\u4f60\u53bb\u95ee\u4ed6\u5427</li> <li>Resolver\uff1a\u4f60\u597dTLD\uff0c\u4f60\u77e5\u9053\u7f51\u5740<code>www.baidu.com</code>\u7684IP\u5730\u5740\u662f\u4ec0\u4e48\u5417\uff1f</li> <li>TLD\uff1a\u6211\u4e0d\u77e5\u9053\uff0c\u4f46SLD\u5e94\u8be5\u77e5\u9053</li> <li>Resolver\uff1a\u4f60\u597dSLD\uff0c\u4f60\u77e5\u9053\u7f51\u5740<code>www.baidu.com</code>\u7684IP\u5730\u5740\u662f\u4ec0\u4e48\u5417\uff1f</li> <li>SLD\uff1a\u6211\u77e5\u9053\uff0c\u662f<code>103.235.46.40</code></li> <li>Resolver\uff1a\u611f\u8c22\uff0c\u6211\u5b58\u4e0b\u6765\uff0c\u4ee5\u9632\u4e0b\u6b21\u8fd8\u9700\u8981\u7528</li> <li>Resolver\uff1aLaptop\uff0c\u4f60\u8981\u7684IP\u5730\u5740\u662f<code>103.235.46.40</code></li> <li>Laptop\uff1a\ud83d\ude4f</li> </ul> <p>(TLD = Top Level Domain)  (SLD = Second Level Domain)</p>"},{"location":"cloud/k8s/ckad/ckad-2/","title":"2.\u914d\u7f6e","text":""},{"location":"cloud/k8s/ckad/ckad-2/#1-dockerfile","title":"1. Dockerfile","text":""},{"location":"cloud/k8s/ckad/ckad-2/#cmd","title":"CMD","text":"<p>\u5047\u8bbe\u6211\u4eec\u7528<code>Dockerfile</code>\u521b\u5efa\u4e86\u81ea\u5df1\u7684\u955c\u50cf<code>myImg</code>\u3002</p> <p><code>CMD</code> \u662f\u5bb9\u5668\u8dd1\u8d77\u6765\u4e4b\u540e\u9ed8\u8ba4\u4f1a\u8dd1\u7684\u547d\u4ee4\uff0c\u5982\u679c<code>docker run</code>\u4e2d\u91cd\u65b0\u5b9a\u4e49\u4e86\u547d\u4ee4\uff0c\u90a3\u4e48<code>CMD</code>\u4e2d\u7684\u5185\u5bb9\u4f1a\u88ab\u5b8c\u5168\u91cd\u5199\uff0c\u6bd4\u5982\uff1a</p> <pre><code>docker run myImg sleep 10\n</code></pre> <p><pre><code># \u7528\u4e8e\u521b\u5efa\u955c\u50cf`myImg`\u7684Dockerfile\uff1a\nFROM ubuntu\nCMD [\"sleep\", \"5\"]\n</code></pre> \u7ed3\u679c\uff1a <code>sleep 10</code> \u4f1a\u8986\u76d6<code>CMD sleep 5</code>\u3002\u6700\u7ec8\uff0c\u5bb9\u5668\u4f1a\u776110\u79d2\u949f\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-2/#entrypoint","title":"ENTRYPOINT","text":"<p><pre><code># \u7528\u4e8e\u521b\u5efa\u955c\u50cf`myImg`\u7684Dockerfile\uff1a\nFROM ubuntu\nENTRYPOINT [\"sleep\"]\n</code></pre> <code>ENTRYPOINT</code>\u4f1a\u628a<code>docker run</code>\u4e2d\u7684\u547d\u4ee4\uff0c\u6dfb\u52a0\u5230<code>ENTRYPOINT</code>\u547d\u4ee4\u7684\u540e\u9762\u3002\u6bd4\u5982\uff1a</p> <p><pre><code>docker run myImg 10\n</code></pre> \u7ed3\u679c\uff1a<code>sleep</code>\u8fd9\u4e2a\u547d\u4ee4\u6765\u81ea<code>ENTRYPOINT</code>\uff0c\u800c\u79d2\u6570\u6765\u81ea<code>docker run</code>\u4e2d\u7ed9\u7684\u53c2\u6570\u3002\u6700\u7ec8\u6267\u884c\u7684\u547d\u4ee4\u662f\uff1a</p> <p><pre><code>sleep 10\n</code></pre> \u5bb9\u5668\u4f1a\u776110\u79d2\u949f\u3002</p> <p>Warning</p> <pre><code>\u5982\u679c`docker run`\u4e2d\u6ca1\u6709\u7ed9\u53c2\u6570\uff0c\u90a3\u5c31\u4f1a\u62a5\u9519\n</code></pre> <p>Note</p> <pre><code>Dockerfile\u4e2d\u5b9a\u4e49\u7684\u547d\u4ee4\uff0c\u53ef\u4ee5\u662f`shell`\u683c\u5f0f\uff0c\u6216\u8005`json`\u683c\u5f0f\uff1a\n\n- SHELL\u683c\u5f0f\uff1a`CMD sleep 5` \n- JSON\u683c\u5f0f\uff1a`CMD [\"sleep\", \"5\"]`\n</code></pre> <p>\u4ee5\u4e0a\u4e24\u8005\u6548\u679c\u662f\u4e00\u6837\u7684</p>"},{"location":"cloud/k8s/ckad/ckad-2/#entrypoint-cmd","title":"ENTRYPOINT + CMD","text":"<p><code>ENTRYPOINT</code>\u7684\u4f7f\u7528\u611f\u89c9\u66f4\u5408\u7406\uff0c\u4f46\u662f\u5f53\u6ca1\u6709\u7ed9\u53c2\u6570\u65f6\uff0c\u4f1a\u62a5\u9519\uff0c\u8981\u662f\u6709\u4e2a\u9ed8\u8ba4\u503c\u5c31\u597d\u4e86\u3002\u8fd9\u65f6\u5019\u6211\u4eec\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528<code>ENTRYPOINT</code>\u548c<code>CMD</code>\uff1a</p> <pre><code># \u7528\u4e8e\u521b\u5efa\u955c\u50cf`myImg`\u7684Dockerfile\uff1a\nFROM ubuntu\nENTRYPOINT [\"sleep\"]\nCMD [\"5\"]\n</code></pre> <pre><code>docker run myImg                            # \u4f7f\u7528\u9ed8\u8ba4\u503c\u53c2\u6570 5\ndocker run myImg 10                     # \u6216\u8005\u81ea\u5b9a\u4e49\u53c2\u6570\u4e3a 10\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#dockerfile","title":"\u4f7f\u7528Dockerfile","text":"<p>\u7528\u6700\u540e\u90a3\u4e2a\u540c\u65f6\u7528\u4e86<code>ENTRYPOINT</code>\u548c<code>CMD</code>\u7684<code>Dockerfile</code>\u5efa\u7684\u955c\u50cf\u6765\u521b\u5efaPod\uff1a</p> <p><pre><code>cd myFolder\nls                                              # \u8fd9\u91cc\u5e94\u8be5\u80fd\u770b\u5230\u4f60\u5199\u7684Dockerfile\ndocker build -t myImg .     # \u7528\u5f53\u524d\u8def\u5f84\u4e0b\u7684Dockerfile\u5efa\u955c\u50cf\uff0c\u540d\u5b57\u53eb`myImg`\n</code></pre> \u73b0\u5728\u955c\u50cf\u6709\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528<code>docker run myImg --name myPod --entrypoint sleep2.0 myImg 10</code>\u6765\u521b\u5efa\u5bb9\u5668\uff0c\u6216\u8005\u7528\u4e0b\u9762\u8fd9\u4e2aYAML\u6587\u4ef6\uff1a\uff08\u8fd9\u91cc\u6211\u4eec\u7528\u4e86\u547d\u4ee4\u7684\u65b0\u7248\u672c<code>sleep2.0</code>\uff09 <pre><code># pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: myPod\nspec:\n    containers:\n        - name: myContainer\n          image: myImg\n          command: [\"sleep2.0\"]         # \u6267\u884c\u547d\u4ee4\n          args: [\"10\"]                  # \u53ef\u53d8\u53c2\u6570\n</code></pre></p> Platform Example Dockerfile <code>ENTRYPOINT ['sleep2.0']</code><code>CMD ['10']</code> YAML file -.spec.containers.command: <code>['sleep2.0']</code>-.spec.containers.args: <code>['10']</code> <code>docker run</code> <code>docker run myPod --image=myImg</code><code>--entrypoint sleep2.0</code><code>10</code> <code>k run</code> <code>k run myPod --image=myImg</code><code>--command sleep2.0</code><code>-- 10</code>"},{"location":"cloud/k8s/ckad/ckad-2/#2-poddeployment","title":"2. Pod\u548cDeployment","text":""},{"location":"cloud/k8s/ckad/ckad-2/#pod","title":"Pod","text":"<p>Pod\u5728\u5efa\u6210\u4e4b\u540e\uff0c\u9664\u4e86\u4ee5\u4e0b\u8fd9\u4e9b\u5c5e\u6027\uff0c\u5176\u4ed6\u7684\u5185\u5bb9\u662f\u65e0\u6cd5\u4fee\u6539\u7684\uff1a</p> <ul> <li><code>spec.containers[*].image</code></li> <li><code>spec.initContainers[*].image</code></li> <li><code>spec.activeDeadlineSeconds</code></li> <li><code>spec.tolerations</code></li> </ul> <p>\u5982\u679c\u60f3\u8981\u4fee\u6539\u5df2\u5b58\u5728\u7684Pod\u7684\u8bdd\uff0c\u53ef\u4ee5\u8fd9\u6837\uff1a</p> <pre><code>kubectl get pod xxx -o yaml &gt; new-pod.yml\nvi new-pod.yml          # \u7136\u540e\u6309\u7167\u4f60\u7684\u8981\u6c42\u4fee\u6539new-pod.yaml\nkubectl delete pod xxx\nkubectl create -f new-pod.yml\n</code></pre> <p>\u6ce8\u610f</p> <p>\u8be5\u8bbe\u8ba1\u4e0d\u662f\u6700\u5408\u7406\u7684\uff0c\u56e0\u4e3a<code>Pod</code>\u662f<code>Deployment</code>\u751f\u6210\u7684\u4ea7\u7269\u3002\u5982\u679c\u60f3\u8981\u4fee\u6539<code>Pod</code>\u7684\u67d0\u4e2a\u53c2\u6570\uff0c\u90a3\u4e48 \u66f4\u5408\u7406\u7684\u65b9\u6cd5 \u662f\u4fee\u6539<code>Deployment</code>\uff0c\u7136\u540e\u8ba9<code>Deployment</code>\u751f\u6210\u65b0\u7684<code>Pod</code>\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5220\u9664<code>Pod</code>\uff01</p>"},{"location":"cloud/k8s/ckad/ckad-2/#deployment","title":"Deployment","text":"<p>\u548c<code>Pod</code>\u4e0d\u540c\uff0c<code>Deployment</code>\u53ef\u4ee5\u7b80\u5355\u7684\u901a\u8fc7<code>k edit deployment my-deployment</code>\u4fee\u6539\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-2/#3-env","title":"3. \u73af\u5883\u53d8\u91cf\uff08env\uff09","text":"<p>\u4e3e\u4f8b\uff1a</p> <p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: simple-webapp-color\nspec:\n  containers:\n     - name: simple-webapp-color\n       image: simple-webapp-color\n       port:\n             - containerPort: 8080\n       env:\n             - name: APP_COLOR\n               value: pink\n</code></pre> \u73af\u5883\u53d8\u91cf\uff08<code>env</code>\uff09\u53ef\u4ee5\u7531\u4ee5\u4e0b\u4e09\u79cd\u65b9\u6cd5\u8fdb\u884c\u914d\u7f6e\uff1a</p> <ol> <li>\u7eaf\u952e\u503c\u5bf9</li> <li>\u4ece<code>ConfigMap</code>\u53d6\u503c</li> <li>\u4ece<code>Secret</code>\u53d6\u503c</li> </ol> <p>\u7b2c\u4e00\u79cd\u65b9\u6cd5 \u7eaf\u952e\u503c\u5bf9 \u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a\uff08\u5176\u4ed6\u4e24\u79cd\u65b9\u6cd5\u4e0b\u9762\u4f1a\u8bb2\u5230\uff09</p> <pre><code>env:\n   - name: APP_COLOR\n     value: pink\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#4-configmap","title":"4. ConfigMap","text":""},{"location":"cloud/k8s/ckad/ckad-2/#configmap","title":"ConfigMap\u7684\u4f7f\u7528","text":"<p>\u4f7f\u7528<code>ConfigMap</code>\u4e2d\u6240\u6709\u7684\u952e\u503c\u5bf9\uff1a</p> <p><pre><code>envFrom:\n    - configMapRef:\n            name: app-config    # ConfigMap\u7684\u540d\u5b57\n</code></pre> \u53ea\u4f7f\u7528<code>ConfigMap</code>\u4e2d\u7684\u4e00\u4e2a\u6216\u51e0\u4e2a\u503c\uff1a</p> <pre><code>env:\n    - name: APP_COLOR           # \u73af\u5883\u53d8\u91cf\u7684\u540d\u5b57\n      valueFrom: \n        configMapKeyRef: \n            name: app-config    # ConfigMap\u7684\u540d\u5b57\n            key: APP_COLOR      # ConfigMap\u4e2d\u5bf9\u5e94\u7684\u73af\u5883\u53d8\u91cf\u7684\u540d\u5b57\n</code></pre> <p>\u8bb0\u5fc6\u70b9</p> <p><code>...From</code> + <code>...Ref</code></p> <p>\u5c06<code>ConfigMap</code>\u4f5c\u4e3a\u4e00\u4e2a\u6587\u4ef6\u5199\u5165\u5bb9\u5668\u7684<code>volume</code>\u91cc\u9762\u3002\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u5728<code>volume</code>\u91cc\u9762\u4e3a\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u4ee5\u201c\u952e\u201d\u4e3a\u6587\u4ef6\u540d\uff0c\u201c\u503c\u201d\u4e3a\u6587\u4ef6\u5185\u5bb9\u3002\uff08\u6bd4\u5982\u6709\u4e24\u4e2a\u6587\u4ef6\uff0c<code>APP_COLOR</code>\u6587\u4ef6\u5185\u5bb9\u662fAPP_COLOR\u7684\u503c\uff0c\u6bd4\u5982\"green\"\uff0c<code>APP_MODE</code>\u6587\u4ef6\u5185\u5bb9\u662f\"prod\"\uff09</p> <pre><code>spec:\n    volumes:\n        - name: app-config-volume           # volume \u7684\u540d\u5b57\n          configMap: \n            name: app-config                    # ConfigMap \u7684\u540d\u5b57\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#configmap_1","title":"ConfigMap\u7684\u521b\u5efa","text":"<p>\u4ee5\u4e0b\u662f\u521b\u5efa<code>ConfigMap</code>\uff08\u7f29\u5199\u4e3a<code>cm</code>\uff09\u7684\u65b9\u6cd5\uff1a</p>"},{"location":"cloud/k8s/ckad/ckad-2/#k","title":"\u7528<code>k</code>\u547d\u4ee4\u521b\u5efa","text":"<pre><code># \u4ece\u7eaf\u952e\u503c\u5bf9\u53d6\u503c\uff1a\nkubectl create configmap &lt;configMapName&gt; \\\n    --from-literal=&lt;key1&gt;=&lt;value1&gt; \\\n    --from-literal=&lt;key2&gt;=&lt;value2&gt;\n\n# \u6216\u8005\uff0c\u4ece\u6587\u4ef6\u53d6\u503c\uff1a\nkubectl create configmap &lt;configMapName&gt; \\\n    --from-file=&lt;pathToFile1&gt; \\\n    --from-file=&lt;pathToFile2&gt;\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#yaml","title":"\u7528<code>*.yaml</code>\u5b9a\u4e49","text":"<p><pre><code># configmap.yml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: app-config\ndata:\n  APP_COLOR: blue\n  APP_MODE: prod\n</code></pre> \u26a0\ufe0f \u4e4b\u524d\u6211\u4eec\u770b\u5230\u7684yaml\u6587\u4ef6\u90fd\u67094\u4e2a\u6839\u5c5e\u6027\uff08<code>apiVersion</code>, <code>kind</code>, <code>metadata</code>, <code>spec</code>\uff09\uff0c\u8fd9\u6b21\u6ca1\u6709<code>spec</code>\u4e86\uff0c\u6362\u6210\u4e86<code>data</code>\uff01</p> <p>\u7136\u540e\u521b\u5efa\u6240\u5b9a\u4e49\u7684<code>configmap.yml</code></p> <pre><code>kubectl create -f configmap.yml\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#5-secret","title":"5. Secret","text":""},{"location":"cloud/k8s/ckad/ckad-2/#secret","title":"Secret\u7684\u4f7f\u7528","text":"<p><code>Secrets</code>\u7528\u6765\u5b58\u50a8\u4e0d\u5e94\u8be5\u88ab\u66b4\u9732\u7684\u6570\u636e\uff0c\u548c<code>ConfigMap</code>\u7684\u552f\u4e00\u533a\u522b\u5c31\u662f<code>Secrets</code>\u662f\u52a0\u5bc6\u7684\u3002 \u4f7f\u7528<code>Secret</code>\u4e2d\u6240\u6709\u7684\u952e\u503c\u5bf9\uff1a</p> <p><pre><code>envFrom:\n    - secretRef:\n        name: app-secret    # \u521b\u5efa\u7684Secret\u7684\u540d\u5b57\n</code></pre> \u53ea\u4f7f\u7528<code>Secret</code>\u4e2d\u7684\u4e00\u4e2a\u6216\u51e0\u4e2a\u503c\uff1a</p> <pre><code>env:\n    - name: DB_Host     # \u73af\u5883\u53d8\u91cf\u7684\u540d\u5b57\n      valueFrom: \n        secretKeyRef: \n            name: app-secret    # Secret\u7684\u540d\u5b57\n            key: DB_Host        # Secret\u4e2d\u5bf9\u5e94\u7684\u73af\u5883\u53d8\u91cf\u7684\u540d\u5b57\n</code></pre> <p>\u5c06<code>Secret</code>\u4f5c\u4e3a\u4e00\u4e2a\u6587\u4ef6\u5199\u5165\u5bb9\u5668\u7684<code>volume</code>\u91cc\u9762\uff1a</p> <pre><code>spec:\n    volumes:\n        - name: app-secret-volume       # volume\u7684\u540d\u5b57\n          secret:\n            secretName: app-secret  # secret\u7684\u540d\u5b57 --&gt; \u6ce8\u610f\u662f secretName \u4e0d\u662f name\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#secret_1","title":"Secret\u7684\u521b\u5efa","text":""},{"location":"cloud/k8s/ckad/ckad-2/#k_1","title":"\u7528<code>k</code>\u547d\u4ee4\u521b\u5efa","text":"<pre><code># \u4ece\u7eaf\u952e\u503c\u5bf9\u53d6\u503c\uff1a\n# \u8fd9\u91cc\u7684\u201cgeneric\u201d\u662fsecret\u7684\u7c7b\u578b\uff0c\u662f\u5fc5\u987b\u7ed9\u7684\u503c\uff0c\u4e0d\u7136\u4f1a\u62a5\u9519\uff01\uff01\u6211\u4eec\u4e4b\u540e\u4f1a\u8bb2\u5230\nkubectl create secret generic &lt;SecretName&gt; --from-literal=&lt;key&gt;=&lt;value&gt;\n\n# \u6216\u8005\uff0c\u4ece\u6587\u4ef6\u53d6\u503c\uff1a\nkubectl create secret generic &lt;SecretName&gt; --from-file=&lt;pathToFile&gt;\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#yaml_1","title":"\u7528<code>*.yaml</code>\u5b9a\u4e49","text":"<p>\u7eaf\u6587\u672c\u7248\u672c\uff08\u4e0d\u63a8\u8350\uff09\uff1a</p> <p><pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n    name: app-secret\ndata:\n    DB_Host: mysql\n    DB_User: root\n    DB_Password: paswrd\n</code></pre> \u52a0\u5bc6\u7248\u672c\uff1a \u5148\u7528<code>base64</code>\u5bf9\u4fe1\u606f\u8fdb\u884c\u52a0\u5bc6\uff1a</p> <p><pre><code>echo -n 'mysql' | base64\n</code></pre> \u7136\u540e\u518d\u5c06\u52a0\u5bc6\u540e\u7684\u6587\u5b57\u653e\u5230yaml\u6587\u4ef6\u4e2d\u3002\u53ef\u80fd\u957f\u8fd9\u6837\uff1a</p> <pre><code>...\ndata:\n    DB_Host: bXlzcWw=\n    DB_User: cm9vdA==\n    DB_Password: cGFzd3Jk\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#secret_2","title":"Secret\u7684\u52a0\u5bc6","text":"<p>\u4e4b\u524d\u6211\u4eec\u5c06<code>Secret</code>\u4ee5 base64 \u683c\u5f0f\u5bf9\u6570\u636e\u8fdb\u884c\u7f16\u7801\u3002 \u4efb\u4f55\u62e5\u6709 base64 \u7f16\u7801\u5bc6\u7801\u7684\u4eba\u90fd\u53ef\u4ee5\u8f7b\u677e\u89e3\u7801\uff0c\u56e0\u6b64\u5e76\u4e0d\u662f\u5f88\u5b89\u5168\u3002\u90a3\u4e3a\u4ec0\u4e48\u8bf4<code>Secret</code>\u6bd4<code>ConfigMap</code>\u66f4\u5b89\u5168\u5462\uff1f\u56e0\u4e3ak8s\u5bf9<code>Secret</code>\u7684\u5904\u7406\u5f62\u5f0f\u3002</p> <ul> <li><code>Secret</code>\u6587\u4ef6\u4e0d\u4e0a\u4f20\u5230\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff08\u6bd4\u5982git\uff09</li> <li>\u4ec5\u5f53<code>Pod</code>\u9700\u8981\u65f6\uff0c\u624d\u4f1a\u5c06<code>Secret</code>\u53d1\u9001\u5230\u8be5<code>Pod</code>\u6240\u5728\u7684\u8282\u70b9</li> <li>Kubelet \u5c06<code>Secret</code>\u5b58\u50a8\u5230 tmpfs \u4e2d\uff0c\u8fd9\u6837<code>Secret</code>\u5c31\u4e0d\u4f1a\u5199\u5165\u78c1\u76d8\u5b58\u50a8</li> </ul> <p><code>tmpfs</code> </p> <pre><code>**Temporary File System**\u662f\u7c7bUnix\u7cfb\u7edf\u4e0a\u7684\u6682\u5b58\u6863\u5b58\u50a8\u7a7a\u95f4\u3002\u6240\u6709\u5728`tmpfs`\u4e0a\u5b58\u50a8\u7684\u8d44\u6599\u5728\u7406\u8bba\u4e0a\u90fd\u662f\u6682\u65f6\u501f\u653e\u7684\uff0c\u90a3\u4e5f\u8868\u793a\u8bf4\uff0c\u6587\u4ef6\u4e0d\u4f1a\u521b\u5efa\u5728\u786c\u76d8\u4e0a\u9762\u3002\u4e00\u65e6\u91cd\u542f\uff0c\u6240\u6709\u5728`tmpfs`\u91cc\u9762\u7684\u8d44\u6599\u90fd\u4f1a\u6d88\u5931\u4e0d\u89c1\u3002\n\n`tmpfs` \u548c`RAM disk`\u7684\u6982\u5ff5\u8fd1\u4f3c\uff0c\u4f46\u540e\u8005\u4f1a\u5448\u73b0\u51fa *\u5177\u6709\u5b8c\u6574\u6587\u4ef6\u7cfb\u7edf* \u7684\u865a\u62df\u78c1\u76d8\u3002\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#secret_3","title":"Secret\u7684\u7c7b\u578b","text":"\u7c7b\u578b \u63cf\u8ff0 \u4e3e\u4f8b <code>docker-registry</code> \u7ed9Docker registry\u7528\u7684<code>Secret</code> <code>k create secret docker-registry my-secret \\</code> <code>--docker-email=tiger@acme.example \\</code> <code>--docker-username=tiger \\</code> <code>--docker-password=pass1234 \\</code> <code>--docker-server=my-registry.example:5000</code> <code>generic</code> \u4ece\u672c\u5730\u6587\u4ef6\u6216\u8005\u76f4\u63a5\u8f93\u5165\u751f\u6210<code>Secret</code>\uff08\u5373\u9ed8\u8ba4\u7684Opaque\u7c7b\u578b\uff09 <code>k create secret generic my-secret \\</code><code>--from-literal=username=prod_user</code> <code>--from-literal=password=top_secret</code> <code>tls</code> \u7528\u4e8e\u5b58\u50a8certificate\u4ee5\u53ca\u4e0e\u4e4b\u76f8\u5173\u8054\u7684key <code>k create secret tls my-tls-secret \\</code> <code>--cert=path/to/cert/file \\</code> <code>--key=path/to/key/file</code> <p>TLS (Transport Layer Security)</p> <p>\u662f\u4e00\u79cd\u52a0\u5bc6\u534f\u8bae\uff0c\u7528\u4e8e\u4fdd\u62a4 Internet \u4e0a\u7684\u901a\u4fe1\u3002 \u5b83\u662f SSL\uff08\u5b89\u5168\u5957\u63a5\u5b57\u5c42\uff09\u7684\u7ee7\u627f\u8005\uff0c\u4e3a\u4e24\u53f0\u8ba1\u7b97\u673a\u63d0\u4f9b\u4e86\u4e00\u79cd\u5b89\u5168\u5730\u76f8\u4e92\u901a\u4fe1\u7684\u65b9\u5f0f\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-2/#6-dockersecuritycontext","title":"6. Docker\u7684\u5b89\u5168\u6027\uff08SecurityContext\uff09","text":""},{"location":"cloud/k8s/ckad/ckad-2/#process-isolation","title":"Process isolation","text":"<p>\u5f53\u67d0\u4e2a\u4e3b\u673a/\u7535\u8111\u8fd0\u884cDocker\u65f6\uff0cDocker\u662f\u4ee5\u4e00\u4e2a\u5355\u72ec\u7684\u8fdb\u7a0b\uff08process\uff09\u7684\u5f62\u5f0f\u5b58\u5728\u7684\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4<code>ps aux</code>\u6216\u8005\u8fdb\u7a0b\u76d1\u89c6\u5668\uff08\u5982\u4e0b\u56fe\uff09\u770b\u5230\u8be5Docker\u8fdb\u7a0b\u3002</p> <p><code>ps aux</code>\u610f\u5473\u7740<code>process all user x</code>, <code>x</code>\u8868\u793a\u4efb\u610f\u7528\u6237 </p> <p>\u5bb9\u5668</p> <p>\u4e0d\u540c\u4e8e\u865a\u62df\u673a\uff0c\u5bb9\u5668\u5e76\u4e0d\u662f\u5b8c\u5168\u4e0e\u4e3b\u673a\u672c\u8eab\u5206\u79bb\u7684\u3002\u5bb9\u5668\u7528\u4e86Linux\u4e2d\u7684\u547d\u540d\u7a7a\u95f4\uff08Namespace\uff09\u8fdb\u884c\u5206\u79bb\uff0c\u4e3b\u673a\u672c\u8eab\u6709\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\uff0c\u5bb9\u5668\u81ea\u5df1\u6709\u5b83\u7684\u547d\u540d\u7a7a\u95f4\u3002\u6240\u6709\u7684\u5bb9\u5668\u5176\u5b9e\u8fd8\u662f\u5728\u4e3b\u673a\u4e0a\uff0c\u4f46\u662f\u5728\u81ea\u5df1\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u8dd1\u3002</p> <p>\u5982\u56fe\u6240\u793a\uff1a</p> <ul> <li>\u4e3b\u673a\uff08Host\uff09\u53ef\u4ee5\u770b\u5230\u7684Process\u5305\u62ec\uff1a1\uff0c2\uff0c3\uff0c3.1\uff0c3.2</li> <li>\u5bb9\u5668\uff08Container\uff09\u53ef\u4ee5\u770b\u5230\u7684Process\u5305\u62ec\uff1a3.1\uff0c3.2</li> </ul> <p></p> <p>Warning</p> <p>\u5c3d\u7ba1 \u4e3b\u673a\u89c6\u89d2 \u548c \u5bb9\u5668\u89c6\u89d2 \u90fd\u80fd\u770b\u52303.1\uff08<code>sleep 3000</code>\uff09\u548c3.2\uff08<code>ls</code>\uff09\u4e24\u4e2a\u8fdb\u7a0b\uff0c\u4ed6\u4eec\u5728\u4e24\u4e2a\u89c6\u89d2\u4e2d\u663e\u793a\u7684\u8fdb\u7a0bID\u662f\u4e0d\u4e00\u6837\u7684\uff01\u8fd9\u662f\u56e0\u4e3a\u8fdb\u7a0b\u5728\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u8fdb\u7a0b ID\uff0c\u8fd9\u5c31\u662f Docker \u5728\u7cfb\u7edf\u4e2d \u9694\u79bb\u5bb9\u5668 \u7684\u65b9\u5f0f\uff01</p>"},{"location":"cloud/k8s/ckad/ckad-2/#users","title":"\u5b89\u5168\u89d2\u5ea6\u7684Users","text":"<p>\u7528<code>docker run ubuntu sleep 3600</code> \u8fd0\u884c\u4e00\u4e2a\u5bb9\u5668\uff0c\u5f53\u6211\u4eec\u7528<code>ps aux</code>\u67e5\u770b\u8fdb\u7a0b\u65f6\uff0c\u4f60\u4f1a\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> <pre><code># ps aux\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot         1  0.0  0.0   2788  1116 ?        Ss   07:55   0:00 sleep 3600\nroot         7  0.1  0.0   2888   984 pts/0    Ss   08:39   0:00 /bin/sh\nroot        13  0.0  0.0   7060  1596 pts/0    R+   08:39   0:00 ps aux\n</code></pre> <p>Linux\u7528\u6237\u7c7b\u578b</p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06Linux\u4e2d\u7684\u7528\u6237\u5206\u4e3a\u4e24\u7c7b\uff1a</p> <ol> <li>root\u7528\u6237\uff1a\u4e5f\u53eb superuser \u6216\u8005 administrator</li> <li>\u975eroot\u7528\u6237\uff1a\u901a\u5e38\uff0c\u5728 Linux \u7cfb\u7edf\u4e0a\u521b\u5efa\u7684\u7b2c\u4e00\u4e2a\u975eroot\u7528\u6237\u7684 UID \u4e3a 1000\uff0c\u7b2c\u4e8c\u4e2a\u7528\u6237\u5e10\u6237\u5206\u914d\u7684 UID \u4e3a 1001\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002<code>UID &gt;= 1000</code> \u7684\u7528\u6237\u90fd\u662f\u975eroot\u7528\u6237</li> </ol>"},{"location":"cloud/k8s/ckad/ckad-2/#root-vs-root","title":"\u5bb9\u5668root VS \u4e3b\u673aroot","text":"\u7279\u6027 \u5bb9\u5668 root \u7528\u6237 \u4e3b\u673a root \u7528\u6237 UID \u5bb9\u5668\u5185\u90e8\u7684 root UID \u901a\u5e38\u4e3a <code>0</code>\uff0c\u4f46\u53ef\u4ee5\u6620\u5c04\u5230\u4e3b\u673a\u666e\u901a\u7528\u6237\u3002 \u4e3b\u673a root \u7684 UID \u59cb\u7ec8\u4e3a <code>0</code>\uff0c\u5e76\u5bf9\u5e94\u7cfb\u7edf\u7684\u8d85\u7ea7\u7528\u6237\u6743\u9650\u3002 \u6743\u9650\u8303\u56f4 \u9ed8\u8ba4\u4ec5\u9650\u4e8e\u5bb9\u5668\u5185\u90e8\uff0c\u65e0\u6cd5\u76f4\u63a5\u64cd\u4f5c\u4e3b\u673a\u8d44\u6e90\u3002 \u5bf9\u6574\u4e2a\u4e3b\u673a\u7cfb\u7edf\u62e5\u6709\u5b8c\u5168\u7684\u6743\u9650\uff0c\u53ef\u4fee\u6539\u4efb\u4f55\u7cfb\u7edf\u8d44\u6e90\u3002 \u7f51\u7edc\u6743\u9650 \u7f51\u7edc\u6743\u9650\u53d7\u5bb9\u5668\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff08Network Namespace\uff09\u9650\u5236\u3002 \u62e5\u6709\u5bf9\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u7684\u5b8c\u5168\u63a7\u5236\u6743\u3002 \u7279\u6743\u6a21\u5f0f\u5f71\u54cd \u5728\u9ed8\u8ba4\u6a21\u5f0f\u4e0b\u6743\u9650\u6709\u9650\uff0c\u4f46\u542f\u7528 <code>--privileged</code> \u4f1a\u83b7\u53d6\u4e3b\u673a\u6743\u9650\u3002 \u4e0d\u53d7\u9650\u5236\uff0c\u9ed8\u8ba4\u62e5\u6709\u6240\u6709\u7279\u6743\u3002 <p>\u4e3b\u673aroot\u7528\u6237 \u662fLinux\u7cfb\u7edf\u4e2d\u6700\u5f3a\u5927\u7684\u7528\u6237\uff0c\u57fa\u672c\u4ec0\u4e48\u90fd\u80fd\u5e72\uff08\u5177\u4f53\u80fd\u5e72\u4ec0\u4e48\u7684\u5217\u8868\u5728<code>usr/include/linux/capability.h</code>\uff09\u3002\u800c \u5bb9\u5668root\u7528\u6237 \u662f\u8bbe\u9650\u7684\uff0c\u8fd9\u91cc\u5217\u4e3e\u4e00\u4e9b:</p> \u547d\u4ee4 \u7528\u9014 \u4e3b\u673aroot\u7528\u6237 \u5bb9\u5668root\u7528\u6237 <code>chown</code> \u6388\u6743 \u2713 \u2713 <code>dac</code> \u2713 \u2713 <code>kill</code> \u6740\u6b7b\u8fdb\u7a0b \u2713 \u2713 <code>setfcap</code> \u2713 \u2713 <code>setpcap</code> \u2713 \u2713 <code>setgid</code> \u2713 \u2713 <code>setuid</code> \u2713 \u2713 <code>net_bind</code> \u2713 \u2713 <code>net_raw</code> \u2713 \u2713 <code>mac_admin</code> \u2713 \u274c <code>broadcast</code> \u2713 \u274c <code>net_admin</code> \u2713 \u274c <code>sys_admin</code> \u2713 \u274c <code>sys_chroot</code> \u2713 \u2713 <code>audit_write</code> \u2713 \u2713 \u5176\u4ed6 \u2713 \u274c <p>\u4ee5\u4e0a\u5217\u51fa\u7684\u662f\u9ed8\u8ba4\u7684\u6743\u9650\uff0c\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u624b\u52a8\u5730\u7ed9\u5bb9\u5668\u7684\u7528\u6237\u6dfb\u52a0\u6216\u8005\u5220\u51cf\u6743\u9650\uff1a</p> <ul> <li>\u589e\u52a0<ul> <li>\u4e3a\u5bb9\u5668<code>ubuntu</code>\u589e\u52a0\u4e00\u4e2a<code>MAC_ADMIN</code>\u7684\u6743\u9650\uff1a      <pre><code>docker run --cap-add MAC_ADMIN ubuntu\n</code></pre></li> <li>\u4e3a\u5bb9\u5668<code>ubuntu</code>\u5f00\u653e\u6240\u6709\u6743\u9650\uff1a      <pre><code>docker run --privileged ubuntu\n</code></pre></li> </ul> </li> <li>\u5220\u51cf\uff1a     <pre><code>docker run --cap-drop KILL ubuntu\n</code></pre></li> </ul>"},{"location":"cloud/k8s/ckad/ckad-2/#_1","title":"\u4fee\u6539\u5bb9\u5668\u7528\u6237","text":"<p>\u5982\u679c\u6211\u4eec\u60f3\u8981\u4f7f\u7528\u975eroot\u7528\u6237\u8fd0\u884c\uff08\u56e0\u4e3a\u8fd9\u6837\u66f4\u5b89\u5168\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u4fee\u6539\uff1a</p> <p>\u65b9\u6cd5\u4e00\uff1a\u521b\u5efa\u5bb9\u5668\u65f6\u52a0\u4e0a\u53c2\u6570<code>--user</code></p> <pre><code>docker run --user=1000 ubuntu sleep 3600\n</code></pre> <p>\u65b9\u6cd5\u4e8c\uff1a\u5728\u4f7f\u7528\u955c\u50cf\u4e4b\u524d\uff0c\u5728\u5b9a\u4e49\u955c\u50cf\u7684Dockerfile\u4e2d\u4fee\u6539\u7528\u6237 \u7528ubuntu\u4f5c\u4e3a\u57fa\u7840\u955c\u50cf\uff0c\u521b\u5efa\u4e00\u4e2a\u7ed9\u81ea\u5b9a\u4e49\u955c\u50cf\u7684Dockerfile\uff1a</p> <p><pre><code>FROM ubuntu\nUSER 1000\n</code></pre> \u57fa\u4e8e\u8be5Dockerfile\u521b\u5efa\u955c\u50cf<code>my-ubuntu</code>\uff1a</p> <p><pre><code>docker build -t my-ubuntu .\n</code></pre> \u521b\u5efa\u5bb9\u5668</p> <p><pre><code>docker run my-ubuntu sleep 3600\n</code></pre> \u518d\u6b21\u7528<code>ps aux</code>\u67e5\u770b\u8fdb\u7a0b\u65f6\uff0c\u4f60\u4f1a\u5f97\u5230\u5982\u4e0b\u7ed3\u679c\uff1a</p> <pre><code># ps aux\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\n1000         1  0.0  0.0   2788  1116 ?        Ss   07:55   0:00 sleep 3600\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#7-k8ssecuritycontext","title":"7. k8s\u7684\u5b89\u5168\u6027\uff08SecurityContext\uff09","text":"<p>\u4e0a\u4e00\u7ae0\u6211\u4eec\u8ba8\u8bba\u4e86Docker\u7684\u5b89\u5168\u6027\u3002\u540c\u6837\u7684\u8bbe\u7f6e\u5728k8s\u4e2d\u4e5f\u6709\uff0c\u800c\u4e14\u53ef\u4ee5\u9009\u62e9\u8303\u7574\uff1a</p> <ul> <li><code>Pod</code>\u7ea7\u522b\u7684\u5b89\u5168\u914d\u7f6e</li> <li><code>Container</code>\u7ea7\u522b\u7684\u5b89\u5168\u914d\u7f6e</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u5bb9\u5668\u7684\u7528\u6237\u7c7b\u578b\uff1a <pre><code>kubectl exec ubuntu-sleeper -- whoami\n</code></pre></p> <p>\u4f7f\u7528\u89c4\u5219\u548c\u4f18\u5148\u7ea7\u5982\u4e0b\uff1a</p> <ul> <li><code>Pod</code>\u7684\u914d\u7f6e\u4f1a\u81ea\u52a8\u5e94\u7528\u5230\u5728\u8be5<code>Pod</code>\u4e0a\u7684\u6240\u6709<code>Container</code>\u4e2d</li> <li><code>Container</code>\u7684\u5b89\u5168\u914d\u7f6e \u4f1a\u8986\u5199\u6240\u5728\u7684 <code>Pod</code>\u4e0a\u7684 \u7684\u5b89\u5168\u914d\u7f6e\uff1a <code>Container</code> &gt; <code>Pod</code></li> </ul> <p>\u26a0\ufe0f \u53ea\u6709<code>Container</code>\u7ea7\u522b\u7684\u5b89\u5168\u914d\u7f6e\u624d\u53ef\u4ee5\u6dfb\u52a0<code>capabilities</code>\uff08\u6743\u9650\uff09\u5c5e\u6027\u3002\u4e3e\u4f8b\uff1a\u589e\u52a0\u67d0\u4e2a<code>capabilities</code>\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: web-pod\nspec:\n    # ---------- Pod\u7ea7\u522b ----------\n    securityContext:\n        runAsUser: 1000\n\n    containers:\n      - name: ubuntu\n        image: ubuntu\n        command: [\"sleep\", \"3600\"]\n        # ---------- Container\u7ea7\u522b ----------\n        securityContext:\n            runAsUser: 1000\n            capabilities:\n                add: [\"MAC_ADMIN\", \"SYS_TIME\"]\n</code></pre> <p>\u4e3e\u4f8b\uff1a\u5220\u9664\u67d0\u4e2a<code>capabilities</code>\uff1a</p> <pre><code>...\n            # ---------- Container\u7ea7\u522b ----------\n            securityContext:\n                capabilities:\n                    drop: [\"MAC_ADMIN\", \"SYS_TIME\"]\n</code></pre> <p>Note</p> <pre><code>\u5982\u679c\u8981\u7528root\u7528\u6237\uff0c\u5219\u76f4\u63a5\u5220\u9664`runAsUser: xxxx`\u5373\u53ef\uff01\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#8-serviceaccount","title":"8. ServiceAccount","text":"<p>\u5728k8s\u4e2d\uff0c\u6709\u4e24\u7c7b\u8d26\u53f7\uff1a</p> <ul> <li>\u7528\u6237\u8d26\u53f7\uff08UserAccount\uff09\uff1a\u7ed9\u4eba\u7684\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8eAdmin\uff0cDeveloper\u7b49</li> <li> <p>\u670d\u52a1\u8d26\u53f7\uff08ServiceAccount\uff09\uff1a\u7ed9App\u7684\uff0c\u7528\u4e8eApp\u4e0ek8s\u7684\u4ea4\u4e92\u3002\u670d\u52a1\u8d26\u53f7\u63d0\u4f9b\u4e86\u8eab\u4efd\u4fe1\u606f\uff0c\u5e38\u89c1\u7684\u4f7f\u7528\u6848\u4f8b\u6709\uff1a</p> <ul> <li>\u4e0eAPIServer\u7684\u4ea4\u6d41</li> <li>\u4e0e\u5916\u90e8\u670d\u52a1\u7684\u4ea4\u6d41</li> <li>\u53d6\u5f97\u79c1\u6709\u7684\u955c\u50cf\u6570\u636e\u5e93\uff08private image registry\uff09\u8ba4\u8bc1</li> <li>\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u4f7f\u7528SA\u6765\u8bc6\u522bPods</li> </ul> </li> </ul> <p>\u521b\u5efa<code>ServiceAccount</code>\u7684\u65f6\u5019\uff0c\u4e5f\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u76f8\u5bf9\u5e94\u7684\u9759\u6001 Token\u3002\u8be5\u4ee4\u724c\u4f1a\u88ab\u653e\u5728\u4e00\u4e2a \u81ea\u52a8\u751f\u6210\u7684<code>Secret</code>\u5bf9\u8c61 \u4e2d\u3002\u7528\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u770b\u5230\u751f\u6210\u7684\u4ee4\u724c\u7684\u540d\u5b57\uff1a</p> <p><pre><code>kubectl describe serviceaccount &lt;ServiceAccountName&gt;\n</code></pre> \u4f60\u4f1a\u770b\u5230\uff1a</p> <p></p> <p>\u52a8\u6001 Token</p> <p>\u4e5f\u53ef\u4ee5\u4e3a Kubernetes \u670d\u52a1\u8d26\u6237\uff08ServiceAccount\uff09\u751f\u6210\u77ed\u671f\u7684\u8eab\u4efd\u8ba4\u8bc1 Token\uff0c\u901a\u5e38\u7528\u4e8e API \u8bbf\u95ee\u6216\u5176\u4ed6\u9700\u8981\u8eab\u4efd\u9a8c\u8bc1\u7684\u573a\u666f\uff1a <pre><code># \u4e3a SA \u751f\u6210 \u52a8\u6001 Token\nkubectl create token  &lt;ServiceAccountName&gt; \\\n    --duration=10m  # \u9ed8\u8ba4 Token \u6709\u6548\u671f\u901a\u5e38\u4e3a 1 \u5c0f\u65f6\n</code></pre> \u547d\u4ee4\u4f1a\u8fd4\u56de\u4e00\u4e2a\u7c7b\u4f3c\u4ee5\u4e0b\u7684 Token\uff08JWT \u683c\u5f0f\uff09\uff1a <pre><code>eyJhbGciOiJSUzI1NiIsImtpZCI6Il9oYXZlX3NvbWVfZnVuIn0.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tN3h2cXoiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjEyMzQ1NiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.abcdef...\n</code></pre></p> <p>\u67e5\u770bPod\u7684<code>ServiceAccount</code>\u653e\u5728\u54ea\u91cc\uff1a</p> <p><pre><code>k describe pod &lt;PodName&gt;\n</code></pre> </p>"},{"location":"cloud/k8s/ckad/ckad-2/#_2","title":"\u4f7f\u7528","text":""},{"location":"cloud/k8s/ckad/ckad-2/#sa","title":"\u4ece\u96c6\u7fa4\u5916\u4f7f\u7528sa","text":"<p>\u4ee4\u724c\u88ab\u5bfc\u51fa\u5230\u5916\u90e8\u5e94\u7528\u7a0b\u5e8f\uff0c\u5728\u5411 Kubernetes API \u53d1\u9001\u8bf7\u6c42\u7684\u65f6\u5019\u7528\u8be5\u4ee4\u724c\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002\u6bd4\u5982\uff1a</p> <p><pre><code>curl https://192.168.56.70:6443/api \\\n    -insecure \\\n    --header \"Authorization: Bearer eyJhxxB...\"\n</code></pre> \u26a0\ufe0f <code>eyJhxxB...</code>\u5373\u4ee4\u724c\u7684\u5185\u5bb9\u3002</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-2/#sa_1","title":"\u4ece\u96c6\u7fa4\u5185\u4f7f\u7528sa","text":"<p>\u5047\u5982\u8be5\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u4e8e\u96c6\u7fa4\u7684\u67d0\u4e2a<code>Pod</code>\u4e0a\uff0c\u5219\u81ea\u52a8\u751f\u6210\u7684\u4ee4\u724c\u4f1a\u88ab\u5199\u5165\u8be5<code>Pod</code>\u7684<code>Volume</code>\u4e2d\uff0c\u65e0\u9700\u201c\u5bfc\u51fa\u201d\u3002</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-2/#default-sa","title":"<code>default</code> sa","text":"<p>k8s\u7cfb\u7edf\u81ea\u52a8\u4e3a\u6bcf\u4e00\u4e2a<code>Namespace</code>\u751f\u6210\u4e00\u4e2a\u540d\u4e3a<code>default</code>\u7684SA\uff0c\u8be5SA\u62e5\u6709\u7279\u5b9a\u7684API\u6743\u9650\u3002</p> <p>\u5728\u8fd9\u4e2a Namespace \u4e2d\u521b\u5efa\u7684 \u6bcf\u4e2a <code>Pod</code>\uff0c\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u5176\u4ed6\u670d\u52a1\u8d26\u6237\uff0c\u90fd\u4f1a\u81ea\u52a8\u4f7f\u7528\u8fd9\u4e2a <code>default</code> \u670d\u52a1\u8d26\u6237\u3002Kubernetes \u4f1a\u628a default \u670d\u52a1\u8d26\u6237\u5173\u8054\u7684\u8ba4\u8bc1\u4fe1\u606f\uff08Token\u3001CA \u8bc1\u4e66\u7b49\uff09\u81ea\u52a8\u6302\u8f7d\u5230 <code>Pod</code> \u91cc\u7684\u56fa\u5b9a\u8def\u5f84\u4e2d: <pre><code>/var/run/secrets/kubernetes.io/serviceaccount\n</code></pre> \u8fd9\u6837\uff0cPod \u91cc\u7684\u5e94\u7528\u5c31\u80fd\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u51ed\u8bc1\u8bbf\u95ee Kubernetes API\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7528<code>k describe pod xxx</code>\u67e5\u770b<code>Volumes</code> \u3002\u4e5f\u53ef\u4ee5\u53bb\u770bSecret\u672c\u8eab\uff1a </p> <p>\u6211\u4eec\u7528<code>k exec -it xxx ls /var/run/secrets/kubernetes.io/serviceaccount</code>\u8fdb\u5230\u67d0\u4e2aPod\u7684\u7ec8\u7aef\uff0c\u80fd\u770b\u5230\u4e09\u4e2a\u6587\u4ef6\uff1a</p> <ul> <li>ca.crt</li> <li>namespace</li> <li>token: \u771f\u6b63\u5b58\u4e86\u4ee4\u724c\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u8bbf\u95ee Kubernetes API\u3002</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-2/#default-sa_1","title":"\u53eb\u505c\u9ed8\u8ba4<code>default</code> sa\u7684\u6302\u8f7d","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u53eb\u505c<code>default</code>ServiceAccount\u7684\u81ea\u52a8\u6302\u8f7d\uff08\u53ef\u4ee5\u5728 Pod \u6216\u8005 Deployment \u7684\u5b9a\u4e49\u6587\u4ef6\u4e2d\u8fdb\u884c\u4fee\u6539\uff09\uff1a</p> <pre><code># ---------------Pod--------------\napiVersion: v1\nkind: Pod\nmetadata:\n    name: web-pod\nspec:\n    containers:\n        - name: ubuntu\n            image: ubuntu\n    automountServiceAccountToken: false             # \u53eb\u505c`default`ServiceAccount\u7684\u81ea\u52a8\u6302\u8f7d\n\n# ---------------Deployment--------------\n.spec.template.spec:\n    automountServiceAccountToken: false     # \u53eb\u505c`default`ServiceAccount\u7684\u81ea\u52a8\u6302\u8f7d\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#poddeploymentsa","title":"\u4fee\u6539Pod/Deployment\u4f7f\u7528\u7684sa","text":"<p><code>default</code> ServiceAccount\u53ea\u63d0\u4f9b\u4e86\u6700\u57fa\u7840\u7684 Kubernetes API\u8bbf\u95ee\u6743\u9650\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9Pod\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684ServiceAccount\u4ee5\u63d0\u4f9b\u66f4\u591a\u5176\u4ed6\u6743\u9650\uff1a \u5220\u6389\u65e7\u7684Pod\uff0c\u7528new-pod.yml\u65b0\u5efa\u4e00\u4e2aPod\uff08\u6216\u8005\u76f4\u63a5\u4fee\u6539\u5305\u542b\u8be5Pod\u7684Deployment\uff09</p> <pre><code># ---------------Pod--------------\napiVersion: v1\nkind: Pod\nmetadata:\n    name: web-pod\nspec:\n    containers:\n        - name: ubuntu\n            image: ubuntu\n    serviceAccountName: robot       # \u4f7f\u7528\u53e6\u4e00\u4e2a\u540d\u4e3a`robot`\u7684ServiceAccount\n\n# ---------------Deployment--------------\n.spec.template.spec:\n    serviceAccountName: robot       # \u4f7f\u7528\u53e6\u4e00\u4e2a\u540d\u4e3a`robot`\u7684ServiceAccount\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#9-resource-requirements","title":"9. \u8d44\u6e90\u9700\u6c42\uff08Resource Requirements\uff09","text":""},{"location":"cloud/k8s/ckad/ckad-2/#container","title":"Container\u7684\u8d44\u6e90\u914d\u7f6e","text":""},{"location":"cloud/k8s/ckad/ckad-2/#_3","title":"\u8d44\u6e90\u7684\u9ed8\u8ba4\u503c","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0ck8s cluster\u4e0a\u8d44\u6e90\u7684\u4f7f\u7528\u662f\u6ca1\u6709\u9650\u5236\u7684\u3002\u4f46\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>LimitRange</code>\u8bbe\u7f6e\u9ed8\u8ba4\u503c\uff0c\u6bd4\u5982\u9ed8\u8ba4\u4e00\u4e2a\u65b0<code>Container</code>\u521d\u59cb\u5316\u65f6\u81f3\u5c110.5 CPU\u548c256 Mi\u7684\u5185\u5b58\uff08memory\uff09\u3002<code>LimitRange</code> \u5e94\u7528\u4e8e\u6574\u4e2a\u547d\u540d\u7a7a\u95f4\uff08<code>Namespace</code>\uff09\u3002\u4e3e\u4f8b\uff1a</p> <pre><code># \u9ed8\u8ba4\u5185\u5b58\uff1a\napiVersion: v1\nkind: LimitRange\nmetadata:\n  name: mem-limit-range\nspec:\n  limits:\n  - default:\n      memory: 512Mi\n    defaultRequest:\n      memory: 256Mi\n    type: Container\n</code></pre> <p><code>.spec.limits.type</code> \u7684\u53ef\u80fd\u503c\u6709: <code>Container</code>, <code>Pod</code>, <code>PersistentVolumeClaim</code></p> <p>ResourceQuotas vs LimitRange</p> <ul> <li><code>ResourceQuotas</code> \u5bf9\u4e00\u4e2aNS\u4e2d\u7684\u603b\u8d44\u6e90\u8bbe\u9650</li> <li><code>LimitRange</code> \u5bf9NS\u4e2d\uff0c\u5355\u4e2a Pod/Container \u4f7f\u7528\u7684\u8d44\u6e90\u8bbe\u9650\uff0c\u76ee\u7684\u662f\u907f\u514d\u5355\u4e2a Pod \u6216\u5bb9\u5668\u8fc7\u5ea6\u4f7f\u7528\u8d44\u6e90\u3002</li> </ul> <pre><code># \u9ed8\u8ba4CPU\uff1a\napiVersion: v1\nkind: LimitRange\nmetadata:\n  name: mem-limit-range\nspec:\n  limits:\n  - default:\n      cpu: 1\n    defaultRequest:\n      cpu: 0.5\n    type: Container\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#pod_1","title":"Pod\u8d44\u6e90\u914d\u7f6e","text":"<p>\u5982\u679c\u4f60\u7684<code>Container</code>\u9700\u8981\u66f4\u591a\u7684\u8d44\u6e90\uff0c\u4f60\u53ef\u4ee5\u5728<code>Pod</code>/<code>Deployment</code>\u7684\u5b9a\u4e49\u6587\u4ef6\u4e2d\u4fee\u6539<code>Container</code>\u7684\u8d44\u6e90\u5c5e\u6027\uff0c\u5b83\u4f1a\u8986\u5199 <code>LimitRange</code> \u4e2d\u7684\u9ed8\u8ba4\u503c\u3002</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: web-pod\nspec:\n    containers:\n      - name: ubuntu    # \u8d44\u6e90\u90fd\u662f\u76f8\u5bf9Container\u6765\u8bf4\u7684\uff0c\u4e0d\u662f\u6574\u4e00\u4e2aPod\n        image: ubuntu\n        resources:\n            requests:           # \u81ea\u5b9a\u4e49\u6240\u9700\u8d44\u6e90\u7684\u5927\u5c0f\n                memory: \"1Gi\"\n                cpu: 1\n            limits:             # \u81ea\u5b9a\u4e49\u53ef\u7528\u8d44\u6e90\u4e0a\u9650\n                memory: \"2Gi\"\n                cpu: 2\n</code></pre> <ul> <li><code>requests</code>\uff1a\u4fdd\u8bc1\u7684\u6700\u5c11\u8d44\u6e90\u6570\u91cf</li> <li><code>limits</code>\uff1a\u6700\u5927\u8d44\u6e90\u6570\u91cf\uff0c<code>Container</code>\u4e0d\u53ef\u4ee5\u4f7f\u7528\u8d85\u51fa\u8be5\u8303\u56f4\u7684\u8d44\u6e90\uff01</li> </ul> <p>Warning</p> <pre><code>\u5982\u679c\u7ed9\u67d0\u4e2aContainer\u81ea\u5b9a\u4e49\u4e86`requests`\uff0c\u6700\u597d\u4e5f\u81ea\u5b9a\u4e49\u5b83\u7684`limits`\uff0c\u5426\u5219\u53ef\u80fd\u62a5\u9519:&lt;br/&gt; `\u81ea\u5b9a\u4e49requests &gt; LimitRange \u4e2d\u9ed8\u8ba4\u7684limits`\n</code></pre> <p>k8s\u4f1a\u6839\u636e\u8d44\u6e90\u9700\u6c42\u53bb\u627e\u6709\u8d44\u6e90\u7a7a\u95f2\u7684Node\uff0c\u7136\u540e\u628a\u65b0Pod\u653e\u5230Node\u91cc\u9762\uff1a</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-2/#pod_2","title":"\u5f53Pod\u5bf9\u8d44\u6e90\u7684\u4f7f\u7528\u8d85\u51fa\u9650\u5236\u65f6","text":"<p>\u5f53\u67d0\u4e2a<code>Container</code>\u7684\u8d44\u6e90\u4f7f\u7528\u8d85\u51fa\u9650\u5236\u65f6\uff0ck8s\u4f1a\u8fd9\u6837\u5904\u7406\uff1a</p> <ul> <li>CPU\u4f7f\u7528\u8fc7\u591a\uff1aKubernetes \u4f1a\u9650\u5236 CPU\uff0c\u4f7f\u5176\u4e0d\u4f1a\u8d85\u51fa\u6307\u5b9a\u7684\u9650\u5236\u3002<code>Container</code>\u4e0d\u80fd\u4f7f\u7528\u8d85\u8fc7\u5176\u9650\u5236\u7684 CPU \u8d44\u6e90\u3002</li> <li>Memory\u4f7f\u7528\u8fc7\u591a\uff1a\u7406\u8bba\u4e0a\uff0c<code>Container</code>\u53ef\u4ee5\u4f7f\u7528\u6bd4\u5176\u9650\u5236\u66f4\u591a\u7684\u5185\u5b58\u8d44\u6e90\u3002\u4f46\u662f\uff0c\u5982\u679c\u4e00\u4e2a<code>Pod</code>\u4e0d\u65ad\u5c1d\u8bd5\u6d88\u8017\u8d85\u8fc7\u5176\u9650\u5236\u7684Memory\uff0c\u5219\u8be5<code>Pod</code>\u5c06\u88ab\u7ec8\u6b62\u3002</li> </ul> <p>CPU\u5355\u4f4d</p> <ul> <li>\u6d6e\u70b9\u6570\uff0c1CPU=1000m\uff08m=millicpu\uff09\uff0c\u6700\u5c0f\u7684CPU\u53ef\u4ee5\u662f1m</li> <li>1 CPU = 1 vCPU\uff0c\u53ef\u4ee5\u662f\uff1aAWS\u76841 vCPU\uff1bGCP\u76841Core\uff1bAzure\u76841Core\uff1b1 Hyperthred</li> </ul> <p>Memory\u5355\u4f4d</p> <ul> <li>1 G\uff08Gigabyte\uff09= 1,000,000,000 bytes</li> <li>1 M\uff08Megabyte\uff09= 1,000,000 bytes</li> <li>1 K\uff08Kilogabyte\uff09= 1,000 bytes</li> <li>1 Gi\uff08Gibibyte\uff09= 2^30 =1,073,741,824 bytes</li> <li>1 Mi\uff08Mebibyte\uff09= 2^20 = 1,048,576 bytes</li> <li>1 Ki\uff08Kibibyte\uff09= 2^10 = 1,024 bytes</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-2/#10-podnode","title":"10. Pod\u548cNode\u7684\u5173\u7cfb","text":"<p>\u5982\u4f55\u4fdd\u8bc1\u67d0\u4e2a<code>Pod</code>\u4e00\u5b9a\u4f1a\u653e\u5230\u67d0\u4e2a<code>Node</code>\u4e0a?</p>"},{"location":"cloud/k8s/ckad/ckad-2/#taints-toleration","title":"Taints \u548c Toleration","text":"<p>\u6211\u8981\u53bb\u91ce\u8425\uff0c\u4e3a\u4e86\u9632\u6b62\u866b\u5b50\u968f\u4fbf\u505c\u5728\u6211\u8eab\u4e0a\uff0c\u6211\u9700\u8981\u9632\u866b\u55b7\u96fe\u3002<code>Taints</code>\u76f8\u5f53\u4e8e\u6740\u866b\u5242\uff0c\u67d0\u4e2a<code>Taint</code>\u9488\u5bf9\u866b\u5b50A\uff0c\u4f46\u662f\u866b\u5b50B\u4e0d\u6015\u8fd9\u79cd\u6740\u866b\u5242\uff0c\u6240\u4ee5\u866b\u5b50B\u6709<code>Tolerant</code>\u3002\u6240\u4ee5\u51b3\u5b9a\u4e86\u866b\u5b50\u662f\u5426\u4f1a\u843d\u5230\u6211\u7684\u8eab\u4e0a\uff0c\u6709\u4e24\u4e2a\u56e0\u7d20\uff1a</p> <ol> <li>\u6211\u55b7\u7684<code>Taint</code></li> <li>\u866b\u5b50\u7684<code>Toleration</code></li> </ol> <p>\u5047\u8bbe\u6211\uff08\u4eba\uff09\u662f\u4e2a<code>Node</code>\uff0c\u866b\u5b50\u662f<code>Pod</code>\u3002<code>Taints</code> \u548c <code>Toleration</code>\u4e24\u4e2a\u6982\u5ff5\u4e0e\u5b89\u5168\u65e0\u5173\uff0c\u5b8c\u5168\u53ea\u662f\u9650\u5236\u4ec0\u4e48<code>Pod</code>\u653e\u5728\u4ec0\u4e48<code>Node</code>\u4e2d\u7684\u4e00\u4e2a\u89c4\u5219\u3002\u5f53\u5b8c\u5168\u6ca1\u6709\u89c4\u5219\u5b9a\u4e49\u7684\u65f6\u5019\uff0ck8s\u7684<code>Scheduler</code>\u5bf9<code>Pod</code>\u8fdb\u884c\u5e73\u5747\u5206\u914d\u3002</p> <p>Warning</p> <p><code>Taint</code> \u548c<code>Toleration</code>\u53ea\u662f\u4e3a\u4e86\u5c06\u67d0\u4e9b<code>Pod</code>\u6392\u9664\u5728\u67d0\u4e2a<code>Node</code>\u4e4b\u5916\uff0c\u5b83\u65e0\u6cd5\u4fdd\u8bc1\u7279\u6b8a\u7684<code>Pod</code>\u4e00\u5b9a\u4f1a\u653e\u5728\u9002\u5408\u5b83\u4eec\u7684<code>Node</code>\u4e0a\uff08\u8fd9\u4e2a\u7531Node Affinity\u5b9e\u73b0\uff09\u3002\u56e0\u4e3a\u5176\u4ed6<code>Node</code>\u53ef\u80fd\u6ca1\u6709\u8bbe<code>Taint</code>\u3002</p> <p>\u76f8\u53cd\uff0c<code>Taint</code> \u548c<code>Toleration</code>\u544a\u8bc9<code>Node</code>\u53ea\u63a5\u53d7\u5177\u6709\u67d0\u4e9b <code>Toleration</code> \u7684  <code>pod</code> --&gt; \u53ea\u4fdd\u8bc1Node\u7684\u7eaf\u51c0\u5ea6</p>"},{"location":"cloud/k8s/ckad/ckad-2/#1-nodetaint","title":"1. \u7ed9<code>Node</code>\u52a0\u4e0a<code>Taint</code>\uff1a","text":"<pre><code># taint\u672c\u8eab\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u6240\u4ee5 \u201c&lt;key&gt;=&lt;value&gt;\u201d \u5c31\u591f\u4e86\nkubectl taint nodes &lt;NodeName&gt; &lt;key&gt;&lt;operator&gt;&lt;value&gt;:&lt;TaintEffect&gt;\n# \u4e3e\u4f8b\uff1a\nkubectl taint nodes node1 app=blue:NoSchedule\n</code></pre> <p>OpenShift \u4e5f\u6709\u8fd9\u4e2amechanism\uff0c\u4f46\u9700\u8981adm</p> <pre><code>oc adm taint nodes node1 app=blue:NoSchedule\n</code></pre> <p>\u5176\u4e2d\u7684<code>TaintEffect</code> \u5c5e\u6027\u51b3\u5b9a\u4e86\u5982\u679c <code>Pod</code> \u6ca1\u6709\u5bf9\u5e94\u7684 <code>Toleration</code> \u4f1a\u53d1\u751f\u4ec0\u4e48\uff0c\u4ece\u4e25\u683c\u5230\u5bbd\u677e\u5171\u67093\u4e2aEffect\uff1a</p> <ol> <li><code>NoExecute</code>\uff1a\u4e0d\u518d\u63a5\u53d7\u65b0\u7684<code>Pod</code>\uff0c\u9a71\u9010\u6709\u5df2\u5b58\u5728\uff0c\u4f46\u5e76\u6ca1\u6709<code>Toleration</code>\u7684<code>Pod</code></li> <li><code>NoSchedule</code>\uff1a\u6ca1\u6709<code>Toleration</code>\u7684<code>Pod</code>\u4e0d\u4f1a\u653e\u5728\u6709<code>Taint</code>\u7684<code>Node</code>\u4e0a</li> <li><code>PreferNoSchedule</code>\uff1a\u5c3d\u91cf\u907f\u514d\uff0c\u4f46\u662f\u4e0d\u4fdd\u8bc1</li> </ol>"},{"location":"cloud/k8s/ckad/ckad-2/#2-podtoleration","title":"2. \u7ed9\u6240\u5c5e\u7684<code>Pod</code>\u52a0\u4e0a<code>Toleration</code>","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: web-pod\nspec:\n    containers:\n        - name: ubuntu\n          image: ubuntu\n\n    tolerations:    # \u56db\u4e2a\u5c5e\u6027\uff0c\u5206\u522b\u5bf9\u5e94taint\u4e2d\u7684 \u201capp=blue:NoSchedule\u201d\n        - key: app\n          operator: Equal\n          value: blue\n          effect: NoSchedule\n</code></pre> <p>Warning</p> <pre><code>`tolerations`\u4e2d\u5305\u542b\u7684\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u522b\u5fd8\u4e86\u8fd9\u4e2a\u7b26\u53f7\uff1a`-`\n</code></pre> <p>Best Practise</p> <p>\u4e00\u822c\u6211\u4eec\u5148\u7528<code>--dry-run=client</code>\u751f\u6210<code>*.yaml</code>\u6587\u4ef6\uff0c\u518d\u5728\u6587\u4ef6\u4e2d\u52a0\u4e0a<code>tolerations</code>\uff01</p> <p>Namespace \u548c Node</p> <pre><code>- Namespace\u662f\u4e00\u79cd\u5c06\u96c6\u7fa4\u903b\u8f91\u5206\u533a\u4e3a\u865a\u62df\u5b50\u96c6\u7fa4\u7684\u65b9\u6cd5\u3002--&gt; logical partition, only for conveniency\n- Node\u5219\u662f\u53ef\u5206\u53ef\u6570\u7684\u7269\u7406\u673a\u6216\u865a\u62df\u673a\u3002--&gt; physical partition, it REALLY exists\n</code></pre> <p>Master Node</p> <p>\u8fd8\u8bb0\u5f97k8s\u7684Node\u6709\u4e24\u79cd\u7c7b\u578b\u5417\uff1f Master node\u5176\u5b9e\u5c31\u6bd4Worker node\u591a\u4e86\u4e00\u4e9b\u7ba1\u7406\u529f\u80fd\u3002\u4f46\u662f\u6211\u4eec\u53d1\u73b0\uff0cKubernetes\u7684<code>Scheduler</code>\u4ece\u6765\u4e0d\u5f80Master Node\u4e0a\u9762\u653e<code>Pod</code>\u3002 \u8fd9\u662f\u56e0\u4e3a\u5f53k8s\u7684\u96c6\u7fa4\u88ab\u521d\u59cb\u5316\u65f6\uff0cMaster node\u4e0a\u81ea\u52a8\u52a0\u4e86<code>Taint</code>\uff0c\u7528\u6765\u6392\u9664\u6240\u6709<code>Pod</code>\uff08\u8fd9\u4e2a\u8bbe\u5b9a\u662f\u53ef\u4ee5\u4fee\u6539\u7684\uff0c\u4f46\u6211\u4eec\u4e00\u822c\u4e0d\u4fee\u6539\uff09\u3002</p> <p>\u8fd9\u4e2aTaint\u53ef\u4ee5\u8fd9\u6837\u67e5\u770b\uff1a <pre><code>k get nodes\nk describe node &lt;MasterNodeName&gt; | grep Taint\n</code></pre></p> <p>Note</p> <pre><code>**Master Node**\u5373\u540d\u4e3a \"control-plane\"\u7684Node\uff0c\u53eb\u6cd5\u4e0d\u540c\u800c\u5df2\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#node-selectors-node-affinity","title":"\u8282\u70b9\u9009\u62e9\u5668\u548c\u8282\u70b9\u5173\u8054\u6027\uff08Node Selectors &amp; Node Affinity\uff09","text":"<p>\u6211\u4eec\u5df2\u77e5Taint\u548cToleration\u6ca1\u6709\u529e\u6cd5\u4fdd\u8bc1\u67d0\u4e2a<code>Pod</code>\u653e\u5230\u6709\u7279\u5b9a\u8d44\u6e90\u7684<code>Node</code>\u4e0a\u53bb\u3002\u4e3a\u4e86\u786e\u4fdd\u67d0<code>Pod</code>\u6258\u7ba1\u5728\u7279\u5b9a<code>Node</code>\u4e0a\uff0ck8s\u63d0\u4f9b\u4e86\u4e24\u79cd\u673a\u5236\uff0c\u8ba9<code>Pod</code>\u5bf9 <code>Node</code>\u8fdb\u884c\u7b5b\u9009\uff1a</p> <ol> <li>Node Selector</li> <li>Node Affinity</li> </ol> <p>\u4e24\u8005\u90fd\u4ee5<code>Node</code>\u7684<code>label</code>\u4e3a\u57fa\u7840\uff0c\u5728Pod\u7684\u5b9a\u4e49\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5220\u9009\u6761\u4ef6\u3002</p> <pre><code>kubectl label nodes &lt;NodeName&gt; &lt;labelKey&gt;=&lt;labelValue&gt;  # \u7ed9Node\u6dfb\u52a0\u4e00\u4e2a\u6807\u7b7e\n\nkubectl label nodes node01 size=Large       # \u4e3e\u4f8b\n</code></pre> <p>Warning</p> <pre><code>k8s\u4e2d\u7684 `labels` \u662f\u533a\u5206\u5927\u5c0f\u5199\u7684\uff01\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-2/#node-selector","title":"\u65b9\u6cd5\u4e00\uff1aNode Selector","text":"<p>\u7136\u540e\u7ed9<code>Pod</code>\u52a0\u4e0a\u8282\u70b9\u9009\u62e9\u5668\uff1a</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: web-pod\nspec:\n    containers:\n        - name: ubuntu\n            image: ubuntu\n    nodeSelector:       # \u6dfb\u52a0 nodeSelector\uff0c\u8fd9\u91cc\u7684\u952e\u503c\u5bf9\u5176\u5b9e\u662fNode\u7684label\n        size: Large\n</code></pre> <ul> <li>\u4f18\u70b9\uff1a \u7b80\u5355</li> <li>\u7f3a\u70b9\uff1a \u53ea\u652f\u6301\u975e\u5e38\u7b80\u5355\u7684\u903b\u8f91\u3002\u66f4\u590d\u6742\u7684\u903b\u8f91\u6bd4\u5982 \u201c<code>size=Large</code> or <code>size=Medium</code>\u201d \u662f\u65e0\u6cd5\u901a\u8fc7<code>nodeSelector</code>\u5b9e\u73b0\u7684</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-2/#node-affinity","title":"\u65b9\u6cd5\u4e8c\uff1a Node Affinity","text":"<p>Node Selector\u6ca1\u6709\u529e\u6cd5\u63d0\u4f9b<code>not</code>\u6216\u8005<code>or</code>\u7b49\u590d\u6742\u5224\u65ad\uff0cNode Affinity\u53ef\u4ee5\uff01</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: web-pod\nspec:\n    containers:\n        - name: ubuntu\n            image: ubuntu\n    affinity:                                           # \u6dfb\u52a0 nodeAffinity\n        nodeAffinity:\n            requiredDuringSchedulingIgnoredDuringExecution:\n                nodeSelectorTerms:\n                    - matchExpressions:     # \u63a5\u4e0b\u6765\u7684\u5185\u5bb9\u662f\u4e2a\u6570\u7ec4\n                        - key: size\n                          operator: In\n                          values:\n                            - Large\n                            - Medium\n</code></pre> <p>Info</p> <pre><code>\u5982\u679c\u662f\u4e00\u4e2a`Deployment`\uff0c`affinity`\u5e94\u8be5\u653e\u5728`.spec.template.spec.affinity`\u4e2d\uff01\n</code></pre> <p>\u5176\u4ed6\u53ef\u7528\u7684 operator:</p> <ul> <li><code>NotIn</code>\uff1a\u4e0e<code>In</code>\u76f8\u53cd\uff0c\u4e0d\u5728<code>values</code>\u4e2d\u7684\u503c</li> <li><code>Exists</code>\uff1a\u53ea\u8981\u5b58\u5728\u67d0\u4e2a<code>key</code>\u5373\u6ee1\u8db3\u6761\u4ef6\uff0c\u65e0\u8bba<code>values</code>\u4e2d\u5305\u542b\u4ec0\u4e48\u503c\uff1a <pre><code># \u6bd4\u5982\uff1a\u5f53Node\u7684label\u662f`size=`\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ea\u6709key\uff0c\u6ca1\u6709value\uff0c\u5c31\u53ef\u4ee5\u7528`Exists`\n- matchExpressions:\n    - key: size\n      operator: Exists\n</code></pre></li> <li><code>DoesNotExist</code>\uff1a\u4e0e<code>Exists</code>\u76f8\u53cd</li> <li><code>Gt</code> = greater than</li> <li><code>Lt</code> = less than</li> </ul> <p>Affinity\u7c7b\u578b \u5b9a\u4e49\u4e86<code>Scheduler</code>\u5728Node Affinity\u7684\u884c\u4e3a\u4ee5\u53ca Pod \u751f\u547d\u5468\u671f\u4e2d\u7684\u9636\u6bb5\u3002</p> <ul> <li><code>requiredDuringSchedulingIgnoredDuringExecution</code></li> <li><code>preferredDuringSchedulingIgnoredDuringExecution</code></li> <li><code>requiredDuringSchedulingRequiredDuringExecution</code>\uff1a\u8fd8\u5728\u5f00\u53d1\u4e2d</li> </ul> <p>Pod\u6709\u4e24\u4e2a\u751f\u547d\u5468\u671f</p> DuringScheduling DuringExecution ...\u6307Pod \u4ece\u4e0d\u5b58\u5728\u5230\u9996\u6b21\u521b\u5efa\u7684\u72b6\u6001 ...\u6307Pod\u5df2\u7ecf\u5728\u8fd0\u884c\u4e86\uff0c\u4f46\u53ef\u80fd\u73af\u5883\u4e2d\u6709\u65b0\u7684\u66f4\u6539\uff08\u4f8b\u5982\u8282\u70b9\u6807\u7b7e\u7684\u66f4\u6539\uff09 <code>requiredDuringScheduling</code> <code>IgnoredDuringExecution</code> Required. Ignored. \u4e0d\u505a\u4efb\u4f55\u6539\u53d8 <code>preferredDuringScheduling</code> <code>IgnoredDuringExecution</code> Preferred. \u5c1d\u8bd5Pod \u653e\u5728\u6b63\u786e\u7684Node\u4e0a\u3002\u5982\u679c\u627e\u4e0d\u5230\u6b63\u786e\u7684\uff0c\u5c31\u968f\u4fbf\u627e\u4e00\u4e2aNode\u653e\u3002 Ignored. \u4e0d\u505a\u4efb\u4f55\u6539\u53d8 <code>requiredDuringScheduling</code> <code>RequiredDuringExecution</code> Required. Required. \u9a71\u9010/\u7ec8\u6b62Node\u4e0a\u4e0d\u7b26\u5408\u89c4\u5219\u7684Pod\u3002"},{"location":"cloud/k8s/ckad/ckad-2/#taints-toleration-node-affinity","title":"\u7ec4\u5408\u62f3\uff1aTaints Toleration \u548c Node Affinity","text":"<ul> <li>Taints Toleration\uff1a \u7279\u6b8a\u7684<code>Node</code>\u4e0a\u53ea\u6709\u7279\u6b8a\u7684<code>Pod</code>\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u7279\u6b8a\u7684<code>Pod</code>\u4e00\u5b9a\u80fd\u653e\u5230\u7279\u6b8a\u7684<code>Node</code>\u4e0a  -&gt; \u4f18\u5148\u6ee1\u8db3Node\u9700\u6c42</li> <li>Node Affiniity\uff1a \u7279\u6b8a\u7684<code>Pod</code>\u4e00\u5b9a\u5728\u7279\u6b8a\u7684<code>Node</code>\u4e0a\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u7279\u6b8a\u7684<code>Node</code>\u4e0a\u53ea\u6709\u7279\u6b8a\u7684<code>Pod</code>  -&gt; \u4f18\u5148\u6ee1\u8db3Pod\u9700\u6c42</li> <li>Taints Toleration + Node Affiniity\u7ec4\u5408\u62f3\uff1a \u7279\u6b8a\u7684<code>Node</code>\u4e0a\u6709\u4e14\u53ea\u6709\u7279\u6b8a\u7684<code>Node</code>  -&gt; \u4e24\u8005\u9700\u6c42\u90fd\u6ee1\u8db3</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-2/#_4","title":"\u5c0f\u7ed3","text":"<code>Node</code> <code>Pod</code> Taint &amp; Toleration \u52a8\u8bcd taint <code>k taint node my-node color=green:NoSchedule</code> \u5728Pod\u7684\u5b9a\u4e49\u6587\u4ef6\u4e2d\u6dfb\u52a0<code>.spec.tolerations</code> Node Selector \u52a8\u8bcd label <code>k label node my-node color=green</code> \u5728Pod\u7684\u5b9a\u4e49\u6587\u4ef6\u4e2d\u6dfb\u52a0<code>.spec.nodeSelector</code> Node Affinity \u52a8\u8bcd label <code>k label node my-node color=green</code> \u5728Pod\u7684\u5b9a\u4e49\u6587\u4ef6\u4e2d\u6dfb\u52a0<code>.spec.affinity.nodeAffinity</code>"},{"location":"cloud/k8s/ckad/ckad-2/#kubectl","title":"&gt;&gt;&gt;  \u672c\u7ae0kubectl\u547d\u4ee4\u6574\u7406","text":"<p>Docker\u547d\u4ee4</p> <p><code>docker run &lt;ImageName&gt; --entrypoint &lt;EntryPointCMD&gt; --user=&lt;UserID&gt;</code> \u7528\u955c\u50cf\u5efa\u4e00\u4e2a\u5bb9\u5668\uff0c<code>--user</code>\u53ef\u4ee5\u662f<code>root</code>\u6216\u8005<code>1010</code>\u7b49</p> <p><code>docker build -t &lt;NewImageName&gt;</code> \u7528Dockerfile\u65b0\u5efa\u4e00\u4e2a\u540d\u4e3a<code>NewImageName</code>\u7684\u955c\u50cf</p> <p>Docker \u7528\u6237\u6743\u9650\u76f8\u5173</p> <p><code>docker run --cap-add MAC_ADMIN &lt;ContainerName&gt;</code> \u7ed9\u5bb9\u5668\u7684\u7528\u6237\u589e\u52a0\u4e00\u4e2a\u6743\u9650<code>MAC_ADMIN</code></p> <p><code>docker run --privileged &lt;ContainerName&gt;</code> \u7ed9\u5bb9\u5668\u7684\u7528\u6237\u6240\u6709\u6743\u9650\uff01 </p> <p><code>docker run --cap-drop MAC_ADMIN &lt;ContainerName&gt;</code>  \u7ed9\u5bb9\u5668\u7684\u7528\u6237\u5220\u51cf\u6743\u9650<code>MAC_ADMIN</code></p> <p>Pod\u76f8\u5173</p> <p><code>k get pod xxx -o yaml &gt; xxx.yml</code> \u67e5\u770bPod\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u5305\u62ecvolumes\uff08\u5176\u4e2d\u6709ServiceAccount\uff09\uff0c\u53ef\u4ee5\u5bfc\u51fa\u5230yml\u6587\u4ef6\u91cc</p> <ul> <li>\u5927\u591a\u6570\u7684Pod\u5c5e\u6027\u662f\u4e0d\u80fd\u901a\u8fc7<code>k edit pod xxx</code>\u6765\u4fee\u6539\u7684\uff0c\u5982\u679c\u9700\u8981\u4fee\u6539\uff0c\u90a3\u53ef\u4ee5\u628a\u65e7\u7684Pod\u5b9a\u4e49\u5bfc\u51fa\u6210yml\u6587\u4ef6\uff0c\u5220\u6389\u65e7\u7684Pod\uff0c\u91cd\u5efa\u65b0\u7684Pod</li> <li>\u5f88\u591a\u9700\u8981\u6539\u7684\u5c5e\u6027\u53ef\u4ee5\u53bb\u6539Deployment</li> </ul> <p><code>k get pod -o wide</code>\u53ef\u4ee5\u770b\u5230Pod\u8dd1\u5728\u54ea\u4e2a<code>Node</code>\u4e0a\uff0c\u7528\u4e86\u54ea\u4e2aIP\u5730\u5740</p> <p><code>k describe pod xxx</code> \u83b7\u53d6Pod\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f</p> <p>Node\u76f8\u5173</p> <p><code>k get nodes</code> </p> <p><code>k describe node xxx</code> \u5173\u4e8eNode\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u4e0a\u9762\u8dd1\u4e86\u4ec0\u4e48Pod</p> <p>Deployment\u76f8\u5173</p> <p><code>k edit deployment xxx</code> \u4fee\u6539Deployment</p> <p>ConfigMap\u76f8\u5173</p> <p><code>k get configmaps</code> \u5217\u51fa\u6240\u6709\u7684configmaps</p> <p><code>k describe configmaps/xxx</code> \u83b7\u53d6\u67d0configmap\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f</p> <p><code>k create configmap &lt;configMapName&gt; --from-literal=&lt;key1&gt;=&lt;value1&gt;</code> \u7528\u952e\u503c\u5bf9\u65b0\u5efaconfigmap\uff08\u26a0\ufe0f \u591a\u4e2a\u952e\u503c\u5bf9\u4f7f\u7528\u591a\u4e2a<code>--from-literal=</code>\uff09</p> <p><code>k create configmap &lt;configMapName&gt; --from-file=&lt;pathToFile1&gt;</code>\u7528\u6587\u4ef6\u65b0\u5efaconfigmap</p> <p>Secret\u76f8\u5173</p> <p><code>k get secrets</code>\u5217\u51fa\u6240\u6709\u7684secrets</p> <p><code>k describe secret/xxx -o yaml</code>\u83b7\u53d6\u67d0secret\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f</p> <p><code>k create secret generic &lt;SecretName&gt; --from-literal=&lt;key&gt;=&lt;value&gt;</code> \u7528\u952e\u503c\u5bf9\u65b0\u5efasecret\uff08\u26a0\ufe0f <code>generic</code>\u662fSecret\u7c7b\u578b\uff0c\u8fd9\u4e2a\u7c7b\u578b\u5c5e\u6027\u4e00\u5b9a\u4e0d\u80fd\u5c11\uff0c\u4e0d\u7136\u4f1a\u62a5\u9519\uff09</p> <p><code>k create secret generic &lt;SecretName&gt; --from-file=&lt;pathToFile&gt;</code>\u7528\u6587\u4ef6\u65b0\u5efasecret</p> <p>\u5b89\u5168\uff08user\uff09\u76f8\u5173</p> <p><code>k exec &lt;PodName&gt; -- whoami</code>\u67e5\u770bPod\u4e2d\u4f7f\u7528\u7684\u7528\u6237\u662f\u4ec0\u4e48\u7c7b\u578b\uff08root\u8fd8\u662f\u975eroot\uff09</p> <p>ServiceAccount\u76f8\u5173</p> <p><code>k get serviceaccount</code>\u5217\u51fa\u6240\u6709\u7684serviceaccount</p> <p><code>k create serviceaccount &lt;ServiceAccountName&gt;</code>\u65b0\u5efaserviceaccount</p> <p><code>k describe serviceaccount &lt;ServiceAccountName&gt;</code> \u83b7\u53d6\u67d0serviceaccount\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f</p> <p><code>k create token  &lt;ServiceAccountName&gt;</code>\u4e3aserviceaccount\u751f\u6210token</p> <p>Taint\u76f8\u5173</p> <p><code>k taint nodes &lt;NodeName&gt; &lt;key&gt;&lt;operator&gt;&lt;value&gt;:&lt;TaintEffect&gt;</code> \u6dfb\u52a0Taint</p> <p><code>k taint nodes &lt;NodeName&gt; &lt;key&gt;&lt;operator&gt;&lt;value&gt;:&lt;TaintEffect&gt;-</code> \u5220\u9664Taint</p> <ul> <li>\u26a0\ufe0f \u6ce8\u610f\uff1a\u6700\u540e\u6709\u4e2a\u2796\u53f7\uff0c\u610f\u5473\u7740\u201cremove\u201d</li> <li>\u26a0\ufe0f \u6ce8\u610f\uff1a\u51cf\u53f7\u524d\u9762\u6ca1\u6709\u7a7a\u683c\uff01</li> </ul> <p><code>k describe node &lt;NodeName&gt; | grep -i Taint</code> \u67e5\u770bNode\u7684Taint</p> <p><code>k describe node kubemaster | grep -i Taint</code> \u67e5\u770bMaster Node\u7684Taint</p> <p>Node\u7684Label</p> <p><code>k label nodes &lt;NodeName&gt; &lt;labelKey&gt;=&lt;labelValue&gt;</code>\u7ed9Node\u52a0Selector --&gt; \u66f4\u9ad8\u7ea7\u7684Node Affinity\u53ea\u80fd\u901a\u8fc7\u6539node.yml\u6765\u6dfb\u52a0 </p> <p>DRY RUN</p> <p><code>k run xxx --image=yyy --restart=Never --dry-run=client -o yaml &gt; pod.yaml</code></p> <p>\u5e2e\u52a9</p> <p><code>k explain pods --recursive | grep envFrom -A3</code> \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f \u6709\u7528\uff01\uff01\uff01\u67e5\u627eenvFrom\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p> <pre><code> envFrom &lt;[]Object&gt;                 # \u65b9\u62ec\u53f7\u4ee3\u8868\u63a5\u4e0b\u6765\u7684\u5185\u5bb9\u662f\u4e00\u4e2aObject\u7684\u6570\u7ec4\n    configMapRef &lt;Object&gt;           # Object\uff1a\n        name &lt;string&gt;                   # \u5b57\u7b26\u4e32\u7c7b\u578b\n        optional &lt;boolean&gt;              # \u5e03\u5c14\u7c7b\u578b\n</code></pre> <p>Bash</p> <p><code>ps aux</code> \u67e5\u770b\u8fdb\u7a0b</p> <p><code>echo -n 'user' | base64</code> \u52a0\u5bc6</p> <p><code>echo -n 'user' | base64 --decode</code> \u89e3\u5bc6 </p>"},{"location":"cloud/k8s/ckad/ckad-3/","title":"3.\u591a\u5bb9\u5668Pod","text":"<p>\u591aPod\u5bb9\u5668\u6709\u591a\u79cd\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5305\u62ecAmbassador\uff0cAdapter\u548cSidecar\u3002\u6211\u4eec\u4f1a\u4e00\u4e00\u5bf9\u4ed6\u4eec\u8fdb\u884c\u5b66\u4e60\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-3/#1-pod","title":"1. \u4e3a\u4f55\u9700\u8981\u591a\u5bb9\u5668Pod","text":"<p>\u5c06\u5927\u578b\u5355\u4f53\u5e94\u7528\u7a0b\u5e8f\uff08monolith\uff09\u89e3\u8026\u4e3a\u79f0\u4e3a\u5fae\u670d\u52a1\uff08microservices\uff09\u7684\u5b50\u7ec4\u4ef6\u7684\u60f3\u6cd5\u4f7f\u6211\u4eec\u80fd\u591f\u5f00\u53d1\u548c\u90e8\u7f72\u4e00\u7ec4\u72ec\u7acb\u7684\u5c0f\u578b\u53ef\u91cd\u7528\u4ee3\u7801\u3002 \u8fd9\u79cd\u67b6\u6784\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u6839\u636e\u9700\u8981\u6269\u5927\u3001\u7f29\u5c0f\u548c\u4fee\u6539\u6bcf\u4e2a\u670d\u52a1\uff0c\u800c\u4e0d\u662f\u4fee\u6539\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u3002\u5982\u4e0b\u56fe\uff1a </p> <p>\uff08\u56fe\u7247\u6765\u6e90\uff09</p> <p>\u4f46\u662f\uff0c\u6709\u65f6\u60a8\u53ef\u80fd\u9700\u8981\u4e24\u4e2a\u670d\u52a1\u4e00\u8d77\u5de5\u4f5c\uff0c\u4f8b\u5982 Web \u670d\u52a1\u5668\u548c\u65e5\u5fd7\u670d\u52a1\u3002\u6bcf\u4e2a\u914d\u5bf9\u7684 Web \u670d\u52a1\u5668\u5b9e\u4f8b\u9700\u8981\u4e00\u4e2a\u65e5\u5fd7\u670d\u52a1\u7684\u5b9e\u4f8b\u3002\u6240\u4ee5\u6211\u4eec\u9700\u8981\u628a\u8fd9\u4e24\u4e2a\u5fae\u670d\u52a1\u653e\u5230\u540c\u4e00\u4e2aPod\u4e2d\uff0c\u4ee5\u4fdd\u8bc1\u5b83\u4eec\uff1a</p> <ul> <li>\u5904\u4e8e\u540c\u4e00\u4e2a\u751f\u547d\u5468\u671f\uff08lifecycle\uff09\uff1a\u610f\u5473\u7740\u540c\u65f6\u88ab\u751f\u6210/\u9500\u6bc1</li> <li>\u5206\u4eab\u540c\u4e00\u4e2anetwork\uff1a\u53ef\u4ee5\u76f8\u4e92\u5f15\u7528\u4e3a<code>localhost</code></li> <li>\u8bbf\u95ee\u540c\u4e00\u4e2avolume</li> </ul> <p>\u5f53\u7528\u6237\u8bbf\u95ee\u91cf\u589e\u591a\uff0c\u6211\u4eec\u9700\u8981\u6269\u5927\u5e94\u7528\u89c4\u6a21\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ea\u9700\u591a\u5efa\u51e0\u4e2aPod\u5c31\u53ef\u4ee5\u4e86\uff1a </p> <p>\u4e3e\u4f8b\uff1a\u591a\u5bb9\u5668Pod\u7684\u5b9a\u4e49\u6587\u4ef6</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: simple-webapp\nspec:\n    # containers\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u662f\u4e00\u4e2acontainer\n    containers:\n    - name: simple-webapp\n      image: simple-webapp\n      ports:\n        - containerPort: 8080\n    - name: log-agent\n      image: log-agent\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-3/#2-pod","title":"2. \u591a\u5bb9\u5668Pod\u7684\u8bbe\u8ba1\u6a21\u5f0f","text":""},{"location":"cloud/k8s/ckad/ckad-3/#sidecar","title":"Sidecar","text":"<p>\u5728\u540c\u4e00\u4e2a<code>Pod</code>\u4e2d\uff0c\u7ed9\u6bcf\u4e2a\u914d\u5bf9\u7684 Web \u670d\u52a1\u5668\u914d\u4e00\u4e2a\u65e5\u5fd7\u670d\u52a1\u7684\u5b9e\u4f8b\u3002\u7136\u540e\u5c06\u4e0d\u540cPod\u4e2d\u65e5\u5fd7\u670d\u52a1\u8bb0\u5f55\u4e0b\u6765\u7684\u65e5\u5fd7\u53d1\u9001\u5230\u4e00\u4e2a\u4e2d\u592e\u670d\u52a1\u5668\u3002</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-3/#adapter","title":"Adapter","text":"<p>\u662f\u57fa\u4e8eSidecar\u8bbe\u8ba1\u6a21\u5f0f\u7684\u53d8\u79cd\u3002\u552f\u4e00\u7684\u533a\u522b\u662f\u5728\u53d1\u9001\u65e5\u5fd7\u5230\u4e2d\u592e\u670d\u52a1\u5668\u4e4b\u524d\uff0c\u5148\u5bf9\u65e5\u5fd7\u683c\u5f0f\u8fdb\u884c\u5904\u7406\uff0c\u4ee5\u4fbf\u4e2d\u592e\u670d\u52a1\u5668\u53ef\u4ee5\u6536\u5230\u6570\u636e\u683c\u5f0f\u76f8\u540c\u7684\u5bf9\u65e5\u5fd7\u3002</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-3/#ambassador","title":"Ambassador","text":"<p>\u5047\u8bbe\u4f60\u6709<code>dev</code>\uff0c<code>prod</code>\u4e24\u4e2a\u4e2a\u6570\u636e\u5e93\uff0c\u5206\u522b\u5bf9\u5e94\u5f00\u53d1\u548c\u751f\u4ea7\u4e24\u4e2a\u5e94\u7528\u573a\u666f\u3002\u5982\u4f55\u5224\u65ad\u5f53\u524d\u73af\u5883\uff0c\u5e76\u9009\u62e9\u6b63\u786e\u7684\u6570\u636e\u5e93\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u5c06\u6b64\u7c7b\u903b\u8f91\u5916\u5305\u7ed9 <code>Pod</code> \u4e2d\u7684\u67d0\u4e00\u4e2a\u7279\u5b9a\u5bb9\u5668\uff0c\u8be5\u5bb9\u5668\u5c31\u626e\u6f14\u4e86\u4e00\u4e2a\u5927\u4f7f\uff08Ambassador\uff09\u7684\u89d2\u8272\u3002</p> <p></p> <p>Warning</p> <p>\u8fd9\u4e09\u79cd\u662f\u4e0d\u540c\u7684\u8f6f\u4ef6\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5f53\u6211\u4eec\u7528yaml\u6587\u4ef6\u5199<code>Pod</code>\u65f6\uff0c\u5b9a\u4e49\u6587\u4ef6\u5176\u5b9e\u5e76 \u6ca1\u6709 \u533a\u522b\uff01</p>"},{"location":"cloud/k8s/ckad/ckad-3/#3-initcontainer","title":"3. initContainer","text":"<p>\u6211\u4eec\u4e4b\u524d\u63d0\u53ca\u7684<code>Pod</code>\u4e2d\u7684<code>Container</code>\u90fd\u662f\u5728<code>Pod</code>\u8d77\u6765\u4e4b\u540e\u5c31\u4e00\u76f4\u5728\u8fd0\u884c\u7684\u3002<code>Pod</code>\u751f<code>Container</code>\u751f\uff0c<code>Pod</code>\u6b7b<code>Container</code>\u6b7b\uff0c\u5728\u540c\u4e00\u4e2a\u751f\u547d\u5468\u671f\u3002</p> <p>\u4f46\u8fd8\u6709\u4e00\u79cd\u5e94\u7528\u573a\u666f\uff0c<code>Container</code>\u4e0a\u7684\u7a0b\u5e8f\u53ea\u9700\u8981\u8dd1\u4e00\u6b21\uff0c\u4e0d\u9700\u8981\u6574\u4e2a\u751f\u547d\u5468\u671f\u90fd\u5728\u6267\u884c\u3002\u6bd4\u5982\uff0c\u628a\u6e90\u4ee3\u7801\u4ecegithub\u4e0a\u4e0b\u8f7d\u4e0b\u6765 -- \u8fd9\u4ef6\u4e8b\u60c5\u5c31\u53ea\u9700\u8981\u505a\u4e00\u6b21\u3002<code>initContainer</code>\u5c31\u662f\u89e3\u51b3\u529e\u6cd5\u3002</p> <p>\u5bf9<code>initContainer</code>\u7684\u5b9a\u4e49\u548c\u666e\u901a<code>Container</code>\u662f\u7c7b\u4f3c\u7684\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: myapp-pod\n  labels:\n    app: myapp\nspec:\n  containers:\n  - name: myapp-container\n    image: busybox:1.28\n    command: ['sh', '-c', 'echo Hello Word! &amp;&amp; sleep 3600']\n\n  initContainers:   # \u548ccontainers\u4e00\u6837\uff0cinitContainers\u4e5f\u653e\u5728\u4e00\u4e2a\u6570\u7ec4\u91cc\n  - name: init-myservice\n    image: busybox\n    command: ['sh', '-c', 'git clone &lt;my-repository&gt; ;']\n</code></pre></p> <p>initContainer \u8fd0\u884c\u89c4\u5219\uff1a</p> <ol> <li>\u5982\u679c\u6709\u4e00\u4e2a <code>initContainer</code> \u672a\u80fd\u8fd0\u884c\u5b8c\u6210\uff0c\u5219Kubernetes \u4f1a\u53cd\u590d\u91cd\u542f Pod\uff0c\u76f4\u5230<code>initContainer</code> \u8fd0\u884c\u6210\u529f\u4e3a\u6b62</li> <li>\u5982\u6709\u591a\u4e2a<code>initContainer</code>\uff0c\u5219\u4f1a\u6309\u5e8f\u4e00\u4e2a\u4e00\u4e2a\u8fd0\u884c</li> <li>POD\u9996\u6b21\u521b\u5efa\u65f6\uff0c\u4f1a\u8fd0\u884c <code>initContainer</code>\uff0c\u5982\u679c<code>initContainer</code>\u548c<code>Container</code>\u540c\u65f6\u5b58\u5728\uff0c<code>Container</code>\u8981\u5728\u6240\u6709\u7684<code>initContainer</code>\u8dd1\u5b8c\u4e4b\u540e\u624d\u8dd1\uff01</li> </ol>"},{"location":"cloud/k8s/ckad/ckad-3/#4-debug","title":"4. Debug","text":"<ul> <li><code>k describe pod/xxx</code>\u662f\u4e2a\u975e\u5e38\u5f3a\u5927\u7684\u547d\u4ee4\u3002\u6bd4\u5982\u80fd\u770b\u5230\u72b6\u6001\uff0c\u539f\u56e0\uff0c\u9519\u8bef\u4ee3\u7801\u7b49\u3002 </li> <li><code>k logs pod/xxx</code> \u6253\u5370\u8be5pod\u7684\u65e5\u5fd7</li> <li><code>k debug pod/xxx</code> \u548c<code>k exec</code>\u4e00\u6837\uff0c \u8fdb\u5230Pod\u91cc\u9762\u53bb\uff0c\u6267\u884c\u5b83\u7684bash\u3002\u533a\u522b\u662f\uff0c<code>k debug</code>\u80fd\u5728\u5bb9\u5668\u6709\u9519\u7684\u60c5\u51b5\u4e0b\uff0c\u5f3a\u5236\u542f\u52a8\u5e76\u8fdb\u884cdebug\uff0c\u800c<code>k exec</code>\u53ea\u80fd\u5728Pod\u662f\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u4e0b\u624d\u80fd\u6267\u884c</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-3/#kubectl","title":"&gt;&gt;&gt;  \u672c\u7ae0kubectl\u547d\u4ee4\u6574\u7406","text":"<p>YAML\u8bed\u6cd5</p> <p><pre><code>command:\n    - sh\n    - -c\n    - sleep \n    - \"20\"\n</code></pre> \u26a0\ufe0f \u7eaf\u6570\u5b57\u8981\u52a0\u53cc\u5f15\u53f7</p> <p>JSON\u8bed\u6cd5\uff1a</p> <pre><code>command: [\"sleep\", \"20\"]\n</code></pre> <p>\u4fee\u6539Pod</p> <p>\u9664\u4e86 \u201c\uff081\uff09\u8f93\u51fayaml\uff082\uff09\u5220\u9664\u65e7Pod\uff083\uff09\u4eceyaml\u6587\u4ef6\u65b0\u5efaPod\u201d \u7684\u65b9\u6cd5\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u79cd\u66f4\u7b80\u5355\u7684\u65b9\u6cd5\uff1a</p> <ul> <li><code>k edit pod/xxx</code>\u8fd9\u91cc\u4f60\u4f1a\u5f97\u5230\u63d0\u793a\u4fe1\u606f\u8bf4Pod\u65e0\u6cd5\u88ab\u76f4\u63a5\u4fee\u6539\uff0c\u4f60\u7684\u6539\u53d8\u88ab\u6682\u65f6\u5b58\u5230\u4e86<code>/tmp/kubectl-edit-xxxx.yaml</code>\u6587\u4ef6\u4e2d</li> </ul> <ul> <li><code>k replace --force -f /tmp/kubectl-edit-xxxx.yaml</code>\u5f3a\u5236\u7528\u65b0\u7684YAML\u6587\u4ef6\u4ee3\u66ff\u65e7\u7684Pod</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-4/","title":"4.\u5bb9\u5668\u72b6\u6001\u76d1\u6d4b","text":""},{"location":"cloud/k8s/ckad/ckad-4/#1-pod","title":"1. Pod\u7684\u751f\u547d\u5468\u671f","text":"<p>\u88ab\u7528\u6765\u5f62\u5bb9<code>Pod</code>\u7684\u72b6\u6001\u7684\u6709Pod Status\u548cPod Condition\uff0c\u603b\u7684\u6765\u8bf4 Status \u662f\u6574\u4f53\u72b6\u6001\u7684\u9ad8\u5c42\u6b21\u603b\u7ed3\uff0cCondition \u63d0\u4f9b\u66f4\u7ec6\u7c92\u5ea6\u7684\u4fe1\u606f\uff0c\u63cf\u8ff0 Pod \u7684\u5177\u4f53\u8fd0\u884c\u6761\u4ef6\u548c\u72b6\u6001\u3002</p> \u7279\u6027 Pod Status Pod Condition \u76ee\u7684 \u63d0\u4f9b Pod \u7684\u6574\u4f53\u751f\u547d\u5468\u671f\u72b6\u6001\u3002 \u63d0\u4f9b Pod \u7684\u8be6\u7ec6\u8fd0\u884c\u6761\u4ef6\u4fe1\u606f\u3002\u53ef\u4ee5\u770b\u5230\u5e26timestamp\u7684\u5386\u53f2\u6761\u4ef6\u53d8\u5316 \u5b57\u6bb5\u4f4d\u7f6e <code>.status.phase</code> <code>.status.conditions</code> \u53ef\u80fd\u503c \u53ea\u6709\u6709\u9650\u7684\u51e0\u4e2a\u53ef\u80fd\u503c\uff1aPending, Running, Succeeded, Failed, Unknown \u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6bcf\u4e2a\u6761\u4ef6\u90fd\u6709\u7c7b\u578b\u3001\u72b6\u6001\u3001\u6700\u540e\u53d8\u5316\u65f6\u95f4\u7b49\u5b57\u6bb5\uff0c\u53ef\u80fd\u7684\u6761\u4ef6\u6709\uff1aPodScheduled, Ready, Initialized, ContainersReady \u7b49\u3002 \u8be6\u7ec6\u7a0b\u5ea6 \u9ad8\u5c42\u6b21\u3001\u7b80\u8981\u603b\u7ed3\u3002 \u7ec6\u7c92\u5ea6\u3001\u591a\u6761\u4ef6\u63cf\u8ff0\u3002 \u4fe1\u606f\u7528\u9014 \u67e5\u770b Pod \u7684\u751f\u547d\u5468\u671f\u72b6\u6001\uff0c\u4fbf\u4e8e\u5feb\u901f\u5224\u65ad\u5f53\u524d\u72b6\u6001\u3002 \u67e5\u770b Pod \u7684\u5177\u4f53\u72b6\u6001\u53d8\u5316\uff0c\u4fbf\u4e8e\u6392\u67e5\u95ee\u9898\u6216\u8c03\u8bd5\u3002"},{"location":"cloud/k8s/ckad/ckad-4/#pod-status","title":"Pod Status","text":"Pod Status \u89e3\u91ca <code>Pending</code> <code>Pod</code>\u521a\u521a\u5efa\u6210\uff0c k8s\u7684Scheduler \u6b63\u5728\u8003\u8651\u628a<code>Pod</code>\u653e\u5728\u54ea\u4e00\u4e2a<code>Node</code>\u4e0a\u3002\u5982\u679cScheduler\u6ca1\u6709\u529e\u6cd5\u51b3\u5b9a\u628a<code>Pod</code>\u653e\u54ea\u91cc\u90a3\u4e48\u5c31\u4f1a\u4e00\u76f4\u5904\u4e8e<code>Pending</code>\u72b6\u6001\u53ef\u7528 <code>k describe pod/xxx</code> \u67e5\u770b\u539f\u56e0\uff08\u6bd4\u5982\u662f\u8d44\u6e90\u4e0d\u8db3\u5bfc\u81f4\u7684\uff09 <code>ContainerCreating</code> \u8fd9\u662f<code>Pod</code>\u5df2\u7ecf\u88abScheduler\u987a\u5229\u5206\u914d\u5230<code>Node</code>\u4e2d\u4e86\u3002\u63a5\u4e0b\u6765\u4f1a\u4e0b\u8f7d\u955c\u50cf\u5e76\u521b\u5efa\u5bb9\u5668 <code>Waiting</code> Pod\u88ab\u6392\u5230\u4e86\u67d0\u4e2a<code>Node</code>\u4e0a\uff0c\u4f46\u51fa\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c<code>Pod</code>\u6ca1\u6709\u529e\u6cd5\u8dd1\u3002\u539f\u56e0\u591a\u79cd\u591a\u6837\uff0c\u6bd4\u5982\u955c\u50cf\u6ca1\u6709\u529e\u6cd5\u4e0b\u8f7d\u7b49 <code>Running</code> \u5bb9\u5668\u987a\u5229\u5730\u521b\u5efa\u597d\u4e86\uff0cApp\u5728\u8dd1\u4e86 <p>Example in YAML file</p> <pre><code>status:\n  phase: Running\n</code></pre> <p>k describe</p> <p><code>k describe pod/xxx\u7528\u4e8e</code>\u67e5\u770b<code>Status</code>\u5c5e\u6027\uff1a</p> <p><pre><code>NAME       READY   STATUS      RESTARTS      AGE\nelephant   0/1     OOMKilled   3 (33s ago)   54s\nmonkey     1/1     READY       3 (33s ago)   54s\n</code></pre> \u26a0\ufe0f \u7ed3\u679c\u4e2d<code>READY</code>\u5217\u4ee3\u8868\uff1a<code>Pod\u4e2dREADY\u7684Container\u7684\u6570\u91cf</code> / <code>Pod\u4e2dContainer\u7684\u603b\u6570</code>\uff0c\u6bd4\u5982<code>1/1</code></p>"},{"location":"cloud/k8s/ckad/ckad-4/#pod-condition","title":"Pod Condition","text":"Pod Status \u89e3\u91ca <code>PodScheduled</code> <code>Pod</code>\u88abScheduler\u987a\u5229\u5206\u914d\u5230<code>Node</code>\u4e2d <code>Initialized</code> \u6240\u6709 InitContainer \u90fd\u6210\u529f\u6267\u884c\u5b8c\u6bd5 <code>ContainersReady</code> <code>Pod</code>\u4e0a\u6240\u6709\u5bb9\u5668\u90fd\u8fd0\u884c\u6b63\u5e38 <code>Ready</code> <code>Pod</code>\u4e0a\u6240\u6709\u5bb9\u5668\u53ef\u4ee5\u901a\u8fc7Service\u88ab\u7528\u6237\u8bbf\u95ee\u5230 --&gt; \u8fd9\u4e2a\u5c5e\u6027\u4e5f\u80fd\u5728<code>k get pods</code>\u4e2d\u7684\u8868\u683c\u4e2d\u770b\u5230\uff0c\u4f8b\u5b50\u5982\u4e0b\uff1a <p>Example in YAML file</p> <pre><code>status:\n  conditions:\n    - type: PodScheduled\n      status: True\n      lastProbeTime: null\n      lastTransitionTime: \"2024-12-01T10:00:00Z\"\n    - type: Ready\n      status: True\n      lastProbeTime: null\n      lastTransitionTime: \"2024-12-01T10:05:00Z\"\n    - type: ContainersReady\n      status: True\n      lastProbeTime: null\n      lastTransitionTime: \"2024-12-01T10:05:00Z\"\n    - type: Initialized\n      status: True\n      lastProbeTime: null\n      lastTransitionTime: \"2024-12-01T09:55:00Z\"\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-4/#2-readinessliveness","title":"2. Readiness\u548cLiveness\u76d1\u6d4b","text":""},{"location":"cloud/k8s/ckad/ckad-4/#probe","title":"Probe\u7684\u4e09\u79cd\u5199\u6cd5","text":"<p>Pod Condition\u4e2d\u7684<code>Ready</code>\u4e0d\u80fd\u4fdd\u8bc1Container\u4e2d\u7684App\u5df2\u7ecf\u53ef\u4ee5\u63a5\u53d7\u7528\u6237\u8bbf\u95ee\u4e86\u3002\u6bd4\u5982Jenkins\u670d\u52a1\u5668\u521a\u521a\u5f00\u59cb\u8dd1\u7684\u65f6\u5019\u9700\u8981\u5927\u653910-15\u79d2\u65f6\u95f4\uff0c\u6240\u4ee5\u5728\u8fd910-15\u79d2\u4e2d\u5185\u3002<code>Pod</code>\u4f1a\u544a\u8bc9\u6211\u4eecCondition\u662f<code>Ready</code>\u4e86\uff0c\u4f46\u5176\u5b9eApp\u672c\u8eab\u5e76\u6ca1\u6709\u8d77\u6765\u3002\u6211\u4eec\u7ed9Container\u6dfb\u52a0 Probes\uff0c\u7528 Probes \u6765\u6d4b\u8bd5App\u662f\u5426\u6210\u529f\u8fd0\u884c\u3002Probes\u6709\u4e09\u79cd\u5199\u6cd5\uff1a</p> <ol> <li>HTTP\u6d4b\u8bd5: for web applications <pre><code>httpGet: \n   path: /api/ready\n   port: 8080\n</code></pre></li> <li>TCP socket\u6d4b\u8bd5: for services that don't expose HTTP but should be reachable via a port. <pre><code>tcpSocket: \n   port: 3306\n</code></pre></li> <li>\u81ea\u5b9a\u4e49\u7684 \u547d\u4ee4\u811a\u672c: for checking internal states or system-level conditions. <pre><code>exec: \n   command:\n    - cat\n    - /app/is_ready\n</code></pre></li> </ol>"},{"location":"cloud/k8s/ckad/ckad-4/#tcp-vs-http","title":"TCP vs HTTP","text":"<p>Probe\u7684\u914d\u7f6e</p> <ul> <li><code>initialDelaySeconds: 10</code>\uff1a\u7b2c\u4e00\u6b21\u7528Probe\u4e4b\u524d\u5148\u7b4910\u79d2\uff08\u5355\u4f4d\uff1aSeconds\uff09</li> <li><code>periodSeconds: 5</code>\uff1a\u6bcf5\u79d2\u7528\u4e00\u6b21Probe\uff08\u5355\u4f4d\uff1aSeconds\uff09</li> <li><code>failureThreshold: 8</code>\uff1a\u6700\u591a\u5c1d\u8bd58\u6b21\uff0c\u5982\u679c\u7b2c\u516b\u6b21\u8fd8\u662f\u5931\u8d25\uff0c\u90a3\u5c31\u505c\u6b62\u5c1d\u8bd5\u5e76\u8bbe<code>Ready</code>\u4e3aFALSE</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-4/#probe_1","title":"Probe\u7684\u4f7f\u7528","text":""},{"location":"cloud/k8s/ckad/ckad-4/#readinessprobe","title":"ReadinessProbe","text":"<p>ReadinessProbe\u7ed9Pod Condition\u7684<code>Ready</code>\u52a0\u4e86\u4e00\u4e2a\u95e8\u69db\uff1a\u53ea\u6709\u5f53ReadinessProbe\u4e2d\u7684\u6d4b\u8bd5\u5f97\u5230\u6b63\u786e\u7ed3\u679c\u540e\u624d\u80fd\u7ed9Pod\u4e00\u4e2a<code>Ready</code>\u7684Condition\u3002\u4e3e\u4f8b\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: simple-webapp\n  labels:\n    app: simple-webapp\nspec:\n  containers:\n  - name: simple-webapp\n    image: simple-webapp\n    ports:\n      - containerPort: 8080\n\n    readinessProbe:           # \u9884\u5907\u6d4b\u8bd5\n      initialDelaySeconds: 10 # \u66f4\u591a\u590d\u6742\u8bbe\u7f6e\n      periodSeconds: 5\n      failureThreshold: 8\n      httpGet:                # httpGet\u6d4b\u8bd5\n        path: /api/ready\n        port: 8080\n</code></pre> Probe\u4fdd\u8bc1\u4e86\u6807\u8bb0\u4e3a<code>Ready</code>\u7684\u5bb9\u5668\u662f\u6b63\u5e38\u8fd0\u884c\u7684\u3002\u4fdd\u8bc1\u4e86\u8f6f\u4ef6\u66f4\u65b0\u65f6\u7528\u6237\u603b\u662f\u80fd\u6210\u529f\u8bbf\u95ee\u5230\u6211\u4eec\u7684\u8f6f\u4ef6\u3002\u6ca1\u6709<code>Ready</code>\u4e4b\u524d\uff0c\u6240\u6709\u7684traffic\u90fd\u4f1a\u88ab\u5bfc\u5230\u65e7\u7684<code>Pod</code>\u4e0a\u53bb\uff0c\u7b49\u65b0\u7684<code>Pod</code>\u786e\u5b9a<code>Ready</code>\u4e86\u4e4b\u540e\uff0c\u624d\u4f1a\u5bf9\u5b83\u8fdb\u884c\u4f7f\u7528\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-4/#livenessprobe","title":"LivenessProbe","text":"<p>Docker VS Kubernetes</p> <p>\u5f53\u6211\u4eec\u7528Docker\u521b\u5efa\u4e00\u4e2a<code>Container</code>\u65f6\uff0c\u5982\u679c\u4e00\u4e2a<code>Container</code>\u7a81\u7136\u51fa\u95ee\u9898\uff0c\u5176\u4e2d\u7684App\u65e0\u6cd5\u88ab\u4f7f\u7528\u4e86\uff0c\u90a3\u9700\u8981\u5f00\u53d1\u8005\u624b\u52a8\u5220\u9664\u51fa\u95ee\u9898\u7684<code>Container</code>\uff0c\u518d\u91cd\u65b0\u5efa\u4e00\u4e2a\u3002\u800cKubernetes\u4f1a\u81ea\u52a8\u5c1d\u8bd5\u5220\u9664\u65e7\u7684<code>Container</code>\uff0c\u5efa\u4e00\u4e2a\u65b0\u7684 --&gt; Pod/Container\u7531Deployment\u7ba1\u7406\u548c\u6267\u884c</p> <p>\u6709\u65f6\u4f1a\u6211\u4eec\u4f1a\u9047\u5230<code>Container</code>\u672c\u8eab\u6ca1\u6709\u95ee\u9898\uff0c\u4f46\u662f<code>Container</code>\u4e2d\u7684App\u56e0\u4e3a\u67d0\u4e2abug\u800c\u51fa\u9519\u7684\u60c5\u51b5\uff08\u6bd4\u5982\uff0cpython\u4ee3\u7801\u4e2d\u67d0\u4e2a\u4f9d\u8d56\u5305\u65e0\u6cd5\u627e\u5230\uff09\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b<code>Pod</code>\u6ca1\u6709\u529e\u6cd5\u76d1\u6d4b\u5230\u5185\u90e8App\u7684\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u9700\u8981\u7528\u5230LivenessProbe \uff0c\u5b83\u53ef\u4ee5\u5b9a\u671f\u6d4b\u8bd5\u5bb9\u5668\u5185\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u771f\u7684\u5065\u5eb7\u3002\u5982\u679c\u6d4b\u8bd5\u5931\u8d25\uff0c\u5219\u8be5<code>Container</code>\u88ab\u8ba4\u4e3a\u4e0d\u5065\u5eb7\uff0c\u4f1a\u88ab\u9500\u6bc1\u5e76\u91cd\u5efa\u3002\u4e3e\u4f8b\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: simple-webapp\n  labels:\n    app: simple-webapp\nspec:\n  containers:\n  - name: simple-webapp\n    image: simple-webapp\n    ports:\n      - containerPort: 8080\n\n    livenessProbe:        # livenessProbe\n      httpGet: \n        path: /api/ready\n        port: 8080\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-4/#3-logging","title":"3. \u5bb9\u5668\u65e5\u5fd7\uff08Logging\uff09","text":"<p>Docker\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 \u975e\u5206\u79bb \u7684\u6a21\u5f0f\u521b\u5efa\u5bb9\u5668xxx\uff1a</p> <p><pre><code>docker run [ImageName] --name [ContainerName]\n</code></pre> \u8be5\u6a21\u5f0f\u4e0b\uff0c\u5982\u679c\u7528Ctrl+C\u9000\u51fa\uff0c\u8be5\u5bb9\u5668\u4f1a\u88ab\u6682\u505c\u8fd0\u884c\u3002\u5982\u679c\u6211\u4eec\u60f3\u8981\u5bb9\u5668\u4e00\u76f4\u5728\u80cc\u666f\u4e2d\u8fd0\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 \u5206\u79bb\u6a21\u5f0f \u8dd1\u5bb9\u5668\uff08<code>d</code>\u6307<code>detached</code>\uff0c\u5373\u201d\u5206\u79bb\u201c\uff09\uff1a <pre><code>docker run -d [ImageName] --name [ContainerName]\n</code></pre> \u6b64\u65f6\u5982\u679c\u6211\u4eec\u60f3\u8981\u67e5\u770b\u5bb9\u5668\u4e2d\u7684\u65e5\u5fd7\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff0c<code>-f</code>\u8868\u793a<code>follow</code>\u6253\u5370\u5b9e\u65f6\u65e5\u5fd7\uff1a <pre><code>docker logs -f [ContainerName] \n</code></pre></p> <p>\u540c\u6837\u7684\uff0c\u5728k8s\u4e2d\uff0c\u6211\u4eec\u4e5f\u53ef\u6253\u5370\u5b9e\u65f6\u65e5\u5fd7: <pre><code>kubectl logs -f [PodName]   # \u26a0\ufe0f \u5728[PodName]\u524d\u9762\u4e0d\u52a0 `pod`\n</code></pre></p> <p>\u5f53\u4e00\u4e2a<code>Pod</code>\u4e2d\u5305\u542b \u591a\u4e2a <code>Container</code>\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5199\u660e\u6253\u5370\u54ea\u4e00\u4e2a<code>Container</code>\u7684\u65e5\u5fd7\uff1a<code>-c</code>\u4ee3\u8868<code>container</code> <pre><code>kubectl logs -f [PodName] -c [ContainerName]\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-4/#4-debug","title":"4. \u76d1\u6d4b\u548cDebug","text":"<p>\u6839\u636e\u5e94\u7528\u573a\u666f\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u60f3\u8981\u76d1\u6d4b<code>Node</code>\u5c42\u9762\u548c<code>Pod</code>\u5c42\u9762\u7684\u6307\u6807\uff1a</p> <ul> <li><code>Node</code>\u5c42\u9762\uff1a<ul> <li>\u96c6\u7fa4\u4e0a<code>Node</code>\u7684\u603b\u6570</li> <li>\u5065\u5eb7\u7684<code>Node</code>\u6570\u91cf</li> <li>CPU\u6d88\u8017</li> <li>\u5185\u5b58\u6d88\u8017</li> <li>\u78c1\u76d8\u5229\u7528\u7387\uff08disk utilization\uff09</li> </ul> </li> <li><code>Pod</code>\u5c42\u9762\uff1a<ul> <li><code>Pod</code>\u6570\u91cf</li> <li>\u6bcf\u4e2a<code>Pod</code>\u7684CPU\uff0c\u5185\u5b58\u6d88\u8017</li> </ul> </li> </ul> <p>k8s\u6ca1\u6709\u63d0\u4f9b\u81ea\u5e26\u7684\u76d1\u6d4b\u5de5\u5177\uff0c\u4f46\u662f\u6709\u5f88\u591a\u5f00\u6e90\u7684\u7b2c\u4e09\u65b9\u670d\u52a1\uff0c\u6bd4\u5982<code>MetricsServer</code>\uff0c<code>Prometheus</code>\uff0c <code>Elastic Stack</code>\uff0c<code>DataDog</code>\uff0c<code>Dynatrace</code>\u7b49\u3002\u5728CKAD\u7684\u8003\u8bd5\u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u4e86\u89e3\u5982\u4f55\u4f7f\u7528<code>MetricsServer</code>\u5373\u53ef\uff0c\u5176\u4ed6\u7684\u5de5\u5177\u4f1a\u5728CKA\u4e2d\u8bb2\u5230\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-4/#metricsserver","title":"MetricsServer","text":"<p><code>MetricsServer</code>\u7684\u524d\u8eab\u662f<code>Heapster</code>\uff08\u5df2\u5f03\u7528\uff09\u3002\u6bcf\u4e2ak8s\u96c6\u7fa4\u6709\u4e00\u4e2a<code>MetricsServer</code>\u3002<code>MetricsServer</code>\u6536\u96c6Node\u548cPod\u7684\u65e5\u5fd7\uff0c\u5e76\u4fdd\u5b58\u5230 \u5185\u5b58 \u4e2d\uff08\u4e0d\u5728\u78c1\u76d8\u4e0a\uff01\uff09\uff0c\u6240\u4ee5\u6ca1\u6709\u529e\u6cd5\u67e5\u770b\u5386\u53f2\u65e5\u5fd7\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-4/#_1","title":"\u65e5\u5fd7\u7684\u751f\u6210","text":"<p>\u6bcf\u4e2a<code>Node</code>\u4e0a\u90fd\u6709\u4e00\u4e2akubelet\u4ee3\u7406\uff0c\u8d1f\u8d23\u63a5\u6536Master\u7684\u6307\u4ee4\uff0c\u5e76\u4e14\u7ba1\u7406\u8be5<code>Node</code>\u4e0a\u7684<code>Pod</code>\u3002\u8be5\u4ee3\u7406\u62e5\u6709\u4e00\u4e2a\u540d\u4e3acAdvisor\uff08container advisor\uff09\u7684\u5b50\u7ec4\u4ef6\uff0c\u4e13\u95e8\u8d1f\u8d23\u6536\u96c6Pod\u7684\u65e5\u5fd7\u3002</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-4/#metricsserver_1","title":"MetricsServer\u7684\u5b89\u88c5","text":"<p>\u4f7f\u7528minikube\u5b89\u88c5\uff1a  <pre><code>minikube addons enable metrics-server\n</code></pre> \u5176\u4ed6\u73af\u5883\u4e0b\u7684\u5b89\u88c5\uff1a <pre><code>git clone https://github.com:kubernetes-sigs/metrics-server.git   # \u4ecegit\u4e0b\u8f7dMetric-Server\u7684YAML\u6587\u4ef6\n\ncd metrics-server     # \u4f1a\u751f\u6210\u4e00\u5806MetricsServer\u6240\u9700\u7684\u8d44\u6e90\uff1aPod\uff0cService\u548cRoles\nkubectl create -f .   \n\nkubectl top node      # \u7b49\u5f85deploy\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u770bNode\u6216Pod\u7684\u65e5\u5fd7\nkubectl top pod\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-4/#5-k8s","title":"5. \u5e38\u89c1k8s\u9519\u8bef","text":"\u9519\u8bef\u7801 \u89e3\u91ca <code>OOMKilled</code> \u5f53\u5bb9\u5668\u5185\u5b58\u4e0d\u8db3\u5e76\u4e14\u5185\u6838\u88ab\u8feb\u7ec8\u6b62\u8fdb\u7a0b\u65f6\uff0c\u4f1a\u53d1\u751f\u6b64\u9519\u8bef\u3002 OOM\uff08Out Of Memory/\u5185\u5b58\u4e0d\u8db3\uff09\u662f Linux \u5185\u6838\u7684\u4e00\u9879\u529f\u80fd\uff0c\u53ef\u4ee5\u7ec8\u6b62\u8fdb\u7a0b\u4ee5\u91ca\u653e\u5185\u5b58\u3002 <code>ImagePullBackOff</code> \u5f53 Kubernetes \u65e0\u6cd5\u4ece\u6307\u5b9a\u7684 registry \u4e2d\u62c9\u53d6\u5bb9\u5668\u955c\u50cf\u65f6\u4f1a\u51fa\u73b0\u6b64\u9519\u8bef\u3002 \u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u591a\u79cd\u539f\u56e0\u9020\u6210\u7684\uff0c\u4f8b\u5982\u767b\u5f55\u4fe1\u606f\u4e0d\u6b63\u786e\u3001\u7f51\u7edc\u95ee\u9898\u6216\u56fe\u50cf\u540d\u79f0\u9519\u8bef\u7b49\u3002 <code>CrashLoopBackOff</code> \u5f53\u5bb9\u5668\u4e0d\u65ad\u5d29\u6e83\u4e14 Kubernetes \u65e0\u6cd5\u6210\u529f\u91cd\u542f\u65f6\uff0c\u4f1a\u51fa\u73b0\u6b64\u9519\u8bef\u3002 \u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u914d\u7f6e\u4e0d\u6b63\u786e\u3001\u8d44\u6e90\u4e0d\u8db3\u6216\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u9519\u8bef\u7b49\u5404\u79cd\u539f\u56e0\u9020\u6210\u7684\u3002 <code>ErrImagePull</code> \u5f53 Kubernetes \u7531\u4e8e\u8eab\u4efd\u9a8c\u8bc1\u95ee\u9898\u65e0\u6cd5\u4ece\u6307\u5b9a\u7684\u6ce8\u518c\u8868\u4e2d\u62c9\u53d6\u5bb9\u5668\u955c\u50cf\u65f6\uff0c\u4f1a\u51fa\u73b0\u6b64\u9519\u8bef\u3002 <code>InsufficientCPU/InsufficientMemory</code> \u5f53 <code>Pod</code> \u6216<code>Container</code>\u8bf7\u6c42\u7684 CPU \u6216\u5185\u5b58\u591a\u4e8e\u8282\u70b9\u4e0a\u53ef\u7528\u7684\u5185\u5b58\u65f6\uff0c\u4f1a\u53d1\u751f\u8fd9\u4e9b\u9519\u8bef\u3002 \u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u914d\u7f6e\u4e0d\u6b63\u786e\u6216\u8d44\u6e90\u4e0d\u8db3\u9020\u6210\u7684\u3002 <code>NodeNotReady</code> \u5f53\u8282\u70b9\u7531\u4e8e\u7f51\u7edc\u95ee\u9898\u3001\u8d44\u6e90\u4e0d\u8db3\u6216\u8282\u70b9\u7ef4\u62a4\u7b49\u5404\u79cd\u539f\u56e0\u5c1a\u672a\u51c6\u5907\u597d\u63a5\u53d7 <code>Pod</code> \u65f6\uff0c\u4f1a\u51fa\u73b0\u6b64\u9519\u8bef\u3002 <code>InvalidImageName</code> \u5f53\u5bb9\u5668\u955c\u50cf\u540d\u79f0\u4e0d\u6b63\u786e\u6216\u65e0\u6548\u65f6\u4f1a\u51fa\u73b0\u6b64\u9519\u8bef\u3002 <code>NotFound</code> \u5f53 Kubernetes \u65e0\u6cd5\u627e\u5230\u6307\u5b9a\u7684\u8d44\u6e90\uff08\u5982 pod\u3001\u670d\u52a1\u6216\u90e8\u7f72\uff09\u65f6\uff0c\u4f1a\u51fa\u73b0\u6b64\u9519\u8bef\u3002 <code>Forbidden</code> \u5f53\u7528\u6237\u6ca1\u6709\u8bbf\u95ee\u6216\u4fee\u6539\u8d44\u6e90\u6240\u9700\u7684\u6743\u9650\u65f6\u4f1a\u53d1\u751f\u6b64\u9519\u8bef\u3002 <code>Timeout</code> \u5f53\u8fdb\u7a0b\u5b8c\u6210\u65f6\u95f4\u8fc7\u957f\uff0c\u5e76\u8d85\u8fc7\u914d\u7f6e\u7684\u8d85\u65f6\u671f\u9650\u65f6\uff0c\u4f1a\u53d1\u751f\u6b64\u9519\u8bef\u3002 \u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u5404\u79cd\u539f\u56e0\u9020\u6210\u7684\uff0c\u4f8b\u5982\u7f51\u7edc\u901f\u5ea6\u6162\u6216\u8d44\u6e90\u4e0d\u8db3\u3002"},{"location":"cloud/k8s/ckad/ckad-4/#kubectl","title":"&gt;&gt;&gt;  \u672c\u7ae0kubectl\u547d\u4ee4\u6574\u7406","text":"<p>\u751f\u547d\u5468\u671f</p> <p><code>k describe pod/xxx</code>\u548c<code>k get pod/xxx</code>\u90fd\u53ef\u67e5\u770bPod\u72b6\u6001</p> <p>docker</p> <p><code>docker run [ImageName] --name [ContainerName]</code></p> <p><code>docker run -d [ImageName] --name [ContainerName]</code> detached \u6a21\u5f0f</p> <p><code>docker logs -f [ContainerName]</code> \u6253\u5370\u65e5\u5fd7</p> <p>k8s\u65e5\u5fd7</p> <p><code>k logs -f [PodName]</code></p> <p><code>k logs -f [PodName] -c [ContainerName]</code></p> <p>MetricsServer\u5b89\u88c5</p> <p>\u7528minikube\u5b89\u88c5\uff1a<code>minikube addons enable metrics-server</code></p> <p>\u5176\u4ed6\u73af\u5883\u5b89\u88c5\uff08\u76f4\u63a5\u4e0b\u6e90\u7801\uff09\uff1a <pre><code>git clone https://github.com:kubernetes-sigs/metrics-server.git\ncd metrics-server\nkubectl create -f .\nkubectl top node\nkubectl top pod\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-5/","title":"5.Pod\u8bbe\u8ba1","text":""},{"location":"cloud/k8s/ckad/ckad-5/#1","title":"1. \u6807\u7b7e &amp; \u9009\u62e9\u5668","text":"<ul> <li>\u6807\u7b7e\uff08<code>labels</code>\uff09 \u5e2e\u52a9\u6211\u4eec\u6807\u8bb0\u8d44\u6e90</li> <li>\u9009\u62e9\u5668\uff08<code>selector</code>\uff09 \u7528\u4e8e\u5220\u9009\u8fc7\u6ee4\u5e26\u67d0\u4e9b \u6807\u7b7e \u7684\u8d44\u6e90</li> </ul> <p>\u5047\u8bbe\u67d0\u4e2aPod\u5e26\u6709\u4e24\u4e2a\u6807\u7b7e\uff1a<code>app=App1</code>\u548c<code>function=frontend</code>\uff0cYAML\u5b9a\u4e49\u6587\u4ef6\u5982\u4e0b\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n    name: simple-webapp\n    labels:\n        app: App1\n        function: frontend\nspec:\n    ...\n</code></pre> \u6211\u4eec\u7528\u9009\u62e9\u5668\u8fc7\u6ee4\u3002</p> <p>Info</p> <ul> <li>\u5982\u6709\u591a\u4e2a<code>selector</code>\uff0c\u4f7f\u7528\u9017\u53f7\u9694\u5f00\uff0c\u4e2d\u95f4\u6ca1\u6709\u7a7a\u683c\uff01\uff01</li> <li>\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0conly pods that have both labels (<code>app=App1</code> and <code>env=dev</code>) will be returned.</li> </ul> <pre><code>kubectl get pods --selector app=App1,env=dev\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-5/#replicaset","title":"\u4e3e\u4f8b\uff1aReplicaSet\u5bf9\u6807\u7b7e\u7684\u4f7f\u7528","text":"<p>\u6ce8\u610f\u5728ReplicaSet\u7684\u5b9a\u4e49\u4e2d\uff0c \u6709\u4e24\u4e2a<code>labels</code>\uff1a\uff081\uff09\u7ed9ReplicaSet\uff0c\uff082\uff09\u624d\u662fPod\u7684\u3002 <pre><code>apiVersion: apps/v1\nkind: ReplicaSet\nmetadata:\n  name: simple-webapp\n  labels:                       # \uff081\uff09ReplicaSet \u7684\u6807\u7b7e\n    app: App1\n    function: frontend\nspec:\n  replicas: 3\n  selector:                 # \u9009\u62e9\u5668\n    matchLabels:\n      app: App1\n  template:\n    metadata:\n      labels:               # \uff082\uff09Pod \u7684\u6807\u7b7e\n        app: App1\n        function: frontend\n    spec:\n      containers:\n        - name: simple-webapp\n          image: simple-webapp\n</code></pre></p> <p>Note</p> <p><code>selector.matchLabels:</code> \u5b9a\u4e49 ReplicaSet \u8d1f\u8d23\u7ba1\u7406\u54ea\u4e9b Pod\u3002</p> <p>\u903b\u8f91\uff1aKubernetes \u4f1a\u67e5\u627e\u6240\u6709 \u5df2\u5b58\u5728\u7684 Pod\uff0c\u5982\u679c\u5b83\u4eec\u7684 \u6807\u7b7e\uff08Labels\uff09\u5305\u542b\u6709\u7b26\u5408\u7684 matchLabels \uff08\u8fd9\u91cc\u662f <code>app=App1</code>\uff09\uff0c\u90a3\u4e48 ReplicaSet \u4f1a\u63a5\u7ba1\u5b83\u4eec\u3002</p> <p>Warning</p> <p><code>selector.matchLabels</code>\u4e2d\u5982\u679c\u6709\u591a\u4e2a\u6761\u4ef6\uff0c\u5219\u4ed6\u8d1f\u8d23\u7684Pod\u4e2d\u5e94\u8be5\u5305\u542b \u6240\u6709\u7684 \u6807\u7b7e</p>"},{"location":"cloud/k8s/ckad/ckad-5/#2","title":"2. \u6ce8\u91ca","text":"<p>\u6ce8\u91ca\uff08<code>annotations</code>\uff09\u7528\u4e8e\u8bb0\u5f55\u5176\u4ed6\u8be6\u7ec6\u4fe1\u606f\u3002 \u4f8b\u5982\uff1a\u540d\u79f0\uff0c\u7248\u672c\u53ca\u5176\u4ed6</p> <pre><code>metadata:\n  name: simple-webapp\n  labels:\n    app: App1\n    function: frontend\n  annotations:                  # \u6ce8\u91ca\n    buildversion: 1.34\n</code></pre> <p>Label vs Annotation</p> <ul> <li>Label: \u7528\u6765\u6807\u8bb0\u548c\u7b5b\u9009\u8d44\u6e90\u3002\u4e00\u822c\u5185\u5bb9\u8f83\u5c11\uff0c\u9002\u5408\u7b80\u6d01\u7684\u6807\u8bb0\u3002</li> <li>Annotation: \u7528\u6765\u5b58\u50a8\u989d\u5916\u7684\u5143\u6570\u636e\uff0c\u4f46\u8fd9\u4e9b\u6570\u636e\u4e0d\u53c2\u4e0e\u7b5b\u9009\u6216\u5339\u914d\u3002\u6bd4\u5982: \u7248\u672c\u4fe1\u606f\u3001\u4f5c\u8005\u3001\u53d8\u66f4\u65f6\u95f4\u7b49\uff0c\u4f9b\u4eba\u7c7b\u6216\u5de5\u5177\u67e5\u770b\u3002\u5185\u5bb9\u8f83\u591a\uff0c\u53ef\u4ee5\u5305\u542b\u957f\u6587\u672c\u6216\u590d\u6742\u4fe1\u606f\u3002</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-5/#3-deployment-rollout-rollback","title":"3. Deployment, Rollout, Rollback","text":"<p>\u5f53\u6211\u4eec\u7b2c\u4e00\u6b21\u521b\u5efa<code>Deployment</code>\u65f6\uff0c\u4f1a\u89e6\u53d1\u4e00\u4e2a<code>Rollout</code>\uff08\u540d\u8bcd\uff1a\u7248\u672c\u90e8\u7f72\uff09\uff0c\u4ece\u800c\u751f\u6210\u4e00\u4e2a<code>Deployment Revision</code>\uff08\u53ef\u4ee5\u7406\u89e3\u4e3aDeployment\u7684\u4e00\u4e2a\u7248\u672c\uff09\u3002\u5047\u8bbe\u73b0\u5728\u5f00\u53d1\u8005\u4fee\u6539\u4e86github\u4e0a\u7684\u4ee3\u7801\uff0c\u8be5\u66f4\u65b0\u4f1a\u89e6\u53d1\u65b0\u4e00\u4e2a<code>Rollout</code>\uff0c\u4ece\u800c\u751f\u6210\u65b0\u7248\u672c\u7684<code>Deployment Revision</code>\u3002</p> <p></p> <p>Note</p> <p>\u67e5\u770b\u5f53\u524d<code>Rollout</code>\u72b6\u6001\uff1a <pre><code>kubectl rollout status deployment/[DeploymentName]\n</code></pre> \u67e5\u770b\u5386\u53f2<code>Rollout</code>\uff1a <pre><code># \u26a0\ufe0f \u53ef\u7528 `--revision=1` \u6307\u5b9a\u67e5\u770b Deployment \u7684\u67d0\u4e2a\u7279\u5b9a\u7248\u672c\nkubectl rollout history deployment/[DeploymentName]\n</code></pre> \u4f60\u4f1a\u770b\u5230\uff1a <pre><code>deployment.apps/[DeploymentName]\nREVISION  CHANGE-CAUSE\n1         kubectl apply --record -f deployment.yaml\n2         &lt;none&gt;    # \u8fd9\u91cc\u6267\u884c\u547d\u4ee4\u7684\u65f6\u5019\u5fd8\u4e86\u5199 --record\uff0c \u6240\u4ee5\u4fe1\u606f\u4e22\u5931\u4e86\n</code></pre> \u5047\u8bbe\u4f60\u53d1\u73b0\u65b0\u7684\u8f6f\u4ef6\u7248\u672c\u6709bug\uff0c\u60f3\u8981\u56de\u6eda\u5230\u4e0a\u4e00\u4e2a\u7248\u672c\uff1a</p> <pre><code>kubectl rollout undo deployment/[DeploymentName]\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-5/#deployment-strategy","title":"\u90e8\u7f72\u653f\u7b56\uff08Deployment Strategy\uff09","text":"<p>\u5047\u8bbe\u6211\u4eec\u90e8\u7f72\u4e86\u4e00\u4e2a\u7f51\u7ad9\u5728\u96c6\u7fa4\u4e0a\uff0c\u56e0\u4e3a\u8bbf\u95ee\u91cf\u5927\uff0c\u6211\u4eec\u5c06App\u590d\u5236\u4e865\u4efd\uff08<code>replicas</code>\uff09\u3002\u73b0\u5728\u5f00\u53d1\u8005\u4fee\u6539\u4e86\u6e90\u4ee3\u7801\uff0c\u60f3\u8981\u66f4\u65b0\u7f51\u7ad9\u3002\u6709\u4ee5\u4e0b\u4e24\u79cd\u66f4\u65b0/\u90e8\u7f72\u65b9\u5f0f\u53ef\u4f9b\u9009\u62e9\uff1a</p> <ol> <li> <p>Rolling Update\u653f\u7b56\uff08\u9ed8\u8ba4\u653f\u7b56\uff09\uff1a\u5220\u9664\u4e00\u4e2a\u65e7\u7684App\uff0c\u91cd\u65b0\u90e8\u7f72\u4e00\u4e2a\u65b0\u7684App\uff0c\u9010\u4e2a\u8fdb\u884c\u66f4\u65b0 <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: simple-web\nspec:\n  strategy:                         # \u90e8\u7f72\u653f\u7b56\n    type: RollingUpdate\n    rollingUpdate:          # \u53ef\u5b9a\u4e49\u66f4\u7ec6\u8282\u7684\u5185\u5bb9\n      maxSurge: 25%\n      maxUnavailable: 25%\n</code></pre></p> </li> <li> <p>Recreate\u653f\u7b56\uff1a\u5220\u9664\u65e7\u76845\u4efdApp\uff0c\u518d\u91cd\u65b0\u90e8\u7f72\u65b0\u76845\u4efdApp\u3002\u4e0d\u63a8\u8350\uff0c\u5220\u9664\u65e7\u7684\u4e4b\u540e\uff0c\u65b0\u7684\u90e8\u7f72\u5b8c\u6210\u4e4b\u524d\uff0c\u7528\u6237\u65e0\u6cd5\u8bbf\u95ee\u7f51\u7ad9 <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: simple-web\nspec:\n  strategy:                         # \u90e8\u7f72\u653f\u7b56\n    type: Recreate\n</code></pre></p> </li> </ol> <p>Note</p> <p>\u90e8\u7f72\u653f\u7b56\u53ef\u4ee5\u7528 <code>k describe deployment/[DeploymentName]</code> \u67e5\u770b</p>"},{"location":"cloud/k8s/ckad/ckad-5/#new-deployment","title":"new Deployment","text":"<p>\u66f4\u65b0github\u6e90\u7801\u4f1a\u81ea\u52a8\u89e6\u53d1\u65b0\u90e8\u7f72\uff0c\u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u4fee\u6539\u955c\u50cf\u7248\u672c\uff0c\u6807\u7b7e\uff08<code>labels</code>\uff09\u7b49\u3002\u6211\u4eec\u53ef\u4ee5\uff1a</p> <p>\uff081\uff09\u76f4\u63a5\u7f16\u8f91YAML\u6587\u4ef6 <pre><code># \u5148\u4fee\u6539deployment-definition.yaml\u6587\u4ef6\uff0c\u518d\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\nkubectl apply -f deployment-definition.yaml\n</code></pre> \uff082\uff09\u7528<code>k</code>\u7684\u547d\u4ee4\u76f4\u63a5\u4fee\u6539\u7279\u5b9a\u8d44\u6e90\uff0c\u6bd4\u5982\u955c\u50cf <pre><code># \u26a0\u53ef\u7528 `--record` \u7ed9\u4fee\u6539\u6dfb\u52a0\u63cf\u8ff0\uff0c\u5199\u5230Deployment\u6587\u4ef6\u4e2d\uff0c\u76f8\u5f53\u4e8egit commit -m \u201c\u63cf\u8ff0\u201d\nkubectl set image deployment/[DeploymentName] nginx=nginx:1.9.1     \n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-5/#replicaset_1","title":"ReplicaSet","text":"<p>Deployment \u4e3a Pod \u548c ReplicaSet \u63d0\u4f9b\u58f0\u660e\u5f0f\u66f4\u65b0\u3002\u4e09\u8005\u5173\u7cfb\u5982\u4e0b\uff1a</p> <p></p> <p>\ud83e\ude86\u4e4b\u524d\u6211\u4eec\u63d0\u5230\u8fc7\u5957\u5a03\uff1aPod &lt; ReplicaSet &lt; Deployment</p> <p>Note</p> <p>\u67e5\u770b<code>replicasets</code>\uff1a <pre><code>kubectl get replicasets\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-5/#4","title":"4. \u4e00\u6b21\u6027\u7684\u4efb\u52a1","text":"<p>\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e4b\u524d\u63d0\u8fc7\u7684<code>initContainer</code>\u5417\uff1f\u8fd9\u7c7b\u7279\u6b8a\u7684\u5bb9\u5668\u5728\u5b8c\u6210\u67d0\u4e00\u6b21\u6027\u7684\u4efb\u52a1\u540e\u81ea\u6740\u3002\u4f8b\u5982\uff0c\u6267\u884c\u8ba1\u7b97\u3001\u5904\u7406\u56fe\u50cf\u3001\u5bf9\u5927\u578b\u6570\u636e\u6267\u884c\u67d0\u79cd\u5206\u6790\u3001\u751f\u6210\u62a5\u544a\u548c\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u7b49   --&gt; \u8fd9\u4e9b\u5de5\u4f5c\u8d1f\u8f7d\u7684\u751f\u547d\u5468\u671f\u5f88\u77ed\u3002Docker\u4e5f\u53ef\u4ee5\u8dd1\u4e00\u6b21\u6027\u4efb\u52a1\uff1a</p> <p>Docker\u4e2d\u7684\u4e00\u6b21\u6027\u4efb\u52a1</p> <p>\u4e0b\u9762\u7684\u5bb9\u5668\u5728\u8ba1\u7b973+2\uff0c\u5728Ctrl+C\u4e4b\u540e\u88ab\u5173\u505c\u3002 <pre><code>docker run ubuntu expr 3+2\n</code></pre> \u53ef\u7528<code>docker ps -a</code>\u67e5\u770b\u505c\u4e86\u7684\u5bb9\u5668\uff0c\u5927\u6982\u80fd\u770b\u5230\u7c7b\u4f3c\u7ed3\u679c\uff1a\u53ef\u4ee5\u5728<code>STATUS</code>\u91cc\u770b\u5230\u8be5\u5bb9\u5668\u5df2\u5173\u505c\uff0c\u7ed3\u675f\u7684\u4ee3\u7801\u4e3a<code>0</code>\u610f\u5473\u7740\u8fd0\u884c\u6210\u529f\uff0c\u6ca1\u6709bug\u3002 <pre><code>CONTAINER ID IMAGE    COMMAND     CREATED        STATUS                   PORTS      NAMES\n3192d2048    ubuntu   \"expr 3+2\"  30 seconds ago Exited(0) 41 seconds ago            crazy_cat\n</code></pre></p> <p>k8s\u4e2d\u7684\u4e00\u6b21\u6027\u4efb\u52a1</p> <p>\u2753\u4e0eDocker\u540c\u6837\u7684\u4efb\u52a1\uff0c\u4ee5\u6211\u4eec\u73b0\u5728\u7684\u77e5\u8bc6\uff0c\u5982\u679c\u4e0d\u7528<code>initContainer</code>\uff0c\u7528\u666e\u901a\u7684Container\u8dd1\uff0c\u662f\u600e\u4e48\u6837\u7684\u5462\uff1f \u2757\u5148\u5b9a\u4e49Pod\uff0c\u518d\u7528<code>k create -f pod.yaml</code>\u6267\u884c</p> <pre><code># pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: math-pod\nspec:\n    containers:\n    - name: math-add\n    image: ubuntu\n    command: ['expr', '3', '+',]\n    restartPolicy: Always # \u9ed8\u8ba4\u7684Pod\u91cd\u542f\u7b56\u7565\u662fAlways\uff0c\u8fd8\u53ef\u4ee5\u662fNever\u6216\u8005OnFailure\n</code></pre> <p>\u8fd9\u4e2a\u64cd\u4f5c\u7684\u7ed3\u679c\u662f\uff1aKubernetes\u4e0d\u65ad\u7684\u60f3\u8981\u91cd\u5efa\u5bb9\u5668\uff0c\u4ee5\u4fdd\u8bc1\u5bb9\u5668\u7684\u6570\u91cf\u4e3a1\uff0c\u800c\u88ab\u65b0\u5efa\u7684\u5bb9\u5668\u5219\u6bcf\u6b21\u90fd\u5728\u6267\u884c\u5b8c\u8ba1\u7b97\u4efb\u52a1\u540e\u81ea\u6740\u3002\u4ee5\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u8fbe\u5230\u9608\u503c\u3002Kubernetes \u5e0c\u671bApp\u6c38\u8fdc\u5b58\u5728\u3002</p> <p><code>Pod</code> \u7684\u9ed8\u8ba4\u884c\u4e3a\u662f\u5c1d\u8bd5\u91cd\u65b0\u542f\u52a8\u5bb9\u5668\u4ee5\u4fdd\u6301\u5176\u8fd0\u884c\u3002\u8be5\u884c\u4e3a\u7531 Pod \u4e0a\u7684\u91cd\u542f\u7b56\u7565\uff08<code>restartPolicy</code>\uff09\u5b9a\u4e49\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8bbe\u7f6e\u4e3a <code>always</code>\u3002 </p> <p>\u27a1\ufe0f\u27a1\ufe0f\u27a1\ufe0f \u89e3\u51b3\u65b9\u6cd5\uff1a\u6211\u4eec\u53ef\u4ee5\u5c06\u5b83\u4fee\u6539\u6210<code>Never</code>\u6216\u8005<code>OnFailure</code>\uff0c\u4ee5\u963b\u6b62\u5bb9\u5668\u7684\u91cd\u5efa --&gt; \u8fd9\u4e2a\u89e3\u51b3\u65b9\u6cd5\uff0c\u4e0d\u662f\u7279\u522b\u7684\u4f18\u96c5\u3002\u66f4 \u4f18\u96c5 \u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u4f7f\u7528 Job \u6216\u8005 CronJob</p>"},{"location":"cloud/k8s/ckad/ckad-5/#job","title":"Job","text":"<p>\u7136\u800c\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u6b21\u6027\u7684\u4efb\u52a1\u4e0d\u4f1a\u662f\u8ba1\u7b972+3\u90a3\u4e48\u7b80\u5355\uff0c\u4e00\u822c\u4f1a\u662f\u5927\u91cf\u6570\u636e\u7684\u6279\u5904\u7406\u7b49\u590d\u6742\u4f46\u53ea\u9700\u6267\u884c\u4e00\u6b21\u7684\u4efb\u52a1\uff0c\u8fd9\u91cc\u6211\u4eec\u5f15\u5165<code>Job</code>\u8fd9\u4e2a\u6982\u5ff5\u3002</p> <p>Job VS ReplicaSet</p> <pre><code>`Job`\u53ef\u4e0e`ReplicaSet`\u8fdb\u884c\u7c7b\u6bd4\uff0c\u53ea\u4e0d\u8fc7`Job`\u4e2d\u7684Pod\u505a\u7684\u4e00\u6b21\u6027\u4efb\u52a1\uff0c\u800c`ReplicaSet`\u4e2d\u7684Pod\u8fd0\u884c\u7684\u662f\u6301\u7eed\u6027App\u3002\n\n&lt;img src=\"../ckad-5/replicaset_job.png\" width=600 /&gt;\n</code></pre> <p>Note</p> <pre><code>- `.spec.completions: 3`\uff1a3\u4e2a\u4efb\u52a1\uff0c\u75313\u4e2aPod\u6267\u884c\uff0cPod\u6309\u5e8f\u521b\u5efa\uff0c\u7b2c\u4e8c\u4e2a Pod \u4ec5\u5728\u7b2c\u4e00\u4e2a Pod \u5b8c\u6210\u540e\u521b\u5efa\u3002\u5982\u6709Pod\u521b\u5efa\u5931\u8d25\uff0cJob\u4f1a\u6301\u7eed\u65b0\u5efaPod\u76f4\u5230\u6709\u6307\u5b9a\u6570\u91cf\u7684`completed`\u7684Pod\u4e3a\u6b62\n- `.spec.parallelism: 3`\uff1a3\u4e2a\u4efb\u52a1\uff0c\u75313\u4e2aPod\u6267\u884c\uff0c**\u5e76\u884c** \u8fd0\u884c Pod\n- `.spec.backoffLimit: 15`\uff1a\u5982\u679c\u6ca1\u6709\u4e00\u6b21Pod\u6267\u884c\u6210\u529f\uff0c\u6700\u591a\u6267\u884cPod15\u6b21\u3002\u6240\u4ee5Pod\u505c\u6b62\u6267\u884c\u7684\u60c5\u51b5\u6709\u4e24\u79cd\uff1a\u8981\u4e48\u6709\u4e00\u6b21\u6210\u529f\u4e86\uff0c\u8981\u4e48\u6b21\u6570\u8d85\u8fc715\u4e86\n</code></pre> <p>\u7528<code>k create -f job.yaml</code>\u65b0\u5efaJob\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a <pre><code>kubectl get jobs\n</code></pre> \u7ed3\u679c\u5982\u4e0b\uff1a <pre><code>NAME            DESIRED SUCCESSFUL  AGE\nmath-add-job    3       0           38s\n</code></pre></p> <p>\u56e0\u4e3aJob\u4e5f\u540c\u65f6\u65b0\u5efa\u4e86<code>Container</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>k  get pods</code>\u67e5\u770b\uff0c\u7ed3\u679c\u5982\u4e0b\u3002<code>RESTARTS</code>\u4e3a0\uff0c\u56e0\u4e3aPod\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u91cd\u5efa\u3002 <pre><code>NAME                READY   STATUS      RESTARTS    AGE\nmath-add-job-187pn  0/1     Completed   0           2m\nmath-add-job-230ds  0/1     Completed   0           2m\nmath-add-job-948xc  0/1     Completed   0           2m\n</code></pre></p> <p>\u67e5\u770b<code>expr 3+2</code>\u7684\u8ba1\u7b97\u7ed3\u679c\uff1a <pre><code>kubectl logs math-add-job-187pn\n</code></pre></p> <p>\u5220\u9664Job\uff1a <pre><code>kubectl delete job math-add-job\n</code></pre> \u751f\u6210<code>Job</code>\u5b9a\u4e49\u6587\u4ef6 <pre><code>kubectl create job math-add-job \\\n    --image=[ImageName] \\\n    --dry-run=client -o yaml \\\n    &gt; math-add-job.yaml\n</code></pre></p> Job CronJob Job\u7684\u5b9a\u4e49\u5728`.spec.template.spec.containers` CronJob\u7684\u5b9a\u4e49\u5728`.spec.jobTemplate.spec.template.spec.containers` <pre><code>\n    kubectl create job example-job \\\n    --image=busybox \\ \n    -- \\\n    echo \"Hello from Job\"\n    </code>\n    \n    \n    <pre><code>\n    kubectl create cronjob example-cronjob \\\n    --image=busybox \\\n    --schedule=\"*/1 * * * *\" \\\n    -- \\\n    echo \"Hello from CronJob\"\n    </code>\n    \n  \n  \n    \n<pre><code>\napiVersion: batch/v1\nkind: Job\nmetadata:\n    name: math-add-job\n\nspec:   \n    completions: 3\n    parallelism: 3\n    backoffLimit: 15\n    template:\n        spec:\n            containers:\n                - name: math-add\n                  image: ubuntu\n                  command: ['expr', '3', '+', '2']\n                  restartPolicy: Never\n\n</code>\n    \n    \n<pre><code>\napiVersion: batch/v1\nkind: CronJob\nmetadata:\n    name: reporting-cron-job\nspec:\n    schedule: \"1 * * * *\"\n    jobTemplate:\n\n        spec:\n            completions: 3\n            parallelism: 3\n            backoffLimit: 15\n            template:\n                spec:\n                    containers:\n                        - name: math-add\n                          image: ubuntu\n                          command: ['expr', '3', '+', '2']\n                          restartPolicy: Never\n\n</code>"},{"location":"cloud/k8s/ckad/ckad-5/#cronjobs","title":"CronJobs","text":"<p>\u8fd9\u4e2a\u66f4\u9ad8\u7ea7\u4e86\u59d0\u59b9\u4eec\uff0c<code>CronJob</code>\u662f\u4e00\u4e2a\u53ef\u4ee5\u88ab\u9884\u7ea6\u6216\u8005\u5b9a\u671f\u6267\u884c\u7684<code>Job</code>\u3002</p>\n\n<p>Note</p>\n<ul>\n<li><code>.spec.schedule</code>\u65f6\u95f4\u683c\u5f0f\u4ece\u5c0f\u5230\u5927, \u5982\u4e0b\uff1a<code>\"[minute (0-59)] [hour (0-23)] [day of the month (1-31)] [month (1-12)] [weekday (0-6)]\"</code></li>\n<li>\u26a0\ufe0f\u73b0\u5728 CronJob \u5b9a\u4e49\u4e2d\u6709\u4e09\u4e2a<code>spec</code></li>\n</ul>\n\n<p>\u7528<code>k create -f crobjob.yaml</code>\u65b0\u5efaJob\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a\n<pre><code>kubectl get cronjob\n</code></pre>\n\u7ed3\u679c\u5982\u4e0b\uff1a\n<pre><code>NAME                SCHEUDLE        SUSPEND         ACTIVE\nreporting-cron-job  */1 * * * *     False           0\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-5/#kubectl","title":"&gt;&gt;&gt;  \u672c\u7ae0kubectl\u547d\u4ee4\u6574\u7406","text":"<p>\u6807\u7b7e&amp;\u9009\u62e9\u5668</p>\n<p><code>k get pods --selector app=App1,env=dev</code>\u5176\u4e2d<code>--selector</code>\u548c <code>-l</code> \u6548\u679c\u4e00\u6837\uff0c\u90fd\u662f\u7528\u6807\u7b7e\u5bf9\u8d44\u6e90\u8fdb\u884c\u9009\u62e9</p>\n\n<p>Rollout\u76f8\u5173</p>\n<p><code>k rollout status deployment/[DeploymentName]</code> \u67e5\u770b\u72b6\u6001</p>\n<p><code>k rollout history deployment/[DeploymentName]</code> \u67e5\u770b\u5386\u53f2Rollout\uff0c\u53ef\u7528<code>--revision=1</code>\u6307\u5b9a\u7248\u672c</p>\n<p><code>k rollout undo deployment/[DeploymentName]</code> \u56de\u6eda\u5230\u4e0a\u4e00\u4e2a\u7248\u672c</p>\n\n<p>Deployment\u76f8\u5173</p>\n<p><code>k set image deployment/[DeploymentName] nginx=nginx:1.9.1</code> \u4fee\u6539\u955c\u50cf\u8d44\u6e90</p>\n\n<p>ReplicaSet\u76f8\u5173</p>\n<p><code>k get replicasets</code>\u5217\u51fa\u6240\u6709replicasets</p>\n\n<p>Job\u76f8\u5173</p>\n<p><code>k create job [JobName] --image=[ImageName] --dry-run=client -o yaml &gt; [JobName].yaml</code> \u751f\u6210Job\u5b9a\u4e49\u6587\u4ef6</p>\n<p><code>k get jobs</code>\u5217\u51fa\u6240\u6709jobs</p>\n<p><code>k delete job [JobName]</code>\u5220\u9664\u67d0job</p>\n\n<p>CronJob\u76f8\u5173</p>\n<p><code>k get cronjob</code></p>"},{"location":"cloud/k8s/ckad/ckad-6/","title":"6.\u670d\u52a1\u4e0e\u7f51\u7edc","text":""},{"location":"cloud/k8s/ckad/ckad-6/#1-service","title":"1. \u670d\u52a1\uff08<code>Service</code>\uff09","text":"<p>Service vs Route</p> <p>The <code>Service</code> will expose your application internally within the cluster, and the Route will create a publicly accessible URL for external access.</p>"},{"location":"cloud/k8s/ckad/ckad-6/#service","title":"\u4e3a\u4ec0\u4e48\u9700\u8981Service\uff1f","text":"<p>Kubernetes\u4e2d\u7684\u6bcf\u4e2a<code>Pod</code>\u90fd\u6709\u5b83\u81ea\u5df1\u7684IP\u5730\u5740\uff0c\u4f46<code>Pod</code>\u7ecf\u5e38\u4f1a\u56e0\u4e3a\u5404\u79cd\u539f\u56e0\u800c\u6302\u6389\uff0c\u5982\u679c\u6211\u4eec\u7528<code>Pod</code>\u7684IP\u5730\u5740\u6765\u8bbf\u95ee\u8be5<code>Pod</code>\uff0c\u4f1a\u5e38\u51fa\u73b0IP\u5730\u5740\u65e0\u6548\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u7528 \u670d\u52a1\uff08<code>Service</code>\uff09  \u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u670d\u52a1\uff08<code>Service</code>\uff09\u63d0\u4f9b\u4e86\u7a33\u5b9a\u7684IP\u5730\u5740\uff0c\u6211\u4eec\u6c38\u8fdc\u53ef\u4ee5\u627e\u5230\u670d\u52a1\uff08<code>Service</code>\uff09\u7684IP\u5730\u5740\uff0c\u7136\u540e\u901a\u8fc7\u8be5\u670d\u52a1\uff08<code>Service</code>\uff09\u8bbf\u95ee\u5230\u60f3\u8981\u627e\u7684\u5e94\u7528Pod\u3002</p> \u670d\u52a1\u4e0d\u5b58\u5728\u65f6\uff1a <p>\u4e3a\u4e86\u66f4\u597d\u7684\u7406\u89e3\uff0c\u6211\u4eec\u770b\u4e00\u4e0b\u5982\u679c \u670d\u52a1\u4e0d\u5b58\u5728 \uff0c\u7528\u6237\u53ef\u4ee5\u600e\u4e48\u8bbf\u95eePod\u4e2d\u7684\u5e94\u7528\uff1a \u65b9\u6cd5\u4e00\uff1a \u5982\u679c\u7528\u6237\u672c\u8eab\u5728Cluster\u5185\u90e8\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7<code>curl http:10.244.0.2</code>\u8bbf\u95ee\u5e94\u7528 \u65b9\u6cd5\u4e8c\uff1a \u5982\u679c\u5728Cluster\u5916\u90e8\uff0c\u53ef\u4ee5\u901a\u8fc7 ssh \u6765\u8bbf\u95ee<code>curl http:10.244.0.2</code></p> <p></p> \u6709\u4e86\u670d\u52a1\u4e4b\u540e\uff1a <p>Cluster\u5916\u90e8\u5bf9\u5e94\u7528\u7684\u8bbf\u95ee\u4f1a\u66f4\u65b9\u4fbf\u3002\u670d\u52a1\uff08<code>Service</code>\uff09\u76f8\u5f53\u4e8e\u4e00\u4e2a\u865a\u62df\u670d\u52a1\u5668\uff0c\u6709\u81ea\u5df1\u7684IP\u5730\u5740\uff08\u8fd9\u91cc\u662f<code>10.106.127.123</code>\uff09\u3002 \u8fd9\u91cc\u6211\u4eec\u4e0d\u518d\u9700\u8981 ssh \uff0c\u800c\u662f\u76f4\u63a5\u8bbf\u95eeNode\u6240\u5728\u7684ip\u5730\u5740<code>192.168.1.2</code>\uff08\u26a0\ufe0f\u7528\u6237\u672c\u8eab\u7684\u7535\u8111IP\u548cNode\u7684IP\u662f\u5728\u540c\u4e00\u4e2a\u7f51\u7edc\u91cc\u9762\u7684\uff0c\u5373IP\u5730\u5740\u4e2d\u7684\u524d\u4e09\u90e8\u5206\u65f6\u76f8\u540c\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u624d\u80fd\u76f4\u63a5\u8bbf\u95ee\u5230Node\u5f97IP\uff09\uff0c \u5165\u53e3\u5219\u4f7f\u7528Service\u63d0\u4f9b\u7684\u7aef\u53e3\uff08<code>30080</code>\uff09\uff0c\u6bd4\u5982\u4f7f\u7528<code>curl 192.168.1.2:30080</code> </p> <p>\u67e5\u770b\u670d\u52a1\uff1a <pre><code>k get services\n# \u6216\nk get svc\n</code></pre> \u7ed3\u679c\u5982\u4e0b\uff1a <pre><code>NAME            TYPE        CLUSTER-IP      EXTERNAL-IP     PORT(S)         AGE\nkubernetes      ClusterIP   10.43.0.1       &lt;None&gt;          443/TCP         7m30s\nmyapp-service   NodePort    10.106.127.123  &lt;None&gt;          80:30008/TCP    30s\n</code></pre></p> <p>Info</p> <ul> <li><code>kubernetes</code> \u670d\u52a1\u662fk8s\u5728\u542f\u52a8\u65f6\u521b\u5efa\u7684\u9ed8\u8ba4\u670d\u52a1\u3002<code>myapp-service</code>\u670d\u52a1\u662f\u6211\u4eec\u521b\u5efa\u7684\uff0c\u73b0\u5728\u4f5c\u4e3a\u7528\u6237\u53ef\u4ee5\u901a\u8fc7<code>curl http://192.168.1.2:30008</code>\u76f4\u63a5\u8bbf\u95ee\u5230\u524d\u7aefApp\u4e86\uff01</li> <li>PORT(S)\u4e2d\u4ee3\u8868\u7684\u662f\uff1a<code>&lt;ServicePort&gt;:&lt;NodePort&gt;/&lt;Protocol&gt;</code></li> <li><code>targetPort</code> \u4e0d\u4f1a\u663e\u793a\u5728 <code>oc get svc</code> \u7ed3\u679c\u4e2d</li> <li><code>ClusterIP</code>\uff08\u96c6\u7fa4\u5185\u7684\u865a\u62df IP\uff09\uff0c\u96c6\u7fa4\u5185\u7684 Pod \u901a\u8fc7\u6b64 IP \u8bbf\u95ee Service</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-6/#ports","title":"\u8bed\u6cd5\uff1a\u4e09\u4e2aports","text":"<p><pre><code># Service with NodePort\napiVersion: v1\nkind: Service\nmetadata:\n  name: my-nodeport-service\nspec:\n  type: NodePort\n  selector:\n    app: my-app\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 8080\n    nodePort: 30007\n</code></pre> YAML\u6587\u4ef6\u4e2d\u5171\u6709\u4e09\u4e2a\u7aef\u53e3\uff1a</p> <ol> <li><code>port</code> - Service \u81ea\u5df1\u7684 Port  <ul> <li>\u670d\u52a1\u672c\u8eab\u7684\u7aef\u53e3</li> <li>\u670d\u52a1\u81ea\u5df1\u7684port\u5c31\u7b80\u5355\u5730\u53eb<code>port</code></li> <li>\u2705 \u5fc5\u5199\uff0c\u5426\u5219\u4f1a\u62a5\u9519</li> </ul> </li> <li><code>targetPort</code> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u7684\u5b9e\u9645\u7aef\u53e3\uff08Pod\u7684\u7aef\u53e3\uff09 </li> <li>\u662f\u670d\u52a1\u7684\u76ee\u6807\uff0c\u6240\u4ee5\u53eb<code>target</code></li> <li>\ud83d\udeab \u53ef\u9009\uff0c\u5982\u4e0d\u5199\u660e\uff0c\u9ed8\u8ba4\u4e0e<code>port</code>\u503c\u76f8\u540c</li> </ul> </li> <li><code>nodePort</code> <ul> <li>Node\u7684\u7aef\u53e3\uff0c\u662f\u5916\u90e8\u8bbf\u95ee\u670d\u52a1\u7684\u7aef\u53e3\uff08\u96c6\u7fa4\u5916\uff09</li> <li>\ud83d\udeab \u53ef\u9009\uff0c\u5982\u4e0d\u5199\u660e\uff0ck8s\u4f1a\u63d0\u4f9b\u4efb\u610f\u4e00\u4e2a\u5728 [30000, 32767] \u8303\u56f4\u5185\u53ef\u7528\u7684\u7aef\u53e3</li> </ul> </li> </ol> <p></p> <p>\u5982\u56fe\uff0c\u5916\u90e8\u7684\u8bbf\u95ee\u8005\u53ea\u9700\u8981\u77e5\u9053Node\u7684IP\u5730\u5740\uff08<code>192.168.1.2</code>\uff09\uff0c\u548cNode\u5f00\u653e\u7684Port\uff08<code>30007</code>\uff09\u5c31\u884c\u4e86</p> <p><code>service.spec.ports</code></p> <p><code>.spec.ports</code>\u5bb9\u7eb3\u7684\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u610f\u5473\u7740\u4e00\u4e2a\u670d\u52a1\u53ef\u5f00\u653e \u591a\u4e2a\u7aef\u53e3\uff0c\u7528\u4e8e\u4e0e\u4e0d\u540c\u7684App\u8fdb\u884c\u6c9f\u901a</p> <ul> <li>\u26a0\ufe0f \u6ce8\u610f\uff1a\u5982\u679c\u6709\u591a\u4e2a\u7aef\u53e3\u5f00\u653e\uff0c\u90a3\u4e48<code>Service</code>\u7684\u6bcf\u4e2a\u7aef\u53e3\u90fd\u5fc5\u987b\u6709\u4e00\u4e2a\u540d\u79f0</li> </ul> <p>\u4f7f\u7528\u573a\u666f: </p> <ol> <li>\u591a\u534f\u8bae\u670d\u52a1\uff08\u5982 HTTP + gRPC\uff09- L7 \u5e94\u7528\u5c42\u534f\u8bae     \u8fd9\u91cc\u7684 HTTP \u548c gRPC \u90fd\u662f\u57fa\u4e8e TCP \u7684\u5e94\u7528\u5c42\u534f\u8bae\u3002\u5b83\u4eec \u4f7f\u7528\u4e0d\u540c\u7684\u7aef\u53e3\uff0c\u4f46\u90fd\u662f TCP\uff0c\u4f8b\u5982\uff1a     <pre><code>spec:\n    ports:\n    - name: http\n        port: 80\n        targetPort: 8080\n    - name: grpc\n        port: 50051\n        targetPort: 50051\n</code></pre></li> <li>TCP + UDP - \u4f8b\u5982DNS\u670d\u52a1 - L4 \u4f20\u8f93\u5c42\u534f\u8bae     \u8fd9\u91cc\u6d89\u53ca \u4e0d\u540c\u7684\u4f20\u8f93\u5c42\u534f\u8bae\uff0c\u5373 TCP \u548c UDP\uff0c\u6240\u4ee5\u5fc5\u987b\u5206\u5f00\u58f0\u660e     <pre><code>spec:\n    ports:\n      - name: dns-tcp\n        port: 53\n        targetPort: 53\n        protocol: TCP\n      - name: dns-udp\n        port: 53\n        targetPort: 53\n        protocol: UDP\n</code></pre></li> <li>\u540c\u65f6\u63d0\u4f9b\u591a\u4e2a\u7248\u672c\u7684 API     <pre><code>spec:\n    ports:\n        - name: api-v1\n        port: 8080\n        targetPort: 8080\n        - name: api-v2\n        port: 9090\n        targetPort: 9090\n</code></pre></li> <li>Service \u4ee3\u7406\u591a\u4e2a\u4e0d\u540c\u7684 Backend \u7aef\u53e3. \u4e00\u4e2a Pod \u8fd0\u884c\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u76d1\u542c\u4e0d\u540c\u7aef\u53e3\uff08\u5982 Web + Metrics\uff09\u3002     <pre><code>spec:\nports:\n  - name: web\n    port: 80\n    targetPort: 8080\n  - name: metrics\n    port: 9090\n    targetPort: 9090\n</code></pre></li> </ol> <p>Info</p> <ul> <li><code>.spec.selector</code> \u6307\u5b9a<code>targetPort</code>\u5c5e\u4e8e\u54ea\u4e00\u4e2aPod\uff0c\u4e0a\u9762\u4f8b\u5b50\u4e2d\u7ed1\u5b9a\u4e86\u4e00\u4e2a<code>labels</code>\u4e2d\u6709<code>app=myapp</code>\u7684Pod\u3002<ul> <li>\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a\u524d\u7aefApp\u4f1a\u6709\u591a\u4e2areplicas\uff0c\u4f46\u56e0\u4e3a\u4ed6\u4eec\u90fd\u6709\u76f8\u540c\u7684<code>labels</code>\uff0c\u4ed6\u4eec\u4f1a\u81ea\u52a8\u88abservice\u627e\u5230\uff01</li> </ul> </li> <li><code>targetPort</code>\u662fPod\u800c\u4e0d\u662fContainer\uff01\u56e0\u4e3aPod\u4e2d\u7684\u6240\u6709Container\u662f\u5171\u4eab\u7f51\u7edc\u7684\uff0c\u6240\u4ee5\u7528\u540c\u4e00\u4e2aPod\u7aef\u53e3</li> </ul> <p>\u670d\u52a1\u7684\u7aef\u70b9\uff08Endpoint\uff09</p> <p><code>Service</code>\u4e2d\u6709\u4e00\u4e2a<code>Endpoint</code>\uff0c\u8fd9\u4e2a<code>Endpoint</code>\u662f \u8be5<code>Service</code> \u6307\u5411\u7684 \u771f\u6b63\u7684 Pod IP \u5730\u5740\u548c\u7aef\u53e3</p> <p>\u67e5\u770b<code>Service</code>\u7ec6\u8282:</p> <pre><code>k describe svc &lt;ServiceName&gt;\n</code></pre> <p></p> <ul> <li><code>IP</code>\uff1aCluster\u7ed9 service \u5206\u914d\u7684\u865a\u62dfIP</li> <li><code>Endpoints</code>\uff1aservice\u6307\u5411\u7684 Pod \u771f\u6b63\u7684IP\uff0c \u5e76\u975e\u865a\u62df\uff01</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-6/#ip","title":"IP\u5730\u5740\u7c7b\u578b","text":"<p>\u6709\u4e24\u79cd\u7c7b\u578b\uff1a\u5916\u90e8IP\u5730\u5740\uff08external/public\uff09 \u548c \u5185\u90e8IP\u5730\u5740\uff08internal/private\uff09\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u6bcf\u4e2a\u8bbe\u5907\u90fd\u6709\u81ea\u5df1\u7684 \u5916\u90e8IP \u548c \u5185\u90e8IP\uff0c\u4e14\u4e00\u822c\u4e24\u8005\u4e0d\u540c\u3002</p> <ul> <li> <p>\u5916\u90e8IP\uff1a\u7531\u4f60\u7684\u7f51\u7edc\u4f9b\u5e94\u5546\u63d0\u4f9b\uff0c\u4f60\u8bbf\u95ee\u4e00\u4e2a\u7f51\u9875\u65f6\uff08\u6bd4\u5982\u767e\u5ea6\uff09\uff0c\u767e\u5ea6\u53ef\u4ee5\u770b\u5230\u4f60\u7684\u5916\u90e8IP\u5730\u5740\uff0c\u77e5\u9053\u4f60\u662f\u4ece\u54ea\u513f\u6765\u7684\u3002 <pre><code>\n    # ifconfig=InterFace config\n    curl ifconfig.me\n    </code></pre></p> </li> <li> <p>\u5185\u90e8IP\uff1a\u662f\u81ea\u52a8\u751f\u6210\u7684\u3002\u4eba\u5982\u5176\u540d\uff0c\u53ea\u505a\u5185\u90e8\u4f7f\u7528\u3002\u6bd4\u5982\uff0c\u7528\u4e8e\u5728\u5bb6\u5ead\u7f51\u7edc\u4e2d\u8bc6\u522b\u4f60\u7684\u8eab\u4efd\u4fe1\u606f\u3002 <pre><code>\n    # ipconfig=Internet Protocol configuration\n    ipconfig getifaddr en0\n    </code></pre></p> </li> </ul> <p>Note</p> <p>\u5f53\u4f60\u4f7f\u7528VPN\uff08Virtual Private Network\uff09\u7684\u65f6\u5019\uff0c\u4f60\u7684 \u7f51\u7edc\u5730\u5740 \u662f\u88ab\u9690\u85cf\u7684</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-6/#_1","title":"\u670d\u52a1\u7c7b\u578b","text":"\u670d\u52a1\u7c7b\u578b \u63cf\u8ff0 \u6bd4\u55bb YAML <code>ClusterIP</code> \u2757\u9ed8\u8ba4\u7c7b\u578b \u9ed8\u8ba4\u7c7b\u578b\uff0c\u4ec5\u80fd\u5728\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee\u3002\u6bd4\u5982\uff1aFrontend\u8bbf\u95eeBackend\u9002\u7528\u4e8e\uff1a\u96c6\u7fa4\u5185\u90e8\u670d\u52a1\u95f4\u901a\u4fe1\u3002 \u516c\u53f8\u5185\u90e8\u7684\u5185\u7ebf\u7535\u8bdd\uff0c\u5916\u90e8\u65e0\u6cd5\u62e8\u6253\u3002 <pre><code>\nspec:\n    type: ClusterIP\n</code></pre> <code>NodePort</code> \u66b4\u9732\u670d\u52a1\u5230\u6bcf\u4e2a\u8282\u70b9\u7684\u56fa\u5b9a\u7aef\u53e3\u4e0a\uff0c\u901a\u8fc7 <code>[NodeIP]:[NodePort]</code> \u8bbf\u95ee\u3002\u9002\u7528\u4e8e\uff1a\u6d4b\u8bd5\u73af\u5883\uff0c\u6216\u5feb\u901f\u66b4\u9732\u670d\u52a1 - \u7528\u4e8e\u5916\u90e8\u8bbf\u95ee\u3002 \u4f01\u4e1a\u5927\u95e8\u7684\u8bbf\u5ba2\u5165\u53e3\uff0c\u6bcf\u4e2a\u95e8\u6709\u56fa\u5b9a\u95e8\u724c\u53f7\u3002 <pre><code>\nspec:\n    type: NodePort\n    ports:\n        - nodePort: 30007\n</code></pre> <code>Headless</code> \u4e00\u79cd\u7279\u6b8a\u7684 <code>ClusterIP</code> \u914d\u7f6e\uff0c\u65e0\u8d1f\u8f7d\u5747\u8861\uff0c\u4e0d\u4f1a\u5206\u914d\u865a\u62df\u7684 ClusterIP\uff08`clusterIP: None`\uff09\uff0c\u800c\u662f\u76f4\u63a5\u66b4\u9732\u540e\u7aef Pod \u7684\u771f\u5b9e IP\uff01\u9002\u7528\u4e8e\uff1a\u76f4\u63a5\u8bbf\u95ee Pod \u7684\u573a\u666f\uff0c\u4f8b\u5982 StatefulSet \u5e94\u7528\uff08\u5982\u6570\u636e\u5e93\uff09\u3002 \u7ed9\u5ba2\u6237\u76f4\u63a5\u63d0\u4f9b\u5458\u5de5\u624b\u673a\u53f7\u7801\uff0c\u800c\u975e\u603b\u673a\u8f6c\u63a5\u3002 <pre><code>\nspec:\n    clusterIP: None\n</code></pre> <code>LoadBalancer</code> \u901a\u8fc7\u4e91\u5e73\u53f0\u521b\u5efa\u4e00\u4e2a **\u5916\u90e8\u8d1f\u8f7d\u5747\u8861\u5668**\uff0c \u5e76\u5206\u914d\u516c\u5171 IP\u3002\u9002\u7528\u4e8e\uff1aProduction\u73af\u5883\u4e2d\uff0c\u90a3\u4e9b\u9700\u8981\u76f4\u63a5\u5bf9\u5916\u66b4\u9732\u7684\u670d\u52a1\u3002 - <pre><code>\nspec:\n    type: LoadBalancer\n</code></pre> <code>ExternalName</code> \u5c06\u670d\u52a1\u6620\u5c04\u5230\u5916\u90e8\u7684 DNS \u540d\u79f0\uff0c\u65e0\u9700\u4ee3\u7406\u6d41\u91cf\u3002\u9002\u7528\u4e8e\uff1a\u4f7f\u7528\u5916\u90e8\u8d44\u6e90\uff08\u5982\u5916\u90e8\u6570\u636e\u5e93\u6216 API\uff09\u3002 - <pre><code>\nspec:\n    type: ExternalName\n    externalName: example.com\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-6/#1clusterip","title":"\uff081\uff09ClusterIP\u7c7b \u670d\u52a1","text":"<p>Danger</p> <p>The name \"ClusterIP\" refers to the fact that this service provides a virtual IP address (ClusterIP) that is accessible only within the cluster.</p> <p>\ud83d\udca1 <code>ClusterIP</code> Cluster \u7ed9 Service \u5206\u914d\u7684\u90a3\u4e2a\u865a\u62df IP \u5c31\u53eb\u505a <code>ClusterIP</code></p> <p>\ud83d\udca1 \u53ef\u4ee5\u5206\u914d\u7ed9 Service \u7684 <code>ClusterIP</code>\u8303\u56f4 \u5728 OpenShift Cluster\u5b89\u88c5\u65f6\u5c31\u5df2\u7ecf\u5728 <code>install-config.yaml</code> \u7684 <code>networking.serviceNetwork</code> \u88ab\u5b9a\u4e49\u4e86\u3002</p> <p>\u9ed8\u8ba4\u7c7b\u578b\uff0c\u4ec5\u80fd\u5728\u96c6\u7fa4\u5185\u90e8\u8bbf\u95ee\u3002\u6bd4\u5982\uff1aFrontend\u8bbf\u95eeBackend</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: clusterip-service\n  namespace: default\nspec:\n  type: ClusterIP\n  selector:\n    app: my-app\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 8080\n</code></pre> <p>Info</p> <p>\u95ee\uff1a\u5047\u8bbe\u73b0\u5728\u6709\u524d\u7aef\u540e\u7aef\u7ec4\u6210\u7684\u7a0b\u5e8f\uff0c\u800c\u524d\u7aef\u548c\u540e\u7aef\u5404\u6709\u81ea\u5df1\u7684<code>Replicas</code>\uff08\u590d\u5236\u54c1\uff0c\u4e3a\u4e86\u5904\u7406\u8f83\u5927\u7684\u7528\u6237\u8bbf\u95ee\u800c\u5b58\u5728\uff09\u3002\u8bbf\u95ee\u524d\u7aef1\u7684\u65f6\u5019\uff0c\u524d\u7aef1\u7684API\u662f\u53d1\u9001\u7ed9\u540e\u7aef\u7684\u54ea\u4e00\u4e2a<code>replica</code>\u7684\u5462\uff1f</p> <p>\u7b54\uff1aKubernetes\u7684 ClusterIP\u670d\u52a1 \u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5c06 <code>Pod</code> \u5206\u7ec4\u5728\u4e00\u8d77\uff08\u6240\u6709\u7684\u524d\u7aef<code>replicas</code>\u4e3a\u4e00\u7ec4\uff0c\u540e\u7aef<code>replicas</code>\u4e3a\u53e6\u4e00\u7ec4\uff09\uff0c\u5e76\u63d0\u4f9b\u5355\u4e2a\u63a5\u53e3\uff08\u5373<code>Service</code>\uff09\u6765\u8bbf\u95ee\u7ec4\u4e2d\u7684 <code>Pod</code>\u3002<code>Pod</code>\u4f1a\u56e0\u4e3a\u5404\u79cdbug\u751f\u751f\u6b7b\u6b7b\uff0c\u6bcf\u6b21\u91cd\u751f\u4e4b\u540e\u62ff\u5230\u7684IP\u5730\u5740\u8fd8\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u76f4\u63a5\u7528<code>Pod</code>\uff0c\u56e0\u4e3a\u6211\u4eec\u4e0d\u77e5\u9053\u8be5\u53bb\u54ea\u4e2aIP\u5730\u5740\u627e\uff0c\u800c<code>Service</code>\u63d0\u4f9b\u4e86\u7a33\u5b9a\u7684IP\u5730\u5740\u3002\u5982\u56fe\uff1a</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-6/#2nodeport","title":"\uff082\uff09NodePort\u7c7b","text":"<p>Danger</p> <p>The name \"NodePort\" refers to the fact that the service opens a specific port on each cluster node, making it accessible from outside the cluster via the node's IP and the exposed port.</p> <p>\u66b4\u9732\u670d\u52a1\u5230\u6bcf\u4e2a\u8282\u70b9\u7684\u56fa\u5b9a\u7aef\u53e3\u4e0a\uff0cExternal clients can access it via <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>.</p> <p>NodePort \u670d\u52a1\u4f8b\u5b50\uff1a <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: my-nodeport-service\nspec:\n  type: NodePort\n  selector:\n    app: my-app\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 8080\n    nodePort: 30007\n</code></pre></p> <p>\u591aNode</p> <p>\u5f53Pod\u7684replicas\u5206\u5e03\u5728\u4e0d\u540c\u7684Node\u4e0a\u65f6\uff0cService\u4f1a\u81ea\u52a8\u6269\u5c55\u5230\u591a\u4e2aNode\u4e0a\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u591a\u4f59\u7684\u64cd\u4f5c\u3002 <pre><code>curl http://192.168.1.2:30008\ncurl http://192.168.1.3:30008\n</code></pre> </p>"},{"location":"cloud/k8s/ckad/ckad-6/#3headless","title":"\uff083\uff09Headless\u7c7b","text":"<p>Danger</p> <p>The term \"headless\" implies that the service does not have a \"head\" or a centralized virtual IP address (ClusterIP). -&gt; Instead, it directly exposes the backend pod IPs to clients.</p> <p>TODO\uff1aHeadless\u7c7b Service \u662f\u5982\u4f55expose Pod\u7684\uff1f</p> <p>\u5f53\u6211\u4eec\u60f3\u8981\u8bbf\u95ee\u6307\u5b9a\u7684Pod\u65f6\uff0c\u4f8b\u5982 StatefulSet \u5e94\u7528\uff08\u5982\u6570\u636e\u5e93\uff09\u3002\u53ea\u8981\u5c06<code>.spec.clusterIP</code>\u8bbe\u7f6e\u4e3a<code>None</code>\u5373\u53ef\uff1a</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: headless-service\n  namespace: default\nspec:\n  clusterIP: None  # Specifies headless\n  selector:\n    app: cassandra\n  ports:\n    - port: 9042  # Cassandra default port\n      name: cql\n</code></pre> <p>Info</p> <p>\u5927\u591a\u6570Stateful \u7684\u5e94\u7528\uff08\u6bd4\u5982\u6570\u636e\u5e93\uff09\u6765\u8bf4\uff0c<code>Pod</code>\u7684<code>Replicas</code>\u4e4b\u95f4\u662f\u6709\u533a\u522b\u7684\u3002</p> <p>\u6bd4\u5982\u4e00\u4e2aMySQL\u7684\u5e94\u7528\u53ef\u4ee5\u5206\u4e3a<code>Master Pod</code>\u548c<code>Worker Pod</code>\uff1a</p> <ul> <li>\u53ea\u6709<code>Master Pod</code>\u53ef\u4ee5\u5411\u6570\u636e\u5e93\u5199\u5165\u6570\u636e</li> <li><code>Worker Pod</code>\u53ea\u8d1f\u8d23\u540c\u6b65\u548c\u8bfb\u53d6\u6570\u636e\u3002</li> </ul> <p>\u90a3\u4e48\u5982\u4f55\u624d\u80fd\u8bbf\u95ee\u5230\u6307\u5b9a\u7684Pod\u5462\uff1f</p> <p>the headless service (defined with <code>clusterIP: None</code>) is responsible for creating DNS records for each individual pod in a StatefulSet. In our case we have a stateful app <code>Cassandra</code>: <pre><code>apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\nname: cassandra\nnamespace: default\nspec:\nserviceName: cassandra  # Headless service name\nreplicas: 3\nselector:\n    matchLabels:\n    app: cassandra\ntemplate:\n    metadata:\n    labels:\n        app: cassandra\n    spec:\n    containers:\n        - name: cassandra\n        image: cassandra:4.0\n        ports:\n            - containerPort: 9042  # Cassandra query language (CQL) port\n        volumeMounts:\n            - name: cassandra-data\n            mountPath: /var/lib/cassandra\n        env:\n            - name: CASSANDRA_CLUSTER_NAME\n            value: \"CassandraCluster\"\n            - name: CASSANDRA_SEEDS\n            value: \"cassandra-0.cassandra.default.svc.cluster.local\"\nvolumeClaimTemplates:\n    - metadata:\n        name: cassandra-data\n    spec:\n        accessModes: [\"ReadWriteOnce\"]\n        resources:\n        requests:\n            storage: 5Gi\n</code></pre></p> <p>the Service auto-generated these <code>DNS</code> for each pods: <pre><code>cassandra-0.cassandra.default.svc.cluster.local\ncassandra-1.cassandra.default.svc.cluster.local\ncassandra-2.cassandra.default.svc.cluster.local\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-6/#4loadbalancer","title":"\uff084\uff09LoadBalancer\u7c7b","text":"<p>Danger</p> <p>The name \"LoadBalancer\" signifies that this service type integrates with an external load balancer to distribute incoming traffic across the pods</p> <p><code>LoadBalancer</code>\u7c7bService = <code>NodePort</code>\u7c7bService + \u53d1\u9001\u4e00\u4e2a \u6dfb\u52a0\u8d1f\u8f7d\u5747\u8861\u5668\uff08Load Balancer\uff09 \u7684\u8bf7\u6c42</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: loadbalancer-service\n  namespace: default\nspec:\n  type: LoadBalancer\n  selector:\n    app: my-app\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 8080\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-6/#service_1","title":"\u521b\u5efa\u670d\u52a1\uff08<code>Service</code>\uff09","text":"<pre><code># \u65b9\u6cd5\u4e00\uff1a\u7528yaml\u6587\u4ef6\u5b9a\u4e49\nk create -f my_service.yaml\n\n# \u65b9\u6cd5\u4e8c\uff1a\u751f\u6210service\n# - port:TargetPort=8080:8080\n# - \u9700\u8981\u624b\u52a8\u5f80YAML\u4e2d\u4fee\u6539`.spec.selector`\n# - \u81ea\u52a8\u751f\u6210\u4e86`.spec.ports.name`\nk create service nodeport [ServiceName] \\\n    --tcp=8080:8080 \\\n    --dry-run=client \\\n    -o yaml &gt; service.yaml\n\n# \u65b9\u6cd5\u4e09\uff1a\u66b4\u9732deployment\uff08\u4ee5\u751f\u6210service\uff09\n# - \u9700\u8981\u624b\u52a8\u5f80YAML\u4e2d\u6dfb\u52a0`.metadata.labels`\nk expose deployment/[DeploymentName] \\\n    --name=[ServiceName] \\\n    --port=8080 \\\n    --target-port=8080 \\\n    --type=NodePort \\\n    --dry-run=client -o yaml &gt; service.yaml\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-6/#2-ingress","title":"2. Ingress","text":""},{"location":"cloud/k8s/ckad/ckad-6/#_2","title":"\u80cc\u666f","text":"<p>\ud83e\udd14 \u5f53App\u5728\u672c\u5730\u670d\u52a1\u5668\u4e0a\u65f6\uff0c\u5982\u4f55\u5b9e\u73b0\u7528\u57df\u540d <code>http://www.my-shop.com</code>\u8bbf\u95ee\u5230<code>192.168.1.2:30008</code> \u5462\uff1f</p> <ul> <li>-&gt; NodePort\u7c7b\u7684Service\u66b4\u9732 Node\u7aef\u53e3 30080</li> <li>-&gt; 192.168.1.2:30008 </li> <li>-&gt; \u914d\u7f6eDNS\u670d\u52a1\u5668</li> <li>-&gt; http://www.my-shop.com:30080 </li> <li>-&gt; \u6dfb\u52a0\u4ee3\u7406\u670d\u52a1\u5668 / Proxy Server</li> <li>-&gt; http://www.my-shop.com </li> <li>-&gt; Done!</li> </ul> <p>\ud83e\udd14 \u5f53App\u5728\u4e91\u670d\u52a1\u5668\u4e0a\u65f6\uff08\u6bd4\u5982Google Cloud Platform\uff09\uff0c\u5982\u4f55\u5b9e\u73b0\u5462\uff1f</p> <ul> <li>-&gt; <code>LoadBalancer</code>\u7c7b\u7684Service\uff0c\u4e0d\u4ec5\u62e5\u6709<code>NodePort</code>\u7c7b\u7684\u529f\u80fd\uff0c\u8fd8\u5411\u4e91\u670d\u52a1\u5668\u53d1\u9001\u4e86\u4e00\u4e2a \u6dfb\u52a0\u8d1f\u8f7d\u5747\u8861\u5668(<code>LoadBalancer</code>) \u7684\u8bf7\u6c42</li> <li>-&gt; \u4e91\u670d\u52a1\u5668\u81ea\u52a8\u914d\u7f6e\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668\uff08\u26a0\ufe0f \u8d1f\u8f7d\u5747\u8861\u5668 \u7684\u4ef7\u683c\u662f\u6309\u201c\u4e2a\u201d\u8ba1\u7b97\u7684\uff01\uff09</li> <li>-&gt; \u8be5\u8d1f\u8f7d\u5747\u8861\u5668\u4f1a\u53d1\u5e03\u4e00\u4e2a\u53ef\u4f9b\u5916\u90e8\u8bbf\u95ee\u7684IP\uff08\u6211\u4eec\u53eb\u4ed6<code>LoadBalancerIP</code>\uff09</li> <li>-&gt; \u914d\u7f6eDNS\u670d\u52a1\u5668\uff0c\u6307\u5411<code>LoadBalancerIP</code></li> <li>-&gt; <code>http://www.my-shop.com</code></li> </ul> <p>\u26a0\ufe0f\u8d1f\u8f7d\u5747\u8861\u5668 \u53ef\u5d4c\u5957\uff0c\u6bd4\u5982\u5bf9\u4e00\u4e2a\u4e3b\u57df\u540d\u4e0b\u7684\u5b50\u57df\u540d\u8fdb\u884c\u914d\u7f6e\uff1a</p> <p></p> <p>\u8fd9\u4e9b\u6b65\u9aa4\u90fd\u5b8c\u6210\u4ee5\u540e\uff0c\u914d\u7f6e<code>SSL</code>\u4ee5\u4f7f\u7528<code>https</code>\uff08\u800c\u4e0d\u662f<code>http</code>\uff09\u3002\u5bf9<code>SSL</code>\u7684\u914d\u7f6e\u53ef\u4ee5\u5728\u591a\u4e2a\u4f4d\u7f6e\u5b9e\u73b0\uff1a</p> <ul> <li>App\u672c\u8eab\u5c42\u9762</li> <li>\u8d1f\u8f7d\u5747\u8861\u5668\u5c42\u9762</li> <li>\u4ee3\u7406\u670d\u52a1\u5668\u5c42\u9762</li> </ul> <p>\u4e0a\u8ff0\u4e09\u79cd\u914d\u7f6e\u65b9\u6cd5\uff0c\u5747\u53ef\u5b9e\u73b0\u540c\u6837\u7684\u529f\u80fd\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-6/#ingress","title":"\u6551\u661fIngress","text":"<p>\u5404\u79cd\u5404\u6837\u7684\u914d\u7f6e\uff0c\u4f60\u7684\u5934\u73b0\u5728\u591a\u5927\u4e86\u5462\uff1fIngress\u5c31\u662f\u7528\u6765\u5e2e\u5fd9\u89e3\u51b3\u8fd9\u4e2a\u4ee4\u4eba\u5934\u75bc\u7684\u95ee\u9898\u7684\uff01\u5b83\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u8def\u7531\uff08\u5305\u62ec\u5f15\u6d41\u5230\u4e0d\u540cApp\uff0c\u6bd4\u5982<code>/shopping</code> \u548c<code>/game</code>\uff09\u548c<code>SSL</code>\u914d\u7f6e\u3002</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-6/#ingress_1","title":"Ingress\u7ec4\u6210","text":"<p>\u628aIngress\u5206\u4e3a\u4e24\u4e2a\u7ec4\u4ef6\uff1aIngress Controller\u548cIngress Resource\u3002\u4e00\u822c\u4e24\u8005\u5206\u522b\u5728\u4e0d\u540c\u7684namespace\u4e2d\uff0c\u7279\u522b\u662fIngress Controller\uff0c\u505a\u4e3a\u4e0e\u5e94\u7528\u65e0\u5173\u7684\u8d44\u6e90\uff0c\u5e94\u8be5\u88ab\u653e\u5230\u5355\u72ec\u7684Namespace\u4e2d\uff01</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-6/#1-ingress-controller","title":"(1) Ingress Controller","text":"<p>Ingress\u63a7\u5236\u5668\u7531\u56db\u4e2a\u8d44\u6e90\u7ec4\u6210\uff1a</p> <ol> <li>\u8d1f\u8f7d\u5747\u8861\u5668\uff08\u4ee5Deployment\u7684\u5f62\u5f0f\u5b58\u5728\uff09</li> <li>ConfigMap</li> <li>NodePort\u7c7b\u7684\u670d\u52a1</li> <li>ServiceAccount</li> </ol>"},{"location":"cloud/k8s/ckad/ckad-6/#1","title":"1.\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u5668","text":"<p>\u4ee5\u4e00\u4e2a\u5355\u72ec\u8f6f\u4ef6\u7684\u5f62\u5f0fdeploy\u5230\u5f53\u524d\u7684cluster\u4e0a\u3002\u8f83\u4e3a\u6d41\u884c\u7684\u6709<code>GCE HTTPS LoadBalancer\uff08\u8c37\u6b4c\uff09</code>\uff0c<code>Nginx</code>\uff0c<code>Contour</code>\uff0c<code>HaProxy</code>\uff0c<code>taefik</code>\u548c<code>Istio</code>\u3002\u5176\u4e2d<code>GCE HTTPS LoadBalancer\uff08\u8c37\u6b4c\u7684\uff09</code>\u548c<code>Nginx</code>\u7531Kubernetes\u7ba1\u7406\u3002</p> <p>\u6211\u4eec\u8fd9\u91cc\u4ee5<code>Nginx</code>\u4e3a\u4f8b\uff1a\u547d\u540d\u8be5Deployment\u4e3a<code>nginx-ingree-controller</code> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n    name: nginx-ingree-controller\nspec:\n    replicas: 1\n    selector:\n        matchLabels:\n            name: nginx-ingress\n    template:\n        metadata:\n            labels:\n                name: nginx-ingress\n        spec:\n            containers:\n                - name: nginx-ingress-controller\n                  image: quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.21.0\n            args:\n                - /nginx-ingress-controller     # nginx\u7a0b\u5e8f\u5b58\u50a8\u5728\u8be5\u6587\u4ef6\u5939\u4e0b\uff0c\u6240\u4ee5\u8981\u5728\u8fd0\u884c\u65f6\u8fdb\u5165\u6587\u4ef6\u5939\n                - --configmap=${POD_NAMESPACE}/nginx-configuration  # \u4f7f\u7528CM\u5b58nginx\u8bbe\u7f6e\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5199\u5728\u5f53\u524d\u7684Deployment\u91cc\u9762\n            env:\n                - name: POD_NAME\n                  valueFrom:\n                    fieldRef: \n                        fieldPath: metadata.name\n                - name: POD_NAMESPACE\n                  valueFrom:\n                    fieldRef: \n                        fieldPath: metadata.namespace\n            ports:\n                - name: http\n                  containerPort: 80\n                - name: https\n                  containerPort: 443\n</code></pre></p> <p>Note</p> <p>\u6240\u4f7f\u7528\u7684\u955c\u50cf\u662f\u4e00\u4e2a\u4e13\u95e8\u7528\u6765\u505aIngress\u7684nginx\u955c\u50cf\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u627e\u5230\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-6/#2configmap","title":"2.\u4e00\u4e2aConfigMap","text":"<p>\u8fd9\u91cc\u547d\u540d\u4e3a<code>nginx-configuration</code>\uff0c\u8be5ConfigMap\u88ab1\u4e2d\u7684Deployment\u4f7f\u7528\uff0c\u7528\u6765\u5b58\u50a8\u548c\u4fee\u6539<code>nginx</code>\u914d\u7f6e\uff0c\u6bd4\u5982\u5b58\u50a8\u65e5\u5fd7\u7684\u8def\u5f84\uff0cSSL \u8bbe\u7f6e\uff0c\u6700\u957f\u7b49\u5f85\u65f6\u95f4\u7b49\u3002 <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata: \n    name: nginx-configuration\n...\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-6/#3nodeportservice","title":"3.\u4e00\u4e2aNodePort\u7c7b\u578b\u7684Service","text":"<p>\u4f7fDeployment <code>nginx-ingree-controller</code>\u53ef\u4f9b\u5916\u90e8\u8bbf\u95ee <pre><code>apiVersion: v1\nkind:  Service\nmetadata: \n    name: nginx-ingress-service\nspec:\n    type: NodePort\n    ports:\n        - port: 80\n          targetPort: 80\n          protocol: TCP\n          name: http\n        - port: 443\n          targetPort: 443\n          protocol: TCP\n          name: https\n    selectors:\n        # \u5bf9\u5e94Deployment\u7684Label\n        name: nginx-ingress\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-6/#4serviceaccount","title":"4.\u4e00\u4e2aServiceAccount","text":"<p><code>nginx</code> Ingress\u8fd8\u63d0\u4f9b\u4e86\u989d\u5916\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u76d1\u63a7\u4ece\u96c6\u7fa4\u5916\u90e8\u6765\u7684\u8bbf\u95ee\uff0c\u5e76\u5b9e\u65f6\u4fee\u6539nginx\u914d\u7f6e\u3002\u8be5\u64cd\u4f5c\u9700\u8981\u6b63\u786e\u7684\u6743\u9650\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4e00\u4e2aServiceAccount\uff0c\u5e76\u5728Deployment\u4e2d\u4f7f\u7528\u8be5SA <pre><code>apiVersion: v1\nkind:  ServiceAccount\nmetadata: \n    name: nginx-ingress-serviceaccount\n# Roles, ClusterRoles, RoleBindings...\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-6/#2-ingress-resource","title":"(2) Ingress Resource","text":"<p>Ingress Resource\u662f\u5e94\u7528\u4e8eIngress Controller\u7684\u4e00\u7ec4\u89c4\u5219\u548c\u914d\u7f6e\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u5bf9<code>www.my-shop.com/shopping</code>\u7684\u8bbf\u95ee\u6d41\u5165\u5230<code>Shopping App</code>\u5e94\u7528\u4e2d\uff0c\u800c\u5bf9<code>www.my-shop.com/game</code>\u7684\u8bbf\u95ee\u6d41\u5165\u5230<code>Game App</code>\u5e94\u7528\u4e2d</li> <li>\u6216\u8005\u76f4\u63a5\u4ecedomain\u5c31\u5f00\u59cb\u533a\u5206\uff0c\u6bd4\u5982\u5e38\u89c1\u7684\u5730\u57df\u533a\u5206\uff1a<code>www.apple.cn</code>\u548c<code>www.apple.de</code></li> </ul> <p>\u6211\u4eec\u7528yaml\u6587\u4ef6\u5b9a\u4e49\u4e00\u4e2aIngress Resource\u3002\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u4f1a\u5c06\u6240\u6709\u8bbf\u95ee\u90fd\u5bfc\u5165\u5230\u540d\u4e3a<code>shopping-service</code>\u7684Service\u4e2d\u53bb <pre><code># ingress_resource.yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress # \u6ce8\u610f\u662fIngress\u7c7b\u578b\nmetadata:\n    name: ingress-rule\nspec: \n    backend:\n        serviceName: shopping-service\n        servicePort: 80\n</code></pre></p> <p>\u751f\u6210Ingress Resource\uff1a <pre><code>kubectl create -f ingress_rule.yaml\n</code></pre> \u67e5\u770b\u751f\u6210\u7684Ingress Resource\uff1a <pre><code>kubectl get ingress\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-6/#backend","title":"\u8bbe\u7f6e\u9ed8\u8ba4backend","text":"<p><code>k describe ingress/ingress-rule</code> \u53ef\u4ee5\u770b\u5230\u4e00\u4e2a<code>Default backend</code>\u3002\u8fd9\u4e2a\u540d\u4e3a<code>default-http-backend</code>\u7684\u670d\u52a1\u662f\u5f53\u7528\u6237\u8f93\u5165\u7684DNS\u5730\u5740\uff08\u5373\u7f51\u5740\uff09\u548c\u89c4\u5219\u4e2d\u4efb\u610f\u4e00\u6761\u90fd\u4e0d\u76f8\u7b26\u7684\u65f6\u5019\u4f1a\u88ab\u8bbf\u95ee\uff01\u6240\u4ee5\u53ef\u4ee5\u624b\u52a8\u5efa\u4e00\u4e2a\u8fd9\u4e2a\u540d\u5b57\u7684\u670d\u52a1\uff0c\u7136\u540e\u8bbf\u95ee\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\uff0c\u66f4\u52a0\u53cb\u597d\u7684404\u9875\u9762 </p> <p>\u8fd9\u65f6\u67e5\u770bYaml\u6587\u4ef6\uff0c\u8be5ingress\u5927\u6982\u957f\u8fd9\u6837\uff1a <pre><code>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: ingress-resource-backend\nspec:\n  defaultBackend:   # \u9ed8\u8ba4\u670d\u52a1\n    resource:\n      apiGroup: k8s.example.com\n      kind: StorageBucket\n      name: static-assets\n  rules:                    # \u89c4\u5219\n    ...\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-6/#rewrite-target","title":"rewrite-target","text":"<pre><code>annotations:\n    # the `/` is the path that replaces the original path\n    nginx.ingress.kubernetes.io/rewrite-target: /\n</code></pre> <p>\u4e3e\u4f8b</p> <pre><code>\u5f53\u67d0\u4e2aIngress\u63d0\u4f9b\u5bf9\u591a\u4e2a\u5e94\u7528\u7684\u8bbf\u95ee\uff0c\u6bd4\u5982\uff1a\n\n- `/frontend` -&gt; `frontend-service` -&gt; `frontend-react-app`\n- `/dashboard` -&gt; `dashboard-service` -&gt; `dashboard-power-bi-app`\n\n`http://example.com/frontend/home`\u4f1a\u88ab\u91cd\u65b0\u6210`http://example.com/home`\u3002\n\n\u800c`frontend-react-app`\u8f6f\u4ef6\u672c\u8eab\u63d0\u4f9b\u7684\u9875\u9762\u662f\u6ca1\u6709\u5b50\u57df\u540d\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u5728\u672c\u5730\u8dd1react\u8f6f\u4ef6\uff0c\u80fd\u8bbf\u95ee\u5230\u7684\u9875\u9762\u662f`localhost:3000`\u800c\u4e0d\u662f`localhost:3000/frontend`\uff0c\u6240\u4ee5\u9700\u8981\u201crewrite\u201d\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-6/#ingress_2","title":"Ingress\u89c4\u5219","text":"<p>\u4f8b1\uff1a\u540c\u4e00\u4e2a\u57df\u540d\uff0c\u4e0d\u540c\u5b50\u8def\u5f84</p> <p>\u5047\u8bbe\u6211\u4eec\u60f3\u8981\u5b9e\u73b0\u4e00\u4e2a\u5206\u6d41\uff0c\u6240\u6709\u8bbf\u95ee<code>www.my-shop.com/shopping</code>\u90fd\u5c06\u8bbf\u95ee\u5bfc\u5165\u5230\u540d\u4e3a<code>shopping-service</code>\u7684Service\uff0c\u5f53\u4e2a\u7528\u6237\u8bbf\u95ee<code>www.my-shop.com/game</code>\u65f6\uff0c\u8bbf\u95ee\u53e6\u4e00\u4e2a\u540d\u4e3a<code>game-service</code>\u7684Service\u3002\u6211\u4eec\u53ef\u4ee5\u5728Ingress Resource\u7684yaml\u6587\u4ef6\u4e2d\u5199\u89c4\u5219\uff08rule\uff09\uff0c\u4e3e\u4f8b\uff1a <pre><code># my_ingress_with_path.yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n    name: ingress-rule\nspec: \n    rules:\n    # \u8fd9\u91cchost\u662f\u53ef\u9009\u7684\uff0c\u5982\u4e0d\u6307\u5b9a\uff0c\u5219\u8be5\u89c4\u5219\u9002\u7528\u4e8e\u901a\u8fc7\u6307\u5b9a IP \u5730\u5740\u7684\u6240\u6709\u5165\u7ad9 HTTP \u901a\u4fe1\n    - host: www.my-shop.com\n      http:\n        paths:\n        - path: /shopping\n        pathType: Prefix\n        backend:\n            service:\n                name: shopping-service\n                port: \n                    number: 80\n        - path: /game\n        pathType: Prefix\n        backend:\n            service:\n                name: game-service\n                port: \n                    number: 80\n</code></pre> \u6b64\u5916\uff0c\u4e5f\u53ef\u4ee5\u7528<code>k</code>\u547d\u4ee4\u76f4\u63a5\u751f\u6210Ingress\uff1a <pre><code>kubectl create ingress ingress-rule \\\n    --rule=\"www.my-shop.com/shopping*=shopping-service:80\" \\\n    --rule=\"www.my-shop.com/game*=game-service:80\"\n</code></pre></p> <p>\u4f8b1\uff1a\u4e0d\u540c\u57df\u540d</p> <pre><code># my_ingress_with_host.yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n    name: ingress-rule\nspec: \n    rules:\n      - host: www.my-shop.cn\n        http:\n            paths:\n            backend:\n                serviceName: my-shop-cn\n                servicePort: 80\n      - host: www.my-shop.de\n        http:\n            paths:\n            backend:\n                serviceName: my-shop-de\n                servicePort: 80\n</code></pre> <p>Warning</p> <p>Ingress\u9ed8\u8ba4\u53ea\u8bbf\u95ee\u5f53\u524dNamespace\u4e2d\u7684\u670d\u52a1\uff0c\u4f46\u4e5f\u53ef\u4ee5\u6709\u4f8b\u5916\uff1a</p> <p>Alternatively there is way to achieve ingress in one namespace and service in another namespace via externalName.Checkout Kubernetes Cross Namespace Ingress Network\uff1a <pre><code>kind: Service\napiVersion: v1\nmetadata:\n    name: test-service-1\n    namespace: namespace-a\nspec:\n    type: ExternalName\n    externalName: test-service-2.namespace-b.svc.cluster.local\n    ports:\n    - port: 80\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-6/#bug-debug","title":"Bug &amp; Debug","text":"<p>\u5f88\u591a\u65f6\u5019Ingress\u51fa\u95ee\u9898\u662f\u56e0\u4e3a\u5b83\u7684annotations\u4e2d\u7f3a\u5c11\u4e86\u4e00\u4e9b\u4e1c\u897f\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b\u5b83\u6240\u6307\u5411\u7684Pod\u7684log\uff0c\u6216\u8005ingress controller\u7684log\u67e5\u770b\u5177\u4f53\u95ee\u9898\u51fa\u5728\u54ea\u513f\uff1a <pre><code># \u67e5\u770bIngress\u6240\u6307\u5411\u7684\u67d0\u4e2aApp \u7684 log\nk logs webapp-wear-658fc8dbb4-4m6gs -n app-space \n\n# \u67e5\u770bIngress controller \u7684 log\nk logs ingress-nginx-controller-ffc6b494b-b7vms -n ingress-nginx \n</code></pre></p> <p>\u5e38\u89c1\u95ee\u9898\uff1a</p> <p>503 Service Temporarily Unavailable</p> <pre><code>`pathType: Exact` which should be `pathType: Prefix`\n</code></pre> <p>301 too many redirect</p> <pre><code>missing this:\n\n```yaml\nmetadata:\n    annotations:\n    nginx.ingress.kubernetes.io/ssl-redirect: \"false\"\n```\n\nBy default the controller redirects (301) to HTTPS if TLS is enabled for that Ingress. If you want to disable that behavior, you can use the nginx.ingress.kubernetes.io/ssl-redirect: \"false\" annotation.\n\nAnd in the lab, we manage the HTTPS from our side, not from the ingress. So, you should add annotation nginx.ingress.kubernetes.io/ssl-redirect: \"false\"\n</code></pre> <p>svc didnt reach the correct one</p> <pre><code>missing this\n```yaml\nmetadata:\n    annotations:\n        nginx.ingress.kubernetes.io/rewrite-target: /\n```\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-6/#3-networkpolicy","title":"3. NetworkPolicy","text":"<p>NetworkPolicy\uff08<code>netpol</code>\uff09 \u662f Kubernetes \u4e2d\u7528\u4e8e\u63a7\u5236 Pod \u7f51\u7edc\u6d41\u91cf\u7684\u89c4\u5219\u3002\u901a\u8fc7 Network Policies\uff0c\u53ef\u4ee5\u5b9a\u4e49\u54ea\u4e9b\u6d41\u91cf\uff08\u5165\u7ad9\u548c/\u6216\u51fa\u7ad9\uff09\u53ef\u4ee5\u5230\u8fbe Pod \u6216\u4ece Pod \u53d1\u51fa\u3002</p> <p>\u7406\u8bba</p> <ul> <li>\u6982\u5ff5\uff1a ingress\u548cegress\u90fd\u662f \u76f8\u5bf9 \u7684\u6982\u5ff5\uff0c\u6536\u5230\u7684\u8bf7\u6c42\u53ebingress\uff0c\u53d1\u51fa\u7684\u53ebegress</li> <li>\u80cc\u666f\uff1a \u7406\u8bba\u4e0a\u4e00\u4e2acluster\u4e0a\u6240\u6709\u7684<code>Pod</code>\u4e4b\u95f4\u90fd\u80fd\u901a\u8fc7<code>Service</code>\u4e92\u76f8\u6c9f\u901a\uff0c\u4f46\u5982\u56fe\uff0c\u6211\u4eec\u53ef\u80fd\u4e0d\u9700\u8981\u4e5f\u4e0d\u60f3\u8981 Frontend \u548c Database \u4e4b\u95f4\u76f4\u63a5\u8fdb\u884c\u6c9f\u901a\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 Network Policies \u5bf9\u67d0\u4e2a<code>Pod</code>\u7684traffic\u8bbe\u9650</li> <li>Network Policies\uff1a\u901a\u8fc7<code>label</code>\u548c<code>selectors</code>\u5c06 Network Policies \u8fde\u63a5\u5230<code>Pod</code>\u4e0a\u53bb</li> </ul> <p>NetworkPolicy\u4e3e\u4f8b\uff1aYAML\u4e2d\u7684<code>.spec.podSelector.matchLabels.name</code>\u6307\u5b9a\u4e86 \u76ee\u6807 Pod \u6807\u7b7e\u3002 <pre><code># policy-definition.yaml\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n    name: db-policy\n    namespace: prod\nspec:\n    podSelector:\n        matchLabels:\n            role: db        # \u8bf4\u660e\u6b64NetPol\u7528\u5728\u6709\u201crole: db\u201d\u6807\u7b7e\u7684pod\u4e0a\n    policyTypes:            \n        - Ingress           # \u8fd9\u91cc\u5199\u660e\u4e86\u89c4\u5219\u662f\u9650\u5236\u4e86Ingress\u8fd8\u662fEgress\u8fd8\u662f\u4e24\u8005\u90fd\uff0c\u8fd9\u91cc\u4e24\u4e2a\u90fd\u9650\u5236\u4e86\n        - Egress\n    ingress:                # \u5bf9ingress\u7684\u89c4\u5219\uff1a\n        - from:\n            - podSelector:              # \u5143\u7d201\n                matchLabels:\n                    role: api-pod\n              namespaceSelector:        # \u53ef\u9009\u9879\u76ee\uff1a\u5982\u679capi-pod\u4e0d\u5728\u5f53\u524d\u7684namespace\uff0c\u5219\u9700\u8981\u6ce8\u660eselector\n                matchlabels:\n                    name: staging\n            - ipBlock:                  # \u5143\u7d202\uff1a\u4e0e\u5143\u7d201\u4e4b\u524d\u662f\u201c\u6216\u201d\u7684\u5173\u7cfb\n                cidr: 192.168.5.12/32\n          ports:\n          - protocol: TCP\n            port: 3306\n    egress:                 # \u5bf9egress\u7684\u89c4\u5219\uff1a\n        - to:\n          - ipBlock:\n                cidr: 192.168.5.12/32\n          ports:\n          - protocol: TCP\n            port: 80\n</code></pre></p> <p>Note</p> <p><code>.spec.podSelector: {}</code> \u610f\u601d\u662f\u8be5\u89c4\u5219\u5e94\u7528\u5230\u5f53\u524d namespace \u6240\u6709 Pod \u4e0a</p> <p>Note</p> <p>\u65e0\u8bba\u662f ingress \u8fd8\u662f egress\u7684\u89c4\u5219\uff0c\u90fd\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a</p> <ol> <li><code>ingress.from</code>\u89c4\u5b9a\u4e86\u901a\u4fe1\u7684\u6765\u6e90 \uff08<code>egress.to</code> \u89c4\u5b9a\u4e86\u901a\u4fe1\u7684\u76ee\u7684\u5730\uff09</li> <li><code>ports</code>\u89c4\u5b9a\u4e86\u4f7f\u7528\u5f53\u524dPod\u7684\u54ea\u4e2a\u7aef\u53e3\u8fdb\u884c\u901a\u4fe1\u3002</li> </ol> <p>\u26a0\ufe0f \u5982\u679c\u53ea\u6709<code>namespaceSelector</code>\uff0c\u6ca1\u6709<code>podSelector</code>\uff0c\u5219\u8868\u793a\u8be5\u89c4\u5219\u9002\u7528\u4e8e\u67d0namespace\u4e0a\u7684\u6240\u6709Pod  \u26a0\ufe0f <code>ipBlock</code>\uff1a\u5047\u8bbe\u89c4\u5219\u60f3\u8981\u5e94\u7528\u5230\u67d0\u4e2a\u4e0d\u5728\u5f53\u524d<code>Cluster</code> \u4e0a\u7684App\uff0c\u5219\u53ef\u4f7f\u7528\u5b83</p> <p><code>cidr</code></p> <p>CIDR\uff08Classless Inter-Domain Routing\uff09\u8868\u793a\u6cd5\u7528\u4e8e\u5b9a\u4e49 IP \u5730\u5740\u8303\u56f4\uff0c\u683c\u5f0f\u4e3a\uff1a</p> <pre><code>&lt;IP\u5730\u5740&gt;/&lt;\u524d\u7f00\u957f\u5ea6&gt;\n</code></pre> <p>\u4e3e\u4f8b\uff1a</p> <ul> <li><code>192.168.5.12/32</code>\uff1a\u8868\u793a \u5355\u4e2a IP \u5730\u5740\uff08<code>192.168.5.12</code>\uff09\uff0c\u56e0\u4e3a /32 \u8868\u793a\u7f51\u7edc\u63a9\u7801 <code>255.255.255.255</code>\uff0c\u5373\u4ec5\u5339\u914d\u8fd9\u4e00\u4e2a IP\u3002</li> <li><code>192.168.5.0/24</code>\uff1a\u8868\u793a <code>192.168.5.0</code> \u5230 <code>192.168.5.255</code> \u7684\u6240\u6709 IP\u3002</li> <li><code>10.0.0.0/8</code>\uff1a\u8868\u793a <code>10.0.0.0</code> \u5230 <code>10.255.255.255</code> \u7684\u6240\u6709 IP\u3002</li> </ul> <p>\u521b\u5efaNetwork Policies\uff1a</p> <pre><code>kubectl create -f policy-definition.yaml\n</code></pre> <p>AND vs OR</p> <p><code>from</code>\u4e2d\u5305\u542b\u7684\u5185\u5bb9\u662f\u5426\u4f5c\u4e3a\u6570\u7ec4\u7684\u5143\u7d20\u5b58\u5728\u5f88\u91cd\u8981\uff01\u5982\u4e0b\uff1a</p> As combined item As separated items in list For example, <code>namespaceSelector</code> AND <code>podSelector</code> For example, <code>namespaceSelector</code> OR <code>podSelector</code> <p>more than one <code>netpol</code></p> <p>If a pod is matched by selectors in one or more <code>netpol</code>s, then the pod accepts only connections that at least one of those <code>netpol</code> allows.</p> <p>Warning</p> <p>If a pod does not match any <code>netpol</code>, then OpenShift does NOT restrict traffic to that pod.</p> <p>Where does <code>netpol</code> apply?</p> <p>Network policies control only internal traffic from pods that do not use host networking.</p> <p>\u7f51\u7edc\u7b56\u7565\u53ea\u9002\u7528\u4e8e \u4f7f\u7528 Kubernetes \u865a\u62df\u7f51\u7edc\u7684 Pod \u7684\u5185\u90e8\u6d41\u91cf\uff0c\u5373 Pod \u4e4b\u95f4\u901a\u8fc7\u96c6\u7fa4\u7f51\u7edc\u901a\u4fe1\u7684\u6d41\u91cf\u3002\u5bf9\u4e8e\u90a3\u4e9b\u914d\u7f6e\u4e86 \u4e3b\u673a\u7f51\u7edc\uff08host networking\uff09 \u7684 Pod\uff0c\u7531\u4e8e\u5b83\u4eec\u76f4\u63a5\u4f7f\u7528\u4e3b\u673a\u7684\u7f51\u7edc\u6808\uff0c\u56e0\u6b64\u7f51\u7edc\u7b56\u7565\u5bf9\u5b83\u4eec\u7684\u6d41\u91cf \u4e0d\u8d77\u4f5c\u7528:</p> <ul> <li>Internal Traffic\uff08\u5185\u90e8\u6d41\u91cf\uff09\uff1a\u6307 Pod \u4e4b\u95f4\u901a\u8fc7 Kubernetes \u865a\u62df\u7f51\u7edc\u8fdb\u884c\u7684\u901a\u4fe1\u3002Pod A \u901a\u8fc7\u670d\u52a1\uff08Service\uff09\u8bbf\u95ee Pod B\uff0c\u4f8b\u5982 <code>backend-service.default.svc.cluster.local</code>\u3002</li> <li>Host Networking\uff08\u4e3b\u673a\u7f51\u7edc\uff09\uff1a\u6307 Pod \u4e0d\u518d\u6709\u4e00\u4e2a\u72ec\u7acb\u7684 Pod IP\uff0c\u800c\u662f\u4f1a\u76f4\u63a5\u4f7f\u7528 Node \u7684 IP\u3002\u4e0d\u518d\u4f7f\u7528 Kubernetes \u5206\u914d\u7ed9Pod\u7684\u865a\u62df\u7f51\u7edc\uff0c\u6b64\u65f6\u7f51\u7edc\u7b56\u7565\u5bf9\u6d41\u91cf\u65e0\u6548\u3002\u5373\uff0c\u5982\u679c Pod \u914d\u7f6e\u4e86 <code>hostNetwork: true</code>\uff1a     <pre><code>\n    apiVersion: v1\n    kind: Pod\n    metadata:\n        name: host-network-example\n        namespace: default\n    spec:\n        hostNetwork: true\n        containers:\n        - name: nginx\n            image: nginx:latest\n            ports:\n            - containerPort: 80\n    </code>"},{"location":"cloud/k8s/ckad/ckad-6/#4-labels-selectors","title":"4. \u6807\u7b7e&amp;\u9009\u62e9\u5668\uff08Labels &amp; Selectors\uff09","text":"<p>k8s\u4e2d\u5927\u91cf\u5730\u4f7f\u7528\u4e86\u6807\u7b7e&amp;\u9009\u62e9\u5668\u3002\u6bd4\u5982\uff1aService\u901a\u8fc7\u9009\u62e9\u5668\uff08selector\uff09\u627e\u5230\u62e5\u6709\u6b63\u786e\u6807\u7b7e\uff08labels\uff09\u7684Pod\u3002\n<pre><code>selector:\n    app: myapp\n    tier: frontend\n</code></pre></p>\n\n<p>Warning</p>\n<p>Pod\u8981\u6ee1\u8db3<code>selector</code>\u4e2d\u6240\u6709\u7684\u6807\u7b7e\u624d\u53ef\u4ee5\uff01<code>app==myapp</code> \u548c <code>tier=frontend</code>\u4e24\u4e2a\u6807\u7b7e\u90fd\u8981\u6709\u3002\u4e0b\u9762\u8fd9\u4e2aPod\u5c31\u4e0d\u6ee1\u8db3\u6761\u4ef6\uff1a</p>\n<pre><code>kind: Pod\nmetadata:\n    name: myPod\n    labels:\n        tier: frontend\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-6/#kubectl","title":"&gt;&gt;&gt;  \u672c\u7ae0kubectl\u547d\u4ee4\u6574\u7406","text":"<p>IP</p>\n<ul>\n<li><code>curl ifconfig.me</code> \u67e5\u770b\u5916\u90e8IP</li>\n<li><code>ipconfig getifaddr en0</code> \u67e5\u770b\u5185\u90e8IP</li>\n</ul>\n<p>\u670d\u52a1\uff08<code>Service</code>\uff09</p>\n<ul>\n<li><code>k get service</code></li>\n<li><code>k create service nodeport [ServiceName] --tcp=8080:8080</code></li>\n<li><code>k expose deployment/[DeploymentName] \\\n    --name=[ServiceName] \\\n    --port=8080 \\\n    --target-port=8080 \\\n    --type=NodePort</code></li>\n</ul>\n<p>Ingress</p>\n<ul>\n<li><code>k get ingress</code></li>\n<li><code>k describe ingress/ingress-rule</code></li>\n<li><code>k create ingress ingress-rule \\\n        --rule=\"www.my-shop.com/shopping*=shopping-service:80\"\n        --rule=\"www.my-shop.com/game*=game-service:80\"</code></li>\n</ul>\n<p>Network Policies</p>\n<ul>\n<li><code>k get networkpolicies</code></li>\n<li><code>k get netpol</code></li>\n</ul>"},{"location":"cloud/k8s/ckad/ckad-7/","title":"7.\u5bb9\u5668\u6570\u636e\u7684\u53ef\u6301\u4e45\u5316","text":""},{"location":"cloud/k8s/ckad/ckad-7/#1-volume","title":"1. \u5377\uff08Volume\uff09","text":"<p>Docker \u5bb9\u5668\u672c\u8d28\u4e0a\u662f \u77ac\u6001\uff08transient\uff09  \u7684\u3002 \u8fd9\u610f\u5473\u7740\u5b83\u4eec\u53ea\u80fd\u6301\u7eed\u5f88\u77ed\u7684\u65f6\u95f4\u3002\u5b83\u4eec\u5728App\u88ab\u521b\u5efa\u65f6\u88ab\u8c03\u7528\uff0c\u5bb9\u5668\u88ab\u9500\u6bc1\u65f6\uff0c\u6570\u636e\u4e0e\u5bb9\u5668\u4e00\u8d77\u88ab\u9500\u6bc1\u3002</p> <p>\u4e3a\u4e86\u4f7f\u5bb9\u5668\u7684\u6570\u636e\u6301\u4e45\u5316\uff0c\u6211\u4eec\u5c06\u5bb9\u5668\u6240\u5728\u7684 Pod \u8fde\u63a5\u5230\u5377\u3002 \u5bb9\u5668\u4e2d\u7684\u6570\u636e\u653e\u5728\u8be5\u5377\u4e2d\uff0c\u5373\u4f7f\u5bb9\u5668\u88ab\u5220\u9664\uff0c\u6570\u636e\u4f1a\u4ecd\u7136\u5b58\u5728\u3002</p> <p>\u4e0b\u9762\u7684yaml\u6587\u4ef6\u4e3aPod\u521b\u5efa\u5e76\u8fde\u63a5\u5377\uff1a</p> <ul> <li>Container\uff1a\u5176\u4e2d\u7684App\u968f\u673a\u751f\u6210\u4e00\u4e2a0-100\u4e4b\u95f4\u7684\u6570\uff0c\u5e76\u5b58\u5230\u6587\u4ef6\u5939 <code>/opt</code> \u4e2d</li> <li>Volume\uff1a\u8be5\u5377\u540d\u4e3a<code>data-volume</code>\uff0c\u5b9e\u9645\u4e0a\u662f\u5f53\u524dNode\u4e0a\u7684\u4e00\u4e2a\u6587\u4ef6\u5939<code>/data</code>\u3002\u6240\u6709\u7528\u5377<code>data-volume</code>\u5b58\u50a8\u7684\u4fe1\u606f\uff0c\u6700\u540e\u90fd\u4f1a\u88ab\u653e\u5728Node\u7684<code>/data</code>\u6587\u4ef6\u5939\u4e0b</li> </ul> <p><pre><code># pod.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: simple-webapp\nspec:\n  containers:\n  - name: simple-webapp\n    image: simple-webapp\n    command: [\"/bin/sh\", \"-c\"]\n    args: [\"shuf -i 0-100 -n 1 &gt;&gt; /opt/number.out;\"]\n\n    volumeMounts:       # (1) \u5c06\u5bb9\u5668\u6587\u4ef6\u5939`/opt`\u6302\u8f7d\u5230\u540d\u4e3adata-volume\u7684\u5377\u4e0a\n    - mountPath: /opt     # Container\u5185\u90e8\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u6587\u4ef6\u5939\u540d\n      name: data-volume   # Volume\u7684\u540d\u5b57\n\n  volumes:              # (2) \u521b\u5efa\u5377\uff1a\u8fd9\u91cc\u7533\u660e\u4e86\u4e00\u4e2a\u5728Node\u4e0a\u7684\u6587\u4ef6\u5939\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u5b58\u50a8\u65b9\u5f0f\uff0c\u6bd4\u5982\u5f15\u7528\uff08PVC\uff09\n  - name: data-volume     # Volume\u7684\u540d\u5b57\n    hostPath:\n      path: /data\n      type: Directory\n</code></pre> \u5377\u7684\u4f7f\u7528\u786e\u4fdd\u4e86Pod\u88ab\u5220\u9664\u540e\uff0c\u8be5Pod\u6240\u4ea7\u751f\u7684\u6570\u636e\u8fd8\u88ab\u4fdd\u7559\u5728\u6240\u5728\u7684Node\u4e0a\uff0c\u5982\u56fe\uff1a </p> <p>\u4e0a\u9762\u56fe\u4e2d\u7684\u7684\u6302\u8f7d\u65b9\u6cd5\u53ea\u9002\u7528\u4e8e\u5355Node\u7684\u96c6\u7fa4\u3002\u5982\u679c\u662f\u591a\u4e2aNode\uff0c\u6bcf\u4e2aNode\u4e0a\u7684\u6570\u636e\u90fd\u662f\u4e0d\u4e00\u6837\u7684\uff1a </p> <p>Volume\u7684\u7f3a\u70b9</p> <ul> <li>\u5377\u4e0ePod\u76f8\u8fde -&gt; \u6bcf\u6b21\u65b0\u5efa\u4e00\u4e2a\u9700\u8981\u5b58\u50a8\u7a7a\u95f4\u7684Pod\uff0c\u90fd\u9700\u8981\u624b\u52a8\u914d\u7f6e\u5377</li> <li>\u5377\u5b58\u5728\u4e8eNode\u670d\u52a1\u5668\u4e0a -&gt; \u5206\u5e03\u5728\u4e0d\u540cNode\u4e0a\u7684App\u65e0\u6cd5\u8bbf\u95ee\u5230\u540c\u4e00\u4e2a\u7684\u5377</li> <li>\u5377\u7684\u8fd9\u4e24\u4e2a\u7279\u6027\u5bfc\u81f4\u7ba1\u7406\u56f0\u96be\uff0c\u800c\u4e14\u4e5f\u4e0d\u5229\u4e8e\u6269\u5927\u5e94\u7528\u89c4\u6a21\uff0c\u56e0\u4e3a\u65e0\u6cd5\u652f\u6301\u591aNode\u7684\u5e94\u7528\uff0c\u800c\u6301\u4e45\u5377\u80fd\u89e3\u51b3\u8be5\u95ee\u9898</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-7/#2-persistentvolume-pv","title":"2. \u6301\u4e45\u5377\uff08PersistentVolume / PV\uff09","text":"<p>\u6211\u4eec\u60f3\u8981\u4e00\u4e2a \u66f4\u4e2d\u5fc3\u5316 \u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u5982\u6709\u67d0\u4e2a\u591aNode\u7684\u5e94\u7528\u9700\u8981\u4fee\u6539\u5b58\u50a8\u7a7a\u95f4\uff0c\u7ba1\u7406\u5458\uff08Administrator\uff09\u53ef\u4ee5\u7edf\u4e00\u5bf9\u5176\u8fdb\u884c\u7ba1\u7406\u3002\u6301\u4e45\u5377\u6c60\u53ef\u4ee5\u5e2e\u6211\u4eec\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u6301\u4e45\u5377\u662fCluster\u5c42\u7ea7\u7684\uff0c\u653e\u6ee1 \u5b58\u50a8\u5377 \u7684\u6c60\u5b50\uff08Pool\uff09\uff0c\u7531\u96c6\u7fa4\u7684\u7ba1\u7406\u5458\u8fdb\u884c\u7ba1\u7406\u548c\u914d\u7f6e\u3002\u7136\u540e\u7531Pod\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u53d1\u9001 \u5b58\u50a8\u5377\u8bf7\u6c42\uff08PersistentVolumeClaim / PVC\uff09\u3002</p> <p>\u26a0\ufe0f \u4e00\u4e2aPV\u672c\u8eab\u662f\u4e0d\u53ef\u5206\u5272\u7684\u5355\u4f4d\uff0c\u800c\u7ba1\u7406\u5458\u7ba1\u7406\u7684\u662f\u4e00\u5806\u5b58\u50a8\u5bb9\u91cf\u5927\u5c0f\u5404\u5f02\u7684PV <pre><code># \u6301\u4e45\u5377\uff08PersistentVolume\uff09\u7684\u5b9a\u4e49\n# my-pv.yaml\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-volume\nspec:\n  accessModes:          # \u53ef\u80fd\u7684mode\uff1a ReadOnlyMany, ReadWriteOnce \u548c ReadWriteMany\n    - ReadWriteOnce\n  capacity:             # \u6240\u9700\u7684\u5b58\u50a8\u7a7a\u95f4\u7684\u5927\u5c0f\n    storage: 1Gi\n  hostPath:             # \u5377\u7684\u7c7b\u578b\uff1aNode\uff08\u4e3b\u673a\uff09\u4e0a\u7684\u6587\u4ef6\u5939 - \u4e0d\u63a8\u8350\n    path: /tmp/data\n  storageClassName: \"\"  # SC\n</code></pre> \u751f\u6210\u6301\u4e45\u5377\uff1a</p> <p><pre><code>kubectl create -f my-pc.yaml\n</code></pre> \u67e5\u770b\u5df2\u6709\u7684\u6301\u4e45\u5377\uff1a <pre><code>kubectl get persistentvolume\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-7/#_1","title":"\u6301\u4e45\u5377\u7684\u7c7b\u578b","text":"<p>\u5f53\u6211\u4eec\u5728<code>pod.yaml</code>\u4e2d\u5b9a\u4e49<code>volumes</code>\u5c5e\u6027\u65f6\uff0c\u6709\u5f88\u591a\u4e0d\u540c\u9009\u62e9\u3002\u6bd4\u5982\uff1aNFS\u3001ClusterFS\u3001Flocker\u3001FibreChannel\u3001CephFS\u3001ScaleIO \u6216\u516c\u5171\u4e91\u89e3\u51b3\u65b9\u6848\uff0c\u5982AWS EBS\uff0c Azure\uff0c Google Persistent Disk\uff0c\u6216\u8005AWS Elastic Block Store\u3002\u6bd4\u5982\uff1a</p> <p><pre><code>volumes:\n- name: data-volume\n  awsElasticBlockStore:\n    volumeID: &lt;volume-id&gt;\n    fsType: ext4\n</code></pre> \u8fd8\u6709\u5176\u4ed6\u66f4\u591a\u6301\u4e45\u5377\u7684\u7c7b\u578b\uff1a</p> <ul> <li><code>awsElasticBlockStore</code>\uff1aAWS Elastic Block Store (EBS)</li> <li><code>azureDisk</code>\uff1aAzure Disk</li> <li><code>azureFile</code>\uff1aAzure File</li> <li><code>cephfs</code>\uff1aCephFS volume</li> <li><code>csi</code>\uff1aContainer Storage Interface (CSI)</li> <li><code>fc</code>\uff1aFibre Channel (FC) storage</li> <li><code>gcePersistentDisk</code>\uff1aGCE Persistent Disk</li> <li><code>glusterfs</code>\uff1aGlusterfs volume</li> <li><code>hostPath</code>\uff1aHostPath volume (for single node testing only; WILL NOT WORK in a multi-node cluster; consider using local volume instead)</li> <li><code>iscsi</code>\uff1aiSCSI (SCSI over IP) storage</li> <li><code>local</code>\uff1alocal storage devices mounted on nodes.</li> <li><code>nfs</code>\uff1aNetwork File System (NFS) storage</li> <li><code>portworxVolume</code>\uff1aPortworx volume</li> <li><code>rbd</code>\uff1aRados Block Device (RBD) volume</li> <li><code>vsphereVolume</code>\uff1avSphere VMDK volume</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-7/#3-persistentvolumeclaimpvc","title":"3. \u6301\u4e45\u5377\u7533\u9886\uff08PersistentVolumeClaim\uff0cPVC\uff09","text":"<p>\u5728\u5b9a\u4e49\u4e86Cluster\u4e0a\u7684PersistentVolume\u4e4b\u540e\u3002Pod\u9700\u8981\u53d1\u9001PVC\u8bf7\u6c42\uff0c\u4ee5\u62ff\u5230\u8bd5\u7528PV\u7684\u8bb8\u53ef</p> <p>\u6982\u5ff5\u6574\u7406</p> <ul> <li>PV\uff1a\u7531 \u7ba1\u7406\u8005\uff08Administrator\uff09 \u914d\u7f6e\u7684\u5b58\u50a8\u7a7a\u95f4</li> <li>PVC\uff1a\u7531Pod\u7684 \u7528\u6237\uff08User of Pod\uff09 \u53d1\u51fa\u7684\u201c\u60f3\u8981\u4f7f\u7528\u4e00\u90e8\u5206\u5b58\u50a8\u7a7a\u95f4\u201c\u7684\u8bf7\u6c42</li> </ul> <p><pre><code># my-pvc.yaml\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: my-claim\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:        # \u6240\u9700\u8d44\u6e90\n    requests:\n      storage: 500Mi\n  storageClassName: \"\"\n</code></pre> \u751f\u6210PVC\uff1a <pre><code>kubectl create -f my-pvc.yaml\n</code></pre> \u67e5\u770b\u5df2\u6709PVC\uff1a <pre><code>kubectl get persistentvolumeclaim\n</code></pre> PVC\u5728Pod\u4e2d\u7684\u4f7f\u7528\uff1a <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: mypod\nspec:\n  containers:\n    - name: myfrontend\n      image: nginx\n      volumeMounts:\n      - mountPath: \"/var/www/html\"\n        name: mypd\n  volumes:\n    - name: mypd\n      persistentVolumeClaim:  # \u4f7f\u7528PVC\n        claimName: myclaim\n</code></pre> \u26a0\ufe0f \u5728Pod\u4e2d\u6dfb\u52a0PVC\u4e4b\u540e\uff0cReplicaSets \u548c Deployments\u4e2d\u4e5f\u4f1a\u81ea\u52a8\u6dfb\u52a0\u76f8\u5bf9\u5e94\u7684PVC\u5b9a\u4e49\uff01</p>"},{"location":"cloud/k8s/ckad/ckad-7/#pvcpv-binding","title":"PVC\u5982\u4f55\u9009\u62e9PV (Binding)","text":""},{"location":"cloud/k8s/ckad/ckad-7/#1","title":"1. \u6839\u636e\u5c5e\u6027\u81ea\u52a8\u7ed1\u5b9a","text":"<p>Kubernetes \u5c1d\u8bd5\u6839\u636ePVC\u7684\u8981\u6c42\u627e\u5230\u5177\u6709\u8db3\u591f\u5bb9\u91cf\u7684PV\u3002PVC\u53ef\u4ee5\u5b9a\u4e49\u5b58\u50a8\u5bb9\u91cf\uff08<code>sufficient capacity</code>\uff09\uff0c\u8bbf\u95ee\u6a21\u5f0f\uff08<code>access modes</code>\uff09\u3001\u5377\u6a21\u5f0f\uff08<code>volume modes</code>\uff09\u3001\u5b58\u50a8\u7c7b\uff08<code>StorageClass</code>\uff09\u7b49\u5c5e\u6027\u3002\u5982\u679c\u6709\u591a\u4e2aPV\u7b26\u5408PVC\u7684\u8981\u6c42\uff0c\u5219\u968f\u673a\u9009\u62e9\u4e00\u4e2aPV\u3002</p> \u6761\u4ef6 PVC \u548c PV \u5fc5\u987b\u4e00\u81f4 storage PVC \u8bf7\u6c42\u7684 \u2264 PV \u63d0\u4f9b\u7684 accessModes PVC \u8bf7\u6c42\u7684 \u2286 PV \u652f\u6301\u7684 storageClassName \u5fc5\u987b\u5339\u914d\uff08\u6216\u8005\u90fd\u4e3a\u7a7a\uff09 \u72b6\u6001 PV \u5904\u4e8e Available \u72b6\u6001"},{"location":"cloud/k8s/ckad/ckad-7/#2-selectorslabels","title":"2. \u6839\u636eselectors\u548clabels\u9009\u62e9","text":"<p>\u5982\u679c\u4f60\u60f3\u6307\u5b9a PVC \u4f7f\u7528\u54ea\u4e2a PV, \u4e5f\u53ef\u4ee5\u5229\u7528 PVC \u7684<code>labels</code>\u548c<code>selectors</code>\u6765\u5b9a\u4f4d\u5230\u6b63\u786e\u7684PV\u3002\u6bd4\u5982\uff1a</p> <ol> <li>PVC\u4e2d\u6dfb\u52a0<code>selectors</code>\u5c5e\u6027 <pre><code># pvc.yaml\nspec:\n  selector:\n    matchLabels:\n      name: my-pv\n</code></pre></li> <li>\u5728PV\u4e2d\u6dfb\u52a0<code>labels</code>\u5c5e\u6027</li> </ol> <pre><code># pv.yaml\nlabels:\n    name: my-pv\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-7/#3-pvc-volumename","title":"3. pvc \u7684 volumeName","text":"<p>\u5982\u679c\u4f60\u60f3\u6307\u5b9a PVC \u4f7f\u7528\u54ea\u4e2a PV\uff0c\u53ef\u4ee5\u63d0\u524d\u7ed9\u5b83\u8bbe\u7f6e <code>volumeName</code>\u3002 <code>volumeName</code> \u662f\u6700\u76f4\u63a5\u7684\u65b9\u5f0f\uff0c\u4f46\u5fc5\u987b\u786e\u4fdd PVC \u7684\u6240\u6709\u53c2\u6570\uff08\u5982 <code>accessModes</code>\u3001<code>storageClassName</code> \u548c <code>size</code>\uff09\u4e0e\u8be5 PV \u5b8c\u5168\u517c\u5bb9\u3002</p> <pre><code># pvc.yaml\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: my-pvc\nspec:\n  volumeName: my-pv  # \u624b\u52a8\u6307\u5b9a\u7ed1\u5b9a\u5230\u540d\u4e3a \"my-pv\" \u7684 PV\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-7/#_2","title":"\u7279\u4f8b","text":"<p>\u6700\u540e\uff0c\u5982\u679c\u6240\u6709\u6240\u6709\u5c5e\u6027\u90fd\u5339\u914d\uff0c\u4e14\u6ca1\u6709\u66f4\u597d\u7684\u9009\u62e9\uff0c\u5219\u8f83\u5c0f\u7684PVC\u6700\u7ec8\u53ef\u80fd\u4f1a\u7ed1\u5b9a\u6bd4\u5b83\u8981\u6c42\u66f4\u5927\u7684PV\u3002 ** \u8fd9\u53ef\u80fd\u5bfc\u81f4PV\u7684\u6d6a\u8d39\uff01**</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2aPVC\u548c\u4e00\u4e2aPV\u3002PVC\u8981\u6c42\u7684\u5b58\u50a8\u7a7a\u95f4\u662f<code>500Mi</code>\uff0c\u800c\u73b0\u5728\u53ef\u7528\u7684PV\u53ea\u6709\u4e00\u4e2a\uff0c\u90a3\u4e48PVC\u53ea\u80fd\u7ed1\u5b9a\u5230\u5269\u4e0b\u7684PV\u3002\u7528<code>k get pvc</code>\u53ef\u7528\u770b\u5230\uff1a <pre><code>NAME     STATUS    VOLUME       CAPACITY   ACCESS MODES   STORAGECLASS    AGE\nmy-claim Bound     my-volume    1Gi        RWO            aws-xxx         40m\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-7/#pvpvc","title":"\u6ca1\u6709\u53ef\u7528\u7684PV\u65f6\uff0cPVC\u7684\u884c\u4e3a","text":"<p>\u5982\u679c\u5f53\u524d\u7684Cluster\u4e2d\uff0c\u6ca1\u6709\u53ef\u7528\u7684PV\uff0c\u90a3\u4e48\u53d1\u51fa\u7684PVC\u4f1a\u4e00\u76f4\u5904\u4e8e<code>Pending</code>\u7684\u72b6\u6001\u3002\u8fd9\u65f6\u7528<code>k get pvc</code>\u4f1a\u770b\u5230\uff1a <pre><code>NAME     STATUS    VOLUME   CAPACITY    ACCESS MODES   STORAGECLASS           AGE\nmy-claim Pending                                       vpc-block-1iops-tier   35h\n</code></pre> \u5f53Administrator\u5f80Cluster\u4e2d\u6dfb\u52a0\u65b0\u7684PV\u65f6\uff0c\u5904\u4e8e<code>Pending</code>\u72b6\u6001\u7684PVC\u4f1a\u81ea\u52a8\u4e0e\u65b0\u7684PV\u5b8c\u6210\u7ed1\u5b9a\uff01</p>"},{"location":"cloud/k8s/ckad/ckad-7/#4-pvc","title":"4. \u5220\u9664PVC","text":"<p>\u5220\u9664PVC\uff1a</p> <p><pre><code>k delete pvc/my-claim\n</code></pre> \u5f53PVC\u88ab\u5220\u9664\u65f6\uff0c\u4e0e\u4e4b\u7ed1\u5b9a\u7684PV \u53ef\u80fd\u7684\u884c\u4e3a\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ol> <li><code>Retain</code>: \u88ab\u7ed1\u5b9a\u7684PV\u4f1a\u4f9d\u65e7\u5b58\u5728\uff0c\u6ca1\u6709\u88ab\u5220\u9664\uff0c\u9664\u975eAdministrator\u624b\u52a8\u5220\u9664\u3002\u4f46\u8be5PV\u4e5f\u65e0\u6cd5\u88ab\u5176\u4ed6PVC\u4f7f\u7528\u3002\u6b64\u65f6PV\u7684Status\u4f1a\u662f<code>\u201cReleased\u201d</code>\uff0c\u800c\u4e0d\u662f<code>\u201cAvailable\u201d</code>\u3002</li> <li><code>Delete</code>: \u88ab\u7ed1\u5b9a\u7684PV\u4e5f\u4f1a\u81ea\u52a8\u88ab\u5220\u9664\uff0c\u7531\u6b64\uff0cCluster\u7684\u6574\u4f53\u5b58\u50a8\u6c60\u603b\u4f53\u5bb9\u91cf\u4f1a\u53d8\u5c0f</li> <li><code>Recycle</code>: \u88ab\u7ed1\u5b9a\u7684PV\u88ab\u56de\u6536\u5229\u7528\uff0cPV\u4e0a\u7684\u6570\u636e\u4f1a\u88ab\u5220\u9664\uff0c\u4e14\u53ef\u4f9b\u5176\u4ed6PVC\u4f7f\u7528\uff0cCluster\u7684\u6574\u4f53\u5b58\u50a8\u6c60\u603b\u4f53\u5bb9\u91cf\u4f1a\u4e0d\u53d8</li> </ol> <p>\u4f60\u53ef\u4ee5\u5728YAML\u4e2d\u5b9a\u4e49\uff1a</p> <p><pre><code>apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: pv-volume\nspec:\n  accessModes:\n    - ReadWriteOnce\n  capacity:\n    storage: 5Gi\n  awsElasticBlockStore:\n    volumeID: xxx\n    fsType: ext4\n  persistentVolumeReclaimPolicy: Recycle  # \u5bf9PV\u7684\u884c\u4e3a\u8fdb\u884c\u89c4\u5b9a\uff1a\"Retain\", \"Recycle\", \u6216 \"Delete\"\n</code></pre> \u26a0\ufe0f \u5bf9\u5377\u7684\u7ed1\u5b9a\u53ef\u4ee5\u5728Pod\u7684\u5b9a\u4e49\u6587\u4ef6\u4e2d\u8fdb\u884c\uff0c\u4e5f\u53ef\u4ee5\u5728Deployment\u6216\u8005ReplicaSet\u7684\u5b9a\u4e49\u6587\u4ef6\u4e2d\u8fdb\u884c\uff0c\u6548\u679c\u662f\u4e00\u6837\u7684</p>"},{"location":"cloud/k8s/ckad/ckad-7/#5-storageclasses","title":"5. \u5b58\u50a8\u7c7b / StorageClasses","text":"<p>Warning</p> <ul> <li>PV\uff08PersistentVolume\uff09 \u5c31\u50cf\u5df2\u7ecf\u51c6\u5907\u597d\u51fa\u79df\u7684\u623f\u5b50</li> <li>PVC\uff08PersistentVolumeClaim\uff09 \u5c31\u50cf\u79df\u5ba2\u7684\u79df\u623f\u9700\u6c42</li> <li>StorageClass \u5c31\u50cf\u4e2d\u4ecb\u516c\u53f8\u7ed9\u7684template\uff0c\u5e2e\u4f60\u6839\u636e\u9700\u6c42 \u81ea\u52a8\u9020\u623f\u5b50\uff08\u5373\u52a8\u6001 provision\uff09</li> </ul> <p>PVC \u662f\u7528\u6237\u7684\u5b58\u50a8\u9700\u6c42\uff0cPV \u662f\u7cfb\u7edf\u53ef\u7528\u7684\u5b58\u50a8\u8d44\u6e90\uff0c\u800c StorageClass \u5219\u662f\u52a8\u6001\u521b\u5efa PV \u7684\u201c\u5efa\u623f\u6a21\u677f\u201d\uff0c\u4e09\u8005\u4e00\u8d77\u6784\u6210 Kubernetes \u5b58\u50a8\u8d44\u6e90\u7684\u5206\u914d\u4e0e\u7ba1\u7406\u4f53\u7cfb\u3002</p> <p>Info</p> <p><code>storageClassName: \"\"</code> \u8868\u793a\u9759\u6001\u7ed1\u5b9a</p>"},{"location":"cloud/k8s/ckad/ckad-7/#static-provisioning","title":"Static Provisioning","text":"<p>\u5047\u8bbe\u6211\u73b0\u5728\u60f3\u4f7f\u7528GCE\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u90a3\u4e48\u9700\u89814\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u5728GCE\u4e2d\u65b0\u5efa\u5b58\u50a8\u7a7a\u95f4</li> <li>\u521b\u5efa\u4e00\u4e2a\u4f7f\u7528GCE\u7a7a\u95f4\u7684PV</li> <li>\u521b\u5efa\u4e00\u4e2aPVC\uff0c\u5bf9PV\u8fdb\u884c\u65f6\u4f7f\u7528</li> <li>\u5728Pod\u4e2d\u4f7f\u7528\u5f15\u7528PVC</li> </ol> <p>\u5982\u56fe\uff1a</p> <pre><code>flowchart TD\n  PV[PV: 10Gi Manual\u623f] --&gt; Match\n  PVC[PVC: \u6211\u898110Gi Manual\u623f] --&gt; Match\n  Match --&gt; Bind[\u7ed1\u5b9a\u6210\u529f]</code></pre> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4f5c Static Provisioning\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-7/#dynamic-provisioning","title":"Dynamic Provisioning","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa\u5b58\u50a8\u7c7b / StorageClass\u6765\u81ea\u52a8\u5316\u6b65\u9aa4\uff081\uff09\u548c\uff082\uff09\uff0c\u5b9e\u73b0\u201cDynamic Provisioning\u201d \u3002</p> <ul> <li>PVC\u901a\u8fc7<code>storageClassName</code>\u8fde\u63a5\u5230StorageClass\uff0cStorageClass\u4e2d\u7684 \u914d\u7f6e\u5668/provisioner \u6765\u914d\u7f6e\u65b0\u7684GCE\u78c1\u76d8\uff0c\u5e76\u4e14\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u76f8\u5bf9\u5e94\u7684PV</li> <li>\u4f60\u4e0d\u9700\u8981\u624b\u52a8\u521b\u5efa PV\uff0c\u4e5f\u4e0d\u9700\u8981\u4e8b\u5148\u51c6\u5907\u8def\u5f84\u6216\u78c1\u76d8\u6302\u8f7d\u7b49\u5de5\u4f5c</li> </ul> <p>\u5982\u56fe\uff1a</p> <pre><code>flowchart TD\n  PVC[\"PVC: \u6211\u89815Gi fast\u623f\uff0c\u627eStorageClass\"] --&gt; SC[\"StorageClass: fast\u6a21\u677f\"]\n  SC --&gt; PVNew[\"\u521b\u5efa\u65b0PV: 5Gi\"]\n  PVNew --&gt; Bind[\"\u81ea\u52a8\u7ed1\u5b9a\"]</code></pre> <p>StorageClass\u4e3e\u4f8b</p> <pre><code># my-sc.yaml\napiVerson: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: google-storage\n\nprovisioner: kubernetes.io/gce-pd   # \ud83c\udf08 \u914d\u7f6e\u5668\uff1a\u4e0d\u540c\u4f9b\u5e94\u5546\u63d0\u4f9b\u4e0d\u540c\u7684\u914d\u7f6e\u5668\nVolumeBindingMode: WaitForFirstConsumer\nparameters:             # \u914d\u7f6e\u989d\u5916\u7684\u53c2\u6570\n  type: pd-standard\n  replication-type: none\n</code></pre> <p>provisioner  - k8s\u4e3a\u6bcf\u4e2a\u4e91\u4f9b\u5e94\u5546\u90fd\u63d0\u4f9b\u4e86\u4e0d\u540c\u7684provisioner\uff1a\u6bd4\u5982<code>kubernetes.io/gce-pd</code>\u5c31\u662f\u7ed9 GoogleCloudEngine \u7684provisioner - \u662f\u5982\u679cprovisioner\u662f<code>kubernetes.io/no-provisioner</code>\uff0c\u90a3\u4e48\u610f\u5473\u7740\u8be5StorageClass\u4e0d\u652f\u6301 dynamic provisioning</p> <p>VolumeBindingMode/\u7ed1\u5b9a\u6a21\u5f0f  \u53ef\u80fd\u7684\u503c\u6709\uff1a</p> <ul> <li><code>WaitForFirstConsumer</code>: \u5c06\u5ef6\u8fdf PV \u7684\u7ed1\u5b9a\u548c\u914d\u7f6e\uff0c\u76f4\u5230\u521b\u5efa\u4f7f\u7528\u4e86\u5bf9\u5e94 PVC \u7684 Pod </li> <li><code>Immediate</code></li> </ul> <p>Naming of 'StorageClass'</p> <p>You can use different drive in different StorageClass, thats where the name come from:</p> <p></p> <p>\u6709\u53ef\u80fd PVC \u65e0\u6cd5\u901a\u8fc7 StorageClass \u81ea\u52a8\u751f\u6210 PV</p> <p>\u6bd4\u5982\u96c6\u7fa4\u4e2d\u6839\u672c\u6ca1\u6709\u5b89\u88c5\u8fd9\u4e2a CSI \u63d2\u4ef6\u3002\u90a3\u4e48 StorageClass \u5c31\u5931\u53bb\u4e86\u5b83\u5b58\u5728\u7684\u610f\u4e49\uff0c\u76f4\u63a5\u7528 Static Provisioning\uff0c\u5373PV + PVC\u66f4\u5408\u7406</p>"},{"location":"cloud/k8s/ckad/ckad-7/#_3","title":"\u533a\u522b","text":"<p>Static\u548cDynamic Provisioning\u7684\u533a\u522b\u5982\u56fe\uff1a</p> Static Provisioning Dynamic Provisioning <pre><code>Pod -&gt; PVC -&gt; PV -&gt; GCE</code></pre> <pre><code>Pod -&gt; PVC -&gt; SC(PV)</code></pre> <p></p>"},{"location":"cloud/k8s/ckad/ckad-7/#6-statefulset","title":"6. StatefulSet","text":"<p>StatefulSet \u7c7b\u4f3c\u4e8e Deployment\uff0c\u56e0\u4e3a\u5b83\u4eec\u57fa\u4e8e\u6a21\u677f\u521b\u5efa Pod\u3002 \u4ed6\u4eec\u53ef\u4ee5\u589e\u52a0\u548c\u51cf\u5c11Pod\u7684\u6570\u91cf\u3002 \u4e5f\u53ef\u4ee5\u6267\u884c\u6eda\u52a8\u66f4\u65b0\u548c\u56de\u6eda\uff0c\u4f46\u5b58\u5728\u5dee\u5f02\uff1a</p> <ul> <li>StatefulSet \u4e2d Pod \u662f\u6309\u987a\u5e8f\u521b\u5efa\u7684\u3002 </li> <li>\u90e8\u7f72\u7b2c\u4e00\u4e2a Pod \u540e\uff0c\u5b83\u5fc5\u987b\u5904\u4e8e\u8fd0\u884c\u548c\u5c31\u7eea\u72b6\u6001\uff0c\u624d\u80fd\u7ee7\u7eed\u90e8\u7f72\u4e0b\u4e00\u4e2a Pod \u3002 </li> <li>StatefulSet\u7ed9\u6bcf\u4e00\u4e2a\u521b\u5efa\u7684Pod\u90fd\u6309\u7167\u751f\u6210\u987a\u5e8f\u7f16\u53f7\uff0c\u5e76\u6839\u636e\u7f16\u53f7\u751f\u6210\u72ec\u4e00\u65e0\u4e8c\u7684\u540d\u5b57\uff0c\u6bd4\u5982\uff1a<code>sql-1</code>\uff0c<code>sql-2</code></li> </ul> <p>\u4f7f\u7528\u573a\u666f</p> <ul> <li>StatefulSet: \u9700\u8981\u6709\u72b6\u6001\u3001\u7a33\u5b9a\u8eab\u4efd\u7684\u5e94\u7528\uff08\u5982\u6570\u636e\u5e93\u3001\u5206\u5e03\u5f0f\u7cfb\u7edf\uff09\uff0c\u6bd4\u5982MySQL\u3001Cassandra\u3001Zookeeper\u3001Kafka \u7b49\u5206\u5e03\u5f0f\u7cfb\u7edf </li> <li>Deployment: \u65e0\u72b6\u6001\u5e94\u7528\uff08\u5982 Web \u5e94\u7528\u3001API \u670d\u52a1\uff09\uff0c\u6bd4\u5982Nginx\u3001\u524d\u7aef\u670d\u52a1\u3001\u5fae\u670d\u52a1\u5e94\u7528       </li> </ul> <p><pre><code># StatefulSet\u7684\u5b9a\u4e49\u6587\u4ef6\u548cDeployment\u5927\u540c\u5c0f\u5f02\uff0c\u4e3b\u8981\u628a kind\u7684\u7c7b\u578b\u6539\u4e86\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mysql\nspec:\n  template:\n    metadata:\n      labels:\n        app: mysql\n    spec:\n      containers:\n      - name: mysql\n        image: mysql\n  replicas: 3\n  selector:\n    matchLabels:\n      app: mysql\n\n  serviceName: mysql  # \u58f0\u660e\u8981\u4f7f\u7528\u7684 Headless\u670d\u52a1\n</code></pre> \u751f\u6210StatefulSet\uff1a</p> <pre><code>kubectl create -f my-ss.yaml\n</code></pre> <p>Info</p> <p>StatefulSet\u88ab\u5220\u9664\u65f6\u4ece\u540e\u5f80\u524d\u5220</p>"},{"location":"cloud/k8s/ckad/ckad-7/#headless-service","title":"Headless Service","text":"<p>\u4e0d\u505aloading balance\uff0c\u53ea\u63d0\u4f9bDNS\u7684\u670d\u52a1\u3002\u4e0eStatefulSet\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u4e3a\u6bcf\u4e00\u4e2aPod\u90fd\u63d0\u4f9b\u4e00\u4e2aDNS\uff0c\u683c\u5f0f\u4e3a\uff1a<code>&lt;pod-name&gt;.&lt;headless-service-name&gt;.&lt;namespace&gt;.&lt;cluster-domain&gt;</code>\u6bd4\u5982\uff1a</p> <ul> <li><code>mysql-0.mysql-headless.default.svc.cluster.local</code></li> <li><code>mysql-1.mysql-headless.default.svc.cluster.local</code></li> <li><code>mysql-2.mysql-headless.default.svc.cluster.local</code></li> </ul> <p><pre><code>apiVersion: v1\nkind: Service\nmetadata:\n    name: mysql-headless\nspec:\n    ports:\n        - port: 3306\n    selector:\n        app: mysql\n    clusterIP: None  # Headless\u670d\u52a1\u4e0e\u5176\u4ed6\u670d\u52a1\u533a\u5206\u5f00\u6765\u7684\u5730\u65b9\n</code></pre> \u73b0\u5728\u6211\u4eec\u6709\u4e24\u6761\u8def\uff1a</p> <ol> <li>\u624b\u52a8\u521b\u5efaPod</li> <li>\u901a\u8fc7StatefulSet\u521b\u5efaPod</li> </ol>"},{"location":"cloud/k8s/ckad/ckad-7/#1-pod","title":"1. \u624b\u52a8\u521b\u5efaPod","text":"<pre><code>apiVersion: apps/v1\nkind: Pod\nmetadata:\n  name: myapp-pod\nspec:\n  containers:\n  - name: mysql\n    image: mysql\n\n  subdomain: mysql-headless   # 1. subdomain = \u670d\u52a1\u540d\u5b57\n  hostname: mysql-pod         # 2. hostname \u786e\u4fdd\u6bcf\u4e2aPod\u90fd\u6709\u5404\u81ea\u7684DNS\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-7/#2-statefulsetpod","title":"2. \u901a\u8fc7StatefulSet\u521b\u5efaPod","text":"<p>\u5982\u4e4b\u524d\u7684\u4f8b\u5b50\u6240\u793a\uff0c\u9700\u8981\u52a0\u4e00\u4e2a<code>serviceName</code>\u5373\u53ef</p>"},{"location":"cloud/k8s/ckad/ckad-7/#kubectl","title":"&gt;&gt;&gt;  \u672c\u7ae0kubectl\u547d\u4ee4\u6574\u7406","text":"<p>PersistentVolume\u76f8\u5173</p> <p><code>k get pv</code></p> <p>PersistentVolumeClaim\u76f8\u5173</p> <p><code>k get pvc</code></p> <p><code>k delete pvc/my-claim</code> \u5220\u9664pvc</p>"},{"location":"cloud/k8s/ckad/ckad-7/#_4","title":"\u56fe\u7247\u6765\u6e90","text":"<p>Database icons created by phatplus - Flaticon Folder icons created by Good Ware - Flaticon</p>"},{"location":"cloud/k8s/ckad/ckad-8/","title":"8.2021\u66f4\u65b0\u7684\u8003\u8bd5\u5185\u5bb9","text":""},{"location":"cloud/k8s/ckad/ckad-8/#_1","title":"\u955c\u50cf\u751f\u6210","text":"<p>\u5f53\u6211\u4eec\u5728\u955c\u50cf\u5e93\uff08\u6bd4\u5982Dockerhub\uff09\u4e2d\u627e\u4e0d\u5230\u6240\u9700\u7684\u955c\u50cf\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u81ea\u5df1\u521b\u5efa\u955c\u50cf\uff1a <code>Dockerfile</code>\u6587\u4ef6\u672c\u8d28\u4e0a\u662f\u4e00\u4e2aDocker\u80fd\u591f\u7406\u89e3\u7684 txt\u6587\u4ef6\u3002</p> <p>\u6bcf\u884c\u547d\u4ee4\u90fd\u6709\u4e24\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a<code>&lt;INSTRUCTION&gt; &lt;argument&gt;</code>\uff1a</p> <ul> <li>\u6211\u4eec\u4e60\u60ef\u628a\u547d\u4ee4\uff08<code>INSTRUCTION</code>\uff09\u5168\u90fd\u5927\u5199\uff1a\u6bd4\u5982 <code>FROM</code>\u6216<code>RUN</code></li> <li><code>&lt;argument&gt;</code>\u5c0f\u5199\u3002</li> </ul> <p>\u6bcf\u4e00\u884c\u547d\u4ee4\u7684\u8fd0\u884c\u7ed3\u679c\u90fd\u662f\u4e00\u4e2a\u5c42\uff08<code>layer</code>\uff09\uff0c\u6bcf\u4e00\u5c42\u7684\u90fd\u4ee5\u4e0a\u4e00\u5c42\u7684\u7ed3\u679c\u4e3a\u57fa\u7840\uff0c\u6267\u884c\u547d\u4ee4\u3002\u5047\u8bbe\u4e2d\u9014\u7b2cN\u5c42\u51fa\u9519\uff0c\u91cd\u65b0\u521b\u5efa\u8be5\u955c\u50cf\u65f6\uff0c\u6211\u4eec\u53ef\u76f4\u63a5\u4f7f\u7528N-1\u5c42\u7684\u7ed3\u679c\u3002 <pre><code>FROM ubuntu             # \u4ee5\u67d0\u4e2a\u955c\u50cf\u4e3a\u57fa\u7840\uff08\u5e38\u89c1\u7684\u662f\u201c\u64cd\u4f5c\u7cfb\u7edf\u201d\u955c\u50cf\uff09\n\nRUN app-get update      # \u5b89\u88c5\u4f9d\u8d56\u5305\nRUN apt-get install python\n\nRUN pip install flask\nRUN pip install flask-mysql\n\nCOPY . /opt/source-code # \u590d\u5236\u4ee3\u7801\u5230\u955c\u50cf\u4e2d\n\nENTRYPOINT FLASP_APP=/opt/source-code/app.py flask run  # \u955c\u50cf\u5165\u53e3/\u7a0b\u5e8f\u542f\u52a8\u547d\u4ee4\n</code></pre></p> <p>\u5728<code>Dockerfile</code>\u6240\u5728\u7684\u6587\u4ef6\u5939\u4e2d\uff0c\u7528\u8be5<code>Dockerfile</code>\u521b\u5efa\u955c\u50cf\uff1a\uff08<code>-t</code>==<code>--tag</code>\u7ed9\u955c\u50cf\u52a0\u6807\u7b7e\uff09 <pre><code>docker build -t test/my-custom-image .\n</code></pre> \u5c06\u521b\u5efa\u7684\u955c\u50cf\u653eDocker\u955c\u50cf\u5e93\u4e2d\uff1a</p> <p><pre><code>docker push test/my-custom-image\n</code></pre> \u26a0\ufe0f \u57fa\u4e8e\u955c\u50cf\u5e93\u53ef\u5b9a\u5236\u7684\u7279\u6027\uff0c\u6211\u4eec\u53ef\u4ee5\u8bf4\u201c\u4e07\u7269\u7686\u53ef\u955c\u50cf\u5316\u201d</p> <p>\u8fd0\u884c\u56fe\u50cf webapp-color \u7684\u5b9e\u4f8b\uff0c\u5e76\u5c06\u5bb9\u5668\u4e0a\u7684\u7aef\u53e3 8080 \u53d1\u5e03\u5230\u4e3b\u673a\u4e0a\u7684 8282\uff1a <pre><code>docker run webapp-color -p 8282:8080\n</code></pre></p> <p>Note</p> <p><code>-p &lt;Host-Port&gt;:&lt;Container-Port&gt;</code>\u5176\u4e2d\uff0cHost\uff08\u4e3b\u673a\uff09\u662f Docker \u6240\u5728\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5373\u53ef\u901a\u8fc7 ssh \u8fdb\u5165\u7684\u7cfb\u7edf\u3002 Container-Port \u662f\u5bb9\u5668\u7684\u7aef\u53e3\u3002 </p> <p>\u68c0\u67e5\u67d0\u4e2a\u955c\u50cf\u57fa\u4e8e\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u955c\u50cf\u8dd1\u4e00\u4e2a\u5bb9\u5668\uff1a <pre><code>docker run -it --rm &lt;ImageName&gt; /bin/bash\n\n# \u8fdb\u5165\u5bb9\u5668\u547d\u4ee4\u884c\u5de5\u5177\u4e4b\u540e\uff1a\ncat /etc/*-release\n\n# \u9000\u51fa\u5bb9\u5668\nexit\n</code></pre> \u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>--rm</p> <p>\u9000\u51fa\u5bb9\u5668\u4e4b\u540e\u81ea\u52a8\u5c06\u8be5\u5bb9\u5668\u5220\u9664</p> <p>\u67e5\u770b\u5f53\u524d\u73af\u5883\u4e0b\uff0c\u955c\u50cfpython\u7684\u6240\u6709\u7248\u672c <pre><code>docker images python\n</code></pre></p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-8/#k8s","title":"k8s \u5b89\u5168\u6027","text":"<p>\u6211\u4eec\u77e5\u9053k8s\u7684\u96c6\u7fa4\u4e0a\u6709\u4e24\u79cdNode\uff1a Master Node\u4f55Worker Node\uff0c\u5176\u4e2dMaster Node\u662f\u4e00\u4e2a<code>kube-apiserver</code>\u670d\u52a1\u5668\u3002\u901a\u8fc7\u5bf9\u8be5\u670d\u52a1\u5668\u7684\u8bbf\u95ee\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u4efb\u4f55\u4e8b\u3002\u90a3\u4e48\u8981\u5982\u4f55\u7ba1\u7406<code>kube-apiserver</code>\u670d\u52a1\u5668\u7684 \u8bbf\u95ee\u6743\u9650 \u5462\uff1a</p> <ol> <li>Authentication\uff1a\u8c01\u53ef\u4ee5\u8bbf\u95ee<code>kube-apiserver</code>\u670d\u52a1\u5668\uff1f</li> <li>Authorization\uff1a\u8bbf\u95ee\u8005\u53ef\u4ee5\u505a\u4ec0\u4e48\uff1f</li> </ol>"},{"location":"cloud/k8s/ckad/ckad-8/#1-authentication","title":"1. Authentication","text":"<p>\u8c01\u53ef\u4ee5\u8bbf\u95ee\u96c6\u7fa4\uff1f\u60f3\u8bbf\u95ee\u96c6\u7fa4\u7684\u6709\u8fd9\u51e0\u79cd\u7528\u6237\uff1a</p> \u7528\u6237 \u529f\u80fd \u7528\u6237\u7c7b\u578b \u5e10\u53f7\u7c7b\u578b \u5e10\u53f7\u7531\u8c01\u7ba1\u7406 \u7ba1\u7406\u8005 / Admin \u7ba1\u7406\u96c6\u7fa4\u8d44\u6e90 \u4eba\u7c7b \u7528\u6237\u5e10\u53f7 / `User` \u5e10\u53f7\u7531\u5916\u90e8\u8d44\u6e90\u7ba1\u7406\uff0c\u6bd4\u5982\u8bc1\u4e66\uff0c\u7b2c\u4e09\u65b9\u8eab\u4efd\u8ba4\u8bc1\uff08LDAP\uff09 \u5f00\u53d1\u8005 / Developers \u505aDeployment\uff0c\u5c06App\u5efa\u7acb\u8d77\u6765\u7b49 \u4eba\u7c7b \u7528\u6237\u5e10\u53f7 / `User` \u5e10\u53f7\u7531\u5916\u90e8\u8d44\u6e90\u7ba1\u7406\uff0c\u6bd4\u5982\u8bc1\u4e66\uff0c\u7b2c\u4e09\u65b9\u8eab\u4efd\u8ba4\u8bc1\uff08LDAP\uff09 \u673a\u5668\u4eba / Bots \u5373\u7528\u4e8eintegration\u7684\u7b2c\u4e09\u65b9\u5e94\u7528 \u673a\u5668\u4eba\uff08\u7b2c\u4e09\u65b9\u8fdb\u7a0b\u6216\u670d\u52a1\uff09 \u670d\u52a1\u5e10\u53f7 / `ServiceAcount` \u5e10\u53f7\u7684\u7ba1\u7406\u6bd4\u8f83\u7b80\u5355\uff0c\u7531`Kubernetes`\u81ea\u5df1\u7ba1\u7406\u3002  \u6bd4\u5982:  - `k create sa my-sa`\u65b0\u5efa\u4e00\u4e2a`ServiceAcount`  - `k get sa`\u83b7\u53d6\u5f53\u524d\u96c6\u7fa4\u4e0a\u6240\u6709\u7684`ServiceAcount` \u7ec8\u7aef\u7528\u6237 / End users \u7531App\u81ea\u5df1\u7ba1\u7406\uff0c\u6bd4\u5982\u767e\u5ea6\u4e91\u8981\u7528\u6237\u767b\u9646\u4e4b\u540e\u624d\u80fd\u8bbf\u95ee\uff0c\u4e0d\u5728kubernetes\u7684\u7ba1\u8f96\u8303\u56f4\u4e2d\uff0c\u56e0\u6b64\u4e0d\u505a\u8ba8\u8bba - - -"},{"location":"cloud/k8s/ckad/ckad-8/#user","title":"\u7528\u6237\u5e10\u53f7 / <code>User</code>","text":"<p>\u4e0a\u9762\u63d0\u5230\u7684\u56db\u79cd\u7528\u6237\u4e2d\u7684<code>Admin</code>\u548c<code>Developer</code>\u90fd\u5c5e\u4e8e\u201c\u7528\u6237\u5e10\u53f7\u201d\u7c7b\u578b\u3002\u800c\u6240\u6709\u7684\u7528\u6237\u90fd\u901a\u8fc7<code>kube-apiserver</code>\u6765\u8bbf\u95ee\u96c6\u7fa4\uff0c\u6709\u4e24\u79cd\u8bbf\u95ee\u65b9\u5f0f\uff1a</p> <ol> <li>\u901a\u8fc7<code>kubectl</code>\u5de5\u5177</li> <li>\u901a\u8fc7API\uff1a<code>curl https://kube-server-ip:6443</code></li> </ol> <p>\u4e24\u79cd\u7c7b\u578b\u7684\u8bf7\u6c42\u90fd\u6c47\u96c6\u5230<code>kube-apiserver</code>\u670d\u52a1\u5668\u3002\u8be5\u670d\u52a1\u5668\u5728\u5904\u7406\u8bf7\u6c42\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\uff08Authentication\uff09\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684 \u8ba4\u8bc1\u673a\u5236 / Authentication mechanism \u6765\u83b7\u5f97\u8bbf\u95ee\u6743\u9650\uff0c\u6bd4\u5982\uff1a</p> <ol> <li>\u7528\u6237\u540d + \u5bc6\u7801\uff08Static Password File\uff09</li> <li>\u7528\u6237\u540d + Token\uff08Static Token File\uff09</li> <li>\u8bc1\u4e66\uff08Certificates\uff09</li> <li>\u7b2c\u4e09\u65b9\u8ba4\u8bc1\u670d\u52a1\uff08Identity Services\uff09\uff1a\u5982<code>LDAP</code>\u6216\u8005<code>Kerberos</code></li> </ol>"},{"location":"cloud/k8s/ckad/ckad-8/#1","title":"\u8ba4\u8bc1\u673a\u5236 1\uff1a\u7528\u6237\u540d + \u5bc6\u7801","text":"<p>1.\u521b\u5efa<code>user-details.csv</code>\uff1a\u5305\u542b<code>password</code>\uff0c<code>username</code>\uff0c<code>userid</code>\uff0c<code>group</code>\uff08\u53ef\u9009\uff09\uff0c\u5982\u4e0b\uff1a</p> <p><pre><code>password123, user1, u0001, group1\npassword123, user2, u0002, group1\npassword123, user3, u0003, group2\n</code></pre> 2.\u7136\u540e\u5c06\u6587\u4ef6\u4f4d\u7f6e\u6dfb\u52a0\u5230<code>kube-apiserver</code>\u670d\u52a1\u5668\u7684Pod\u7684<code>.spec.containers.command</code>\u4e2d\u7684<code>--basic-auth-file</code>\u53bb\uff0c\u8bb0\u5f97\u786e\u4fdd \u91cd\u542f <code>kube-apiserver</code>\u670d\u52a1\u5668</p> <p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\nspec:\n  containers:\n  - command:\n    - kube-apiserver\n    - --authorization-mode=Node,RBAC\n    - --basic-auth-file=user-details.csv    # \u6dfb\u52a0\u7528\u4e8ebasic-auth\u7684csv\u6587\u4ef6\n      ...\n    image: k8s.gcr.io/kube-apiserver-amd64:v1.11.3\n    name: kube-apiserver\n    volumeMounts:\n    - mountPath: /tmp/users\n      name: usr-details\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: /tmp/users\n      type: DirectoryOrCreate\n    name: usr-details\n</code></pre> \u26a0\ufe0f \u67e5\u770b\u8be5pod\u4e2d<code>authorization</code>\u7684\u5185\u5bb9\u6709\u51e0\u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\uff1a</p> <ul> <li><code>k describe pod kube-apiserver --namespace kube-system</code></li> <li><code>cat /etc/kubernetes/manifests/kube-apiserver.yaml</code></li> <li><code>ps aux | grep authorization</code></li> </ul> <p>3.\u521b\u5efa\u76f8\u5e94\u7684<code>Role</code>\u548c<code>RoleBinding</code>\uff0c\u5982\u4e0b\uff1a</p> <pre><code>---\n# \u521b\u5efaRole\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  namespace: default\n  name: pod-reader\nrules:\n- apiGroups: [\"\"]     # \u6ce8\u610f \"\" indicates the core API group\uff0c\u4e5f\u53ef\u4ee5\u662f\"apps\"\n  resources: [\"pods\"]\n  verbs: [\"get\", \"watch\", \"list\"]\n\n---\n# \u521b\u5efaRoleBinding\uff1a\u5141\u8bb8user1\u8bbf\u95ee\"default\"\u7684namespace\u4e2d\u6240\u6709\u7684Pod\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: read-pods\n  namespace: default\nsubjects:           # subjects\uff1a\u5b9e\u73b0\u4e86 RoleBinding \u548c User \u4e4b\u95f4\u7684\u7ed1\u5b9a\n- kind: User\n  name: user1\n  apiGroup: rbac.authorization.k8s.io\nroleRef:            # roleRef\uff08\u4e5f\u53ebAccount\uff09\uff1a\u5b9e\u73b0\u4e86 RoleBinding \u548c Role \u4e4b\u95f4\u7684\u7ed1\u5b9a\n  kind: Role                 # \u4e5f\u53ef\u4ee5\u662fClusterRole\n  name: pod-reader\n  apiGroup: rbac.authorization.k8s.io\n</code></pre> <p>\u26a0\ufe0f User\u540d\u5b57\u533a\u5206\u5927\u5c0f\u5199\uff01</p> <p>4.\u7136\u540e\u6211\u4eec\u5c31\u901a\u8fc7 \u7528\u6237+\u5bc6\u7801 \u5bf9\u96c6\u7fa4\u8fdb\u884c\u8bbf\u95ee\u4e86\uff0c\u6bd4\u5982\u901a\u8fc7API\u8bf7\u6c42\uff1a</p> <pre><code>curl -v -k https://master-node-ip:6443/api/vi/pods -u \"user1:password123\"\n</code></pre> <p>Note</p> <pre><code>-v: verbose\uff0c\u8f93\u51fa\u6240\u6709\u8b66\u544a\u6216\u9519\u8bef\u4fe1\u606f &lt;br /&gt;\n-k: \u7701\u7565curl\u7684\u5b89\u5168\u68c0\u6d4b\u6b65\u9aa4\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-8/#2-token","title":"\u8ba4\u8bc1\u673a\u5236 2\uff1a\u7528\u6237\u540d + Token","text":"<ol> <li>\u4e0e \u8ba4\u8bc1\u673a\u52361 \u4e2d\u7c7b\u4f3c\uff0c\u521b\u5efa<code>user-token-details.csv</code>\u6587\u4ef6\uff0c\u4e3e\u4f8b\uff1a <pre><code>KfhuSDbdFafJrenu732hb42, user1, u0001, group1\nskjdhfue2kUKfhuSDbds7sjh, user2, u0002, group1\nTmjfIG6aHW34jndjushdDUI, user3, u0003, group2\n</code></pre></li> <li>\u914d\u7f6e<code>kube-apiserver</code>\u670d\u52a1\u5668\u7684Pod\uff1a\u7528<code>--token-auth-file</code>\u800c\u4e0d\u662f<code>--basic-auth-file</code></li> <li>\u6dfb\u52a0\u76f8\u5e94\u7684<code>Role</code>\u548c<code>RoleBinding</code></li> <li>\u6700\u540e\u53ef\u7528<code>curl</code>\u8bbf\u95ee\uff1a <pre><code>curl -v -k https://master-node-ip:6443/api/vi/pods -u \"Bearer KfhuSDbdFafJrenu732hb42\"\n</code></pre></li> </ol> <p>Warning</p> <pre><code>- \u4e0d\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8fd9\u6837\u505a\u3002\u8ba4\u8bc1\u673a\u52361\u548c2\u4ec5\u7528\u4e8e\u5b66\u4e60\u548c\u7406\u89e3\u3002 &lt;br/&gt;\n- \u8ba4\u8bc1\u673a\u52361\u548c2\u5df2\u5728Kubernetes 1.19\u7248\u672c\u4e2d\u5df2\u88ab\u5e9f\u5f03\uff0c\u5728\u4ee5\u540e\u7684\u7248\u672c\u4e2d\u4e5f\u4e0d\u518d\u9002\u7528\uff01\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-8/#3-certificates","title":"\u8ba4\u8bc1\u673a\u5236 3\uff1a\u8bc1\u4e66 / Certificates","text":"<p>\u8bc1\u4e66 / Certificates\u7684\u751f\u6210\u4e0d\u5728CKAD\uff0c\u800c\u662f\u5728CKA\u7684\u8003\u8bd5\u8303\u56f4\u4e2d\uff0c\u56e0\u6b64\u7701\u7565\u3002\u8fd9\u91cc\u5047\u8bbe\u8bc1\u4e66\u5df2\u751f\u6210\u3002\u53ef\u4ee5\u901a\u8fc7<code>API</code>\u6216\u8005<code>k</code>\u5de5\u5177\u8fdb\u884c\u4f7f\u7528\uff1a <pre><code># \u7528`API`\uff1a\ncurl https://my-kube-playground:6443/api/v1/pods \\\n    --key admin.key\n    --cert admin.crt\n    --cacert ca.crt\n</code></pre></p> <p>Note</p> <pre><code>- `--key`: (TLS) your private key for SSH\n- `--cert`: (TLS) specified client certificate file\n- `--cacert`: (TLS) to use the specified certificate file to verify the peer. CA = certificate authority\n</code></pre> <pre><code># \u7528`kubectl`\u5de5\u5177\uff1a\nkubectl get pods \\\n    --server my-kube-playground:6443 \\\n    --client-key admin.key \\\n    --client-certificate admin.crt\n    --certificate-authority ca.crt\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u7b80\u5316<code>kubectl</code>\u7684\u4f7f\u7528\uff0c\u56e0\u4e3a\u6bcf\u6b21\u8f93\u5165\u8fd9\u4e48\u957f\u7684\u547d\u4ee4\u6709\u70b9\u9ebb\u70e6\u3002\u8fd9\u65f6\u5019\u5c31\u8981\u7528\u5230<code>KubeConfig</code>\u6587\u4ef6\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u751f\u6210\u4e00\u4e2a<code>KubeConfig</code>\u6587\u4ef6\uff0c\u7136\u540e\u518d\u7528<code>kubectl</code>+<code>KubeConfig</code>\u8bbf\u95eePod\uff1a <pre><code>kubectl get pods --kubeconfig config\n</code></pre> \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u4f1a\u53bb\u627e\u8fd9\u4e2a\u8def\u5f84\u4e0b\u7684<code>KubeConfig</code>\u6587\u4ef6\uff1a<code>$HOME/.kube/config</code>\uff0c\u5982\u679c\u6211\u4eec\u4e5f\u628a\u6211\u4eec\u7684<code>KubeConfig</code>\u6587\u4ef6\u653e\u5728\u4e86\u8fd9\u4e2a\u9ed8\u8ba4\u8def\u5f84\u4e2d\uff0c\u90a3\u4e48\u6211\u4eec\u53ea\u9700\u8981\u8dd1 <code>k get pods</code>\u5373\u53ef\uff01</p> <p>Note</p> <p><code>$HOME</code>\u662f\u4e00\u4e2a\u53d8\u91cf\uff0c\u5176\u503c\u53ef\u4ee5\u901a\u8fc7<code>echo $HOME</code>\u67e5\u770b</p> <p>\u90a3\u4e48<code>KubeConfig</code>\u6587\u4ef6\u957f\u5565\u6837\u5462\uff1f\u5b83\u7531\u4e09\u4e2a \u5217\u8868 \u7ec4\u6210\uff1a</p> <ul> <li><code>Users</code></li> <li><code>Clusters</code></li> <li><code>Contexts</code></li> </ul> <p>\u4ed6\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u662f<code>Clusters x Users = Contexts</code>\u5982\u56fe\uff1a</p> <p></p> <p>\u4e3e\u4f8b\uff1a</p> <pre><code># \u4e3e\u4f8b\uff1a\u6bcf\u4e2a\u5217\u8868\uff08`Users`\uff0c`Clusters`\u548c`Contexts`\uff09\u4e2d\u5305\u542b\u4e00\u4e2aitem\napiVersion: v1\nkind: Config\n\ncurrent-context: my-kube-admin@my-kube-playground   # \u5f53\u524d\u4f7f\u7528\u7684context\uff0c\u53ef\u901a\u8fc7kubectl\u4fee\u6539\n\nclusters:                                           # clusters\u5217\u8868\n- name: my-kube-playground\n  cluster: \n    certificate-authority: etc/kubernetes/pki/ca.crt\n    server: https://my-kube-playground:6443\n\ncontexts:                                           # contexts\u5217\u8868\n- name: my-kube-admin@my-kube-playground\n  context:\n    cluster: my-kube-playground\n    user: my-kube-admin\n    namespace: default  # \u53ef\u9009\n\nusers:                                              # users\u5217\u8868\n- name: my-kube-admin\n  user:\n    client-certificate: etc/kubernetes/pki/admin.crt\n    client-key: etc/kubernetes/pki/admin.key\n</code></pre> <p>Warning</p> <pre><code>- \u8be5\u6587\u4ef6\u6ca1\u6709\u751f\u6210\u4efb\u4f55\u989d\u5916\u7684k8s\u8d44\u6e90\uff0c\u53ea\u662f\u8d1f\u8d23\u628a\u5df2\u6709\u7684\u8d44\u6e90\u5229\u7528\u548c\u94fe\u63a5\u8d77\u6765\u4e86 &lt;br/&gt;\n- \u8be5\u6587\u4ef6 **\u5199\u5b8c+\u4fdd\u5b58** \u5373\u53ef\uff0c**\u4e0d\u9700\u8981** `k create -f .....yaml`\u6765\u751f\u6210\uff01\uff01\n</code></pre> <p>\u67e5\u770b\u6b63\u5728\u4f7f\u7528\u7684<code>KubeConfig</code>\u6587\u4ef6\uff1a <pre><code># \u67e5\u770b\u9ed8\u8ba4\u6587\u4ef6\u8def\u5f84\u4e0b\u7684KubeConfig\uff0c\u6216\u8005\u76f4\u63a5\u67e5\u770b\u6587\u4ef6\uff1a $HOME/.kube/config\nkubectl config view\n\n# \u67e5\u770b\u67d0\u4e2a\u7279\u5b9a\u7684KubeConfig\nkubectl config view --kubeconfig=my-customized-config   \n</code></pre></p> <p>\u7528\u81ea\u5b9a\u4e49\u7684<code>KubeConfig</code>\u6587\u4ef6\u4ee3\u66ff\u9ed8\u8ba4\u7684\uff1a <pre><code># \u76f4\u63a5\u7528customized\u7684`KubeConfig`\u6587\u4ef6\u5185\u5bb9 \u53d6\u4ee3\u9ed8\u8ba4\u7684\u8def\u5f84\u4e0b\u7684\uff1a\nmv /directory/to/my/config $HOME/.kube/config\n</code></pre></p> <p>\u4fee\u6539\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684<code>Context</code>\uff0c\u8be5\u547d\u4ee4\u4f1a\u81ea\u52a8\u66f4\u65b0<code>KubeConfig</code>\u6587\u4ef6\u4e2d\u7684<code>.current-context</code> <pre><code># \u4f7f\u7528\u9ed8\u8ba4\u8def\u5f84\u4e0b\u7684KubeConfig\u6587\u4ef6\nkubectl config use-context &lt;Context-Name&gt;   \n\n# \u4f7f\u7528\u81ea\u5b9a\u4e49\u7684KubeConfig\u6587\u4ef6\nkubectl config use-context &lt;Context-Name&gt; --kubeconfig=&lt;New-KubeConfig-File&gt;   \n</code></pre></p> <p>Config\u7684YAML\u6587\u4ef6</p> <pre><code>- `.clusters.cluster.certificate-authority: \u6587\u4ef6\u8def\u5f84` &lt;br /&gt;\n- `.clusters.cluster.certificate-authority-data: \u52a0\u5bc6\u540e\u7684\u6587\u4ef6\u5185\u5bb9`\n\n\u4e24\u8005\u80fd\u8fbe\u5230\u4e00\u6837\u7684\u76ee\u7684\uff01\u6bd4\u5982\u6211\u4eec\u5148\u5bf9`ca.crt`\u6587\u4ef6\u8fdb\u884c\u52a0\u5bc6\uff1a`cat ca.crt | base64` \uff0c\u518d\u628a\u52a0\u5bc6\u540e\u7684\u5185\u5bb9\u52a0\u5230 `.clusters.cluster.certificate-authority-data: `\u91cc\u53bb\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-8/#2-authorization","title":"2. Authorization\uff1a\u8bbf\u95ee\u8005\u53ef\u4ee5\u505a\u4ec0\u4e48\uff1f","text":"<p>\u8bbf\u95ee\u8005\u53ef\u4ee5\u505a\u4ec0\u4e48\u7531 \u6388\u6743\u673a\u5236 / Authorization mechanism \u51b3\u5b9a\u3002\u6bd4\u5982\u7ed9\u7ba1\u7406\u8005/Admin\u548c\u5f00\u53d1\u8005/Developer\u7684\u6743\u9650\u80af\u5b9a\u662f\u4e0d\u4e00\u6837\u7684\u3002\u5e38\u89c1\u7684 \u6388\u6743\u673a\u5236 \u6709\uff1a</p> <ol> <li>Node Authorizor</li> <li>ABAC\u6388\u6743\uff08Attributed-based access control\uff09</li> <li>RBAC\u6388\u6743\uff08Role-based access control\uff09\uff1a \u5173\u8054 \u7528\u6237 \u4e0e \u6743\u9650\u7ec4 </li> <li>Webhook Mode<ul> <li><code>AlwaysAllow</code></li> <li><code>AlwaysDeny</code></li> </ul> </li> </ol> <p>\u4f7f\u7528\u54ea\u4e00\u79cd\u6388\u6743\u673a\u5236\u7531<code>kube-apiserver</code>\u7684Pod\u6587\u4ef6\u4e0a\u914d\u7f6e<code>--authorization-mode=</code>\u51b3\u5b9a\u3002\u591a\u79cd\u673a\u5236\u53ef\u540c\u65f6\u4f7f\u7528\uff0c\u53ea\u9700\u7528\u9017\u53f7\u9694\u5f00\u5373\u53ef\u3002\u591a\u4e2a\u673a\u5236\u4e4b\u95f4\u662f\u201d\u6216\u201c\u7684\u5173\u7cfb\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u673a\u5236\u8ba4\u53ef\u5373\u53ef\uff0c\u7528\u6237\u8bf7\u6c42\u4f1a\u88ab\u6240\u6709\u6388\u6743\u673a\u5236\u6309 \u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f \u68c0\u67e5\u3002\u6bd4\u5982\uff1a <pre><code># \u5916\u90e8\u7528\u6237\u8bbf\u95ee\u65f6\uff1a\n#   \u5148\u7531\u68c0\u67e5Node\u68c0\u67e5\uff0c\u88ab\u62d2\u7edd\uff0c\n#   \u7528RBAC\u68c0\u67e5\u901a\u8fc7\u4e86\uff01\u7528\u6237\u7684\u8bf7\u6c42\u88abredirect\u5230`kube-apiserver`\n#   Webhook\u4e0d\u9700\u8981\u518d\u68c0\u67e5\n    --authorization-mode=Node,RBAC,Webhook\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-8/#1node-authorizor","title":"\u6388\u6743\u673a\u5236 1\uff1aNode Authorizor","text":"<p>\u96c6\u7fa4\u5185 \u7684\u5176\u4ed6Node\uff08\u5e26\u6709<code>kubelet</code>\uff09\u8bbf\u95ee<code>kube-apiserver</code>\u670d\u52a1\u5668\u65f6\uff0c\u4e5f\u9700\u8981Authorization - Node Authorizor\u3002 <code>kubelet</code>\u4f5c\u4e3a\u7cfb\u7edf\u8282\u70b9\u7ec4\u7684\u4e00\u90e8\u5206\uff0c\u6709\u4e00\u4e2a\u4ee5\u7cfb\u7edf\u8282\u70b9\u4e3a\u524d\u7f00\u7684\u540d\u5b57\uff1a<code>system.node.node01</code></p>"},{"location":"cloud/k8s/ckad/ckad-8/#2abac","title":"\u6388\u6743\u673a\u5236 2\uff1aABAC","text":"<p>\u6bd4\u5982<code>dev</code>\u7528\u6237\u9700\u8981\u67e5\u770b\u3001\u521b\u5efa\u548c\u5220\u9664pod\u7684\u6743\u9650\u3002\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a<code>Policy</code>\u6587\u4ef6\u6765\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u5e76\u5c06\u6587\u4ef6\u4f20\u8f93\u7ed9<code>kube-apiserver</code>\u670d\u52a1\u5668\u3002ABAC\u7ba1\u7406\u56f0\u96be\uff0c\u56e0\u4e3a\u9700\u8981\u624b\u52a8\u4fee\u6539<code>Policy</code>\u6587\u4ef6\uff0c\u5e76\u4e14\u6bcf\u4fee\u6539\u4e00\u6b21\u5c31\u8981\u91cd\u542f\u4e00\u6b21<code>kube-apiserver</code>\u670d\u52a1\u5668\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-8/#3rbac","title":"\u6388\u6743\u673a\u5236 3\uff1aRBAC","text":"<p>\u901a\u8fc7\u521b\u5efa\u4e0d\u540c\u7684<code>Role</code>\uff08\u6bd4\u5982Developer\uff0cAdmin\u80fd\u505a\u7684\u4e8b\u60c5\u4e0d\u4e00\u6837\uff09\uff0c\u5e76\u5c06<code>User</code>\u5173\u8054\u5230\u6240\u9700\u7684<code>Role</code>\u4e0a</p> <ol> <li> <p>\u65b0\u5efa<code>Role</code>\uff1a <code>.rules.verbs</code>\u8868\u793a\u8be5apiGroup\u53ef\u4ee5\u6267\u884c\u7684\u52a8\u4f5c  <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  namespace: default    # \u53ef\u9009\n  name: developer\nrules:\n\n  # rule nr.1:\n- apiGroups: [\"\"]           # \"\" indicates the core API group\n  resources: [\"pods\"]   # \u9488\u5bf9pod\u8d44\u6e90\n  verbs: [\"list\", \"get\", \"create\", \"update\", \"delete\"]\n  resourceNames: [\"blue\", \"red\"]    # \u53ef\u9009\uff0c\u7528pod\u7684\u540d\u79f0\u8fdb\u884c\u7b5b\u9009\n\n  # rule nr.2:\n- apiGroups: [\"\"]\n  resources: [\"ConfigMap\"]  # \u9488\u5bf9ConfigMap\u8d44\u6e90\n  verbs: [\"create\"]\n</code></pre></p> </li> <li> <p>\u7528<code>RoleBinding</code> \u5c06<code>User</code>\u5173\u8054\u5230<code>Role</code>\u4e0a <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  namespace: default    # \u53ef\u9009\n  name: devuser-developer-binding\nsubjects:   \n- kind: User                    # \u6216\u8005 kind: Group\n  name: dev-user            # \"name\"\u533a\u5206\u5927\u5c0f\u5199\n  apiGroup: rbac.authorization.k8s.io\nroleRef:                            # \u6307\u5b9a\u4e0e\u4e4b\u7ed1\u5b9a\u7684Role\n  kind: Role                    # \u6216\u8005ClusterRole\n  name: developer\n  apiGroup: rbac.authorization.k8s.io\n</code></pre></p> </li> </ol> <p>Note</p> <pre><code>`Role`\u548c`Rolebinding`\u90fd\u53ef\u4ee5\u88ab\u9650\u5236\u5728\u67d0\u4e2a`namespace`\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u5728yaml\u4e2d\u7684`.metadata.namespace`\u4e2d\u5199\u660e\n</code></pre> <p>\u5173\u4e8e<code>Role</code>\u548c<code>RoleBinding</code>\u7684\u4e00\u4e9b\u547d\u4ee4 <pre><code># \u65b0\u5efarole\nkubectl create role [roleName] --verb=[actionA],[actionB] --resource=pods\n# \u67e5\u770b\u6240\u6709\u7684`Role` (\u7528--namespace xxx\u6216 --all-namespace\uff08-A\uff09\u6765\u9650\u5b9a)\nkubectl get roles\n# \u67e5\u770b\u67d0\u4e2a`Role`\u7684\u6743\u9650\nkubectl describe role developer\n\n# \u65b0\u5efarolebinding\nkubectl create rolebinding NAME --clusterrole=NAME|--role=NAME [--user=username] [--group=\n# \u67e5\u770b\u6240\u6709\u7684`RoleBinding`\nkubectl get rolebindings\n# \u67e5\u770b\u67d0\u4e2a`RoleBinding`\u7684\u5185\u5bb9\nkubectl describe rolebinding devuser-role-binding\n</code></pre> \u67e5\u770b\u6743\u9650 <pre><code># \u67e5\u770b \u5f53\u524d\u7528\u6237\uff08\u6211\uff09 \u662f\u5426\u6709\u67d0\u4e2a\u6743\u9650\uff1a\nkubectl auth can-i create deployments \nkubectl auth can-i delete nodes\n# \u67e5\u770b\u540d\u4e3a dev-user \u7684\u7528\u6237\u662f\u5426\u6709\u67d0\u4e2a\u6743\u9650\uff1a\uff08\u5728\u67d0\u4e2anamespace\u4e2d\uff09\nkubectl auth can-i create deployments \u2014-as dev-user\nkubectl auth can-i delete nodes \u2014-as dev-user \u2014-namespace test\n</code></pre></p> <p>Role vs ClusterRole</p> <pre><code>Kubernetes\u4e2d\u6709`Role`\u548c`ClusterRole`\uff0c`ClusterRole`\u662f\u8de8Namespace\u7684\u5b58\u5728\uff0c`ClusterRole`\u548c`ClusterRoleBinding`\u7684\u521b\u5efa\u65b9\u6cd5\u4e0e`Role`\u7c7b\u4f3c\u3002\u4f7f\u7528`Role`\u8fd8\u662f`ClusterRole`\u7531\u4f7f\u7528\u573a\u666f\u51b3\u5b9a\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-8/#4webhook","title":"\u6388\u6743\u673a\u5236 4\uff1aWebhook","text":"<p>\u4ece\u96c6\u7fa4\u5916\u90e8\u5bf9Authorization\u8fdb\u884c\u7ba1\u7406\uff0c\u6bd4\u5982Open Policy Agent\uff0c\u4f1a\u5728\u6536\u5230\u8bf7\u6c42\u540e\u5224\u65ad\u53d1\u9001\u8bf7\u6c42\u7684\u7528\u6237\u662f\u5426\u6709\u6267\u884c\u8be5\u52a8\u4f5c\u7684\u6743\u5229\uff0c\u5982\u679c\u6709\uff0c\u624d\u4f1aredirect\u8be5\u8bf7\u6c42\u5230<code>kube-apiserver</code>\u670d\u52a1\u5668\u4e0a</p>"},{"location":"cloud/k8s/ckad/ckad-8/#3","title":"3. \u96c6\u7fa4\u5185\u90e8\u7684\u4ea4\u6d41","text":"<p>\u96c6\u7fa4\u5185\u90e8\u7684\u7ec4\u4ef6\uff08\u6bd4\u5982etcd\uff0ckube controller\uff0c manager scheduler\u548cAPI server\uff09\u4e0e<code>kube-apiserver</code>\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u4ea4\u6d41\u90fd\u662f\u7531 TLS \u52a0\u5bc6\u8fc7\u7684\u3002\u540c\u4e00\u4e2a\u96c6\u7fa4\u4e0a\u7684\u4e0d\u540cPod\uff08\u4e0a\u9762\u7684app\uff09\u9ed8\u8ba4\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\u3002\u5982\u679c\u6709\u9700\u8981\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>NetworkPolicy</code> \u6765\u9650\u5236\u8bbf\u95ee\u6743\u9650\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-8/#4-admission-controller","title":"4. Admission Controller","text":"<p>\u9664\u4e86\u4ee5\u4e0a\u63d0\u5230\u7684<code>Authentication</code>\u548c<code>Authorization</code>\u4e24\u4e2a\u673a\u5236\u4e4b\u5916\uff0ckubernetes\u8fd8\u63d0\u4f9b\u4e86<code>Admission Controller</code>\uff0c \u6765\u63a7\u5236\u4e00\u4e9b<code>Authentication</code>\u548c<code>Authorization</code>\u65e0\u6cd5\u63a7\u5236\u7684\u4e1c\u897f\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u53ea\u5141\u8bb8\u4f7f\u7528\u67d0\u4e2aregistry\uff08\u5373\u955c\u50cf\u6570\u636e\u5e93\uff09\u4e2d\u7684\u955c\u50cf</li> <li>\u4e0d\u5141\u8bb8\u7528\u6237\u4f5c\u4e3aroot\u8dd1Pod</li> <li>\u89c4\u5b9aPod\u5fc5\u987b\u6709labels</li> </ul> <p></p> <p>\u67e5\u770b\u5f53\u524d\u542f\u7528\u7684Admission Controller\uff1a\u8fdb\u5165\u5bb9\u5668 <code>kube-apiserver-controlplane</code>\u4e2d\u5e76\u7528<code>kube-apiserver</code>\u547d\u4ee4\u67e5\u770b <pre><code>k exec kube-apiserver-controlplane -n kube-system -- \\\n    kube-apiserver -h | grep enable-admission-plugins\n</code></pre></p> <p>Warning</p> <p><code>kube-apiserver-controlplane</code> \u662f\u4e00\u4e2a\u5728 Namespace <code>kube-system</code>\u4e2d\u7684Pod\uff0c\u800c\u8fdb\u5165\u8be5Pod\u4e2d\u7684\u5bb9\u5668\u4e4b\u540e\uff0c\u6211\u4eec\u624d\u53ef\u4ee5\u4f7f\u7528 <code>kube-apiserver</code> \u547d\u4ee4\u5de5\u5177\uff5e</p> <p>\u4fee\u6539Admission Controller\uff1a <pre><code>vi /etc/kubernetes/manifests/kube-apiserver.yaml \n\n# \u5728yaml\u7684.spec.containers.command\u4e2d:\n\n# 1\uff09\u6dfb\u52a0\n- --enable-admission-plugins=NamespaceAutoProvision\n\n# 2\uff09\u5220\u9664\n- --disable-admission-plugins=NamespaceAutoProvision\n</code></pre></p> <p>Note</p> <p><code>NamespaceExists</code>\u548c<code>NamespaceAutoProvision</code>\u5df2\u7ecf\u88ab\u5f03\u7528\uff0c\u7528<code>NamespaceLifecycle</code>\u4ee3\u66ff\uff1a</p> <ul> <li>Namespace\u4e0d\u5b58\u5728\u65f6\u62d2\u7edd\u6267\u884c\u547d\u4ee4 </li> <li>\u786e\u4fdd\u9ed8\u8ba4\u7684Namespace\u65e0\u6cd5\u88ab\u5220\u9664\uff1a <code>default</code>, <code>kube-system</code> \u548c <code>kube-public</code></li> </ul>"},{"location":"cloud/k8s/ckad/ckad-8/#k8sac","title":"k8s\u63d0\u4f9b\u7684AC\u7c7b\u578b","text":""},{"location":"cloud/k8s/ckad/ckad-8/#1-validating-ac","title":"1. Validating AC\uff08\u9a8c\u8bc1\u7c7b\uff09","text":"<p>\u6bd4\u5982NamespaceExists \u548c NamespaceAutoProvision\uff0c\u4ee5\u4e0b\u9762\u547d\u4ee4\u4e3a\u4f8b\uff1a <pre><code>kubectl run nginx --image nginx --namespace blue\n</code></pre></p> <ul> <li>AC <code>NamespaceExists</code>\u9ed8\u8ba4\u4e3a\u542f\u7528\u72b6\u6001\uff0c\u5e76\u4e14\u4f1a\u68c0\u67e5\u547d\u4ee4\u4e2d\u63d0\u5230\u7684Namespace <code>blue</code>\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u8be5\u547d\u4ee4\u4f1a\u62a5\u9519\u3002</li> <li>AC <code>NamespaceAutoProvision</code>\u9ed8\u8ba4\u4e3a\u5173\u95ed\u72b6\u6001\uff0c\u82e5\u542f\u7528\uff0c\u5219\u5728Namespace <code>blue</code>\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4e2a</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-8/#2-mutating-ac","title":"2. Mutating AC\uff08\u4fee\u6539\u7c7b\uff09","text":"<p>DefaultStorageClass \u8fd9\u4e2aAC\u4f1a\u89c2\u5bdf \u5bf9\u5b58\u50a8\u7c7b\u6ca1\u6709\u7279\u5b9a\u8981\u6c42 \u7684 <code>PersistentVolumeClaim</code> \u7684\u521b\u5efa\uff0c\u5e76\u81ea\u52a8\u5411\u5b83\u4eec\u6dfb\u52a0\u9ed8\u8ba4\u5b58\u50a8\u7c7b\u3002 \u5f53\u6211\u4eec\u67e5\u770b\u521b\u5efa\u7684PVC\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8be5PVC\u7684\u5c5e\u6027<code>StorageClass: default</code></p> <p>AC\u6267\u884c\u987a\u5e8f</p> <p>k8s\u5148\u4f7f\u7528<code>Mutating</code>\u518d\u4f7f\u7528<code>Validating</code>\u7684AC</p>"},{"location":"cloud/k8s/ckad/ckad-8/#admission-controller","title":"\u81ea\u5b9a\u4e49Admission Controller","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u81ea\u5df1\u5b9a\u4e49Admission Controller\uff0c\u9700\u8981\u7528\u5230\u7684\u5de5\u5177\u6709\uff1a</p> <ul> <li>Mutating Admission Webhook</li> <li>Validating Admission Webhook</li> </ul> <p>\u901a\u8fc7\u4e0b\u9762\u4e24\u4e2a\u6b65\u9aa4\u5b9e\u73b0\uff1a</p> <ol> <li>\u5efa\u7acb\u670d\u52a1\u5668 <code>Admission Webhook Server</code>\uff08\u4ee5<code>Deployment</code>\u7684\u5f62\u5f0f\uff09</li> </ol> <p></p> <ol> <li>\u5efa\u7acb\u670d\u52a1</li> </ol> <p></p> <ol> <li>\u7528<code>ValidatingAdmissionConfiguration</code>\u6216\u8005<code>MutatingAdmissionConfiguration</code>\u8fdb\u884c\u914d\u7f6e\u3002\u4e3e\u4f8b\uff1a</li> </ol> <pre><code>apiVersion: admissionregistration.k8s.io/v1\nkind: ValidatingWebhookConfiguration\nmetadata:\n  name: \"pod-policy.example.com\"\nwebhooks:\n    - name: \"pod-policy.example.com\"\n      clientConfig:   \n        service:                             # \u670d\u52a1\u5668\uff1a\u901a\u8fc7\u670d\u52a1\u8bbf\u95ee\n          namespace: \"example-namespace\"\n          name: \"example-service\"\n        caBundle: &lt;CA_BUNDLE&gt;                # certificate bundle for TLS\n      rules:                                 # \u89c4\u5b9a\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u81ea\u5b9a\u4e49AC\n          - apiGroups:   [\"\"]\n            apiVersions: [\"v1\"]\n            operations:  [\"CREATE\"]\n            resources:   [\"pods\"]\n            scope:       \"Namespaced\"\n      admissionReviewVersions: [\"v1\"]\n      sideEffects: None\n      timeoutSeconds: 5\n</code></pre> <p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cServer\u4e5f\u5728\u540c\u4e00\u4e2ak8s cluster\u4e0a\uff0c\u6211\u4eec\u7528\u4e00\u4e2aservice\u53bb\u8bbf\u95ee\u8be5\u670d\u52a1\u5668\u3002\u5982\u679cServer\u4e5f\u5728cluster\u5916\u7684\u8bdd\uff0c clientConfig\u957f\u8fd9\u6837\uff1a <pre><code> clientConfig:\n    uri: \"https://my-server.com\"\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-8/#namespaces","title":"Namespaces","text":"<p>kubernetes\u4e2d\u6709\u5206Namespace\u548c\u4e0d\u5206Namespace\u7684\u8d44\u6e90\uff1a</p> \u5206Namespace \u4e0d\u5206Namespace pods\uff0creplicasets\uff0cjobs\uff0cdeployments\uff0c services\uff0csecrets\uff0croles\uff0crolebindings\uff0c configmaps\uff0cPVC nodes\uff0cPV\uff0cclusterroles\uff0c clusterrolebindings\uff0ccertificatesigningrequests\uff0c namespaces <code>k api-resources --namespaced=true</code> <code>k api-resources --namespaced=false</code> <p>\u53ef\u7528<code>kubectl api-resources</code>\u7ed3\u679c\u4e2d\u7684NAMESPACED\u5217\u67e5\u770b\uff0c\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"cloud/k8s/ckad/ckad-8/#api-groups","title":"API Groups","text":"<p>Kubernetes\u7684 Endpoints \u6839\u636e\u5176\u76ee\u7684\u4e0d\u540c\uff0c\u88ab\u5206\u5230\u4e0d\u540c\u7684API\u7ec4\u4e2d\u3002API\u7ec4\u5728\u4e24\u4e2a\u5730\u65b9\u7528\u5230\uff1a</p> <ol> <li>REST\u8def\u5f84\uff1a<code>/apis/$GROUP_NAME/$VERSION</code></li> <li>yaml\u6587\u4ef6\u4e2dapiVersion\u7684\u503c\uff1a<code>apiVersion: $GROUP_NAME/$VERSIO</code>\uff0c\u6bd4\u5982<code>apiVersion: batch/v1</code></li> </ol> <p>Warning</p> <p><code>/api</code> \u7ec4\u505a\u4e3a\u6700\u65e9\uff0c\u6700\u6838\u5fc3\u7684\u7ec4\uff0c\u7ec4\u540d\u603b\u662f\u88ab\u7701\u7565\uff0c\u6bd4\u5982Pod\u7684<code>apiVersion: v1</code>\u800c\u4e0d\u662f<code>apiVersion: api/v1</code></p> <p>\u5e38\u7528\u7684API\u7ec4\u6709\uff1a</p> <ul> <li><code>/api</code> \u4e5f\u53ebcore\u7ec4\uff0c\u6216\u8005legacy\u7ec4</li> <li><code>/apis</code> \u4e5f\u53ebnamed\u7ec4</li> <li><code>/metrics</code></li> <li><code>/healthz</code></li> <li><code>/version</code></li> <li><code>/logs</code></li> </ul> <p>\u67e5\u770b API\u7ec4\u53ca\u5176\u7248\u672c\uff1a <pre><code>k api-versions\n</code></pre></p> <p>\u5176\u4e2d\u4e0e\u96c6\u7fa4\u4f5c\u7528\u76f8\u5173\u7684\u662fcore\u7ec4\u548cnamed\u7ec4\uff0c\u7ed3\u6784\u5206\u522b\u4e3a\uff1a</p> core\u7ec4 \uff08<code>/api</code>\uff09 named\u7ec4\uff08<code>/apis</code>\uff09 <p>Note</p> <pre><code>\u6ce8\u610f`/apis`\u7ed3\u6784\u66f4\u52a0\u6574\u6d01\uff0c`/api`\u7ec4\u4e2d\u7684Endpoints\u4e5f\u4f1a\u5728\u672a\u6765\u6162\u6162\u5730\u88ab\u79fb\u52a8\u5230`/apis`\u7ec4\u4e2d\uff01\n\uff08\u56fe\u7247\u6765\u81ea[\u8fd9\u91cc](https://www.waytoeasylearn.com/learn/api-groups-in-kubernetes/)\uff09\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-8/#api","title":"API\u7684\u4f7f\u7528","text":"<pre><code># \u67e5\u770b\u5f53\u524dcluster\u4e2d\u6240\u6709\u53ef\u7528\u7684API\u7ec4\uff1a\ncurl https://kube-master:6443 -k\n\n# \u67e5\u770b\u67d0API\u7ec4\u4e2d\u6240\u6709\u53ef\u7528\u7684Resources\ncurl https://kube-master:6443/apis -k\n</code></pre> <p>\u67d0\u4e9bAPI\u662f\u9700\u8981\u8eab\u4efd\u9a8c\u8bc1\u4e4b\u540e\u624d\u80fd\u88ab\u4f7f\u7528\u3002\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <p>1.\u4f7f\u7528<code>curl</code>\u7684\u53c2\u6570\uff08\u6bd4\u5982<code>--key</code>\uff09</p> <pre><code>curl https://kube-master:6443 -k \\\n    --key admin.key\n    --cert admin.crt\n    --cacert ca.crt\n</code></pre> <p>2.\u4f7f\u7528Kube Control Proxy\u7a0b\u5e8f\u67e5\u770b API\u7ec4</p> <pre><code># Kube\u63a7\u5236\u4ee3\u7406\u547d\u4ee4\u542f\u52a8\u4e86\u4e00\u4e2a\u4ee3\u7406\u670d\u52a1\uff0c\u5e76\u4f7f\u7528\u51ed\u8bc1\u548c\u8bc1\u4e66\uff0c\u7aef\u53e3\u4e3a8001\uff0c\u6548\u679c\u7b49\u540c\u4e8ek proxy\nk proxy 8001&amp;\n\n# proxy\u5efa\u7acb\u6210\u529f\u540e\uff0c\u4f60\u4f1a\u770b\u5230\u8fd9\u6761\u4fe1\u606f\uff1aStarting to serve on 127.0.0.1:8001\n# \u73b0\u5728\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u7aef\u53e38001\u4e86\uff0c\u4e0d\u9700\u8981certificates\ncurl localhost:8001 -k \n</code></pre> <p>Warning</p> <pre><code>`k proxy`\u548c`kube proxy`\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u4e1c\u897f\uff01TODO\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-8/#api_1","title":"API\u7ec4\u7684\u7248\u672c","text":"<p>\u6709\u4e9bAPI\u7ec4\u6709\u591a\u4e2a\u7248\u672c\uff0c\u6bd4\u5982<code>v1</code>\uff0c<code>v1alpha1</code>\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7proxy\u7136\u540e\u7528REST\u8bbf\u95ee\u67e5\u770b <pre><code>k proxy 8001&amp;\ncurl https://localhost:8001/apis/&lt;API-Group&gt;\n\n# \u6bd4\u5982\uff0c\u67e5\u770b`batch`\u7ec4\u7684\u6240\u6709\u7248\u672c\uff1a\ncurl https://kube-master:8001/apis/batch\n</code></pre> \u7ed3\u679c\u5982\u4e0b\uff1a\u5176\u4e2d<code>preferredVersion</code>\uff08\u63a8\u8350\u7248\u672c\uff09\u662f\u9ed8\u8ba4\u4f7f\u7528\u7684\u7248\u672c</p> <p></p> <p>\u6216\u8005\u7528\u66f4\u7b80\u5355\u7684\uff1a</p> <pre><code>k api-versions | grep batch\n</code></pre> <p>\u9664\u4e86\u8d44\u6e90\u7684\u63a8\u8350\u7248\u672c\uff0c\u4e5f\u53ef\u80fd\u5b58\u5728\u4e00\u4e2a\u5b58\u50a8\u7248\u672c/storage version\u3002\u662f\u6307\u6700\u7ec8\u5b58\u50a8\u5230etcd\u6570\u636e\u5e93\u4e2d\u7684\u7248\u672c\uff0c\u5047\u8bbe\u8be5\u5b58\u50a8\u7248\u672c\u5b58\u5728\uff0c\u5219\u8d44\u6e90\u518d\u5b58\u50a8\u65f6\uff0c\u90fd\u4f1a\u5148\u88ab\u8f6c\u6362\u6210\u5b58\u50a8\u7248\u672c\u3002</p> <p>\u5b58\u50a8\u7248\u672c\u6ca1\u6709\u529e\u6cd5\u901a\u8fc7<code>k</code>\u67e5\u770b\uff0c\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u67e5\u8be2etcd\u6570\u636e\u5e93\uff0c\u6bd4\u5982\uff1a <pre><code>ETCDCTL_API=3 etcdctl\n    --endpoints=https://[127.0.0.1]:2379\n    --cacert=/etc/kubernetes/pki/etcd/ca.crt\n    --cert=/etc/kubernetes/pki/etcd/server.crt\n    --key=/etc/kubernetes/pki\n    get \"/registry/deployments/default/blue\" --print-value-only\n</code></pre></p> <p>Note</p> <p>\u63a8\u8350\u7248\u672c \u548c \u5b58\u50a8\u7248\u672c \u90fd\u5404\u81ea\u5b58\u6709\u4e00\u4e2a\u503c\uff0c\u8fd9\u4e2a\u503c\u53ef\u80fd\u662f\u76f8\u540c\u7684\uff0c\u4e5f\u6709\u53ef\u80fd\u662f\u4e0d\u540c\u7684</p>"},{"location":"cloud/k8s/ckad/ckad-8/#api_2","title":"\u542f\u7528/\u7981\u7528API\u7248\u672c","text":"<p>\u9700\u8981\u4fee\u6539Pod <code>kube-apiserver-controlplane</code>\u7684\u914d\u7f6e\uff0c\u6700\u76f4\u63a5\u7684\u65b9\u6cd5\u662f\u4fee\u6539<code>/etc/kubernetes/manifest/api-server.yaml</code>\u6587\u4ef6\uff1a</p> <pre><code># \u4e07\u4e00\u4fee\u6539\u51fa\u9519\uff0ccluster\u4f1a\u5d29\u574f\uff0c\u4ee5\u9632\u4e07\u4e00\uff0c\u5148\u653e\u4e00\u4e2a\u5907\u4efd\ncp /etc/kubernetes/manifests/kube-apiserver.yaml /root/kube-apiserver.yaml.backup\n\nvi /etc/kubernetes/manifests/kube-apiserver.yaml\n\n# \u5728spec.containers[0].command\u4e2d\n# \u6dfb\u52a0\u7248\u672c\uff1a\n--runtime-config=batch/v2alpha1,v2,v2beta1\n\n# \u5220\u9664\u67d0\u7248\u672c:\n--runtime-config=batch/v1=false\n</code></pre> <p>\u63a5\u4e0b\u6765\u8981\u7b49\u8be5Pod\u88ab\u91cd\u542f\uff0c\u786e\u5b9aPod\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\uff0c\u4fee\u6539\u624d\u771f\u6b63\u88ab\u5b9e\u73b0\uff01</p>"},{"location":"cloud/k8s/ckad/ckad-8/#api_3","title":"API\u66f4\u65b0\u51c6\u5219","text":"<p>1.API \u5143\u7d20\u53ea\u80fd\u901a\u8fc7\u589e\u52a0 API \u7ec4\u7684\u7248\u672c\u6765\u5220\u9664  <pre><code>    v1alpha1(\u6709\"test\"\u8d44\u6e90)=&gt; v1alpha2(\u65e0\"test\"\u8d44\u6e90)\n</code></pre> 2.API \u5bf9\u8c61\u5fc5\u987b\u80fd\u591f\u5728\u4e0d\u540c\u7684 API \u7248\u672c\u4e4b\u95f4\u8f6c\u6362\u800c\u4e0d\u4f1a\u4e22\u5931\u4fe1\u606f\uff0c\uff08\u6392\u9664\u67d0\u7248\u672c\u4e2d\u67d0\u8d44\u6e90\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\uff09 <pre><code>    v1alpha1 &lt;==&gt; v1alpha2\u4e4b\u95f4\u53ef\u4ee5\u65e0\u7f1d\u8f6c\u6362\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-8/#api_4","title":"API\u5f03\u7528\u51c6\u5219","text":"<p>1.\u9664\u4e86\u6700\u65b0 API \u7248\u672c\u4e4b\u5916\uff0c\u8f83\u65e7\u7684 API \u7248\u672c\u5728\u5ba3\u5e03\u5f03\u7528\u4e00\u6bb5\u65f6\u95f4\u540e\u5fc5\u987b\u5f97\u5230\u652f\u6301\u3002</p> <ul> <li>GA\uff1a\u4e0d\u5c11\u4e8e 12 \u4e2a\u6708\u6216 3 \u6b21release</li> <li>beta\uff08\u6d4b\u8bd5\u7248\uff09\uff1a\u4e0d\u5c11\u4e8e 9 \u4e2a\u6708\u6216 3 \u6b21release</li> <li>alpha\uff1a0 release -&gt; \u5f03\u7528\u4e4b\u540e\u4e0d\u9700\u8981\u989d\u5916\u652f\u6301\uff0c\u6240\u4ee5\u5f53kubernetes\u7248\u672c\u5347\u7ea7\uff0c\u4e14\u4e0d\u518d\u5305\u542b\u67d0\u4e2a\u8d44\u6e90\u7684<code>v1alpha1</code>\u7248\u672c\u540e\uff0c\u6211\u4eec\u9700\u8981\u628a\u8be5\u8d44\u6e90\u7684\u7248\u672c\u90fd\u5347\u7ea7\u5230<code>v1alpha2</code> 2.\u5728\u53d1\u5e03\u65b0\u7684 \u63a8\u8350\u7248\u672c \u548c \u5b58\u50a8\u7248\u672c \u4e4b\u524d\uff0c\u8981\u81f3\u5c11\u5b58\u5728\u8fc7\u4e00\u4e2arelease\uff0c\u65e7\u7684\u548c\u65b0\u7684\u4e24\u4e2a\u7248\u672c\u90fd\u88ab\u652f\u6301\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u7b2c\u4e00\u6b21\u53d1\u5e03\u7684\u7248\u672c\uff0c\u4e0d\u80fd\u6210\u4e3a \u63a8\u8350\u7248\u672c \u6216 \u5b58\u50a8\u7248\u672c </li> <li>\u5728\u65b0\u7684 API \u7248\u672c\u53d1\u5e03\u4e4b\u524d\uff0c\u7ed9\u5b9a\u8f68\u9053\u4e2d\u7684 API \u7248\u672c\u53ef\u80fd\u4e0d\u4f1a\u88ab\u5f03\u7528\uff0c\u81f3\u5c11\u53d1\u5e03\u7a33\u5b9a\u7248\u672c\u3002</li> </ul>"},{"location":"cloud/k8s/ckad/ckad-8/#api_5","title":"API\u7248\u672c\u53d1\u5c55","text":"<p>\u7248\u672c\u7684\u53d1\u5c55\u5386\u53f2\u5927\u6982\u662f\u8fd9\u6837\u7684\uff1a     <code>v1alpha1</code> =&gt; <code>v1alpha2</code> =&gt; <code>v1beta1</code> =&gt; <code>v1</code>  GA\u7248\u672c\uff08General Availability\uff09</p> <p>\u5f53\u4ea7\u54c1\u8fbe\u5230 GA \u65f6\uff0c\u5b83\u53ef\u4ee5\u901a\u8fc7\u516c\u53f8\u7684\u4e00\u822c\u9500\u552e\u6e20\u9053\u83b7\u5f97\uff0c\u800c\u4e0d\u662f\u7528\u4e8e\u6d4b\u8bd5\u548c\u7528\u6237\u53cd\u9988\u7684 \u6709\u9650\u7248\u672c \u6216 \u6d4b\u8bd5\u7248\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\u66f4\u65b0\u8d44\u6e90\u4f7f\u7528\u7684\u7248\u672c\uff1a <pre><code>kubectl convert -f &lt;old-yaml-file&gt; --output-version &lt;new-api&gt;\n\n# \u4e3e\u4f8b\uff1a\u628a\u4e00\u4e2a\u540d\u4e3a nginx \u7684Deployment\u8d44\u6e90\u4ece\u7248\u672c `apps/v1beta1` \u66f4\u65b0\u5230 `apps/v1`\n# \u8be5\u547d\u4ee4\u4f1a\u8f93\u51fa\u4e00\u4e2a\u65b0\u7684yaml\u683c\u5f0f\u7684\u5b9a\u4e49\nkubectl convert -f nginx-old.yaml --output-version apps/v1 &gt; nginx-new.yaml\n</code></pre></p> <p>Warning</p> <p><code>k convert</code>\u53ef\u80fd\u5e76\u4e0d\u662f\u9ed8\u8ba4\u53ef\u7528\u7684\uff0c\u5b83\u662f\u4e00\u4e2a\u989d\u5916\u7684\u63d2\u4ef6\uff0c\u9700\u8981\u81ea\u5df1\u5b89\u88c5\uff0c\u6559\u7a0b\u5728\u8fd9\u91cc  1.\u4e0b\u8f7dbinary\u6587\u4ef6<code>curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl-convert\"</code>  2.\u7ed9binary\u6587\u4ef6\u53ef\u6267\u884c\u7684\u6743\u9650\uff1a<code>chmod +x kubectl-convert</code>  3.\u5c06binary\u6587\u4ef6\u79fb\u52a8\u5230bin\u6587\u4ef6\u5939\u4e0b<code>mv kubectl-convert /usr/local/bin</code>  4.\u73b0\u5728\u53ef\u7528\u4f7f\u7528\uff1a<code>k-convert --help</code></p> <p>Note</p> <p>Kubernetes API versions \u662fKubernetes\u672c\u8eab\u7684\u7248\u672c\uff0c\u5927\u6982\u957f\u8fd9\u6837\uff1a<code>1.22.2</code>\uff0c\u6570\u5b57\u5206\u522b\u4ee3\u8868\uff1a  - <code>1</code>: \u4e3b\u7248\u672c / major version  - <code>22</code>: \u6b21\u8981\u7248\u672c / minor version  - <code>2</code>: \u8865\u4e01\u7248\u672c / patch version </p>"},{"location":"cloud/k8s/ckad/ckad-8/#_2","title":"\u81ea\u5b9a\u4e49\u8d44\u6e90","text":"<p>\u6211\u4eec\u90fd\u77e5\u9053\u65b0\u5efa\u4e00\u4e2aDeployment\u4f1a\u81ea\u52a8\u751f\u6210\u5bf9\u5e94\u7684Pod\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7531k8s\u81ea\u5e26\u7684\u7684Controller\u63a7\u5236\uff0c\u62e5\u6709\u7c7b\u4f3c\u7684Controller\u7684\u8fd8\u6709ReplicaSet\uff0cDeployment\uff0cJob\uff0cCronjob\uff0cStatefulset\uff0cNamespace\u3002</p> <p>\u5982\u679c\u6211\u4eec\u60f3\u8981\u81ea\u5b9a\u4e49\u4e00\u4e2a\u8d44\u6e90\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u80fd\u8981\u5efa\u7acb\u4e24\u6837\u4e1c\u897f\uff1a</p> <p>1.Resource, \u8fd9\u91ccyaml\u6587\u4ef6\u8981\u5305\u542bapiVersion\uff0ckind\uff0cmetadata\u548cspec\uff0c\u4f46kind\u503c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u3002\u4e3e\u4f8b\uff1a</p> <p><pre><code># flightticket.yaml\napiVersion: flights.com/v1\nkind: FlightTicket\nmetadata:\n  name: my-flight-ticket\nspec:\n  from: Mumbai\n  to: London\n  number: 2\n</code></pre> 2.CRD = Custom Resource Definition\u3002kind\u503c\u4e3a <code>CustomResourceDefinition</code></p> <pre><code># flightticket-custom-definition.yaml\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: flighttickets.flights.com   # =spec.names.plural+\".\"+spec.group\nspec:\n  scope: namespaced     # \u53ef\u4ee5\u662fnamespaced\u6216\u8005cluster\n  group: flights.com    # API\u7ec4\uff0c\u662fResource\u4e2dapiVersion\u7684\u503c\n  names:\n    kind: FlightTicket  # Resource \u540d\uff0c\u662fResource\u4e2dkind\u7684\u503c\n    singular: flightticket\n    plural: flighttickets\n    shortNames:\n      - ft\n  versions:\n    - name: v1\n      served: true      # apiserver\u7528\u7684\u7248\u672c\uff0cso that it\u2019s being served via REST API. preferred version\uff1f\n      storage: true     # storage version\n  schema:               \n    openAPIV3Schema:    # shema\u5b9a\u4e49\u4e86\u65b0\u5efa\u8be5Resource\u4e2dspec\u7684\u503c\n      type: object\n      properties:\n        spec:\n          type: object\n          properties:\n            from:\n              type: string\n            to:\n              type: string\n            numer:\n              type: integer\n              minimum: 1\n              maximum: 10\n</code></pre> <p>3.\u81ea\u5b9a\u4e49\u63a7\u5236\u5668\uff08Controller\uff09</p> <p>Controller\u8d1f\u8d23\u76d1\u89c6\u8d44\u6e90<code>FlightTicket</code>\u7684\u72b6\u6001\uff0c\u66f4\u65b0\u53ca\u5220\u9664\uff0c\u5e76\u5728<code>FlightTicket</code>\u88ab\u521b\u5efa\u7684\u65f6\u5019\u8c03\u7528\u8ba2\u98de\u673a\u7968\u7684API\uff08\u6bd4\u5982<code>https:book-flight.com/api</code>\uff09\u3002\u7406\u8bba\u4e0aController\u53ef\u4ee5\u7528\u4efb\u4f55\u7f16\u7a0b\u8bed\u8a00\u4e66\u5199\uff0c\u4f46Go\u6709\u4e00\u4e2a Kubernetes Go Client\uff0c\u91cc\u9762\u6709\u5199Controller\u6240\u9700\u7684\u5305\uff0c\u6bd4\u5982\u7f13\u5b58\u548c\u961f\u5217\u673a\u5236\uff0c\u6a21\u7248\u5728\u8fd9\u91cc\u3002</p> <pre><code>git clone https://github.com/kubernetes/sample-controller.git\ncd sample-controller\n\nvi controller.go                # \u4fee\u6539\u6587\u4ef6\n\ngo build -o sample-controller . # \u7f16\u8bd1\u6587\u4ef6\n\n./sample-controller -kubeconfig=$HOME/.kube/config # \u8fd0\u884c\u6587\u4ef6\uff0c\u5c06`$HOME/.kube/config`\u505a\u4e3a\u53c2\u6570\u7a7f\u8fdb\u53bb\n</code></pre> <p><code>controller.go</code>\u6e90\u7801\u5927\u6982\u957f\u8fd9\u6837\uff1a</p> <pre><code>package flightticket\n\nvar controllerKind = apps.SchemeGroupVersion.WithKind(\"FlightTicket\") ...\nfunc (dc *FlightTicketController) callBookFlightAPI( ...\n</code></pre> <p>\u6211\u4eec\u4e00\u822c\u628aController\u6253\u5305\u5230Docker\u955c\u50cf\u4e2d\uff0c\u5e76\u5728\u4e00\u4e2aPod\u4e2d\u8fd0\u884c\u3002</p> <p>4.\u7528<code>kubectl create -f</code>\u521b\u5efa CRD\u6587\u4ef6 \u548c Resource\u6587\u4ef6 <pre><code>k create -f flightticket-custom-definition.yaml\n\nk create -f flightticket.yaml\nk get flightticket\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-8/#deployment-strategies","title":"Deployment Strategies","text":"<p>\u6211\u4eec\u4e4b\u524d\u8ba8\u8bba\u8fc7\u4e24\u4e2aDeployment Strategies\uff0c\u7136\u800c\u8fd8\u6709\u66f4\u591a\u7684Strategies\uff1a</p> <ol> <li><code>RollingUpdate</code>\uff1a\uff08\u9ed8\u8ba4\u7684Strategy\uff09\u5173\u4e00\u4e2a\u65e7\u7684Pod\uff0c\u65b0\u5efa\u4e00\u4e2a\u65b0\u7684Pod\uff0c\u4ee5\u4fdd\u8bc1\u7528\u6237\u7528\u6c38\u8fdc\u53ef\u4ee5\u8bbf\u95ee\u5230</li> <li><code>Recreate</code>\uff1a\u5173\u95ed\u6240\u6709\u65e7Pod\uff0c\u7136\u540e\u5728\u5efa\u7acb\u65b0Pod</li> <li><code>Blue/Green</code>\uff1a\u65e7Pod\u662fBlue\u7ec4\uff0c\u65b0Pod\u662fGreen\u7ec4\uff0c\u5148\u505a\u6d4b\u8bd5\uff0c\u5c06\u7528\u6240\u6709\u7684traffic\u90fd\u5bfc\u5230Blue\u4e0a\u53bb\uff0c\u5f53\u6d4b\u8bd5\u901a\u8fc7\u540e\uff0c\u6240\u6709traffic\u90fd\u6539\u5230Green\u7ec4\u4e0a\u53bb\u3002</li> <li><code>Canary</code>\uff1a\u5728\u8be5Strategies\u4e2d\uff0c\u65b0\u65e7Pod\u4e5f\u540c\u65f6\u5b58\u5728\uff0c\u7136\u800c\uff0c\u5927\u90e8\u5206traffic\u8fd8\u662f\u8bbf\u95ee\u65e7Pod\uff0c\u53ea\u6709\u4e00\u5c0f\u90e8\u5206traffic\u8bbf\u95ee\u65b0Pod</li> </ol>"},{"location":"cloud/k8s/ckad/ckad-8/#bluegreen","title":"Blue/Green","text":"<p>\u8be5Strategy\u5176\u5b9e\u53ef\u4ee5\u901a\u8fc7Istio\u66f4\u8f7b\u677e\u5730\u5b9e\u73b0\uff0c\u4f46\u6211\u4eec\u8fd9\u91cc\u5148\u4e0d\u4f7f\u7528Istio\u8fd9\u4e2a\u989d\u5916\u7684\u5de5\u5177\u3002k8s\u81ea\u5df1\u53ef\u4ee5\u5b9e\u73b0Blue/Green\uff0c\u5206\u6210\u4e24\u6b65\uff1a</p> <p>1.\u901a\u8fc7Service\u8bbf\u95eeBlue\u7ec4\uff1a <pre><code>...             # Service: svc.yaml\nspec:\n  selector:\n    version: v1\n...\nspec:           # Deployment: blue.yaml\n  template:\n    metadata:\n      name: myapp-pod\n      labels:\n        version: v1\n  selector:\n    matchLabels:\n      version: v1\n...\nspec:           # Deployment: green.yaml\n  template:\n    metadata:\n      name: myapp-pod\n      labels:\n        version: v2\n  selector:\n    matchLabels:\n      version: v2\n</code></pre> 2.\u4fee\u6539Service\u6807\u7b7e\uff0c\u4ece\u800c\u8bbf\u95eeGreen\u7ec4\uff1a <pre><code>...             # Service: svc.yaml\nspec:\n  selector:\n    version: v2\n</code></pre></p>"},{"location":"cloud/k8s/ckad/ckad-8/#canary","title":"Canary","text":"<p>\u5728\u8be5Strategies\u4e2d\uff0c\u65b0\u65e7Pod\u4e5f\u540c\u65f6\u5b58\u5728\uff0c\u7136\u800c\uff0c\u5927\u90e8\u5206traffic\u8fd8\u662f\u8bbf\u95ee\u65e7Pod\uff0c\u53ea\u6709\u4e00\u5c0f\u90e8\u5206traffic\u8bbf\u95ee\u65b0Pod\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u76f8\u5f53\u4e8e\u5728\u505a\u6d4b\u8bd5\u3002\u5f53\u6d4b\u8bd5\u901a\u8fc7\u4e4b\u540e\uff0c\u518d\u628a\u65e7\u7684Pod\u90fd\u53d6\u4ee3\u6389\uff08\u6bd4\u5982\u7528RollingUpdate\uff09\u3002</p> <p>\u5b9e\u73b0\u65b9\u6cd5\uff1a\u7528\u540c\u4e00\u4e2aService\u8bbf\u95ee\u65b0\u65e7\u4e24\u4e2aDeployment\uff08\u7528\u4e00\u4e2a\u4e24\u4e2aDeployment\u4e2d\u90fd\u5b58\u5728\u7684label\u5373\u53ef\uff09\uff0c\u4f46\u662f\u65b0\u65e7\u4e24\u4e2aDeployments\u4e2d\u7684Pod\u6570\u91cf\u4e0d\u540c\uff1a</p> <ul> <li>\u65e7Deployment\u67095\u4e2aPods</li> <li>\u65b0Deployment\u53ea\u67091\u4e2aPod</li> </ul> <p>Warning</p> <p>\u901a\u8fc7\u51cf\u5c11Pod\u7684\u6570\u91cf\u51cf\u5c11traffic\uff0c\u662f\u56e0\u4e3aService\u5bf9\u6bcf\u4e2aPod\u7684\u8bbf\u95ee\u90fd\u662f\u968f\u673a\u7684\uff0c\u5e76\u4e0d\u662f\u4ee5Deployment\u4e3a\u5355\u4f4d\u6765\u8fdb\u884ctraffic\u7684\u5206\u914d\uff01\uff01</p> <p>Note</p> <p>k8s\u4e2d\u6211\u4eec\u65e0\u6cd5\u975e\u5e38\u7cbe\u786e\u7684\u63a7\u5236traffic\u7684\u767e\u5206\u6bd4\uff0c\u4f46<code>Istio</code>\u53ef\u4ee5\uff0c\u6bd4\u598299%\u7684traffic\u8bbf\u95ee\u65e7Pod\uff0c1%\u8bbf\u95ee\u65b0Pod</p>"},{"location":"cloud/k8s/ckad/ckad-8/#helm-chart","title":"Helm Chart","text":"<p>k8s\u6709\u592a\u591aResource\u4e86\uff0c\u6211\u4eec\u7ecf\u5e38\u9700\u8981\u7ed9\u6bcf\u4e2aResource\u5199\u4e00\u4e2aYaml\u6587\u4ef6\uff0c\u7136\u540e\u5206\u522b\u7528<code>k create -f xxx.yaml</code>\u6765\u521b\u5efa\u8fd9\u4e9bResource\u7684\u5bf9\u8c61\u3002\u4fee\u6539\u548c\u5220\u9664\u66f4\u662f\u9700\u8981\u624b\u52a8\u5b8c\u6210\uff0c\u6bd4\u5982\u6211\u8981shopify\u7f51\u7ad9\u5c31\u4f1a\u975e\u5e38\u590d\u6742\u3002</p> <p>Helm\u89e3\u51b3\u4e86\u8fd9\u4e2a\u96be\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u5f53\u4f5cKubernetes\u7684package manager\uff0c\u5b83\u628a\u6240\u6709Resource\u7684\u5bf9\u8c61\u90fd\u6253\u5305\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u53ea\u9700\u8981\u544a\u8bc9Helm\uff0c\u6211\u8981\u4f7f\u7528package <code>shopify</code>\u5373\u53ef\uff1a</p> <p>Helm\u5c06\u666e\u901ayaml\u6587\u4ef6\u7ed3\u6784\u6210 \u6a21\u7248\u6587\u4ef6+\u53d8\u91cf\u6587\u4ef6\u3002</p>"},{"location":"cloud/k8s/ckad/ckad-8/#_3","title":"\u5e38\u7528\u547d\u4ee4\uff1a","text":"<pre><code>helm version\nhelm list\n\n# \u4e0b\u8f7d\u4f46\u662f\u4e0d\u5b89\u88c5\nhelm pull shopify\nhelm pull --untar shopify # \u89e3\u538b\n\n# \u81ea\u5b9a\u4e49/\u4fee\u6539\uff1a\nls shopify\nhelm install new-shopify ./shopify\n\n# \u4e0b\u8f7dChart\u5e76\u4f7f\u7528\nhelm install &lt;AppName&gt; &lt;RepoName&gt;/&lt;ChartName&gt;\nhelm install my-shop bitnami/shopify\n\n\n# \u66f4\u65b0\nhelm upgrade shopify\n\nhelm rollback shopify\n\nhelm uninstall my-shop\n\n# \u5728\u9ed8\u8ba4\u7684Chart\u6570\u636e\u5e93\uff08hub\uff09\u4e2d\u641c\u7d22\uff1ahttps://artifacthub.io/\nhelm search hub shopify   \n\n# \u6dfb\u52a0\u989d\u5916\u6570\u636e\u5e93\nhelm repo add bitnami https://charts.bitnami.com/bitnami\n\n# \u5728\u989d\u5916\u7684Chart\u6570\u636e\u5e93\uff08repo\uff09\u4e2d\u641c\u7d22\nhelm search repo shopify   \n# \u67e5\u770b\u5df2\u6dfb\u52a0\u7684\u989d\u5916\u6570\u636e\u5e93\nhelm repo list\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-8/#linux","title":"\u5728Linux\u4e0a\u5b89\u88c5","text":"<pre><code>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3\nchmod 700 get_helm.sh\n./get_helm.sh\n</code></pre>"},{"location":"cloud/k8s/ckad/ckad-8/#_4","title":"\u5176\u4ed6","text":"\u547d\u4ee4 \u63cf\u8ff0 <code>k get clusterrole --no-headers | wc -l</code> \u6570\u7ed3\u679c\u6709\u51e0\u4e2a\uff08\u6ca1\u6709\u8868\u5934\uff09 <code>k api-resources</code> \u67e5\u770b\u8d44\u6e90\u7684\u5168\u79f0\uff0c\u7f29\u5199\uff0capi\u7248\u672c\uff0c\u662f\u5426namespaced\uff0c\u4ee5\u53caKind\u7684\u503c <code>ls /etc/kubernetes/manifests</code> \u8f93\u51fa\u7ed3\u679c\uff1a etcd.yaml   kube-apiserver.yaml   kube-controller-manager.yaml   kube-scheduler.yaml <code>cat /etc/os-release</code> \u67e5\u770b\u5f53\u524dOS\u7cfb\u7edf"},{"location":"cloud/k8s/ckad/ckad-9/","title":"\u5176\u4ed6","text":"<pre><code>kubectl get pods &lt;pod-name&gt; -o custom-columns=NAME:.metadata.name,RSRC:.metadata.resourceVersion\n</code></pre> <pre><code>kubectl get pods --sort-by=.metadata.name\n</code></pre> <p><pre><code>kubectl get pods --field-selector=status.phase!=Running,spec.restartPolicy=Always\n</code></pre> \u9009\u62e9\u5668\u53ef\u4ee5\u662f\uff1a |\u6570\u636e\u5bf9\u8c61  | \u89e3\u91ca |\u53ef\u7528\u5c5e\u6027| |--|--|--| | <code>metadata</code> |  |<code>name</code> <code>namespace</code>| | <code>status</code> |  |<code>phase</code> | | <code>spec</code> |  |\u8be5\u8d44\u6e90\u7c7b\u578b\u4e2dspec\u4e0b\u7684\u6240\u6709\u5c5e\u6027\uff0c\u5982\u679c\u4f60\u60f3\u770b\u5f53\u524d\u8d44\u6e90\uff08\u6bd4\u5982Pod\uff09\u6709\u54ea\u4e9b\u5c5e\u6027\uff0c\u53ef\u7528\u901a\u8fc7<code>k get pod/xxx -o yaml</code> |</p> <pre><code>oc get route --field-selector spec.to.name=${version}-frontend -o custom-columns=URL:.spec.host --no-headers\n</code></pre> <pre><code>apiVersion: route.openshift.io/v1\nkind: Route\nmetadata:\n  labels:\n    app.kubernetes.io/managed-by: argocd\n  name: argocd-server\n  namespace: my-project\n  uid: 7d4bssd45d\nspec:\n  host: argocd-server-b66.xxx.cloud\n  port:\n    targetPort: https\n  tls:\n    insecureEdgeTerminationPolicy: Redirect\n    termination: passthrough\n  to:\n    kind: Service\n    name: argocd-server\n    weight: 100\n  wildcardPolicy: None\n</code></pre>"},{"location":"cloud/openshift/deployment/","title":"App Deployment","text":""},{"location":"cloud/openshift/deployment/#1-namespace","title":"1. Namespace","text":"<p>Create new Namespace/Project: <pre><code>oc create ns my-project\n</code></pre></p> <p>Use the created NS: <pre><code>oc ns my-project\n</code></pre> or <pre><code>oc project my-project\n</code></pre></p>"},{"location":"cloud/openshift/deployment/#2-secrets","title":"2. Secrets","text":"<p>Create Source Secret to pull source code from a private git repo (reference):</p> <ul> <li>the \"username\" is optional</li> <li>the password is a PAT (Github &gt; Personal access tokens (classic))</li> </ul> <p></p>"},{"location":"cloud/openshift/deployment/#31-build-image-without-pipeline","title":"3.1 Build Image without Pipeline","text":""},{"location":"cloud/openshift/deployment/#imagestream","title":"ImageStream","text":"<pre><code>oc create is backend\n</code></pre>"},{"location":"cloud/openshift/deployment/#buildconfig","title":"BuildConfig","text":""},{"location":"cloud/openshift/deployment/#31-build-image-with-pipeline","title":"3.1 Build Image with Pipeline","text":""},{"location":"cloud/openshift/internal_registry/","title":"Internal Registry","text":""},{"location":"cloud/openshift/internal_registry/#internal-registry","title":"Internal Registry","text":"<p>References: - Source video - OC Duc</p> <p>Internal Registry is usually initialized during the OpenShift Cluster Installation, but if not, you can create one manually.</p> <p>Get routes of image registry: <pre><code>oc get svc -n openshift-image-registry\n\n# output:\nNAME                      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)     AGE\nimage-registry            ClusterIP   172.21.203.6   &lt;none&gt;        5000/TCP    6d18h\nimage-registry-operator   ClusterIP   None           &lt;none&gt;        60000/TCP   6d19h\n</code></pre></p> <p>Login to the container image registry: <pre><code>docker login -u openshift -p $(oc whoami -t) &lt;registry_ip&gt;:&lt;port&gt;\n</code></pre></p> <p>docker login -u openshift -p $(oc whoami -t) 172.21.203.6:5000</p>"},{"location":"cloud/openshift/operator/","title":"Operator","text":""},{"location":"cloud/openshift/operator/#operator","title":"Operator","text":"<p>capability levels</p> <p></p> Capability Level Explaination Example(Database Operator) Level 1 - Basic Install an Operator deploys a database by creating <code>Deployment</code>, <code>ServiceAccount</code>, <code>RoleBinding</code>, <code>ConfigMap</code>, <code>PersistentVolumeClaim</code> and <code>Secret</code> object, initializes an empty database schema and signals readiness of the database to accept queries. Level 2 - Seamless Upgrades An Operator managing a database can update an existing database from a previous to a newer version without data loss. The Operator might do so as part of a configuration change or as part of an update of the Operator itself. Level 3 - Full Lifecycle an Operator managing a database provides the ability to create an application consistent backup of the data by flushing the database log and quiescing the write activity to the database files. Level 4 - Deep Insights A database Operator continues to parse the logging output of the database software and understands noteworthy log events, e.g. running out of space for database files and produces alerts. The operator also instruments the database and exposes application level, e.g. database queries per second Level 5 - Auto Pilot A database operator monitors the query load of the database and automatically scales additional read-only slave replicas up and down. The operator also detects subpar index performance and automatically rebuilds the index in times of reduced load. Further, the operator understands the normal performance profile of the database and creates alerts on excessive amount of slow queries. In the event of slow queries and high disk latency the Operator automatically transitions the database files to another PersistentVolume of a higher performance class."},{"location":"cloud/openshift/operator/#s2i","title":"S2I","text":""},{"location":"cloud/openshift/operator/#method-1-openshift-buildconfig","title":"Method 1: OpenShift BuildConfig","text":""},{"location":"cloud/openshift/operator/#method-2","title":"Method 2","text":""},{"location":"cloud/openshift/pipeline/","title":"Pipeline","text":""},{"location":"cloud/openshift/pipeline/#triggers","title":"Triggers","text":"<p>Trigger includes the following resources: - EventListener:      This object will automatically generated Route. If want to use <code>https</code> instead of <code>http</code>, in the auto-generated Route, add this to  <code>.spec</code>:</p> <pre><code>```yaml\ntls:\n    termination: edge\n    insecureEdgeTerminationPolicy: Redirect\n```\n</code></pre> <ul> <li>TriggerTemplates</li> <li>TriggerBindings or ClusterTriggerBindings</li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/","title":"00 tipps","text":"<p>Compatible versions: 4.10, 4.12, 4.14</p>"},{"location":"cloud/openshift/do280/00_tipps/#tipps","title":"Tipps","text":"<ul> <li>learn how to use the documentation for \"big picture\" stuff. </li> <li>For the smaller scale (writing yaml) i extensively used <code>oc explain</code>. </li> <li><code>oc set volume --help</code></li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#resources","title":"Resources","text":"<ul> <li>EX280 Description</li> </ul> <ul> <li>Studying &amp; Walk through</li> <li>DO180\uff1a<ul> <li>Chapter 5: Manage Storage for Application Config &amp; Data: Limit etc</li> <li>Chapter 6: Reliability: Health Probe etc</li> </ul> </li> <li>OC CLI Reference 4.14</li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#available-resource-in-exam","title":"available resource in exam???","text":"<ul> <li>a Document pdf</li> <li>?docs https://docs.openshift.com/container-platform/4.14</li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#browser","title":"Browser","text":"<p><code>Ctrl+F</code> search on browser</p>"},{"location":"cloud/openshift/do280/00_tipps/#chapters-to-review","title":"Chapters to review","text":""},{"location":"cloud/openshift/do280/00_tipps/#do280","title":"DO280","text":""},{"location":"cloud/openshift/do280/00_tipps/#2-helm-chart","title":"2. Helm Chart","text":"<ul> <li>use helm chart</li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#3-authentication-and-authorization","title":"3. Authentication and Authorization","text":"<ul> <li>htpasswd</li> <li>CURD</li> <li>default roles(cluster-admin, self-provisioner)</li> <li>clusterrolebinding</li> <li>remove self-provisioner role from all users</li> <li>Remove user <code>kubeadmin</code>(also in doc)</li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#4-network-security","title":"4. Network Security","text":"<ul> <li>create cert with the given tool</li> <li>apply networkPolicy</li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#6-enable-developer-self-service","title":"6. Enable Developer Self-Service","text":"<ul> <li>cluster quotas</li> <li>self-provisioner role</li> <li>create-bootstrap-project-template</li> <li>limitrage </li> <li>template.yaml</li> <li>oc edit projects.config.openshift.io cluster</li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#7-manage-k8s-operator","title":"7. Manage k8s Operator","text":"<p>install operator with cli</p>"},{"location":"cloud/openshift/do280/00_tipps/#8-security-context-constraints","title":"8. Security Context Constraints","text":"<ul> <li>create scc</li> <li>use new sa: <code>oc set sa</code></li> <li>create cronjob, update the account</li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#9-update","title":"9. Update","text":""},{"location":"cloud/openshift/do280/00_tipps/#do180","title":"DO180","text":""},{"location":"cloud/openshift/do280/00_tipps/#5-manage-storage-for-application-configuration-and-data","title":"5. Manage Storage for Application Configuration and Data","text":"<ul> <li>storageclass</li> <li>provisioning PV</li> <li> <p>PVC</p> </li> <li> <p>create secret</p> </li> <li>create configmap</li> <li>mount secret/cm: <code>oc set volume</code></li> </ul>"},{"location":"cloud/openshift/do280/00_tipps/#6-configure-applications-for-reliability","title":"6. Configure Applications for Reliability","text":"<ul> <li>health probe</li> <li>resource limit: trouble shooting question <code>.containers[].resources.limits.memory</code> -&gt; need more</li> <li>auto scaling</li> </ul>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/","title":"1. Manifest & Kustomize","text":"<p>imperative commands \u547d\u4ee4\u5f0f means using CLIs directly. Disadvantage:</p> <ul> <li>Impaired reproducibility</li> <li>Lacking version control</li> <li>Lacking support for GitOps</li> </ul> <p>declarative commands \u58f0\u660e\u5f0f is a way to manage resources using manifest file (<code>YAML</code> or <code>JSON</code>)</p> <p>Both Kubernetes and Openshift have both imperative and declarative options. However in production, we recommend to use imperative for developing and experimenting, declarative for deploying, maintaining and documenting. </p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#1-manifest","title":"1. Manifest / \u914d\u7f6e","text":""},{"location":"cloud/openshift/do280/01_manifest_kustimize/#create-manifest","title":"Create Manifest","text":"<p>Where to get the YAML file?</p> <ol> <li>Use the YAML view of a resource in the web console.</li> <li> <p>Use imperative commands with the <code>--dry-run=client</code> option to generate manifests. E.g.: <pre><code>kubectl create deployment hello-openshift -o yaml \\\n    --image registry.ocp4.example.com:8443/redhattraining/hello-world-nginx:v1.0 \\\n    --save-config \\ \n    --dry-run=client \\ \n    &gt; ~/my-app/example-deployment.yaml\n</code></pre></p> <ul> <li>The <code>--save-config</code> saves the current config (in JSON format) in the annotation <code>kubectl.kubernetes.io/last-applied-configuration</code>. \u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u7248\u672c\u63a7\u5236\u7684\u4f5c\u7528\uff0c\u7528\u6765\u8bb0\u5f55\u4e0a\u4e00\u6b21deployment\u7684\u914d\u7f6e\uff0c\u4ee5\u786e\u4fdd\u8d44\u6e90\u72b6\u6001\u4e0e\u914d\u7f6e\u6587\u4ef6\u4e00\u81f4\u3002</li> <li>The <code>--dry-run=client</code> option prevents the command from creating resources in the cluster.</li> </ul> </li> </ol> <p>Doc</p> <p>To see the details of the field, for example <code>deployment.spec.template.spec</code>: <pre><code>kubectl explain deployment.spec.template.spec\n</code></pre></p> <p>Multiple src in single YAML Manifest</p> <p>Use a line of <code>---</code> to separate the resources</p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#customize-manifest","title":"Customize Manifest","text":"<p>\u4f60\u53ef\u4ee5\u4fee\u6539\u4ee5\u4e0b\u8fd9\u4e9b\u5185\u5bb9\uff1a</p> <ol> <li>Remove empty fields</li> <li>Changing attributes such as\uff1a<ul> <li><code>namespace</code></li> <li><code>spec.replicas</code> </li> <li><code>spec.template.spec.containers[].ports.containerPort</code></li> </ul> </li> </ol>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#create-src-with-manifest","title":"Create src with Manifest","text":"<ul> <li>Creating with 1 Manifest file (or a URL):   <pre><code>kubectl create -f resource.yaml\nkubectl apply -f resource.yaml\n\nkubectl create -f https://example.com/example-apps/deployment.yaml\n</code></pre></li> <li>Create with all Manifest files under one directory   <pre><code>kubectl create -R -f ~/my-app\n</code></pre></li> </ul>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#update-src-with-manifest","title":"Update src with Manifest","text":"<p>\u66f4\u65b0\u8d44\u6e90\uff1a</p> <pre><code>kubectl apply -f resource.yaml\n</code></pre> <p>Compare: <code>apply</code> vs <code>create</code></p> <p>\u27a1\ufe0f <code>oc apply</code> is more powerful</p> <code>kubectl apply</code> <code>kubectl create</code> Type declarative imperative consider thecurrent state of a Live Resource? Yes, compare: 1.Live configuration 2.Manifest file 3.Configuration in the annotation <code>last-applied-configuration</code> No can it updateLive Resource? Yes No \u26a0\ufe0f auto annotated in  <code>kubectl.kubernetes.io/last-applied-configuration</code> yes no, you need to add <code>--save-config</code> flag <p>rollout</p> <p>If an updated Manifest changes only values in Secret or ConfigMap, the updated Manifest does NOT generate new pods automatically. Instead:</p> <ul> <li>use <code>oc rollout restart deployment/deployment-name</code> to force the restart \u2192 \u662f\u91cd\u542f\uff0c\u4e0d\u662f\u56de\u6eda\u5230\u4e0a\u4e00\u4e2a\u7248\u672c</li> <li>if <code>spec.replica</code> == 1, you can also delete the previous pod.</li> </ul> <p><code>oc delete pod ...</code> VS <code>oc rollout restart deployment ...</code></p> Feature / Behavior <code>oc delete pod ...</code> <code>oc rollout restart deployment ...</code> What happend? OpenShift\u2019s ReplicaSet will detect that a pod is missing and create a new one to maintain the desired number of replicas. This triggers a new rollout of the deployment by restarting all pods in a controlled manner. Effect Deletes a specific pod, OpenShift recreates it Restarts all pods in the deployment Scope Affects only the deleted pod Affects all pods in the deployment Triggers new rollout? \u274c No \u2705 Yes Secret update (mounted as volume) \u2705 Yes, automatically picked up \u2705 Yes, but not necessary Secret update (used as env var) \u274c No, old value persists \u2705 Yes, ensures new value Best use case Restarting a single pod due to issues such as: stuck process, memory leak. Ensuring all pods restart and pick up new changes"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#patch-manifest","title":"Patch Manifest","text":"<p>The <code>oc patch</code> command updates or adds fields in an existing object:</p> <ul> <li>from json   <pre><code>oc patch deployment hello -p \\\n  '{\"spec\":{\"template\":{\"spec\":{\"resources\":{\"requests\":{\"cpu\": \"100m\"}}}}}}'\n</code></pre></li> <li> <p>from a patch file:   <pre><code>oc patch deployment hello --patch-file \\\n  ~/volume-mount.yaml\n</code></pre></p> <p>patch \u6587\u4ef6</p> <p>\u4e0a\u8ff0\u4f8b\u5b50\u4e2d\uff0coc patch \u4f7f\u7528\u7684 patch \u6587\u4ef6 \u4e0d\u662f \u4e00\u4e2a\u5b8c\u6574\u7684 Deployment \u5b9a\u4e49\u3002\u5b83\u53ea\u9700\u8981\u5305\u542b\u4f60\u60f3\u8981\u4fee\u6539\u7684\u90e8\u5206\u3002Patch \u6587\u4ef6\u53ef\u4ee5\u662f JSON \u6216 YAML \u683c\u5f0f\u3002\u4e3e\u4f8b<code>volume-mount.yaml</code> <pre><code>spec:\n  template:\n    spec:\n      containers:\n        - name: hello-container # \u26a0\ufe0f \u6307\u5b9a\u8981\u4fee\u6539\u7684\u5bb9\u5668\n          volumeMounts:\n            - name: my-volume\n              mountPath: /data\n      volumes:\n        - name: my-volume\n          emptyDir: {}\n</code></pre></p> <p>\u5e38\u89c1\u9519\u8bef\uff1a</p> <ul> <li>\u274c \u5199\u6210\u5b8c\u6574\u8d44\u6e90\u5bf9\u8c61    </li> <li>\u274c \u5b57\u6bb5\u540d\u62fc\u9519\u6216\u5c42\u7ea7\u4e0d\u5bf9  </li> <li>\u274c containers \u5217\u8868\u4e2d\u6ca1\u5199\u5bb9\u5668\u540d </li> <li>\u274c \u7528 JSON Merge Patch \u5199\u590d\u6742\u7ed3\u6784    </li> </ul> </li> </ul>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#validate-manifest","title":"Validate Manifest","text":"<ul> <li><code>--dry-run=server</code>: submits a server-side request without persisting the resource.</li> <li><code>--validate=true</code>: uses a schema to validate the input and fails the request if it is invalid. \u6bd4\u5982json/yaml\u8bed\u6cd5\uff0c\u6570\u636e\u7c7b\u578b\uff0c\u548c\u5fc5\u987b\u8981\u6709\u7684key-value</li> </ul> <p>Compare: <code>server</code> vs <code>client</code></p> <p>\u4e24\u8005\u90fd\u4e0d\u4f1a\u771f\u6b63\u521b\u5efa\u6216\u66f4\u65b0\u8d44\u6e90\u3002</p> <code>--dry-run=client</code> <code>--dry-run=server</code> where? \u5728\u672c\u5730\u8fdb\u884c\u9a8c\u8bc1\uff0c\u4e0d\u4f1a\u4e0e Kubernetes \u670d\u52a1\u5668\u4ea4\u4e92\u3002 \u5728\u670d\u52a1\u5668\u7aef\u8fdb\u884c\u9a8c\u8bc1\u3002\u5b83\u5c06\u628a\u914d\u7f6e\u6587\u4ef6\u53d1\u9001\u5230 Kubernetes API \u670d\u52a1\u5668\uff0c\u7531\u670d\u52a1\u5668\u68c0\u67e5\u6587\u4ef6\u5185\u5bb9\u662f\u5426\u5728\u96c6\u7fa4\u4e2d\u6709\u6548\uff08\u4f8b\u5982\uff0c\u5b57\u6bb5\u503c\u662f\u5426\u6b63\u786e\u3001\u8d44\u6e90\u662f\u5426\u5b58\u5728\u7b49\uff09 suitable for \u68c0\u67e5 YAML \u6587\u4ef6\u7684\u57fa\u672c\u683c\u5f0f\u548c\u7ed3\u6784\uff0c\u9002\u5408\u5feb\u901f\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u6709\u660e\u663e\u9519\u8bef \u66f4\u4e25\u683c\uff0c\u9002\u5408\u9700\u8981\u7cbe\u786e\u9a8c\u8bc1\u7684\u573a\u666f"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#compare-manifest","title":"Compare Manifest","text":"<p>To review differences between live objects and manifests in current directory(<code>.</code>).  \u2192 \u53ea\u662f\u6bd4\u8f83\uff0c\u4e0d\u8fdb\u884c\u5b9e\u8d28\u66f4\u6539</p> <pre><code>oc diff -f .\n# or\nkubectl diff -f .\n</code></pre>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#delete-resource-with-manifest","title":"Delete Resource with Manifest","text":"<pre><code>oc delete -f .\n</code></pre> <p>OpenShift looks at the resource types and names in the YAML files.</p> <p>Danger</p> <p>Live Resources and the YAML file does NOT have to be identical!</p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#2-kustomize","title":"2. Kustomize","text":"<ul> <li>Walk through video</li> <li>kustomization YAML doc</li> </ul> <p>Kustomize \u662f\u4e00\u4e2a\u5f00\u6e90\u7684Kubernetes \u914d\u7f6e\u7ba1\u7406\u5de5\u5177\uff0c\u7528\u4e8e\u5bf9Kubernetes \u6e05\u5355\u6587\u4ef6\u8fdb\u884c\u81ea\u5b9a\u4e49\u548c\u4fee\u6539\u3002 \u5b83\u5141\u8bb8\u7528\u6237\u901a\u8fc7\u5206\u5c42\u548c\u58f0\u660e\u5f0f\u7684\u65b9\u5f0f\u7ba1\u7406\u548c\u5b9a\u5236\u5e94\u7528\u7a0b\u5e8f\u7684\u914d\u7f6e\uff0c\u800c\u65e0\u9700\u76f4\u63a5\u4fee\u6539\u539f\u59cb\u7684\u6e05\u5355\u6587\u4ef6\uff0c\u4fc3\u8fdb\u4e86\u914d\u7f6e\u7684\u590d\u7528\u548c\u53ef\u7ef4\u62a4\u6027\u3002\u6211\u4eec\u53ef\u4ee5\u7528Kustomize\u914d\u7f6e\u591a\u4e2a\u73af\u5883\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>development</li> <li>staging</li> <li>testing</li> <li>production</li> </ul> <p>Info</p> <p>Both <code>kubectl</code> and <code>oc</code> commands integrated the Kustomize tool.</p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#files","title":"Files","text":"<p>Kustomize\u6839\u76ee\u5f55\u4e0b\u6709\u4e24\u4e2a\u6587\u4ef6\u5939\uff1a\u4e00\u4e2a<code>base/</code>\uff0c\u4e00\u4e2a<code>overlays/</code></p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#base","title":"<code>Base</code>","text":"<p>The <code>base/kustomization.yaml</code> file includes a list that includes all resource files under <code>base/</code>. E.g.:</p> Example 1: Example 2: base/kustomization.yaml <pre><code># kustomization.yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nresources:\n- configmap.yaml\n- deployment.yaml\n- secret.yaml\n- service.yaml\n- route.yaml\n</code></pre> <pre><code># kustomization.yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nresources:\n- database\n- exoplanets # \u2b05\ufe0f\u00a0\u8fd9\u662f\u4e2a\u6587\u4ef6\u5939\uff01\n</code></pre> File structure: <pre><code>.\n\u251c\u2500\u2500 base\n\u2502   \u251c\u2500\u2500 configmap.yaml\n\u2502   \u251c\u2500\u2500 deployment.yaml\n\u2502   \u251c\u2500\u2500 secret.yaml\n\u2502   \u251c\u2500\u2500 service.yaml\n\u2502   \u2514\u2500\u2500 kustomization.yaml\n\u2514\u2500\u2500 overlays  \n    \u251c\u2500\u2500 kustomization.yaml\n    \u2514\u2500\u2500 patch-replicas.yaml\n</code></pre> <pre><code>.\n\u251c\u2500\u2500 base\n\u2502   \u251c\u2500\u2500 database \n\u2502   \u2502   \u251c\u2500\u2500 configmap.yaml\n\u2502   \u2502   \u251c\u2500\u2500 deployment.yaml\n\u2502   \u2502   \u251c\u2500\u2500 kustomization.yaml\n\u2502   \u2502   \u251c\u2500\u2500 secret.yaml\n\u2502   \u2502   \u2514\u2500\u2500 service.yaml\n\u2502   \u251c\u2500\u2500 exoplanets \n\u2502   \u2502   \u251c\u2500\u2500 configmap.yaml\n\u2502   \u2502   \u251c\u2500\u2500 deployment.yaml\n\u2502   \u2502   \u251c\u2500\u2500 kustomization.yaml\n\u2502   \u2502   \u251c\u2500\u2500 route.yaml\n\u2502   \u2502   \u251c\u2500\u2500 secret.yaml\n\u2502   \u2502   \u2514\u2500\u2500 service.yaml\n\u2502   \u2514\u2500\u2500 kustomization.yaml \n\u2514\u2500\u2500 overlays  \n    \u2514\u2500\u2500 production\n        \u251c\u2500\u2500 kustomization.yaml\n        \u2514\u2500\u2500 patch-replicas.yaml\n</code></pre>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#overlays","title":"<code>Overlays</code>","text":"<p>Overlays overwrites some setting without modifying the original Base. Each Overlays contains a <code>kustomization.yaml</code> file.</p> <p></p> <p>Relationship: Base + Overlays</p> <ul> <li>The <code>kustomization.yaml</code> file can refer to one or more directories as bases. </li> <li>Multiple overlays can use a common base kustomization directory.</li> </ul> <pre><code># result of `tree .`\nbase\n\u251c\u2500\u2500 configmap.yaml\n\u251c\u2500\u2500 deployment.yaml\n\u251c\u2500\u2500 secret.yaml\n\u251c\u2500\u2500 service.yaml\n\u251c\u2500\u2500 route.yaml\n\u251c\u2500\u2500 kustomization.yaml\noverlay\n\u2514\u2500\u2500 development\n    \u2514\u2500\u2500 kustomization.yaml\n\u2514\u2500\u2500 testing\n    \u2514\u2500\u2500 kustomization.yaml\n\u2514\u2500\u2500 production\n    \u251c\u2500\u2500 kustomization.yaml\n    \u2514\u2500\u2500 patch.yaml\n</code></pre> <pre><code># overlays/development/kustomization.yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nnamespace: dev-env\nresources:\n- ../../base\n</code></pre> <p>extra Attributes</p> <p>These are the extra Attributes provided by Kustomize to use in <code>kustomization.yaml</code>:</p> Field Description <code>namespace</code> Set a specific namespace for all resources. <code>namePrefix</code> Add a prefix to the name of all resources. <code>nameSuffix</code> Add a suffix to the name of all resources. <code>commonLabels</code> Add labels to all resources and selectors. <code>commonAnnotations</code> Add annotations to all resources and selectors. <pre><code>apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\n# common attributes / cross-cutting attributes\nnamespace: first-project\nnameSuffix: -v2\nnamePrefix: chuying-\n\ncommonLabels:\n  owner: chuying\n    app: bingo\ncommonAnnotations:\n  env: test\n  oncallPager: 800-555-1212\n</code></pre>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#patch","title":"Patch","text":"<p>patch \u662f <code>overlays</code> \u7528\u4e8e\u4fee\u6539 <code>base</code> \u8d44\u6e90\u7684\u5177\u4f53\u65b9\u5f0f\uff0c\u6bd4\u5982 <code>overlays/production/patch.yaml</code> \u6587\u4ef6\u5e2e\u52a9\u5b9e\u73b0\u4e86 <code>production</code> overlay\u3002</p> <p>The patch mechanism has several important keys: <code>patch</code>, <code>target</code> and <code>path</code>.</p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#way-1-patch-and-target","title":"Way 1: <code>patch</code> and <code>target</code>","text":"<pre><code># overlays/production/patch.yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nnamespace: test-env\n\n# list of patches\npatches: \n- patch: |-\n    - op: replace             # operation\n      path: /metadata/name    # '/' indicates DOC ROOT, here it means deployment.metatdata.name\n      value: frontend-test\n  target:                     # target\n    kind: Deployment\n    name: frontend\n- patch: |-                   \n    - op: replace\n      path: /spec/replicas\n      value: 15\n  target:\n    kind: Deployment\n    name: frontend\nresources:                    # used \"base\"\n- ../../base\ncommonLabels:                 # add label to all the resources\n  env: test\n</code></pre> <p><code>|-</code></p> <p>is a block scalar indicator that handles multi-line content.</p> <p>with <code>|-</code>: <pre><code>patches:\n  - patch: |-                   \n    - op: replace\n      path: /spec/replicas\n      value: 15\n</code></pre></p> <p>without <code>|-</code>: <pre><code>patchs:\n  - patch: \"- op: replace\\n  path: /spec/replicas\\n  value: 15\"\n</code></pre></p> <p><code>|-</code> vs <code>|</code></p> <p><pre><code>example: |-\n  Line 1\n  Line 2\n</code></pre> This results in <code>Line 1\\nLine 2</code> (without a trailing newline).</p> <p><pre><code>example: |\n  Line 1\n  Line 2\n</code></pre> This results in <code>Line 1\\nLine 2\\n</code> (with a trailing newline).</p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#way-2-patch-and-path","title":"Way 2: <code>patch</code> and <code>path</code>","text":"<pre><code># patch.yaml \napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: frontend-prod\nspec:\n  replicas: 5\n</code></pre> <pre><code>apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nnamespace: prod-env\n\n# list of patches\npatches:\n- path: patch.yaml          # the name of Patch File\n  target:                   # target\n    kind: Deployment\n    name: frontend\n  options:\n    allowNameChange: true   # this OPTION enables kustomization to update the name by using a patch YAML file\nresources:                  # used \"base\"\n- ../../base\ncommonLabels:               # add label to all the resources\n  env: prod\n</code></pre>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#way-3","title":"Way 3","text":"<p>rebuild the resouce by using the same name. Kinda like a trick</p> <pre><code># replicas.yaml\nkind: Deployment\nmetadata:\n  name: frontend\n  namespace: default\nspec:\n  replicas: 2\n</code></pre> <pre><code># kustomization.yaml\npatches:\n  - replicas.yaml\n</code></pre>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#clis","title":"CLIs","text":"<p>Example: I want to use <code>overlay/production</code> now:</p> Command Description <code>oc/kubectl kustomize overlay/production</code> \u6253\u5370\u67e5\u770b\u8be5 Overlay \u4f1a\u751f\u6210\u7684manifests <code>oc/kubectl apply -k overlay/production</code> use <code>overlay/production</code> layer. - Update/create resources.- <code>-k</code> flag means: applies a kustomization- \u5148\u4f7f\u7528 Kustomize \u751f\u6210\u6700\u7ec8\u7684 YAML \u914d\u7f6e\uff08\u4f46\u4e0d\u8f93\u51fa\uff09\uff0c\u7136\u540e\u5c06\u5176\u5e94\u7528\u5230 Kubernetes \u96c6\u7fa4 <code>oc/kubectl apply -k base</code> use <code>base</code> layer <code>oc/kubectl delete -k overlay/production</code> delete resources that were deployed by using Kustomize"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#generator","title":"Generator","text":"<p>Kustomize has configMapGenerator and secretGenerator fields that generate <code>configmap</code> and <code>secret</code> resources. Generators help to manage the content of <code>configmaps</code> and <code>secrets</code>, by taking care of encoding and including content from other sources.</p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#configmapgenerator","title":"configMapGenerator","text":"<p>Definition: The Kustomize's <code>configmapGenerator</code> can generates <code>cm</code> in 3 ways. see example\uff1a <pre><code># kustomization.yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nnamespace: hello-stage\nresources:\n- ../../base\nconfigMapGenerator:\n- name: configmap-1   # 1\ufe0f\u20e3 from file *.properties \n  files:\n    - application.properties\n- name: configmap-2   # 2\ufe0f\u20e3 from env *.env\n  envs:\n    - configmap-2.env\n- name: configmap-3   # 3\ufe0f\u20e3 from literal key-value pair\n  literals:\n    - msg=\"Welcome!\"\n    - enable=\"true\"\n</code></pre></p> <p>Usages: In the deployment file uses the generated <code>configmap</code>: <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hello\n  labels:\n    app: hello\n    name: hello\nspec:\n...output omitted...\n    spec:\n      containers:\n      - name: hello\n        image: quay.io/hello-app:v1.0\n        env:\n        - name: MY_MESSAGE\n          valueFrom:\n            configMapKeyRef:\n              name: configmap-3   # &lt;-- Use the CM by name\n              key: msg\n        - name: MSG_ENABLE\n          valueFrom:\n            configMapKeyRef:\n              name: configmap-3\n              key: enable\n</code></pre></p> <p>Note</p> <ul> <li>By changing the <code>configMapGenerator</code>, Kustomize will generate new <code>configmap</code> in the next <code>oc apply -k</code> process</li> <li>the <code>configmap</code> generated by Kustomize Generator behaves a bit differently \u2192 Kustomize appends a hash to the name like this: <pre><code>apiVersion: v1\ndata:\n  application.properties: |\n    Day=Monday\n    Enable=True\nkind: ConfigMap\nmetadata:\n  name: configmap-1-5g2mh569b5    # 1\ufe0f\u20e3 from file\n---\napiVersion: v1\ndata:\n  Enable: \"True\"\n  Greet: Welcome\nkind: ConfigMap\nmetadata:\n  name: configmap-2-92m84tg9kt    # 2\ufe0f\u20e3 from env\n---\napiVersion: v1\ndata:\n  description: literal key-value pair\n  name: configmap-3\nkind: ConfigMap\nmetadata:\n  name: configmap-3-k7g7d5bffd    # 3\ufe0f\u20e3 from literal key-value pair\n---\n...output omitted...\n</code></pre></li> </ul> <p>Danger</p> <p>\u5047\u8bbe\u6211\u4eec\u4fee\u6539\u4e86<code>configMapGenerator</code>\u4e2d\u7684\u4e00\u4e2a\u503c\uff0c\u67d0\u4e2a<code>Deployment</code>\u5728\u4f7f\u7528\u751f\u6210\u7684<code>config</code>\u3002\u7136\u540e\u6211\u7528<code>oc apply -k overlays/production</code>\u5e94\u7528\u8fd9\u4e2a\u4fee\u6539\uff0c\u90a3\u4e48\u6211\u5c06\u5f97\u5230\uff1a</p> <ul> <li>\u4e00\u4e2a\u62e5\u6709\u65b0\u54c8\u5e0c\u503c\u7684cm\uff1a<code>hello-3-696dm8h728</code></li> <li>\u4e00\u4e2a\u4f7f\u7528\u65b0cm\u7684\u65b0Deployment\uff1a<code>hello-55bc55ff9-hrszh</code></li> </ul>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#secretgenerator","title":"secretGenerator","text":"<p>The Kustomize's <code>secretGenerator</code> can generates <code>secret</code> also in 3 ways: file, env, or literals.</p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#generatoroptions","title":"generatorOptions","text":"<p>This <code>generatorOptions</code> can define alternative behavior of the <code>*Generators</code>. For example:</p>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#1-disable-hash-suffix","title":"1. disable hash suffix","text":"<p>Why hash suffix are needed? \u6211\u4eec\u4f7f\u7528<code>oc/kubectl apply -k overlays/production</code>\u5e94\u7528\u4fee\u6539\u65f6\uff0c\u4f1a\u81ea\u52a8\u751f\u6210\u5e26\u6709\u65b0\u54c8\u5e0csuffix\u7684resources\uff0c\u4fdd\u8bc1\u4e86\u4fee\u6539\u88ab\u4f7f\u7528\u5230\u3002</p> <p>But in some case, the hash suffix is not needed. I can disable it with the <code>generatorOptions</code>:</p> <pre><code>generatorOptions:     # &lt;-- The Option\n  disableNameSuffixHash: true\nconfigMapGenerator:   # The Generators\n- name: my-configmap\n  literals:\n    - name=\"configmap-3\"\n    - description=\"literal key-value pair\"\n</code></pre> <p>Warning</p> <p>\u4f18\u5148\u7ea7\uff1a<code>Kustomize</code> \u7684\u89c4\u5219\u662f \u5c40\u90e8\u8bbe\u7f6e &gt; \u5168\u5c40\u8bbe\u7f6e\uff0c\u6240\u4ee5\u5c40\u90e8\u7684 <code>disableNameSuffixHash: false</code> \u4f1a\u751f\u6548\u3002</p> <pre><code>apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\ngeneratorOptions:   \n  disableNameSuffixHash: true       # Global\nconfigMapGenerator:\n  - name: global-config\n    literals:\n      - key1=value1\n    options:\n      disableNameSuffixHash: false  # Local\n      annotations:\n        createdBy: \"local-options\"\n      labels:\n        environment: \"test\"\n</code></pre>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#2-add-labelsannotations","title":"2. Add <code>labels</code>/<code>annotations</code>","text":"<pre><code># \u8fd9\u4e2a\u6807\u7b7e\u5c06\u6dfb\u52a0\u5230\u5f53\u524d\u6587\u4ef6\u4e2d\u6240\u6709\u7684 ConfigMap \u548c Secret \u4e2d\u3002\ngeneratorOptions:\n  labels:\n    fruit: apple\n  annotations:\n    note: project-on-cloud\n</code></pre>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#tips-tricks","title":"Tips &amp; Tricks","text":"<p>watch</p> <p><code>watch -d oc get deployments,pods</code> </p> <p>The <code>watch</code> tool comes from the <code>procps-ng</code> package, \u662f\u4e00\u4e2a Linux/Unix \u7cfb\u7edf\u81ea\u5e26\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5b83\u7528\u4e8e\u5468\u671f\u6027\u5730\uff08\u9ed8\u8ba4 2 \u79d2\uff09\u6267\u884c\u4e00\u4e2a\u547d\u4ee4\u5e76\u5b9e\u65f6\u5237\u65b0\u8f93\u51fa\u3002</p> <ul> <li><code>-d</code> highlights the difference</li> <li>Use <code>Ctrl+C</code> to exit the watch model</li> </ul>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#clis_1","title":"CLIs","text":"<p>Print the contents of the secret:</p> <pre><code>oc extract secret/db-secrets-55cbgc8c6m --to=-\n</code></pre> <ul> <li>The <code>--to</code> option specifies the destination for the extracted files.</li> <li>The <code>-</code> (dash) is a common convention in Unix-like systems that represents standard output (stdout).</li> </ul>"},{"location":"cloud/openshift/do280/01_manifest_kustimize/#qa","title":"Q&amp;A","text":""},{"location":"cloud/openshift/do280/01_manifest_kustimize/#1deployment-updated-secret","title":"1.Deployment &amp; updated Secret","text":"<p>Q: In Kubernetes, if I update the secret value, will the deployment get the updates automatically?</p> <p>A: No. Secrets are mounted as files in pods (if used as volumes) or injected as environment variables.</p> <p>Q: whats the difference between these 2 methods? Does it make difference when Secret is a file or just Env?     1. oc delete pod/xxx     2. oc rollout restart deployment/xx</p> <p>A:?</p>"},{"location":"cloud/openshift/do280/02_template_helm/","title":"2. OC Template & Helm Chart","text":""},{"location":"cloud/openshift/do280/02_template_helm/#1-openshift-template","title":"1. OpenShift Template","text":"<p>Template\uff08\u6a21\u677f\uff09 \u662f\u4e00\u79cd\u8d44\u6e90\u5b9a\u4e49\uff0c\u5141\u8bb8\u4f60\u901a\u8fc7\u53c2\u6570\u5316\u7684\u65b9\u5f0f\u6765\u521b\u5efa\u4e00\u7ec4 Kubernetes \u6216 OpenShift \u8d44\u6e90\u3002\u8fd9\u79cd\u673a\u5236\u53ef\u4ee5\u7b80\u5316\u548c\u590d\u7528\u5e94\u7528\u7a0b\u5e8f\u7684\u90e8\u7f72\u8fc7\u7a0b\u3002</p> Command Description <code>oc get templates -n openshift</code> list templates in <code>openshift</code> namespace <code>oc get template cache-service -o yaml -n openshift</code> \u6253\u5370\u6a21\u7248\u5230 <code>yaml</code> \u6587\u4ef6 <code>oc describe template cache-service -n openshift</code> \u67e5\u770b\u6a21\u7248\u7684\u6838\u5fc3\u8981\u7d20 <code>oc process --parameters cache-service -n openshift</code> \u53ea\u770b\u6a21\u7248\u7684 Parameters <code>oc process --parameters -f my-template.yaml</code> \u53ea\u770b\u6a21\u7248\u6587\u4ef6\u7684 Parameters <p>parameters</p> <p>Example:</p> <pre><code>[student@workstation ~]$ oc process --parameters mysql-persistent  -n openshift\nNAME                    DESCRIPTION   GENERATOR           VALUE\nMEMORY_LIMIT            ...                               512Mi\nNAMESPACE               ...                               openshift\nDATABASE_SERVICE_NAME   ...                               mysql\nMYSQL_USER              ...           expression          user[A-Z0-9]{3}\nMYSQL_PASSWORD          ...           expression          [a-zA-Z0-9]{16}\nMYSQL_ROOT_PASSWORD     ...           expression          [a-zA-Z0-9]{16}\nMYSQL_DATABASE          ...                               sampledb\nVOLUME_CAPACITY         ...                               1Gi\nMYSQL_VERSION           ...                               8.0-el8\n</code></pre> <ul> <li>GENERATOR generate specifies the generator to be used to generate random string</li> <li>VALUE holds the Parameter data. If specified, the generator will be ignored.</li> </ul>"},{"location":"cloud/openshift/do280/02_template_helm/#_1","title":"\u6a21\u677f\u7684\u6838\u5fc3\u8981\u7d20","text":"<p>\u4e00\u4e2a OpenShift Template \u901a\u5e38\u5305\u542b\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>Metadata: \u5b9a\u4e49\u6a21\u677f\u7684\u5143\u6570\u636e\uff0c\u6bd4\u5982\u540d\u5b57\u548c\u6807\u7b7e\u3002</li> <li>Labels: \u4e3a\u6240\u6709\u751f\u6210\u7684\u8d44\u6e90\u7edf\u4e00\u6dfb\u52a0\u6807\u7b7e\uff0c\u65b9\u4fbf\u7ba1\u7406\u548c\u9009\u62e9\u3002</li> <li>Objects: \u5305\u542b\u6a21\u677f\u5c06\u751f\u6210\u7684\u5177\u4f53\u8d44\u6e90\uff0c\u6bd4\u5982 Deployment\u3001Service\u3001ConfigMap \u7b49\u3002</li> <li>Parameters: \u53c2\u6570\u662f\u6a21\u677f\u7684\u5173\u952e\uff0c\u5141\u8bb8\u7528\u6237\u5728\u5b9e\u4f8b\u5316\u6a21\u677f\u65f6\u4f20\u9012\u503c\u3002\u652f\u6301\u9ed8\u8ba4\u503c\uff0c\u53ef\u4ee5\u4e3a\u67d0\u4e9b\u53c2\u6570\u63d0\u4f9b\u52a8\u6001\u66ff\u6362\u529f\u80fd\u3002--&gt; the values that can be customized</li> </ul>"},{"location":"cloud/openshift/do280/02_template_helm/#assign-parameters-to-template","title":"Assign Parameters to Template","text":"<ol> <li>value with <code>-p</code> <pre><code>oc process my-cache-service \\\n    -p TOTAL_CONTAINER_MEM=1024 \\\n    -p APPLICATION_USER='cache-user' \\\n    -o yaml \\\n    &gt; my-cache-service-manifest.yaml\n</code></pre></li> <li>values within file:     <pre><code>oc process my-cache-service \\\n    --param-file=my-cache-service-params.env \\\n    -o yaml \\\n    &gt; my-cache-service-manifest.yaml\n</code></pre></li> </ol>"},{"location":"cloud/openshift/do280/02_template_helm/#create-src-with-template","title":"Create src with Template","text":"<pre><code>oc process my-cache-service \\\n    --param-file=my-cache-service-params.env | oc apply -f -\n</code></pre>"},{"location":"cloud/openshift/do280/02_template_helm/#update-src-with-template","title":"Update src with Template","text":"<p>To compare the results of applying a different parameters file to a template against the live resources: <pre><code>oc process my-cache-service -o yaml \\\n    --param-file=my-cache-service-params-2.env | oc diff -f -\n</code></pre></p> <p>then do <code>oc apply</code> to update the resource</p>"},{"location":"cloud/openshift/do280/02_template_helm/#clis","title":"CLIs","text":"Command Description <code>oc new-app --template=cache-service -p APPLICATION_USER=my-user</code> create new src from the template \ud83d\udc49 When using it, no need to add <code>-n openshift</code> <code>oc process -f my-cache-service.yaml -p APPLICATION_USER=user1 -o yaml &gt; my-cache-service-manifest.yaml</code> <code>-f</code>: generate manifest YAML from the template file with the given parameter values. <code>oc create -f my-template.yaml</code> \u7528 yaml \u6587\u4ef6\u521b\u5efa template"},{"location":"cloud/openshift/do280/02_template_helm/#2-helm","title":"2. Helm","text":"<p>check this</p> <p>Helm vs Kustomize</p> <p>Kustomize \u548c Helm Chart \u662f\u4e24\u79cd\u7528\u4e8e\u7ba1\u7406 Kubernetes \u914d\u7f6e\u7684\u5de5\u5177\uff0c\u5b83\u4eec\u5728\u529f\u80fd\u548c\u4f7f\u7528\u65b9\u5f0f\u4e0a\u6709\u6240\u4e0d\u540c\uff0c\u4f46\u90fd\u65e8\u5728\u7b80\u5316 Kubernetes \u5e94\u7528\u7684\u90e8\u7f72\u548c\u7ba1\u7406\u3002</p> <ul> <li>Kustomize \u662f\u4e00\u4e2a\u539f\u751f\u652f\u6301 Kubernetes \u7684\u914d\u7f6e\u7ba1\u7406\u5de5\u5177\uff0c\u5141\u8bb8\u7528\u6237\u4e0d\u4f7f\u7528\u6a21\u677f\u800c\u76f4\u63a5\u8c03\u6574\u548c\u590d\u7528 YAML \u6587\u4ef6\u3002</li> <li>Helm Chart \u5305\u62ec Kubernetes \u7684\u8d44\u6e90\u6a21\u677f\uff08\u5982 Deployment\u3001Service \u7b49\uff09\u548c\u4e00\u4e2a values \u6587\u4ef6\uff0c\u901a\u8fc7\u8fd9\u4e2a\u6587\u4ef6\u53ef\u4ee5\u5bf9\u6a21\u677f\u4e2d\u7684\u53d8\u91cf\u8fdb\u884c\u914d\u7f6e\u3002</li> </ul>"},{"location":"cloud/openshift/do280/03_auth/","title":"3. Authentication and Authorization","text":""},{"location":"cloud/openshift/do280/03_auth/#1-users-groups","title":"1. Users &amp; Groups","text":"<p>\u4ee5\u4e0b\u8fd9\u4e9bOC Resources\u4e0e authentication &amp; authorization \u6709\u5173\uff1a</p> <ul> <li><code>identiy</code>: \u8eab\u4efd\uff0ckeeps a record of successful authentication attempts from a specific user and identity provider (IDP). </li> <li><code>role</code>: it defines set of allowed API operations for <code>user</code>, <code>group</code> or <code>serviceaccount</code><ul> <li><code>user</code>: credential for external entities (<code>user</code>, <code>external system</code>), it interacts with API server.  </li> <li><code>serviceaccount</code> / <code>sa</code>: credential for <code>applications</code>, <code>services</code></li> <li><code>group</code>: set of <code>user</code></li> </ul> </li> </ul>"},{"location":"cloud/openshift/do280/03_auth/#users","title":"Users","text":"<p>identity</p> <pre><code>&gt; oc get identity\n\nNAME                  IDP NAME  IDP USER NAME  USER NAME  USER UID\nLDAP:new_admin        LDAP      new_admin      new_admin  489c7402-d318-4805-b91d-44d786a92fc1\nGitHub:developer      GitHub    developer      developer  8dbae772-1dd4-4242-b2b4-955b005d9022\n</code></pre> <ul> <li><code>NAME</code>: identity \u7684\u540d\u5b57\uff0c\u7531 OpenShift \u81ea\u52a8\u751f\u6210</li> <li><code>IDP NAME</code>: identity \u63d0\u4f9b\u8005\uff0c\u8868\u793a\u8be5\u7528\u6237\u901a\u8fc7\u54ea\u4e2a\u8ba4\u8bc1\u7cfb\u7edf\u767b\u5f55\uff08\u5982 github\u3001ldap\u3001htpasswd\uff09\u3002</li> <li><code>IDP USER NAME</code>: \u7528\u6237\u5728 IDP \u8ba4\u8bc1\u7cfb\u7edf\u4e2d\u7684\u552f\u4e00\u6807\u8bc6\u3002</li> <li><code>USER NAME</code>: \u8be5 identity \u5728 OpenShift \u4e2d\u6620\u5c04\u5230\u7684user\u540d</li> <li><code>USER UID</code>: \u8be5 identity \u5728 OpenShift \u4e2d\u6620\u5c04\u5230\u7684\u7528\u6237\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff08UID\uff09\u3002</li> </ul>"},{"location":"cloud/openshift/do280/03_auth/#types","title":"Types","text":"<p>User</p> <p>There are 2 User types:</p> <ol> <li>Regular User: they are represented as <code>user</code> resource</li> <li>System User: Many system users are created automatically when the infrastructure is defined, for example, cluster administrator (with access to everything), a per-node user, users for routers and registries, and various others. Name convention: start with a <code>system:</code> prefix, such as:<ul> <li><code>system:admin</code></li> <li><code>system:openshift-registry</code></li> <li><code>system:node:node1.example.com</code></li> </ul> </li> </ol> <p>ServiceAccount</p> <p>ServiceAccount one type of System User that associated with projects</p> <ul> <li>Some created automatically during project creation</li> <li>Admin can create more <code>sa</code> to grant extra priviledges to Wordloads</li> <li>By default, <code>sa</code> has no role</li> <li>Name convention: start with a <code>system:serviceaccount:[Namespace]:</code> prefix, such as:<ul> <li><code>system:serviceaccount:default:deployer</code></li> <li><code>system:serviceaccount:accounting:builder</code></li> </ul> </li> </ul> <p><code>User</code> vs <code>ServiceAccount</code></p> <p>\u26a0\ufe0f <code>serviceaccount</code> can be considered as ONE TYPE of <code>user</code></p> <code>User</code> <code>ServiceAccount</code> \u4f7f\u7528\u8005 \u4e00\u4e2a\u4eba\uff0c\u6216\u4e00\u4e2a\u5916\u90e8\u7cfb\u7edf\uff08\u4f8b\u5982 CI/CD \u5de5\u5177\uff09 \u5e94\u7528\u7a0b\u5e8f\uff0c\u6216\u670d\u52a1 \u7ba1\u7406\u65b9\u5f0f - \u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\u5b58\u50a8\u5728 \u5916\u90e8\u7cfb\u7edf\uff08\u5982\u8eab\u4efd\u63d0\u4f9b\u5546\uff09\uff0c\u800c\u4e0d\u662f OpenShift \u5185\u90e8\u3002- OpenShift \u652f\u6301\u591a\u79cd\u7528\u6237\u8ba4\u8bc1\u65b9\u5f0f - \u662f\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\uff0c\u53ef\u4ee5\u901a\u8fc7 YAML \u6216 CLI \u7ba1\u7406\u3002- \u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u90fd\u6709\u9ed8\u8ba4\u7684 <code>default</code> <code>ServiceAccount</code> \u9002\u7528\u573a\u666f - \u5f00\u53d1\u8005\u3001\u7ba1\u7406\u5458\u7b49\u76f4\u63a5\u64cd\u4f5c OpenShift \u96c6\u7fa4\u7684\u7528\u6237\u3002- \u901a\u8fc7 CLI\u3001Web \u63a7\u5236\u53f0\u6216 API \u4e0e\u96c6\u7fa4\u4ea4\u4e92\u3002- \u5916\u90e8\u96c6\u6210\u7cfb\u7edf\u9700\u8981\u901a\u8fc7\u7528\u6237\u8eab\u4efd\u8fdb\u884c\u8ba4\u8bc1\uff08\u5982 OAuth\uff09\u3002 - \u7528\u4e8e Pod \u7684\u8fd0\u884c\u65f6\u8eab\u4efd\uff0cPod \u4f7f\u7528 <code>ServiceAccount</code> \u4e0e\u96c6\u7fa4\u4ea4\u4e92\u3002- \u81ea\u52a8\u5206\u914d Token\uff0c\u7528\u4e8e API \u8bbf\u95ee\u7684\u8eab\u4efd\u8ba4\u8bc1\u3002- \u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8bfb\u53d6 ConfigMap\u3001Secrets \u7b49\u96c6\u7fa4\u8d44\u6e90\u65f6"},{"location":"cloud/openshift/do280/03_auth/#groups","title":"Groups","text":"<pre><code># create Group\noc adm groups new my-group\n\n# add multiple Users to a Group\noc adm groups add-users my-group user1 user2\n\n# Remove user1 and user2 from my-group\noc adm groups remove-users my-group user1 user2\n</code></pre>"},{"location":"cloud/openshift/do280/03_auth/#_1","title":"\u5e38\u89c1 \u7cfb\u7edf\u7ea7\u7528\u6237\u7ec4","text":"<p>Danger</p> <p>\u7528\u6237\u7ec4\u53ef\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a <pre><code>oc get rolebinding\n</code></pre></p> <p><code>oc get group</code>\u65e0\u6cd5\u67e5\u770b\u6240\u6709\u5b58\u5728\u7684\u7ec4\uff0c\u53c2\u8003\u8d44\u6599</p> <ol> <li> <p>\u8ba4\u8bc1\u76f8\u5173\u7684\u7528\u6237\u7ec4</p> \u7ec4\u540d \u8bf4\u660e <code>system:authenticated</code> \u6240\u6709\u5df2\u8ba4\u8bc1\u7528\u6237\uff08\u5305\u62ec OAuth\u3001X.509 \u8bc1\u4e66\u3001Kubeconfig \u8ba4\u8bc1\u7684\u7528\u6237\uff09 <code>system:authenticated:oauth</code> \u6240\u6709\u901a\u8fc7 OAuth \u8ba4\u8bc1\u7684\u7528\u6237\uff08\u5373\u4f7f\u7528 oc login \u901a\u8fc7 OAuth \u767b\u5f55\u7684\u7528\u6237\uff09 <code>system:unauthenticated</code> \u6240\u6709\u672a\u8ba4\u8bc1\u7684\u7528\u6237\uff08\u5982\u533f\u540d API \u8bbf\u95ee\uff09 </li> <li> <p>\u89d2\u8272\u76f8\u5173\u7684\u7528\u6237\u7ec4</p> \u7ec4\u540d \u8bf4\u660e <code>system:cluster-admins</code> \u96c6\u7fa4\u7ba1\u7406\u5458\u7ec4\uff0c\u62e5\u6709 \u6700\u9ad8\u6743\u9650\uff0c\u53ef\u4ee5\u7ba1\u7406\u6574\u4e2a\u96c6\u7fa4 <code>system:masters</code> \u96c6\u7fa4\u63a7\u5236\u7ec4\uff0c\u7ba1\u7406 OpenShift \u63a7\u5236\u5e73\u9762\uff08Master \u8282\u70b9\uff09 <code>system:discovery</code> \u6240\u6709\u7528\u6237 \u9ed8\u8ba4\u52a0\u5165\uff0c\u53ef\u8bbf\u95ee oc get \u76f8\u5173\u7684\u516c\u5f00 API <code>system:scope-impersonation</code> \u5141\u8bb8\u7528\u6237\u6a21\u62df OAuth \u4f5c\u7528\u57df\uff08Scope\uff09 </li> <li> <p>\u9879\u76ee\uff08Namespace\uff09\u7ba1\u7406\u76f8\u5173\u7684\u7528\u6237\u7ec4</p> \u7ec4\u540d \u8bf4\u660e <code>system:cluster-readers</code> \u53ea\u8bfb\u8bbf\u95ee\u96c6\u7fa4\u8d44\u6e90\uff0c\u4e0d\u80fd\u4fee\u6539 <code>system:basic-users</code> \u57fa\u672c\u7528\u6237\u7ec4\uff0c\u53ef\u4ee5\u4f7f\u7528 oc whoami \u67e5\u8be2\u81ea\u5df1\u7684\u7528\u6237\u4fe1\u606f <code>system:build-strategists</code> \u6784\u5efa\u7b56\u7565\u7ba1\u7406\u5458\uff0c\u7ba1\u7406\u6784\u5efa\u7b56\u7565 <code>system:image-builders</code> \u5141\u8bb8\u5728 OpenShift \u5185 \u6784\u5efa\u955c\u50cf <code>system:image-pullers</code> \u5141\u8bb8\u4ece Registry \u62c9\u53d6\u955c\u50cf\uff08\u901a\u5e38\u7ed1\u5b9a\u5230 Namespace\uff09 <code>system:image-pushers</code> \u5141\u8bb8\u5411 Registry \u63a8\u9001\u955c\u50cf <code>system:registry</code> OpenShift \u5185\u90e8 \u955c\u50cf\u4ed3\u5e93\u670d\u52a1 </li> <li> <p>\u7279\u6b8a\u7ec4</p> \u7ec4\u540d \u8bf4\u660e <code>system:nodes</code> \u6240\u6709 OpenShift Worker \u8282\u70b9\uff0c\u7528\u4e8e kubelet \u8bbf\u95ee API <code>system:node-proxier</code> OpenShift \u7f51\u7edc\u4ee3\u7406\uff08kube-proxy\uff09 \u8bbf\u95ee API <code>system:router</code> OpenShift Router \u7ec4\u4ef6\uff0c\u8d1f\u8d23 Ingress/Route \u8def\u7531 <code>system:deployer</code> \u8d1f\u8d23 \u90e8\u7f72 Pod\uff0c\u901a\u5e38\u7528\u4e8e DeploymentConfig <code>system:serviceaccounts</code> \u6240\u6709 ServiceAccount \u8d26\u6237\uff08\u7528\u4e8e Pod \u8bbf\u95ee API\uff09 </li> </ol>"},{"location":"cloud/openshift/do280/03_auth/#-","title":"-------","text":""},{"location":"cloud/openshift/do280/03_auth/#2-authentication","title":"2. Authentication","text":"<p>assigns the <code>cluster-admin</code> role to the student user so that the <code>student</code> user can do anything in the cluster: <pre><code>oc adm policy add-cluster-role-to-user cluster-admin student \n</code></pre></p> <p>A newly installed OpenShift cluster provides two ways to authenticate API requests with cluster administrator privileges\uff1a</p> <ol> <li>X.509 \u5ba2\u6237\u7aef\u8bc1\u4e66</li> <li>OAuth \u8bbf\u95ee\u4ee4\u724c</li> </ol>"},{"location":"cloud/openshift/do280/03_auth/#1-x509","title":"1. X.509 \u5ba2\u6237\u7aef\u8bc1\u4e66","text":"<p><code>X.509 client certificates</code>\u66f4\u4e3a\u9759\u6001\uff0c\u901a\u5e38\u7528\u4e8e\u5df2\u7ecf\u4f9d\u8d56\u8bc1\u4e66\u7684\u5b89\u5168\u73af\u5883\u4e2d. OpenShift \u9ed8\u8ba4\u4f7f\u7528 X.509 \u8bc1\u4e66 \u6765\u9a8c\u8bc1 API \u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4ee5\u53ca Kubernetes \u7ec4\u4ef6\uff08\u5982 kubelet\u3001oc CLI\uff09\u8bbf\u95ee API Server\u3002</p> <p>kubeconfig</p> <p>During installation, the OpenShift installer creates a unique <code>kubeconfig</code> file. The file contains specific details and parameters for the CLI to connect a client to the correct API server, including an X.509 certificate:</p> <pre><code>apiVersion: v1\nkind: Config\n\nclusters:\n- name: my-cluster\n  cluster:\n    server: https://api.my-cluster.com:6443\n    certificate-authority: /path/to/ca.crt  # CA \u8bc1\u4e66\uff08\u7528\u4e8e\u9a8c\u8bc1 API \u670d\u52a1\u5668\uff09\n\nusers:\n- name: admin\n  user:\n    client-certificate: /path/to/admin.crt  # \u5ba2\u6237\u7aef\u8bc1\u4e66\uff08X.509\uff09\n    client-key: /path/to/admin.key          # \u5ba2\u6237\u7aef\u79c1\u94a5\n\ncontexts:\n- name: my-context\n  context:\n    cluster: my-cluster\n    user: admin\n\ncurrent-context: my-context\n</code></pre> <p>Clusters x Users = Contexts</p> <pre><code># The installation logs provide the location of the kubeconfig file like this:\nINFO Run 'export KUBECONFIG=/root/auth/kubeconfig' to manage the cluster with 'oc'.\n\n# To use the `kubeconfig` file to authenticate oc commands, do this:\nexport KUBECONFIG=/home/user/auth/kubeconfig\n</code></pre> <p>Note</p> <p>OpenShift \u5185\u90e8\u4f7f\u7528\u4e86\u591a\u7ec4 X.509 \u8bc1\u4e66\uff0c\u6bcf\u7ec4\u8bc1\u4e66\u627f\u62c5\u4e0d\u540c\u89d2\u8272\uff0c\u7edf\u4e00\u4fdd\u969c\u6574\u4e2a\u96c6\u7fa4\u7684\u5b89\u5168\u901a\u4fe1\u4e0e\u8ba4\u8bc1\u673a\u5236\u3002\u6bd4\u5982\uff1a</p> <p>\uff5c\u7528\u9014 \uff5c \u63cf\u8ff0\uff5c \uff5c:- \uff5c :-\uff5c \uff5cAPI Server \u901a\u4fe1\u52a0\u5bc6 \uff5c \u63d0\u4f9b Kubernetes API \u7684 HTTPS \u63a5\u53e3\u6240\u9700\u7684 TLS \u8bc1\u4e66\u3002\uff5c \uff5cEtcd \u901a\u4fe1\u52a0\u5bc6 \uff5c \u63a7\u5236\u5e73\u9762\u7ec4\u4ef6\u4e0e etcd \u901a\u4fe1\u4f7f\u7528\u7684\u8bc1\u4e66\uff0c\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u548c\u5b89\u5168\u6027\u3002\uff5c \uff5c\u96c6\u7fa4\u7ec4\u4ef6\u8eab\u4efd\u8ba4\u8bc1 \uff5c \u7ec4\u4ef6\u4e4b\u95f4\uff08\u5982 kubelet \u548c API Server\uff09\u7684\u76f8\u4e92\u8eab\u4efd\u9a8c\u8bc1\u3002\uff5c \uff5cIngress\uff08\u8def\u7531\uff09\u8bc1\u4e66 \uff5c \u7ec8\u7aef\u7528\u6237\u8bbf\u95ee\u670d\u52a1\uff08\u901a\u8fc7\u8def\u7531\uff09\u65f6\u7684 TLS \u8bc1\u4e66\u3002\uff5c \uff5cService Serving Certificates \uff5c \u7528\u4e8e\u670d\u52a1\u5185\u90e8\u901a\u4fe1\uff08\u5982 pod \u95f4\uff09\u4f7f\u7528\u7684 TLS \u8bc1\u4e66\uff5c</p>"},{"location":"cloud/openshift/do280/03_auth/#2-oauth","title":"2. OAuth \u8bbf\u95ee\u4ee4\u724c","text":"<p><code>OAuth access tokens</code>\u66f4\u52a0\u7075\u6d3b\uff0c\u9002\u7528\u4e8e\u52a8\u6001\u3001\u53ef\u6269\u5c55\u7684\u8bbf\u95ee\u63a7\u5236\u573a\u666f. \u9ed8\u8ba4\u7528\u4e8e\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\uff0c\u652f\u6301\u591a\u79cd OAuth \u8eab\u4efd\u63d0\u4f9b\u8005\uff1a</p> <ul> <li>\u5185\u7f6e\u8eab\u4efd\u63d0\u4f9b\u8005\uff1aHTPasswd\u3001LDAP\u3001Basic Auth\u3001Keystone</li> <li>\u5916\u90e8 OAuth \u63d0\u4f9b\u8005\uff1aGitHub\u3001GitLab\u3001Google\u3001OpenID Connect\uff08OIDC\uff09</li> </ul> <p>Info</p> <p>After installation completes, OpenShift creates\uff1a</p> <ul> <li>Virtual user: <code>kubeadmin</code> </li> <li>Password: \u5b58\u5728 secret <code>kubeadmin</code>\uff08Namespace <code>kube-system</code>\uff09\u91cc  </li> </ul> <pre><code># The installation logs provide the kubeadmin credentials like this:\n...output omitted...\nINFO The cluster is ready when 'oc login -u kubeadmin -p shdU_trbi_6ucX_edbu_aqop'  # \u751f\u6210 `kubeadmin` \u7528\u6237\u548c\u5b83\u7684**OAuth access token**.\n...output omitted...\nINFO Access the OpenShift web-console here:\n    https://console-openshift-console.apps.ocp4.example.com\nINFO Login to the console with user: kubeadmin, password: shdU_trbi_6ucX_edbu_aqop\n</code></pre>"},{"location":"cloud/openshift/do280/03_auth/#clis","title":"CLIs","text":"Command Description <code>oc config view</code> Show merged kubeconfig settings,\u5373\u67e5\u770bkubeconfig\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9 <p>Note</p> <p>OpenShift \u652f\u6301 X.509 \u548c OAuth\uff1a</p> <ul> <li>X.509 \u4e3b\u8981\u7528\u4e8e API \u8bbf\u95ee\uff08ServiceAccount \u8bc1\u4e66\uff09\u548c\u81ea\u52a8\u5316\u5de5\u5177</li> <li>OAuth \u4e3b\u8981\u7528\u4e8e \u7528\u6237\u767b\u5f55\uff08\u9ed8\u8ba4\u4f7f\u7528 OAuthServer\uff09 - Web \u63a7\u5236\u53f0 / <code>oc login</code></li> </ul> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528 oc login \u547d\u4ee4\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u8ba4\u8bc1\uff1a <pre><code># \u901a\u8fc7 X.509 \u8bc1\u4e66\u767b\u5f55\uff08\u901a\u5e38\u7528\u4e8e\u81ea\u52a8\u5316\uff09\noc login --server=https://openshift.example.com --certificate-authority=/path/to/ca.crt\n\n# \u901a\u8fc7 OAuth \u767b\u5f55\uff08\u5f00\u53d1\u8005 \u548c \u96c6\u7fa4\u7ba1\u7406\u8005\u5e38\u7528\u7684\u767b\u9646\u65b9\u5f0f\uff09\noc login --server=https://openshift.example.com --token=YOUR_OAUTH_TOKEN\n</code></pre></p> <p>Note</p> <p>\u65e0\u8bba\u662f\u54ea\u79cd\u65b9\u6cd5\uff0c\u90fd\u4f9d\u8d56\u4e8e\u8eab\u4efd\u63d0\u4f9b\u8005 / Identity Providers\u6765\u9a8c\u8bc1\u7528\u6237\u7684\u8eab\u4efd\u3002 \u8eab\u4efd\u63d0\u4f9b\u8005\uff08IdP\uff09\u662f\u8fd9\u4e24\u79cd\u8ba4\u8bc1\u65b9\u6cd5\u7684\u6838\u5fc3\uff0c\u8d1f\u8d23\u9a8c\u8bc1\u7528\u6237\u7684\u8eab\u4efd\u540e\uff0c\u9881\u53d1\u8ba4\u8bc1\u51ed\u8bc1\uff08<code>OAuth access tokens</code>\u6216<code>X.509 client certificates</code>\uff09</p>"},{"location":"cloud/openshift/do280/03_auth/#3-configure-identity-providersidp","title":"3. Configure Identity Providers\uff08IdP\uff09","text":"<p>\u8eab\u4efd\u63d0\u4f9b\u8005\uff08IdP\uff09\u662f\u7ed9user\u63d0\u4f9b\u8eab\u4efd\u7684\u5de5\u5177\u3002The OpenShift OAuth server can be configured to use many identity providers. The most common ones:</p>"},{"location":"cloud/openshift/do280/03_auth/#1htpasswd","title":"1.HTPasswd","text":"<p>HTPasswd is a simple authentication mechanism that uses an Apache-style <code>.htpasswd</code> file to store user credentials. It validates usernames and passwords against a secret that stores credentials that are generated by using the htpasswd command. \u8fc7\u7a0b\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u7528htpasswd\u5de5\u5177\u751f\u6210\u6587\u4ef6\uff0c\u7528\u6587\u4ef6\u751f\u6210secret\uff0c\u518d\u4fee\u6539oauth\u4ee5\u4f7f\u7528\u8be5secret\u5373\u53ef\uff0c</p>"},{"location":"cloud/openshift/do280/03_auth/#1-create-htpasswd-file","title":"1. Create HTPasswd File","text":"<pre><code># Create the htpasswd file\n#  -&gt; the password `redhat123` will be hashed with the MD5 algorithm\nhtpasswd -cBb /tmp/htpasswd student redhat123\n\n# Update credential\n# \u26a0\ufe0f \u5bc6\u7801\u53ef\u4ee5\u7528 '' \u4ee5\u9632\u4e07\u4e00\u91cc\u9762\u6709\u7279\u6b8a\u5b57\u7b26\nhtpasswd -b /tmp/htpasswd student 'redhat999'\n# Add new credential\nhtpasswd -b /tmp/htpasswd dev 'rh123'\n\n# delete - only the USERNAME, no PW needed\nhtpasswd -D /tmp/htpasswd student\n</code></pre> <p>htpasswd flags</p> <ul> <li><code>-c</code>: Create a new password file. This flag overwrites the existing file if it already exists.</li> <li><code>-B</code>: Use bcrypt encryption for hashing the password. Bcrypt is a secure and computationally expensive algorithm, making it a strong choice for password hashing.  -&gt; If not, then use default MD5 hashing algorithm  -&gt; \u6240\u4ee5<code>-B</code>\u52a0\u4e0d\u52a0\u90fd\u884c</li> <li><code>-b</code>: Batch mode. Allows you to pass the password directly on the command line, rather than being prompted interactively.</li> <li><code>-D</code> Delete user</li> </ul> <p>\u4e3e\u4f8b\uff1a\u67e5\u770bhtpasswd\u6587\u4ef6</p> <pre><code>&gt; cat ~/DO280/labs/auth-providers/htpasswd\nnew_admin:$2y$05$qQaFbpx4hbf4uZe.SMLSduTN8uN4DNJMJ4jE5zXDA57WrTRlpu2QS\nnew_developer:$apr1$S0TxtLXl$QSRfBIufYP39pKNsIg/nD1\n</code></pre>"},{"location":"cloud/openshift/do280/03_auth/#2-createupdate-secret","title":"2. Create(update) secret","text":"<p>Create(update) secret from the HTPasswd File. \u6ce8\u610f\u6240\u7528\u7684Namespace\uff01</p> <pre><code># Creating OC Secret with HTPasswd credential:\n# \u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f After `--from-file`, prefix `htpasswd=` is needed!\noc create secret generic htpasswd-secret \\\n    --from-file htpasswd=/tmp/htpasswd \\\n    -n openshift-config\n\n# Updating the OC HTPasswd Secret\noc set data secret/htpasswd-secret \\\n    --from-file htpasswd=/tmp/htpasswd \\\n    -n openshift-config\n</code></pre> <p>extract from secret</p> <pre><code># Extracting Secret to a file that locates under directory /tmp/\noc extract secret/htpasswd-secret -n openshift-config \\\n    --to /tmp/htpasswd --confirm\n\n# Extracting &amp; print the secret \noc extract secret/htpasswd-secret -n openshift-config \\\n    --to -\n</code></pre> <p>delete user</p> <pre><code># 1. delete user data in the file\nhtpasswd -D /tmp/htpasswd manager\n\n# 2. update the OC secret\noc set data secret/htpasswd-secret \\\n    --from-file htpasswd=/tmp/htpasswd -n openshift-config\n\n# 3. ACTUALLY delete USER resource (named `manager` in this case)\noc delete user manager\n\n# 4. ACTUALLY delete IDENTITY resources\n#  -&gt; `my_htpasswd_provider` is the name of the `identityProviders` that we defined in the OAuth\noc get identities | grep manager\noc delete identity my_htpasswd_provider:manager\n</code></pre> <p><code>user</code> VS <code>identity</code></p> <p><code>user:identity = 1:n</code></p> <p>Example: A <code>user</code> can authenticate through both an LDAP account and a GitHub account, resulting in two <code>identity</code> objects linked to the same <code>user</code>.</p>"},{"location":"cloud/openshift/do280/03_auth/#3-optional-assign-role-to-the-user","title":"3. [Optional] Assign role to the user","text":"<pre><code>[student@workstation ~]$ oc adm policy add-cluster-role-to-user \\\n                            cluster-admin new_admin\n\nWarning: User 'new_admin' not found\nclusterrole.rbac.authorization.k8s.io/cluster-admin added: \"new_admin\"\n</code></pre>"},{"location":"cloud/openshift/do280/03_auth/#4-configuring-the-oauth-custom-resource","title":"4. Configuring the OAuth Custom Resource","text":"<p>To use the HTPasswd identity provider, the OAuth custom resource must be edited to add an entry to the <code>.spec.identityProviders</code> array using  <pre><code>oc edit oauth &lt;oauth-name&gt;\n</code></pre></p> <pre><code>apiVersion: config.openshift.io/v1\nkind: OAuth\nmetadata:\n  name: cluster\nspec:\n  identityProviders:\n  - name: my_htpasswd_provider # name of this IdentityProvider, you can customize it\n    mappingMethod: claim \n    type: HTPasswd\n    htpasswd:\n      fileData:\n        name: htpasswd-secret \n</code></pre> <p>alternative</p> <p>\u4e5f\u53ef\u4ee5\u5148\u628a oauth \u8d44\u6e90\u4fdd\u5b58\u6210 yaml \u6587\u4ef6\uff0c\u518d\u8fdb\u884c\u4fee\u6539\u3002</p> <pre><code>oc get oauth cluster -o yaml &gt; oauth.yaml\noc replace -f oauth.yaml\n</code></pre> <p>UI Console</p> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7UI\u4fee\u6539\uff1a Administration &gt; Cluster Settings &gt; Configuration &gt; Oauth</p> <p><code>oc replace</code> VS <code>oc apply</code></p> <p>Some resources have immutable fields that apply won't let you change. For example, a deployment cannot have its selectors changed. <code>oc replace</code> can be used in these situations.</p> <ul> <li><code>oc apply -f xxx.yaml</code> actually does a diff and updates the resource with a patch of the changes. </li> <li><code>oc replace -f xxx.yaml</code> will submit the full entire spec of the resource, as an atomic action.</li> </ul> <p>namespace <code>openshift-config</code></p> <p><code>openshift-config</code> namespace is used to store global configuration data for the cluster, including authentication configurations. \u8fd9\u91cc\uff0c\u6211\u4eec\u7528\u6765\u50a8\u5b58\u6709\u7528\u6237\u540d+\u5bc6\u7801\u7684<code>secret</code></p> <p>namespace <code>openshift-authentication</code></p> <p><code>openshift-authentication</code> namespace is responsible for running the authentication services. \u6211\u4eec\u901a\u8fc7<code>oc get oauth cluster</code>\u4fee\u6539\u4e86\u914d\u7f6e\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u68c0\u67e5<code>openshift-authentication</code> \u4e0bpod\u662f\u5426\u5b8c\u6210\u91cd\u542f\uff0c\u6765\u786e\u5b9a<code>oauth</code>\u4e2d\u7684\u4fee\u6539\u662f\u5426\u5df2\u7ecf\u88ab\u5e94\u7528</p> <p>\u26a0\ufe0f \u5982\u679c\u5728<code>openshift-config</code>\u4e2d\u7684<code>secret</code>\u88ab\u4fee\u6539\uff0c<code>openshift-authentication</code>\u4e2d\u7684pod\u4e5f\u4f1a\u88ab\u91cd\u542f\uff01</p>"},{"location":"cloud/openshift/do280/03_auth/#2keystone","title":"2.Keystone","text":"<p>Enables shared authentication with an OpenStack Keystone v3 server.</p>"},{"location":"cloud/openshift/do280/03_auth/#3ldap","title":"3.LDAP","text":"<p>Configures the LDAP identity provider to validate usernames and passwords against an LDAPv3 server, by using simple bind authentication.</p>"},{"location":"cloud/openshift/do280/03_auth/#4github-or-github-enterprise","title":"4.GitHub or GitHub Enterprise","text":"<p>Configures a GitHub identity provider to validate usernames and passwords against GitHub or the GitHub Enterprise OAuth authentication server.</p>"},{"location":"cloud/openshift/do280/03_auth/#5openid-connect","title":"5.OpenID Connect","text":"<p>Integrates with an OpenID Connect identity provider by using an Authorization Code Flow.</p>"},{"location":"cloud/openshift/do280/03_auth/#-_1","title":"-------","text":""},{"location":"cloud/openshift/do280/03_auth/#4-authorization","title":"4. Authorization","text":""},{"location":"cloud/openshift/do280/03_auth/#authorization-with-rbac","title":"Authorization with RBAC","text":"<p>Role-based access control (RBAC) is a technique for managing access to resources in a computer system. RBAC determines whether a user can perform certain actions within the cluster or project. There are 2 RBAC levels:</p> <ul> <li>Cluster RBAC: Roles and bindings that apply across all projects.</li> <li>Local RBAC: Roles and bindings that are scoped to a given project. Local role bindings can reference both cluster and local roles.</li> </ul> <p>\ud83d\udc49 See more illustration here </p>"},{"location":"cloud/openshift/do280/03_auth/#rbac-object","title":"RBAC Object","text":"<ul> <li>Rule: Allowed actions for objects or groups of objects.</li> <li>Role: Sets of rules. Users and groups can be associated with multiple roles.</li> <li>Binding: Assignment of users or groups to a role.</li> </ul>"},{"location":"cloud/openshift/do280/03_auth/#clis_1","title":"CLIs","text":"<p>Cluster-wide:</p> CLI <code>oc adm policy add-cluster-role-to-user [RoleName] [UserName]</code> To change a regular user to a cluster administrator(<code>cluster-admin</code> role) \u5373\u521b\u5efa\u4e00\u4e2a <code>clusterrolebindings</code> <code>--rolebinding-name [RoleBindingName]</code>\u53ef\u4e3arolebinding \u547d\u540d <code>oc adm policy remove-cluster-role-from-user [RoleName] [UserName]</code> To change a cluster administrator(<code>cluster-admin</code> role) to a regular user \u5373\u5220\u9664\u4e00\u4e2a <code>clusterrolebindings</code> <code>oc adm policy who-can delete user</code> to determine which user can perform what(<code>delete user</code> in this case) <code>oc adm groups new [GroupName]</code> to add new group to cluster <code>oc adm groups add-users [GroupName] [UserName]</code> to add user to a group <code>$ oc adm policy remove-cluster-role-from-group [RoleName] [GroupName]</code> to remove role from a group\u5373\u5220\u9664\u4e00\u4e2a <code>clusterrolebindings</code> <p>rolebinding</p> <p><code>rolebinding</code> \u53ef\u7528\u4e8e\u4e00\u4e0b\u8fd9\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>role -- rolebinding -- group</li> <li>role -- rolebinding -- user</li> </ul> <p>Namespace-specific:</p> CLI <code>oc policy add-role-to-user [RoleName] [UserName] -n [ProjectName]</code> <p>role &amp; cluster role</p> <ul> <li>local role\uff1a use <code>add-role-to-user</code>  \u8bb0\u5f97\u4e00\u822c\u6765\u8bf4\u90fd\u8981\u52a0 <code>-n [ProjectName]</code></li> <li>cluster role\uff1a use <code>add-cluster-role-to-user</code></li> </ul> <p>Default Clusterroles</p> <p>Here are some important default Clusterroles:</p> Default Clusterroles\uff08Role\uff09 Description ------ \u4e3b\u8981\u7ba1\u7406\u5458\u89d2\u8272 ------ <code>cluster-admin</code> Cluster-wide (global). \u6700\u9ad8\u6743\u9650\uff0c\u62e5\u6709\u6574\u4e2a\u96c6\u7fa4\u7684\u7ba1\u7406\u6743\u9650\uff0c\u5305\u62ec\u6240\u6709\u8d44\u6e90\u548c API\u3002 <code>admin</code> Namespace-specific (local to a namespace). Users with this role can manage all project resources, including granting access to other users to access the project. \u4e3a\u4e86\u7ed9 user \u67d0\u4e2aproject\u7684admin\u89d2\u8272\uff0c\u9700\u8981\u505a\u7684\u662f\uff1a1.\u7528admin\u8eab\u4efd\u521b\u5efa\u8be5\u9879\u76ee2.\u4f7f\u7528\u8be5\u9879\u76ee \u26a0\ufe0f\u53ea\u8981\u662fns-specific\u7684\uff0c\u90fd\u8981\u8fd9\u68373.<code>oc adm policy add-cluster-role-to-user admin &lt;username&gt;</code> <code>edit</code> \u5141\u8bb8\u5728\u9879\u76ee\u5185\u521b\u5efa\u3001\u4fee\u6539\u8d44\u6e90\uff0c\u4f46 \u4e0d\u80fd\u7ba1\u7406 RBAC\uff08\u89d2\u8272\u3001\u89d2\u8272\u7ed1\u5b9a\uff09\uff0c <code>limit ranges</code> \u548c <code>quotas</code>\u7b49\u8d44\u6e90\uff0c\u4e5f\u4e0d\u80fd\u51b3\u5b9a\u8c01\u6709\u6743\u8bbf\u95ee\u5f53\u524d\u9879\u76ee <code>view</code> \u53ea\u8bfb\u8bbf\u95ee\uff0c\u5141\u8bb8\u67e5\u770b\u9879\u76ee\u4e2d\u7684\u8d44\u6e90\uff0c\u4f46\u4e0d\u80fd\u4fee\u6539\u6216\u521b\u5efa\u8d44\u6e90\u3002 ------ OpenShift \u7279\u6709\u89d2\u8272 ------ <code>self-provisioner</code> Users with this role can create their own projects. \u5141\u8bb8\u7528\u6237\u521b\u5efa\u81ea\u5df1\u7684\u9879\u76ee\u3002<code>self-provisioner</code>&gt;<code>basic-user</code> <code>basic-user</code> Users with this role have read access to the project. \u5141\u8bb8\u7528\u6237\u67e5\u770b\u81ea\u5df1\u7684\u4fe1\u606f\uff08\u5982 oc whoami\uff09\u3002 <code>cluster-status</code> Users with this role can access cluster status information. <code>cluster-reader</code> Users with this role can access or view most of the objects but cannot modify them. <p>\u26a0\ufe0f \u8fd9\u4e24\u4e2a\u547d\u4ee4\u8bed\u6cd5\u4e0a\u90fd\u5bf9\uff0c\u4f46\u662fscope\u4e0d\u4e00\u6837\uff01 <pre><code># ONLY view resource in namespace!\noc policy add-role-to-group view qa -n &lt;namespace&gt;\n\n# view resources across the entire cluster!!\noc policy add-cluster-role-to-group view qa\n</code></pre></p>"},{"location":"cloud/openshift/do280/03_auth/#_2","title":"\u7ec3\u4e60\u7ea0\u9519\u8bb0\u5f55","text":"<p>\u8981\u6c42\uff1a As the <code>new_admin</code> user, prevent users from creating projects in the cluster. --\u300b\u8fd9\u91cc\u8981\u6c42\u4f60\u5148\u4ee5<code>new_admin</code>\u7684user\u8eab\u4efd\u767b\u9646\uff0c\u7136\u540e\u518d\u963b\u6b62\u6240\u6709\u7528\u6237\u521b\u5efa\u9879\u76ee\u7684\u80fd\u529b</p> <p>\u9519\u8bef\u7b54\u6848\uff1a <pre><code>oc login -u new_admin -p new_password\noc adm policy remove-cluster-role-from-user self-provisioner new_developer\n</code></pre></p> <p>\u6b63\u786e\u7b54\u6848\uff1a <pre><code>oc login -u new_admin -p new_password\noc adm policy remove-cluster-role-from-group self-provisioner system:authenticated:oauth\n</code></pre></p> <p>\u89e3\u91ca</p> <p>\u6b63\u786e\u7b54\u6848\u786e\u4fdd \u6240\u6709\u7528\u6237 \u90fd\u4e0d\u80fd\u521b\u5efa\u9879\u76ee\uff0c\u9519\u8bef\u7b54\u6848\u53ea\u786e\u4fdd \u7528\u6237<code>new_developer</code> \u4e0d\u80fd\u521b\u5efa\u9879\u76ee</p> <ul> <li><code>self-provisioner</code> \u662f OpenShift \u4e2d\u7684\u4e00\u4e2a\u9ed8\u8ba4clusterrole\uff0c\u8be5\u89d2\u8272\u8d4b\u4e88\u7528\u6237\u521b\u5efa\u65b0\u9879\u76ee\uff08\u5373 namespace\uff09\u7684\u6743\u9650\u3002</li> <li><code>system:authenticated:oauth</code> \u662f\u4e00\u4e2a\u5305\u542b\u6240\u6709\u901a\u8fc7 OAuth \u8ba4\u8bc1\u7684\u7528\u6237\u7684\u7ec4\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5f53\u7528\u6237\u901a\u8fc7 OAuth \u767b\u5f55\u5230 OpenShift \u96c6\u7fa4\u65f6\uff0c\u4ed6\u4eec\u4f1a\u81ea\u52a8\u6210\u4e3a\u8fd9\u4e2a\u7ec4\u7684\u4e00\u5458\u3002</li> </ul> <p>\u53e6\u5916\uff0c\u9519\u8bef\u7b54\u6848\u4f1a\u62a5\u9519\uff1a\u8fd9\u662f\u56e0\u4e3a<code>self-provisioner</code>\u8fd9\u4e2a\u89d2\u8272 \u4e0d\u662f\u76f4\u63a5\u5206\u914d\u7ed9\u7528\u6237<code>new_developer</code>\uff0c\u800c\u662f\u5206\u914d\u7ed9 <code>system:authenticated:oauth</code> \u7ec4\u4e2d\u7684\u6240\u6709\u7528\u6237\uff0c\u6240\u4ee5\u6ca1\u6709\u76f4\u63a5\u7684rolebinding\uff0c\u4e0d\u80fdremove\uff01 <pre><code>error: unable to find target [new_developer]\n</code></pre> \u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\u4e0e\u89d2\u8272 self-provisioner\u76f8\u8fde\u7684\u662f\u4ec0\u4e48\uff1a <pre><code>oc get clusterrolebinding self-provisioner\n</code></pre></p>"},{"location":"cloud/openshift/do280/03_auth/#other-clis","title":"Other CLIs","text":"Default Clusterroles Description <code>MANAGER_PASSWD=\"$(openssl rand -hex 15)\"</code> use <code>openssl</code> to generate random pw <code>echo \"xxx\" | base64 --decode</code> decode base64-string MD5-string can NOT be decoded!"},{"location":"cloud/openshift/do280/04_ext_edge/","title":"04 ext edge","text":"<p>Edge certificates encrypt the traffic between the client and the router, but leave the traffic between the router and the service unencrypted. </p>"},{"location":"cloud/openshift/do280/04_ext_edge/#openshift-edge-route","title":"\u4f7f\u7528 OpenShift \u81ea\u5e26\u8bc1\u4e66 \u521b\u5efa edge route","text":"<pre><code>oc create route edge todo-https \\\n    --service todo-http \\\n    --hostname todo-https.apps.ocp4.example.com \\\n    --key &lt;file&gt;.key \\\n    --cert &lt;file&gt;.crt\n</code></pre>"},{"location":"cloud/openshift/do280/04_ext_edge/#edge-route","title":"\u4f7f\u7528 \u81ea\u5df1\u6307\u5b9a\u7684 \u8bc1\u4e66 \u521b\u5efa edge route","text":"<p>\ud83d\udc49 OpenShift generates its own certificate that it signs with its CA.</p> <pre><code>oc create route edge todo-https \\\n    --service todo-http \\\n    --hostname todo-https.apps.ocp4.example.com\n</code></pre> <p>NO <code>http://</code> or <code>https://</code> in --hostname</p> <p>When creating a route in OpenShift, the <code>--hostname</code> flag specifies only the host portion of the URL (e.g., <code>todo-https.apps.ocp4.example.com</code>) without including <code>http://</code> or <code>https://</code>. This is because:</p> <ul> <li>Hostname is separate from protocol \u2013 --hostname only specifies the domain name, not http:// or https://.</li> <li>Protocol is determined by route type \u2013 edge termination enables HTTPS at the OpenShift router level.</li> <li>Flexibility \u2013 Different TLS termination options control how HTTPS is handled, independent of the hostname.</li> </ul> <ul> <li><code>edge</code> indicates its encrypted</li> <li>If the --key and --cert options are omitted, then the RHOCP ingress operator provides a certificate from the internal Certificate Authority (CA).</li> </ul> <p>Certificates provided from internal 'Certificate Authority'</p> <p>to view the certificates that the internal CA provides: <pre><code>oc get secrets/router-ca -n openshift-ingress-operator -o yaml\n</code></pre></p> <p> </p>"},{"location":"cloud/openshift/do280/04_ext_passthrough/","title":"04 ext passthrough","text":"\u521d\u59cb\u72b6\u6001\u7684\u6587\u4ef6 \u672c\u6b65\u9aa4\u7ed3\u675f\u4e4b\u540e\u7684\u6587\u4ef6 <pre><code>\nopenssl-commands.txt\npassphrase.txt\n\ntraining.ext\ntraining-CA.key\ntraining-CA.pem\n</code></pre> <pre><code>\nopenssl-commands.txt\npassphrase.txt\n\ntraining.ext\ntraining-CA.key\ntraining-CA.pem\n\ntraining.key\ntraining.csr\ntraining-CA.srl\ntraining.crt\n</code></pre>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#original-files","title":"original files","text":""},{"location":"cloud/openshift/do280/04_ext_passthrough/#training-cakey","title":"<code>training-CA.key</code>","text":"<p>private key for the Certificate Authority (CA). Use it to sign other certificates</p> <pre><code>-----BEGIN ENCRYPTED PRIVATE KEY-----\nMIIEqzCCAx0gAwIBAgIUTcgzLN5PmsMqvkifCXuaSxzLJlcwDQYJKoZIhvcNAQEL\nVQQHDAdSYWxlaWdoMRAwDgYDVQQKDAdSZWQgSGF0MRkwFwYDVQQDDBBvY\u0417A0LmV4\n...\n-----END ENCRYPTED PRIVATE KEY-----\n</code></pre>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#training-capem","title":"<code>training-CA.pem</code>","text":"<p>certificate that includes public key and some metadata. Use it to distribute to clients or servers, to establish a trust chain for certificates signed by this CA.</p> <pre><code>-----BEGIN CERTIFICATE-----\nMIIEqzCCAx0gAwIBAgIUTcgzLN5PmsMqvkifCXuaSxzLJlcwDQYJKoZIhvcNAQEL\nVQQHDAdSYWxlaWdoMRAwDgYDVQQKDAdSZWQgSGF0MRkwFwYDVQQDDBBvY\u0417A0LmV4\n...\n-----END CERTIFICATE-----\n</code></pre>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#trainingext","title":"<code>training.ext</code>","text":"<p>ext=extended file system, created for Linux kernel. It contains additional configuration for the certificate:</p> <pre><code>subjectAltName = @alt_names\n\n[alt_names]\nDNS. 1 = *.ocp4.example.com\nDNS. 2 = *.apps.ocp4.example.com\n</code></pre>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#created-files","title":"created files","text":""},{"location":"cloud/openshift/do280/04_ext_passthrough/#trainingkey","title":"<code>training.key</code>","text":"<p>Private Key for the Application that has the host <code>todo-https.apps.ocp4.example.com</code></p>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#trainingcsr","title":"<code>training.csr</code>","text":"<p>is a Certificate Signing Request (CSR), an essential part of the process for obtaining a signed certificate. It contains information about the entity that is requesting the certificate, such as:</p> <pre><code>- Common Name (CN): The fully qualified domain name (e.g., todo-https.apps.ocp4.example.com).\n- Organization (O): The name of the organization (e.g., Red Hat).\n- Location details: Country (C), State (ST), and City (L).\n- Other optional metadata, such as email addresses.\n</code></pre>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#trainingcrt","title":"<code>training.crt</code>","text":"<p>Signed public Certificate for the Application</p>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#training-casrl","title":"<code>training-CA.srl</code>","text":"<p>The <code>training-CA.srl</code> file is used by OpenSSL (or other certificate tools) to keep track of the serial numbers of certificates issued by a Certificate Authority (CA). It ensures that every certificate signed by the CA has a unique serial number, which is required by the X.509 standard for certificates.</p> <p><code>*.pem</code> VS <code>*.crt</code></p> <p><code>*.pem</code> &gt; <code>*.crt</code></p> <p><code>*.pem</code> could contain more info types, while <code>*.crt</code> only contains certificate.</p> PEM (.pem) CRT (.crt) Stands for Privacy-Enhanced Mail Certificate Format Base64-encoded text with header/footer Can be in PEM (Base64) or DER (Binary) Content Can contain certificates, private keys, certificate chains, or other cryptographic data. Typically contains only a single certificate. Common Headers <code>-----BEGIN CERTIFICATE-----</code> (for a public certificate)<code>-----BEGIN PRIVATE KEY-----</code> (for a private key)<code>-----BEGIN CERTIFICATE REQUEST-----</code> (for a CSR) <code>-----BEGIN CERTIFICATE-----</code> Usage Used in OpenSSL, Apache, and many other applications. Used by web servers, applications, and certificate authorities."},{"location":"cloud/openshift/do280/04_ext_passthrough/#1-generate-tls-certificates-for-the-application","title":"1. Generate TLS certificates for the application","text":"<pre><code>graph LR\n    A((User)) -- openssl \u751f\u6210 --&gt; B[Private key]\n    B -- openssl \u751f\u6210 --&gt; C[CSR\u8bf7\u6c42]\n    C -- openssl \u53d1\u9001 \u8bf7\u6c42 \u7ed9CA--&gt; D[Certificate]</code></pre> <pre><code># (1) \u751f\u6210\u79c1\u94a5 `training.key`\nopenssl genrsa -out training.key 4096\n\n# (2) \u751f\u6210 certificate signing request (CSR) `training.csr`:\n# - use the generated training.key`\n# - specify the hostname: todo-https.apps.ocp4.example.com\nopenssl req -new \\          # \u4e0d\u8981\u5fd8\u8bb0\u8fd9\u4e2a -new\n    -key training.key \\\n    -out training.csr \\\n    -subj \"/C=US/ST=North Carolina/L=Raleigh/O=Red Hat/CN=todo-https.apps.ocp4.example.com\"\n\n# (3) \u751f\u6210\u8bc1\u4e66 `training.crt`\n# \n# INPUT:\n# - `training.csr`: the request\n# - `training.ext`: configuration file\n# - `passphrase.txt`: the defined password\n# - CA info:\n#       -  `training-CA.pem`: public key\n#       -  `training-CA.key`: private key\n#\n# OUTPUT:\n#   - `training.crt`: a signed Certificate\n#   - `training-CA.srl`: (If NOT exist) a list for documenting purpose\nopenssl x509 -req \\             # \u4e0d\u8981\u5fd8\u8bb0\u8fd9\u4e2a -req\n    -in training.csr \\          # \u5904\u7406\u8bf7\u6c42, \u6307\u5b9a\u8f93\u5165\u7684 CSR \u6587\u4ef6\n    -passin file:passphrase.txt \\   # \u5b58\u50a8 CA \u79c1\u94a5\u5bc6\u7801\u7684\u6587\u4ef6\n    -extfile training.ext \\ \n\n    -CA training-CA.pem \\\n    -CAkey training-CA.key \\\n    -CAcreateserial \\       # Creates training-CA.srl if NOT exist, to track certificate Serial numbers\n\n    -out training.crt \\\n    -days 1825 \\            # Certificate\u2019s validity period = 5 years\n    -sha256                 # Certificate signature hashing = SHA-256\n</code></pre> <p><code>-subj</code></p> <p>The <code>-subj</code> flag in the <code>openssl req -new</code>command specifies the distinguished name (DN) directly in the command line, instead of interactively entering it.</p> <p>\u5982\u679c\u4f60\u5728\u547d\u4ee4\u4e2d\u4e0d\u7528<code>-subj</code>\uff0c\u4e5f\u53ef\u4ee5\u4e00\u4e2a\u4e2a\u8f93\u5165\uff1a </p> <p>Distinguished Name(DN)</p> <p>The Distinguished Name (DN) is a unique identifier for an entity (such as a <code>server</code>, <code>organization</code>, or <code>individual</code>) in a digital certificate. It is used in:</p> <ul> <li>X.509 certificates</li> <li>Certificate Signing Requests (CSR)</li> <li>LDAP (Lightweight Directory Access Protocol)</li> </ul> <p>\u26f0\ufe0f In this case, DN is the \"ID Card\" for the Certificate</p> <p>A DN consists of multiple Attributes:</p> Attribute Meaning Example <code>C</code> Country <code>C=US</code> (United States) <code>ST</code> State or Province <code>ST=North Carolina</code> <code>L</code> Locality (City) <code>L=Raleigh</code> <code>O</code> Organization <code>O=Red Hat</code> <code>OU</code> Organizational Unit <code>OU=Engineering</code> <code>CN</code> Common Name (usually a domain or hostname) <code>CN=todo-https.apps.ocp4.example.com</code> <code>emailAddress</code> Email Address (optional) <code>emailAddress=admin@example.com</code>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#2-generate-tls-secret-with-certificate-and-key","title":"2. Generate TLS secret with Certificate and Key","text":"<ul> <li>Certificate: <code>training.crt</code></li> <li>Private Key: <code>training.key</code></li> </ul> <pre><code>oc create secret tls todo-certs \\\n    --cert certs/training.crt --key certs/training.key\n</code></pre>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#3-create-app-and-service-with-secret","title":"3. Create App and Service with Secret","text":"<p>Use the <code>secret</code> in the Deployment file:</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\n...output omitted...\n        volumeMounts:\n        - name: tls-certs\n          readOnly: true\n          mountPath: /usr/local/etc/ssl/certs\n...output omitted...\n      volumes:\n      - name: tls-certs\n        secret:\n          secretName: todo-certs\n---\napiVersion: v1\nkind: Service\n...output omitted...\n  ports:\n  - name: https\n    port: 8443\n    protocol: TCP\n    targetPort: 8443\n...output omitted..\n</code></pre>"},{"location":"cloud/openshift/do280/04_ext_passthrough/#4-create-the-encrypted-route-with-service","title":"4. Create the encrypted route with Service","text":"<pre><code>oc create route passthrough todo-https \\\n    --service todo-https --port 8443 \\\n    --hostname todo-https.apps.ocp4.example.com\n</code></pre>"},{"location":"cloud/openshift/do280/04_network_security/","title":"4. Network Security","text":""},{"location":"cloud/openshift/do280/04_network_security/#1-encrypted-route","title":"1. Encrypted Route","text":"<p>encrypted/unencrypted Route</p> <ul> <li>Encrypted routes secures traffic to and from the pods. It support several types of transport layer security (TLS) termination to serve certificates to the client. </li> <li>Unencrypted routes are the simplest to configure, they require no key/certificates. </li> </ul> <p>TLS &amp; TLS Termination</p> <p>[\u52a0\u5bc6] TLS\uff08Transport Layer Security\uff0c\u4f20\u8f93\u5c42\u5b89\u5168\u534f\u8bae\uff09 \u662f\u4e00\u79cd\u7528\u4e8e\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e0a\u63d0\u4f9b\u5b89\u5168\u901a\u4fe1\u7684\u534f\u8bae\uff0c\u5b83\u662f SSL\uff08Secure Sockets Layer\uff09\u7684\u540e\u7eed\u7248\u672c\u3002TLS \u4e3b\u8981\u7528\u4e8e\u786e\u4fdd\u6570\u636e\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u4f20\u8f93\u65f6\u7684 \u4fdd\u5bc6\u6027\u3001\u5b8c\u6574\u6027 \u548c \u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>[\u89e3\u5bc6] TLS Termination \u662f\u6307\u5728\u7f51\u7edc\u901a\u4fe1\u4e2d\uff0c\u901a\u8fc7\u4e00\u4e2a\u8bbe\u5907/\u670d\u52a1\uff08\u5982\u8d1f\u8f7d\u5747\u8861\u5668\u3001\u4ee3\u7406\u670d\u52a1\u5668\uff09\u89e3\u5bc6 TLS \u6240\u52a0\u5bc6\u7684\u6d41\u91cf\uff0c\u4ece\u800c\u4f7f\u540e\u7eed\u7684\u670d\u52a1\u5668\u6216\u670d\u52a1\u53ef\u4ee5\u5904\u7406\u660e\u6587\u6570\u636e\u3002\u4e3e\u4f8b\uff1a\u5728NGINX\u4e2d\u914d\u7f6eTLS Termination\uff1a <pre><code>server {\n    listen 443 ssl;\n    server_name example.com;\n\n    ssl_certificate /path/to/cert.pem;\n    ssl_certificate_key /path/to/key.pem;\n\n    location / {\n        proxy_pass http://backend-service;\n    }\n}\n</code></pre> \u6ce8\u610f:</p> <ul> <li><code>listen 443 ssl</code> \uff1a\u7528443\u7aef\u53e3\u5904\u7406\u52a0\u5bc6\u6d41\u91cf\u3002</li> <li><code>proxy_pass http://backend-service;</code>\uff1a\u5c06\u89e3\u5bc6\u540e\u7684\u6d41\u91cf\u8f6c\u53d1\u7ed9\u540e\u7aef\u670d\u52a1 <code>backend-service</code>\u3002</li> </ul>"},{"location":"cloud/openshift/do280/04_network_security/#tls-termination","title":"\u5e38\u89c1\u7684 TLS Termination \u7c7b\u578b","text":"\u7279\u6027 Edge Termination Passthrough Re-encryption \u89e3\u5bc6\u4f4d\u7f6e \u4e2d\u95f4\u8282\u70b9\uff08\u5982\u8d1f\u8f7d\u5747\u8861\u5668\u3001\u8fb9\u7f18\u4ee3\u7406\uff09 \u540e\u7aef\u670d\u52a1 \u4e2d\u95f4\u8282\u70b9\u548c\u540e\u7aef\u670d\u52a1\u5747\u9700\u52a0\u89e3\u5bc6 \u52a0\u5bc6\u8303\u56f4 \u5ba2\u6237\u7aef\u5230\u4e2d\u95f4\u8282\u70b9 \u5ba2\u6237\u7aef\u5230\u540e\u7aef\uff08\u7aef\u5230\u7aef\u52a0\u5bc6\uff09 \u5ba2\u6237\u7aef\u5230\u4e2d\u95f4\u8282\u70b9 + \u4e2d\u95f4\u8282\u70b9\u5230\u540e\u7aef \u5b89\u5168\u6027 \u660e\u6587\u6d41\u91cf\u5728\u4e2d\u95f4\u8282\u70b9\u548c\u540e\u7aef\u4e4b\u95f4\u4f20\u8f93\uff0c\u9700\u5185\u7f51\u4fdd\u969c \u6d41\u91cf\u59cb\u7ec8\u52a0\u5bc6\uff0c\u5b89\u5168\u6027\u6700\u9ad8 \u63d0\u4f9b\u66f4\u591a\u5b89\u5168\u63a7\u5236\uff0c\u9002\u5408\u590d\u6742\u573a\u666f \u6027\u80fd\u6d88\u8017 \u51cf\u8f7b\u540e\u7aef\u52a0\u89e3\u5bc6\u8d1f\u62c5\uff0c\u63d0\u5347\u6027\u80fd \u4e2d\u95f4\u8282\u70b9\u6027\u80fd\u6d88\u8017\u6700\u5c11 \u4e2d\u95f4\u8282\u70b9\u6027\u80fd\u5f00\u9500\u66f4\u5927 \u4e2d\u95f4\u8282\u70b9\u529f\u80fd \u53ef\u6267\u884c\u8def\u7531\u3001\u8ba4\u8bc1\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u64cd\u4f5c \u65e0\u6cd5\u67e5\u770b\u6d41\u91cf\u5185\u5bb9\uff0c\u529f\u80fd\u53d7\u9650 \u53ef\u6267\u884c\u8def\u7531\u3001\u8ba4\u8bc1\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u64cd\u4f5c \u8bc1\u4e66\u7ba1\u7406\u590d\u6742\u6027 \u4e2d\u95f4\u8282\u70b9\u9700\u7ba1\u7406\u8bc1\u4e66\uff0c\u540e\u7aef\u65e0\u9700\u7ba1\u7406 \u4ec5\u540e\u7aef\u7ba1\u7406\u8bc1\u4e66\uff0c\u914d\u7f6e\u7b80\u5355 \u4e2d\u95f4\u8282\u70b9\u548c\u540e\u7aef\u5747\u9700\u7ba1\u7406\u8bc1\u4e66 \u9002\u7528\u573a\u666f \u9002\u7528\u4e8e\u6027\u80fd\u4f18\u5148\u7684\u573a\u666f\uff0c\u5982\u8d1f\u8f7d\u5747\u8861\u5668\u9700\uff08load balancer\uff09\u8981\u5904\u7406\u5927\u91cf TLS \u6d41\u91cf\u3002\u56e0\u4e3aEdge\u4e3a\u540e\u7aef\u51cf\u8d1f\uff0c\u800c\u4e14\u53ef\u4ee5\u7528load balancer\u6765\u53ef\u4ee5\u63d0\u5347\u7cfb\u7edf\u7684\u667a\u80fd\u6027\u548c\u7ba1\u7406\u6548\u7387 \u9002\u5408\u5bf9\u5b89\u5168\u6027\u8981\u6c42\u9ad8\u7684\u573a\u666f\uff0c\u5982\u9700\u8981\u7aef\u5230\u7aef TLS \u4fdd\u62a4\u7684\u5e94\u7528\u3002 \u9002\u5408\u5fae\u670d\u52a1\u67b6\u6784\u4e2d\uff0c\u65e2\u9700\u8981\u4e2d\u95f4\u8282\u70b9\u63a7\u5236\u6d41\u91cf\uff0c\u53c8\u9700\u8981\u4fdd\u8bc1\u540e\u7aef\u52a0\u5bc6\u4f20\u8f93\u7684\u60c5\u51b5\u3002 <p>\u66f4\u591a\u6559\u7a0b</p> <ul> <li>HTTP, HTTPS, CA, Certificate</li> <li>Redhat Blog: Self-Serviced End-to-end Encryption Approaches for Applications Deployed in OpenShift</li> </ul>"},{"location":"cloud/openshift/do280/04_network_security/#illustration","title":"Illustration","text":"<ol> <li>Clear text: the connection is always unencrypted.</li> <li>Edge: the connection is encrypted from the client to the reverse proxy, but unencrypted from the reverse proxy to the pod.</li> <li>Re-encrypt: the encrypted connection is terminated at the reverse proxy, but then re-encrypted.</li> <li>Passthrough: the connection is not encrypted by the reverse proxy. The reverse proxy uses the Server Name Indication (SNI) field to determine to which backend to forward the connection, but in every other respects it acts as a Layer 4 load balancer.</li> </ol>"},{"location":"cloud/openshift/do280/04_network_security/#openshift","title":"OpenShift \u4e2d\u7684\u8bc1\u4e66","text":""},{"location":"cloud/openshift/do280/04_network_security/#ingress","title":"\u9ed8\u8ba4\u8def\u7531\u8bc1\u4e66\uff08Ingress \u9ed8\u8ba4\u8bc1\u4e66\uff09","text":"<p>\u7528\u4e8e OpenShift Ingress Router\uff0c\u4e5f\u5c31\u662f OpenShift \u4e2d\u7684 \u5916\u90e8 HTTPS \u5165\u53e3\u3002\u5b83\u8d1f\u8d23\u7ec8\u6b62\uff08\u89e3\u5bc6\uff09\u5916\u90e8\u4f20\u5165\u7684 HTTPS \u8bf7\u6c42\uff0c\u5e76\u5c06\u8bf7\u6c42\u8f6c\u53d1\u7ed9\u540e\u7aef\u7684\u5e94\u7528\uff08\u901a\u5e38\u662f HTTP\uff09\u3002</p> <ul> <li>\u53ea\u7528\u5728 Route \u4e0a\uff1a<ul> <li>Edge Route </li> <li>Re-encrypt Route \u7684\u524d\u7aef TLS \u7ec8\u6b62</li> </ul> </li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u8bc1\u4e66\u662f\u7531 OpenShift \u81ea\u52a8\u751f\u6210\u7684\uff0c\u4e00\u822c\u662f\u4e00\u4e2a\u81ea\u7b7e\u540d\u7684\u8bc1\u4e66\uff08\u6216\u4f7f\u7528\u96c6\u7fa4\u81ea\u5e26\u7684\u8bc1\u4e66\uff09\u3002</li> <li>\u8be5\u8bc1\u4e66\u7684 DNS \u540d\u79f0\u4f1a\u5339\u914d\u4f60\u4e3a Route \u914d\u7f6e\u7684\u57df\u540d\uff0c\u4f8b\u5982\uff1ayourapp.apps.cluster.com\u3002</li> </ul> <p>Note</p> <pre><code>oc get secrets/router-ca -n openshift-ingress-operator\n</code></pre>"},{"location":"cloud/openshift/do280/04_network_security/#ca-service-ca","title":"\u5185\u90e8 CA \u6839\u8bc1\u4e66\uff08service-ca \u8bc1\u4e66\uff09","text":"<p>\u7528\u4e8e OpenShift \u96c6\u7fa4\u5185\u90e8\u670d\u52a1\u4e4b\u95f4\u7684\u5b89\u5168\u901a\u4fe1\u3002</p> <ul> <li>\u4e0d\u4ec5\u9650\u4e8e Route\uff0c\u8fd8\u53ef\u7528\u4e8e\u5185\u90e8\u670d\u52a1\uff08\u4f8b\u5982\uff1aPrometheus\u3001Alertmanager\u3001Webhook\u3001API Server\uff09\u4e4b\u95f4\u7684\u52a0\u5bc6\u901a\u4fe1\u3002</li> </ul> <p>Note</p> <pre><code># signing-key \u662f Service CA \u7684 \u79c1\u94a5\uff0c\u7528\u6765\u4e3a\u96c6\u7fa4\u4e2d\u7684\u670d\u52a1\u7b7e\u53d1 TLS \u8bc1\u4e66\noc get sercret/signing-key -n openshift-service-ca\n</code></pre>"},{"location":"cloud/openshift/do280/04_network_security/#example","title":"Example","text":""},{"location":"cloud/openshift/do280/04_network_security/#1-create-clear-route","title":"1. Create clear Route","text":"<pre><code>oc expose svc/my_service\n</code></pre>"},{"location":"cloud/openshift/do280/04_network_security/#2-create-edge-route","title":"2. Create edge Route","text":"<p>\u56e0\u4e3a OpenShift Router \u5728\u8fb9\u7f18\u7ec8\u6b62 TLS\uff0c\u5e76\u8d1f\u8d23\u7ba1\u7406\u8bc1\u4e66\uff0c\u56e0\u6b64\u5f97\u540d \u201cEdge\u201d\u3002\u53ef\u4ee5\u4f7f\u7528\uff1a</p> <ul> <li>OpenShift \u81ea\u5e26\u8bc1\u4e66\uff1a\u5982\u679c\u4f60\u4e0d\u63d0\u4f9b <code>route.spec.tl.certificate</code>\uff0cOpenShift \u4f1a\u4f7f\u7528\u9ed8\u8ba4\u7684 Router \u8bc1\u4e66.</li> <li>\u81ea\u5df1\u6307\u5b9a\u7684 \u8bc1\u4e66</li> </ul> <p>Warning</p> <p>\u9ed8\u8ba4 Router \u8bc1\u4e66\u9002\u7528\u4e8e OpenShift \u63d0\u4f9b\u7684 <code>*.apps.openshift-cluster.example.com</code> \u8fd9\u6837\u7684\u57df\u540d\uff0c\u4f46\u4e0d\u9002\u7528\u4e8e\u4f60\u81ea\u5df1\u7684\u57df\u540d\uff08\u5982 <code>mycompany.com</code>\uff09\u3002\u5982\u679c\u4f60\u60f3\u7528\u81ea\u5df1\u7684\u57df\u540d\uff0c\u5efa\u8bae\u63d0\u4f9b\u81ea\u5b9a\u4e49\u8bc1\u4e66\uff1a <pre><code>tls:\n    termination: edge\n    certificate: |-\n    -----BEGIN CERTIFICATE-----\n    ...\n    -----END CERTIFICATE-----\n    key: |-\n    -----BEGIN RSA PRIVATE KEY-----\n    ...\n    -----END RSA PRIVATE KEY-----\n</code></pre></p> <p>\ud83d\udccc Example: Create an Edge Route</p>"},{"location":"cloud/openshift/do280/04_network_security/#3-create-passthrough-route","title":"3. Create Passthrough Route","text":"<p>\u4e0d\u80fd\u4f7f\u7528 OpenShift \u81ea\u5e26\u8bc1\u4e66\uff0c\u56e0\u4e3a OpenShift \u4e0d\u4f1a\u7ec8\u6b62 TLS\uff0c\u53ea\u662f\u900f\u4f20 HTTPS/TLS \u6d41\u91cf\u5230\u540e\u7aef\u5e94\u7528\u3002 --&gt; \u8fd9\u610f\u5473\u7740\u540e\u7aef\u5e94\u7528\u5fc5\u987b\u81ea\u5df1\u7ba1\u7406\u8bc1\u4e66\u3002\u4f60\u9700\u8981\u5728 \u540e\u7aef\u5e94\u7528\uff08Pod\uff09\u4e2d\u5b89\u88c5 TLS \u8bc1\u4e66\uff0cOpenShift \u4e0d\u4f1a\u5e2e\u4f60\u5904\u7406\uff01</p> <p>\ud83d\udccc Example: Create a Passthrough Route with own Certificate</p>"},{"location":"cloud/openshift/do280/04_network_security/#_1","title":"\u751f\u4ea7\u73af\u5883","text":"<p>\u5728\u751f\u4ea7\u73af\u5883\u4e0b\uff0c\u5e94\u8be5\u5c3d\u91cf\u63d0\u4f9b\u81ea\u5df1\u7684\u8bc1\u4e66\uff0c\u6700\u4fbf\u6377\u7684\u662f\u7528\u81ea\u5df1\u7684\u8bc1\u4e66\uff08\u6bd4\u5982\u4eceLet\u2019s Encrypt\u90a3\u91cc\u4e70\uff09\u4ee3\u66ff OpenShift Ingress Controller \u4e2dOpenshift\u81ea\u5df1\u7684\u8bc1\u4e66\uff0c\u8fd9\u6837cluster\u4e0a\u6240\u6709\u7684 <code>route</code> \u90fd\u53ef\u4ee5\u4f7f\u7528\u8be5\u8bc1\u4e66</p>"},{"location":"cloud/openshift/do280/04_network_security/#2-networkpolicy-netpol","title":"2. NetworkPolicy (<code>netpol</code>)","text":"<p>NetworkPolicy\uff08<code>netpol</code>\uff09 \u662f\u4e00\u4e2akubernetes\u7684\u6982\u5ff5\uff0c\u8be6\u89c1CKAD 6.\u670d\u52a1\u4e0e\u7f51\u7edc. </p> <p>In contrast to traditional firewalls,  <code>netpol</code> network traffic between pods by using labels instead of IP addresses. </p> <p>Example</p> <p>1.Label the namespace <code>network-1</code> with <code>network=network-1</code>:</p> <pre><code>oc label namespace network-1 network=network-1\n# \u26a0\ufe0f oc label project network-1 network=network-1 \u4f1a\u62a5\u9519\uff0c\u65e0\u6cd5\u4fee\u6539 Project \u7684\u5143\u6570\u636e\uff01 \u53ea\u80fd\u6539 Namespace\u7684\uff01\n</code></pre> <p>2.Define <code>netpol</code>: Example 1  allows communication \"all pods in NS <code>network-2</code> --&gt; all pods in NS <code>network-1</code>\"  \u26a0\ufe0f <code>podSelector: {}</code> means all Pods in current NS</p> <pre><code>kind: NetworkPolicy\napiVersion: networking.k8s.io/v1\nmetadata:\n    name: network-2-policy\n    namespace: network-2\nspec:\n    podSelector: {}\n    ingress:\n    - from:\n        - namespaceSelector:\n            matchLabels:\n            network: network-1\n</code></pre> <p>Example 2 blocks all traffic, because no ingress rules are defined <pre><code>kind: NetworkPolicy\napiVersion: networking.k8s.io/v1\nmetadata:\n    name: default-deny\nspec:\n    podSelector: {}\n</code></pre></p> <p>Example 3 allows communication FROM pod <code>deployment: product-catalog</code> in NS <code>network-1</code> TO pod <code>role: qa</code> in NS <code>network-2</code>:</p> <pre><code>kind: NetworkPolicy\napiVersion: networking.k8s.io/v1\nmetadata:\nname: network-1-policy\nnamespace: network-1\nspec:\n    podSelector:\n        matchLabels:\n            deployment: product-catalog\ningress:  \n- from:  \n    - namespaceSelector:\n        matchLabels:\n            network: network-2\n    podSelector:\n        matchLabels:\n            role: qa\n    ports:  \n    - port: 8080\n    protocol: TCP\n</code></pre> <p>When you protect your pods by using network policies, Some OpenShift cluster services might need explicit policies to access pods. The following policies allow ingress from OpenShift monitoring and ingress pods:</p> <pre><code>---\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-from-openshift-ingress\nspec:\n  podSelector: {}\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          policy-group.network.openshift.io/ingress: \"\"\n---\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-from-openshift-monitoring\nspec:\n  podSelector: {}\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          network.openshift.io/policy-group: monitoring\n</code></pre>"},{"location":"cloud/openshift/do280/04_network_security/#3-protect-internal-traffic-with-tls-ca","title":"3. Protect Internal Traffic with TLS / \u5185\u90e8 CA \u6839\u8bc1\u4e66","text":"<p>By default, OpenShift encrypts network traffic between Nodes and the Control Plane, and prevents external entities from reading internal traffic. This encryption provides stronger security than default Kubernetes, which does not automatically encrypt internal traffic. </p> <p>Info</p> Feature Kubernetes <code>cert-manager</code> OpenShift <code>service-ca</code> Scope General-purpose cert management Internal OpenShift services only Supports external issuers? Yes (e.g., Let's Encrypt, Vault) No (uses OpenShift\u2019s internal CA) Manages certs for services? Yes Yes Manages certs for Ingress? Yes No Works outside OpenShift? Yes No Use case For External TLS Needs \u2192 for <code>Ingress</code>, public endpoints, or workload-specific certificates that need external validation. For Internal Communication  \u2192 to automatically issue and rotate certificates for internal <code>services</code> (avoiding manual certificate management). <p>\u4e00\u822c\u6765\u8bf4\u4e00\u4e2aOpenshift cluster\u4e2d\u4e24\u4e2aoperator\u90fd\u4f1a\u88ab\u7528\u5230</p>"},{"location":"cloud/openshift/do280/04_network_security/#service-ca-operator","title":"<code>service-ca</code> Operator","text":"<p>\u751f\u6210 edge route\u7684\u65f6\u5019\uff0cOpenShift \u7684 <code>service-ca</code> Operator \u4e3a\u96c6\u7fa4\u4e2d\u7684services \u63d0\u4f9b\u81ea\u52a8\u8bc1\u4e66\u7ba1\u7406\u3002\u4f7f\u7528\u6b65\u9aa4\u5982\u4e0b\uff1a </p> <p>\u8bf4\u660e</p> <p>\u4e3a\u4e86\u4fbf\u4e8e\u7406\u89e3\uff0c\u6211\u4eec\u8fd9\u91cc:</p> <ul> <li>SERVER = the visitee</li> <li>CLIENT = the visiter</li> <li>CA = a trustworthy third-party authority</li> </ul>"},{"location":"cloud/openshift/do280/04_network_security/#1-server-secret-generation","title":"1. [SERVER] Secret generation","text":"<p><pre><code>oc annotate service hello \\\n    service.beta.openshift.io/serving-cert-secret-name=hello-secret\n</code></pre> With this annotation, the <code>service-ca</code> Operator auto-generates a <code>secret</code> that named <code>hello-secret</code>, which contains signed certificate and a TLS key.</p> <p>the auto-generated Secret <code>hello-secret</code></p> <pre><code>[student@workstation ~]$ oc describe secret hello-secret\nName:         server-secret\nNamespace:    network-svccerts\n...output omitted...\nType:  kubernetes.io/tls\n\nData\n====\ntls.key:  1675 bytes\ntls.crt:  2615 bytes\n</code></pre>"},{"location":"cloud/openshift/do280/04_network_security/#2-server-mount-secret-to-deployment","title":"2. [SERVER] Mount secret to deployment","text":"<p>YAML file of a NGINX <code>deployment</code>:</p> <pre><code>...\nspec:\n  template:\n    spec:\n      containers:\n        - name: hello\n          volumeMounts:\n            - name: hello-volume            # volume definition\n              mountPath: /etc/pki/nginx/    # the application-specific mount path\n      volumes:\n        - name: hello-volume                # volume definition\n          secret:\n            defaultMode: 420                # the read-write permissions that the application recommends\n            secretName: hello-secret        # the auto-generated Secret\n            items:\n              - key: tls.crt                # - Secret's certificate\n                path: server.crt            # file name in the Container, answer \"Mount to where?\"\n              - key: tls.key                # - Secret's key\n...\n</code></pre> <p>Certificate Authority (CA)</p> <p>In cryptography, a certificate authority is an entity that stores, signs, and issues digital certificates. \u662f\u8d1f\u8d23\u53d1\u653e\u548c\u7ba1\u7406\u6570\u5b57\u8bc1\u4e66\u7684\u6743\u5a01\u673a\u6784</p> <p></p>"},{"location":"cloud/openshift/do280/04_network_security/#3-client-certificate-validation","title":"3. [Client] Certificate validation","text":"<p>For a client service application to verify the validity of a certificate, the application needs the CA bundle that signed that certificate. The <code>service-ca</code> Operator injects the CA bundle (a group of Certificates) when you apply the annotation <code>service.beta.openshift.io/inject-cabundle=true</code> to an object.</p> <p>The object could be:</p> <ul> <li>ConfigMap</li> <li>API Service: in <code>spec.caBundle</code> field</li> <li>CRD: in <code>spec.conversion.webhook.clientConfig.caBundle</code> field</li> <li>Mutating or validating webhook: in <code>clientConfig.caBundle</code> field</li> </ul> <p>Example: annotating a <code>ConfigMap</code>:</p> <pre><code>oc annotate configmap ca-bundle \\\n    service.beta.openshift.io/inject-cabundle=true\n\n# this cli will overwrite the whole CM, so make sure the CM is empty\n</code></pre> <p>CA Bundle</p> <p>A CA bundle, or Certificate Authority bundle, is a group of SSL certificates that are bundled into a single file. </p> <p>OpenShift/Kubernetes \u4e2d\u7684\u670d\u52a1\u4f1a\u901a\u8fc7 CA Bundle \u4e2d\u7684 Certificates \u786e\u5b9a\u54ea\u4e9b CA \u662f\u53ef\u4fe1\u4efb\u7684\uff0c\u4ece\u800c\u9a8c\u8bc1\u901a\u4fe1\u5bf9\u65b9\u7684\u8bc1\u4e66\uff0c\u5982\u56fe\uff1a</p> <p></p> <pre><code>-----BEGIN CERTIFICATE-----\nMIIDdzCCAl+gAwIBAg...\n-----END CERTIFICATE-----\n\n-----BEGIN CERTIFICATE-----\nMIIEFTCCAv2gAwIBAg...\n-----END CERTIFICATE-----\n</code></pre> <p>What is inside a certificate?</p> <ul> <li>issue to</li> <li>issued by</li> <li>Server Public Key</li> <li>encrypted server Public Key (encrypted by CA Private Key)</li> </ul>"},{"location":"cloud/openshift/do280/04_network_security/#4-certificate-rotation","title":"4. Certificate rotation","text":"<p>The service CA certificate is valid for 26 months by default and is automatically rotated after 13 months. After rotation is a 13-month grace period where the original CA certificate is still valid. During this grace period, each pod that is configured to trust the original CA certificate must be restarted in some way - a restart of a <code>service</code> will automatically injects the new CA bundle.</p> <p>You can also manually rotate the certificate:      1. service CA's certificate     The Service CA is the certificate authority that signs and issues certificates for services in the cluster.     <pre><code>oc delete secret/signing-key -n openshift-service-ca\n</code></pre>     2. generated service certificate generated service certificate are TLS certificates automatically created by the <code>service-ca</code> Operator for individual services or routes.     <pre><code># delete the existing secret, and the `service-ca` Operator automatically generates a new one.\noc delete secret certificate-secret\n</code></pre></p> <p>rotate</p> <p>In this context, \"rotate\" refers to the process of automatically replacing an old service CA certificate with a new one before the old certificate expires. </p>"},{"location":"cloud/openshift/do280/04_network_security/#exercise-illustration","title":"Exercise Illustration","text":""},{"location":"cloud/openshift/do280/04_network_security/#44-configure-network-policies","title":"4.4 Configure Network Policies","text":""},{"location":"cloud/openshift/do280/04_network_security/#46-protect-internal-traffic-with-tls","title":"4.6 Protect Internal Traffic with TLS","text":""},{"location":"cloud/openshift/do280/05_expose_sni_app/","title":"5. Expose SNI Application","text":""},{"location":"cloud/openshift/do280/05_expose_sni_app/#1-loadbalancer-services","title":"1. LoadBalancer Services","text":"<p>k8s Ingress / OC Route</p> <p>Both k8s Ingress and OC Route are mainly designed to <code>HTTP/HTTPS</code> services. To expose non-HTTP services, you use LoadBalancer service</p> <p>k8s provides different <code>service</code>\uff08different service types check here\uff09. <code>Loadbalancer</code> services require the use of network features that are not available in all environments.</p> <p>For example, cloud providers(such as IBM Cloud or G-cloud) typically provide their own load balancer services. These services use features that are specific to the cloud provider.</p> <p>If you run a Kubernetes cluster on a cloud provider, controllers in Kubernetes use the cloud provider's APIs to configure the required cloud provider resources for a load balancing service. On environments where managed load balancer services are not available, you must configure a load balancer component according to the specifics of your network - for example, MetalLB:</p>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#metallb","title":"MetalLB","text":"<p>MetalLB \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u89e3\u51b3\u65b9\u6848(load balancer component)\uff0c\u4e13\u4e3a\u6ca1\u6709\u5185\u7f6e\u4e91\u8d1f\u8f7d\u5747\u8861\u5668\u7684\u96c6\u7fa4\u8bbe\u8ba1\u3002\u6bd4\u5982bare metal cluster, clusters on hypervisors(\u865a\u62df\u673a\u7ba1\u7406\u7a0b\u5e8f) \u6216\u79c1\u6709\u4e91.</p> <p>\u8be5 Operator \u7684\u540d\u5b57\u672c\u8eab\u4e5f\u5e26 \u201cMetal\u201d\uff0c\u5145\u5206\u8bf4\u660e\u4e86\u5b83\u7684\u4f7f\u7528\u73af\u5883</p> <p>MetalLB is an Operator that you can install per Operator Lifecycle Manager:</p> <p></p> <p>step-by-step</p> <ol> <li>Deploy MetalLB: Ensure MetalLB is installed and running in the cluster.</li> <li>Create the <code>IPAddressPool</code> resource</li> <li>Configure MetalLB Advertisement: create either <code>L2Advertisement</code>\uff08L2\u5e7f\u64ad\uff09 or <code>BGPAdvertisement</code>\uff08BGP\u5e7f\u64ad\uff09 resource</li> <li>Create a LoadBalancer type <code>service</code> and MetalLB will allocate IPs from the specified pool. Example: create <code>service</code> of the LoadBalancer type to expose non-HTTP services outside the cluster. <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: example-lb\n  namespace: example\nspec:\n  ports:\n  - port: 1234 \n    protocol: TCP\n    targetPort: 1234\n  selector:\n    name: example\n  type: LoadBalancer\n</code></pre> After you create the service, the load balancer component(such as MetalLB) updates the service resource with information such as the public IP address where the service is available. You can get the IP address by:   <pre><code>[user@host ~]$ kubectl get service\nNAME         TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)          AGE\nexample-lb   LoadBalancer   172.30.21.79     192.168.50.20   1234:31265/TCP   4m7s\n\n&lt;!-- or --&gt;\n[user@host ~]$ oc get example-lb -o jsonpath=\"{.status.loadBalancer.ingress}\"\n[{\"ip\":\"192.168.50.20\"}]\n</code></pre></li> </ol> <p>\u26a0\ufe0f PORT(S)\u7684\u683c\u5f0f\u662f <code>\u5916\u90e8\u7aef\u53e3:\u5185\u90e8\u7aef\u53e3/\u534f\u8bae</code> (<code>1234:31265/TCP</code>)</p> <p>You can now connect to the <code>service</code> on the <code>192.168.50.20:1234</code> address. You can test it in several ways: <pre><code>ping 192.168.50.20:1234\n# or\nnc -vz 192.168.50.20 1234\n</code></pre></p> <p>MetalLB's \u4e24\u79cd\u6a21\u5f0f</p> <ol> <li>Layer 2 \u6a21\u5f0f\uff1a\u4f7f\u7528 ARP/NDP \u901a\u544a\uff0c\u5c06\u670d\u52a1 IP \u5e7f\u64ad\u7ed9\u540c\u4e00\u5b50\u7f51\u5185\u7684\u6240\u6709\u4e3b\u673a\u3002\u8fd9\u79cd\u6a21\u5f0f\u9002\u7528\u4e8e\u7b80\u5355\u7f51\u7edc\u62d3\u6251\u3002</li> <li>BGP\uff08Border Gateway Protocol\uff09\u6a21\u5f0f\uff1a\u4e0e\u7f51\u7edc\u4e2d\u7684\u8def\u7531\u5668\u5bf9\u7b49\uff0c\u52a8\u6001\u5ba3\u544a\u670d\u52a1 IP\u3002\u8fd9\u79cd\u6a21\u5f0f\u9002\u5408\u66f4\u590d\u6742\u7684\u7f51\u7edc\u73af\u5883\uff0c\u652f\u6301\u66f4\u9ad8\u7ea7\u7684\u6d41\u91cf\u8def\u7531\u548c\u8d1f\u8f7d\u5747\u8861\u3002</li> </ol> <p>Configure MetalLB Advertisement</p> <p>You can use <code>IPAddressPools</code> resource for further configuration, for instance, to restrict the available load balancer IP addresses to 192.168.50.20 and 192.168.50.21. Example: <pre><code>apiVersion: metallb.io/v1beta1\nkind: IPAddressPool\nmetadata:\n  name: my-ip-pool\n  namespace: metallb-system  # Ensure this is the namespace where MetalLB is deployed\nspec:\n  addresses:\n      - 192.168.50.20-192.168.50.21  # The range of IP addresses for the pool\n</code></pre></p> <p>\u26a0\ufe0f To bind the <code>IPAddressPool</code> to MetalLB's AddressPool settings, you need to configure a <code>L2Advertisement</code> or <code>BGPAdvertisement</code></p> <p>Check the IPAddressPools defined in ALL Namespace: <pre><code>oc get ipaddresspools.metallb.io -A\n</code></pre></p>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#2-multus-secondary-networks","title":"2. Multus Secondary Networks","text":"<p>Kubernetes manages a pod network and a service network:</p> <ul> <li>The pod network provides network interfaces to each pod, and by default, provides network communication between all pods. </li> <li>The service network provides stable addressing for services that run on pods. Furthermore, other facilities provide mechanisms to expose services outside the cluster.</li> </ul> <p>However, in some cases, connecting some pods to a custom network could be useful - The Multus CNI (container network interface) plug-in helps to attach pods to custom networks. The custom networks could be internal OR external.</p> <p>step-by-step</p> <ol> <li>install Multus plugin</li> <li>configure Additional Network - 2 options:<ul> <li>NetworkAttachmentDefinition</li> <li>Network</li> </ul> </li> <li>use Additional Network in a Deployment by annotating it</li> </ol>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#multus","title":"\u5b89\u88c5 Multus \u63d2\u4ef6","text":"<p>Multus CNI \u63d2\u4ef6 \u5141\u8bb8\u96c6\u7fa4\u4e2d\u7684 Pod \u4f7f\u7528\u591a\u4e2a\u7f51\u7edc\u63a5\u53e3\u3002\u5b83\u5145\u5f53\u4e00\u4e2a\u5143\u63d2\u4ef6/meta-plugin\uff0c\u80fd\u591f\u5c06\u591a\u4e2a CNI \u63d2\u4ef6/plugin\uff08\u5982 Flannel\u3001Calico\u3001SR-IOV \u7b49\uff09\u6574\u5408\u5728\u4e00\u8d77\uff0c\u8d4b\u4e88\u6bcf\u4e2a Pod \u8fde\u63a5\u5230\u591a\u4e2a\u7f51\u7edc\u7684\u80fd\u529b\uff0c\u4e5f\u5c31\u662f\u8bf4 Pod \u53ef\u4ee5\u62e5\u6709\u591a\u5f20\u7f51\u5361\uff08\u62e5\u6709\u591a\u4e2a<code>ip</code>\uff09\u3002\u5b89\u88c5:</p> <pre><code>kubectl apply -f https://raw.githubusercontent.com/k8snetworkplumbingwg/multus-cni/master/deployments/multus-daemonset.yml\n</code></pre> <p>\u66f4\u591a\u4fe1\u606f\u89c1Multus Doc</p> <p>Multus CNI vs Default CNI in cluster</p> <ul> <li>The default CNI plugin (like <code>Calico</code> or <code>Flannel</code>) continues to function as the primary network provider for the cluster, handling the standard networking features such as Pod-to-Pod communication and IP management.<ul> <li>k8s usually uses <code>Calico</code> or <code>Flannel</code> as default</li> <li>oc uses <code>SDN</code> or <code>OVN-Kubernetes</code></li> </ul> </li> <li>Multus meta-plugin adds support for secondary networks by allowing Pods to connect to additional networks \ud83d\udc49 but it doesn't replace the default network functionality.</li> </ul> <p>meta-plugin</p> <p>meta-plugin is a plugin that can call multiple other plugins.</p> <p>Multus CNI Plugin is a meta-plugin. \u5176\u4ed6CNI \u63d2\u4ef6\u53ef\u901a\u8fc7Operators\u6765\u5b89\u88c5\u3002 \u6bd4\u5982 Kubernetes NMState operator \u6216 SR-IOV (Single Root I/O Virtualization) network operator\u3002\u4ed6\u4eec\u4e0eMultus CNI\u7684\u5173\u7cfb\u5982\u56fe:</p> <p></p> <p>\u4f7f\u7528\u573a\u666f</p> <ul> <li>\u4e3a\u4e86\u5b89\u5168\uff1a\u7528\u6237\u53ef\u4ee5\u5c06\u654f\u611f\u7684\u6d41\u91cf\u53d1\u9001\u5230\u4e13\u4e3a\u5b89\u5168\u8003\u8651\u800c\u7ba1\u7406\u7684\u7f51\u7edc\u5e73\u9762\uff0c\u4e5f\u53ef\u9694\u79bb\u4e0d\u80fd\u5728\u79df\u6237\u6216\u5ba2\u6237\u95f4\u5171\u4eab\u7684\u79c1\u5bc6\u6570\u636e\u3002</li> <li>\u4e3a\u4e86\u6027\u80fd\uff1a\u7528\u6237\u53ef\u4ee5\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u5e73\u9762\u4e0a\u53d1\u9001\u6d41\u91cf\uff0c\u4ee5\u7ba1\u7406\u6bcf\u4e2a\u5e73\u9762\u4e0a\u6d41\u91cf\u7684\u591a\u5c11\u3002</li> </ul>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#secondary-network","title":"\u914d\u7f6e Secondary Network","text":"<p>Two methods to configure secondary networks:</p> <ol> <li>create a <code>NetworkAttachmentDefinition</code> resource. </li> <li>update the configuration of the cluster network resource</li> </ol>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#method-1-create-networkattachmentdefinition","title":"Method 1: create <code>NetworkAttachmentDefinition</code>","text":"<pre><code>apiVersion: k8s.cni.cncf.io/v1\nkind: NetworkAttachmentDefinition\nmetadata:\n  name: example # Network name\nspec:\n  config: |-\n    {\n      \"cniVersion\": \"0.3.1\",\n      \"name\": \"example\",        # Network name\n      \"type\": \"host-device\",    # \ud83c\udf1f Network Type\n      \"device\": \"ens4\",\n      \"ipam\": {                 # Additional network configuration\n        \"type\": \"dhcp\"\n      }\n    }\n</code></pre> <p>\ud83c\udf1f Network Type</p> <p>You can create network attachment definitions of the following types:</p> <ul> <li>Host device: Attaches a network interface to a single pod.  \ud83d\udc49 \u5f53\u67d0\u4e2aDeployment\u53ea\u6709\u4e00\u4e2areplica\u7684\u65f6\u5019\u9002\u7528</li> <li>Bridge: Uses an existing bridge interface on the node, or configures a new bridge interface. The pods that are attached to this network can communicate with each other through the bridge, and to any other networks that are attached to the bridge.</li> <li>IPVLAN: Creates an IPVLAN-based network that is attached to a network interface.</li> <li>MACVLAN: Creates an MACVLAN-based network that is attached to a network interface.</li> </ul>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#method-2-update-network","title":"Method 2: update Network","text":"<p>You can also create the same network attachment by editing the cluster network operator configuration:</p> <pre>\n<code>\napiVersion: operator.openshift.io/v1\nkind: Network\nmetadata:\n  name: cluster\nspec:\n...output omitted...\n  additionalNetworks:\n  - name: example\n    namespace: example\n    rawCNIConfig: |- \n      {\n        \"cniVersion\": \"0.3.1\",\n        \"name\": \"example\",\n        \"type\": \"host-device\",\n        \"device\": \"ens4\",\n        \"ipam\": {\n          \"type\": \"dhcp\"\n        }\n      }\n    type: Raw\n</code>\n</pre> <p><code>ipam</code></p> <p>The IP Address Management (<code>ipam</code>) CNI plug-in provides IP addresses for other CNI plug-ins.</p> <p>You can provide more complex network configurations in the <code>ipam</code> key. <code>dhcp</code> (Dynamic Host Configuration Protocol) or <code>static</code> For example: <pre><code>\"ipam\": {\n  \"type\": \"static\",\n  \"addresses\": [\n    {\"address\": \"192.168.X.X/24\"}\n  ]\n}\n</code></pre></p>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#secondary-network_1","title":"\u4f7f\u7528Secondary Network","text":"<p>Warning</p> <p>Network attachment resources are namespaced, and are available only to pods in their namespace.</p> <p>To use the Secondary Network, simply add <code>annotation</code> to the <code>deployment</code>:</p> <pre>\n<code>\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: example\n  namespace: example\nspec:\n  selector:\n    matchLabels:\n      app: example\n      name: example\n  template:\n    metadata:\n      annotations:\n        k8s.v1.cni.cncf.io/networks: example\n      labels:\n        app: example\n        name: example\n    spec:\n...\n</code>\n</pre> <p>Multus updates the <code>k8s.v1.cni.cncf.io/network-status</code> annotation with the status of the additional networks.</p> <pre>\n<code>\n[user@host ~]$ oc get pod example \\\n  -o jsonpath='{.metadata.annotations.k8s\\.v1\\.cni\\.cncf\\.io/network-status}'\n[{\n    \"name\": \"ovn-kubernetes\",\n    \"interface\": \"eth0\",\n    \"ips\": [\n        \"10.8.0.59\"\n    ],\n    \"mac\": \"0a:58:0a:08:00:3b\",\n    \"default\": true,\n    \"dns\": {}\n},{\n    \"name\": \"non-http-multus/example\",\n    \"interface\": \"net1\",\n    \"ips\": [\n        \"1.2.3.4\"\n    ],\n    \"mac\": \"52:54:00:01:33:0a\",\n    \"dns\": {}\n}]\n</code>\n</pre> <p>There are 2 networks attached to the <code>pod</code>:</p> <ol> <li><code>ovn-kubernetes</code>: the primary network attachment managed by the OVN-Kubernetes CNI plugin, which is the default network(indicated by <code>\"default\": true</code>) for the OpenShift cluster.</li> <li><code>non-http-multus/example</code>: a secondary network attachment created using the Multus CNI.</li> </ol>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#exercise-illustration","title":"Exercise Illustration","text":""},{"location":"cloud/openshift/do280/05_expose_sni_app/#52-networkattachmentdefinition","title":"5.2 NetworkAttachmentDefinition","text":"<p>You can get the <code>NetworkAttachmentDefinition</code> resource by:</p> <pre><code>oc get networkattachmentdefinition.k8s.cni.cncf.io\n</code></pre>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#54","title":"5.4","text":"<p>Background: DO280 Course Infrastructure</p> <p></p> <p>Both <code>bastion</code> and <code>utility</code> VM act as Router:</p> <ul> <li><code>bastion</code> connects student network and classroom network</li> <li><code>utility</code> connects student network and cluster network</li> </ul>"},{"location":"cloud/openshift/do280/05_expose_sni_app/#clusters-network-interfaces","title":"Cluster's Network Interfaces","text":"<p>To check the IP of a node, login as <code>admin</code>. \u5728 OpenShift \u96c6\u7fa4\u4e2d\u7684 master01 \u8282\u70b9\u4e0a\u542f\u52a8\u4e00\u4e2a\u8c03\u8bd5\u5bb9\u5668.  <pre><code># -- \u662f\u4e00\u4e2a\u5206\u9694\u7b26\uff0c\u7528\u4e8e\u533a\u5206 oc debug \u547d\u4ee4\u7684\u9009\u9879\u548c\u8981\u5728\u76ee\u6807\u8282\u70b9\u4e0a\u6267\u884c\u7684\u547d\u4ee4\u3002\n\noc debug node/master01 -- chroot /host ip addr\n</code></pre> The result contains 2 Network Interfaces:</p> <ul> <li><code>ens3</code>: cluster main network interface</li> <li><code>ens4</code>: an additional network interface </li> </ul> <p>Output: <pre><code>2: ens3: ...\n3: ens4: ... inet 192.168.51.10/24 brd 192.168.51.255 ...\n</code></pre></p> <p>Warning</p> <p><code>bastion</code> machine doesn't has access to <code>ens4</code>, <code>utility</code> machine has access to <code>ens4</code> by doing: <pre><code>[student@workstation ~]$ ssh utility\n</code></pre></p>"},{"location":"cloud/openshift/do280/06_developer_self_service/","title":"6. Enable Developer Self-Service","text":""},{"location":"cloud/openshift/do280/06_developer_self_service/#1-resourcequota","title":"1. ResourceQuota","text":"<p>Workload Resource Limit</p> <p>For resource limitating purpose, workloads can specify the following properties:</p> <ul> <li>limits: MAXIMAL resource consumption.</li> <li>requests: MINIMAL resource consumption, to prevent deployments of new workloads if the cluster has insufficient resources.</li> </ul> <p><code>ResourceQuota</code> defines constraint that applies to the one namespace, more check here\u3002</p> <p>ResourceQuota are extensible</p> <p>\u8fd9\u91cc\u7684 extensible/\u53ef\u6269\u5c55 \u6307\u7684\u662f Kubernetes \u5141\u8bb8 <code>ResourceQuota</code> \u914d\u7f6e\u4e0d\u540c\u7684 API \u7ec4\uff0c\u751a\u81f3\u662f \u81ea\u5b9a\u4e49\u8d44\u6e90\uff08CRD\uff09\u914d\u989d\u3002</p> <p>\u4e5f\u662f\u8fd9\u4e2a\u53ef\u6269\u5c55\u6027\uff0c\u5bfc\u81f4 Kubernetes \u672c\u8eab\u65e0\u6cd5\u9a8c\u8bc1 ResourceQuota \u662f\u5426\u6b63\u786e\u6216\u6709\u6548\u3002\u5982\u4f55\u68c0\u6d4b\u5462\uff1f</p> <ol> <li>\u521b\u5efa\u5f88\u4f4e\u7684 ResourceQuota</li> <li>\u521b\u5efa\u8d44\u6e90</li> <li>\u89c2\u5bdf\u8d44\u6e90\u662f\u5426\u6210\u529f\u521b\u7acb\uff0c\u8fd8\u53ef\u4ee5\u770b NS \u7684 events\uff1a     <pre><code>oc get event --sort-by .metadata.creationTimestamps\n</code></pre>     common error:<ul> <li><code>exceeded quota: one-cpu</code></li> <li><code>must specify requests.cpu</code></li> </ul> </li> <li>\u67e5\u770b ResourceQuota \u7684 status\uff1a     <pre><code>oc get quota one-cpu -o yaml\n</code></pre>     Example:     <pre><code>status:\n  hard:\n    requests.cpu: \"1\"\n  used:\n    requests.cpu: \"1\"\n</code></pre></li> </ol>"},{"location":"cloud/openshift/do280/06_developer_self_service/#2-clusterresourcequota","title":"2. ClusterResourceQuota","text":"<p>Cluster administrators can use <code>ClusterResourceQuota</code> to apply restrictions across multiple \"selected\" namespaces</p>"},{"location":"cloud/openshift/do280/06_developer_self_service/#_1","title":"\u521b\u5efa","text":""},{"location":"cloud/openshift/do280/06_developer_self_service/#1-yaml","title":"1. YAML","text":"<pre><code>apiVersion: quota.openshift.io/v1\nkind: ClusterResourceQuota\nmetadata:\n  name: example\nspec:\n  quota:              # NEW\n    hard:             # From here, the same as in ResourceQuota\n      limits.cpu: 4\n  selector:           # selected namespaces\n    annotations: {}\n    labels:\n      matchLabels:\n        kubernetes.io/metadata.name: example\n</code></pre>"},{"location":"cloud/openshift/do280/06_developer_self_service/#2-web-console","title":"2. Web Console","text":"<p>Administration &gt; CustomResourceDefinitions</p>"},{"location":"cloud/openshift/do280/06_developer_self_service/#3-cli","title":"3. CLI","text":"<pre><code>oc create clusterresourcequota example \\\n    --project-label-selector=group=dev \\\n    --hard=requests.cpu=10,limits.cpu=20    # seperate the constraints by \",\" - NO SPACE\n</code></pre>"},{"location":"cloud/openshift/do280/06_developer_self_service/#_2","title":"\u67e5\u770b","text":"<p>Users might not have read access to <code>clusterresourcequota</code>. OpenShift creates resources called <code>AppliedClusterResourceQuota</code> in namespaces that are affected by cluster resource quotas. </p> <pre><code>oc describe AppliedClusterResourceQuota -n example-2\n</code></pre>"},{"location":"cloud/openshift/do280/06_developer_self_service/#3-limitrange","title":"3. LimitRange","text":"<p><code>LimitRange</code> defines constraint that applies to Workload, for example: <code>containers</code>, <code>pods</code>, <code>images</code>, <code>imagestream</code>, and <code>pvc</code>. </p> <pre><code>apiVersion: v1\nkind: LimitRange\nmetadata:\n  name: mem-limit-range\n  namespace: default\nspec:\n  limits:   # \u8bb0\u5fc6\u65b9\u6cd5\uff1a\u56e0\u4e3a\u662f LimitRange \u6240\u4ee5 spec \u7531 limits \u5f00\u59cb\n    - default:\n        memory: 512Mi\n      defaultRequest:\n        memory: 256Mi\n      type: Container\n</code></pre> <p>Limit ranges can specify the following limit types:</p> <ul> <li><code>default</code>(Limit): default limits for workloads,  eliminate a need to declare limits explicitly in each workload. </li> <li><code>defaultRequest</code>: default <code>requests</code> for workloads<ul> <li>\u27a1\ufe0f <code>default</code> &gt;= <code>defaultRequest</code></li> </ul> </li> <li><code>max</code>: the maximum value of both <code>requests</code> and <code>limits</code>. <ul> <li>\u27a1\ufe0f Consider allowing users who create workloads to edit maximum limit ranges.</li> </ul> </li> <li><code>min</code>: the minimum value of both <code>requests</code> and <code>limits</code></li> <li><code>maxLimitRequestRatio</code> = <code>limits</code>/<code>requests</code>. <code>maxLimitRequestRatio: 2</code> means the resource <code>limit</code> cannot be more than twice the <code>request</code>.</li> </ul> <p>Warning</p> <p>Problem: When a <code>ResourceQuota</code>/<code>ClusterResourceQuota</code> is present, all workloads must specify the corresponding <code>limits</code> and <code>requests</code>. </p> <p>Solution: Set the <code>LimitRange.spec.limits.default</code> and <code>LimitRange.spec.limits.defaultRequest</code>, workloads use the requests and limits from the limit range by <code>default</code>. So you will be able to create workloads without seeing this error:</p> <pre><code>...output omitted...\n13s         Warning   FailedCreate        replicaset/example-74c57c8dff   \nError creating: pods \"example-74c57c8dff-rzl7w\" is forbidden: \nfailed quota: example: must specify \n  limits.cpu for: hello-world-nginx; \n  limits.memory for: hello-world-nginx; \n  requests.cpu for: hello-world-nginx; \n  requests.memory for: hello-world-nginx\n...output omitted...\n</code></pre> <p>Warning</p> <p><code>LimitRange</code> gives workloads(e.g. <code>deployment</code>) default value, but in the generated <code>deployment.yaml</code> you see: <pre><code># deployment\n.spec.template.spec.containers[].resources: {}\n</code></pre></p> <p><code>LimitRange</code> modify <code>containers</code> but not <code>deployments</code></p> <p>Danger</p> <p><code>LimitRange</code> do not affect existing pods. </p> CLI <code>oc get event --sort-by .metadata.creationTimestamp</code> <code>oc set resources deployment example --limits=cpu=[new-cpu-limit]</code> Set resource for workload <code>oc adm top node</code> show usage statistics of resources \uff08\u6ca1\u6709\u6392\u5e8f\uff0c\u5c3d\u7ba1\u547d\u4ee4\u4e2d\u6709top\u8fd9\u4e2a\u8bcd\uff09 <code>oc describe node/master01</code> view the node details <p>oc describe node/xxx</p> <pre><code>[student@workstation ~]$ oc describe node/master01\nName:               master01\n\nCapacity:                     # \u2b05 \u603b\u5bb9\u91cf\n  cpu:                6\n\nAllocatable:                  # \u2b05 \u53ef\u5206\u914d CPU \u8d44\u6e90\uff1a5500m\uff085.5 \u6838\u5fc3\uff09\n  cpu:                5500m   \n\nAllocated resources:\n  (Total limits may be over 100 percent, i.e., overcommitted.)\n  Resource           Requests       Limits\n  --------           --------       ------\n  cpu                4627m (84%)    0 (0%)    # \u2b05 4627m (84%), \u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684 Pod requests \u7684\u603b\u548c\n                                              # \u2b05 0 (0%)\uff0c\u6ca1\u6709\u8bbe limits\n  memory             12102Mi (81%)  0 (0%)\n  ephemeral-storage  0 (0%)         0 (0%)\n  hugepages-1Gi      0 (0%)         0 (0%)\n  hugepages-2Mi      0 (0%)         0 (0%)\n</code></pre> <ul> <li>\u53ef\u7528\u7684 CPU=5500m-4627m &lt; 1vCPU</li> <li>Allocatable/\u53ef\u5206\u914d CPU \u8d44\u6e90\uff1aKubernetes \u4e0d\u4f1a\u628a\u5168\u90e8 6 \u4e2a CPU \u6838\u5fc3\u5206\u914d\u7ed9 Pod\uff0c\u5b83\u4f1a\u9884\u7559\u90e8\u5206\u8d44\u6e90\uff08500m\uff09\u7528\u4e8e\u7cfb\u7edf\u8fdb\u7a0b\uff08\u5982 kubelet\u3001\u5bb9\u5668\u8fd0\u884c\u65f6\u3001\u76d1\u63a7\u7b49\uff09 <pre><code># m = millicores / \u6beb\u6838\n1000m = 1 vCPU\n</code></pre> \u8be5\u914d\u7f6e\u53ef\u4ee5\u5728 <code>/etc/kubernetes/kubelet.conf</code> \u91cc\u7684 <code>system-reserved</code> \u914d\u7f6e\u770b\u5230\u3002</li> </ul>"},{"location":"cloud/openshift/do280/06_developer_self_service/#4-project-template","title":"4. Project Template","text":"<p>OC Project vs k8s Namespace</p> <p>OpenShift introduces <code>projects</code> to improve security and users' experience of working with <code>namespaces</code>. The OpenShift API server adds the <code>Project</code> resource type. </p> <p>When you make a query to list <code>projects</code>, the API server lists <code>namespaces</code>, filters the visible <code>namespaces</code> to your user, and returns the visible <code>namespaces</code> in <code>project</code> format.</p> <p>OpenShift introduces the <code>ProjectRequest</code> resource type. When you create a project request, the OpenShift API server creates a <code>namespace</code> from a Project Template. By using a Project Template, cluster administrators can customize <code>namespace</code> to have:</p> <ul> <li>specific permissions</li> <li><code>ResourceQuota</code></li> <li><code>LimitRange</code></li> </ul> <p></p>"},{"location":"cloud/openshift/do280/06_developer_self_service/#resources","title":"Resources","text":"<p>You can add any namespaced resource to the Project Template. For example:</p> <ul> <li>Role &amp; RoleBinding: to grant specific permissions in new projects. <ul> <li>Default template grants the admin role to the user who requests the project.</li> </ul> </li> <li>ResourceQuota &amp; LimitRange: to ensure that all new projects have resource limits.<ul> <li>Better create both <code>ResourceQuota</code> and <code>LimitRange</code> together - to have the <code>default</code> and <code>defaultRequest</code> values - reduce the effort for workload creation.</li> </ul> </li> <li>NetworkPolicy: to enforce organizational network isolation requirements.</li> </ul>"},{"location":"cloud/openshift/do280/06_developer_self_service/#creation","title":"Creation","text":"<p>Create a file with an initial template: <pre><code>oc adm create-bootstrap-project-template -o yaml &gt; project-template.yaml\n</code></pre></p> <p>The YAML file looks like this:</p> <pre>\n<code>\napiVersion: template.openshift.io/v1\nkind: Template\nmetadata:\n  creationTimestamp: null\n  name: project-request\nobjects:\n- apiVersion: project.openshift.io/v1\n  kind: Project\n  metadata:\n    annotations:\n      openshift.io/description: ${PROJECT_DESCRIPTION}\n      openshift.io/display-name: ${PROJECT_DISPLAYNAME}\n      openshift.io/requester: ${PROJECT_REQUESTING_USER}\n    creationTimestamp: null\n    name: ${PROJECT_NAME}\n  spec: {}\n  status: {}\n- apiVersion: rbac.authorization.k8s.io/v1\n  kind: RoleBinding\n  metadata:\n    creationTimestamp: null\n    name: admin\n    namespace: ${PROJECT_NAME}\n  roleRef:\n    apiGroup: rbac.authorization.k8s.io\n    kind: ClusterRole\n    name: admin\n  subjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: ${PROJECT_ADMIN_USER}\nparameters:\n- name: PROJECT_NAME\n- name: PROJECT_DISPLAYNAME\n- name: PROJECT_DESCRIPTION\n- name: PROJECT_ADMIN_USER\n- name: PROJECT_REQUESTING_USER\n</code>\n</pre> <p>Note</p> <p>When a user requests a project, OpenShift replaces the <code>${VARIABLE}</code> syntax with the parameters of the project request, and creates the objects in the objects key.</p> <ul> <li><code>objects</code> contains a list of resources to be created</li> <li><code>parameters</code> contains a list of available parameters</li> </ul> <p>\u4e0d\u5efa\u8bae\u76f4\u63a5\u624b\u52a8\u4fee\u6539\u6539\u6587\u4ef6\uff0c\u53ef\u4ee5\u8fd9\u6837\u505a\uff1a</p> <ol> <li>\u521b\u5efa\u4e00\u4e2anamespace</li> <li>\u521b\u5efa resources \u6bd4\u5982 <code>RoleBinding</code> \u76f4\u5230\u83b7\u5f97\u9884\u671f\u7684\u884c\u4e3a\u3002</li> <li>\u5c06 resources \u7528 YAML \u6253\u5370\u51fa\u6765\uff0c\u6e05\u7406\u6389\u6ca1\u5fc5\u8981\u7684\u90e8\u5206\u6bd4\u5982<code>status</code></li> <li>\u5c06 resources \u52a0\u5165 <code>oc adm create-bootstrap-project-template -o yaml &gt; project-template.yaml</code> \u6587\u4ef6</li> <li>\u518d\u751f\u6210 project template:  \u6ce8\u610f\u4f7f\u7528 project <code>openshift-config</code>: <pre><code>oc create -f project-template.yaml -n openshift-config\n</code></pre></li> </ol>"},{"location":"cloud/openshift/do280/06_developer_self_service/#usage","title":"Usage","text":"<p>Now we have created the project template, to use it, we update the <code>project</code> resource:</p> <p>\u4fee\u6539 \u540d\u4e3a <code>cluster</code> \u7684 <code>projects.config.openshift.io</code> \u8d44\u6e90\uff1a</p> <pre><code>oc edit projects.config.openshift.io cluster\n</code></pre> <pre>\n<code>\napiVersion: config.openshift.io/v1\nkind: Project\nmetadata:\n...output omitted...\n  name: cluster\n...output omitted...\n\nspec:\n  projectRequestTemplate:\n    name: project-request\n\n</code>\n</pre> <p>Reverse the usage</p> <p>\u5982\u679c\u8981\u4f7f\u7528\u539f\u672c\u7684template\uff0c \u628a\u4e0a\u9762 highlighted <code>.spec.projectRequestTemplate</code> \u4ee3\u7801\u53bb\u6389\u5c31\u884c.</p> <p>\u5982\u4f55\u67e5\u770b \u4fee\u6539 \u5df2\u6267\u884c\u5b8c\u6210\uff1f</p> <p>\u5728 project <code>openshift-apiserver</code> \u4e2d\u67e5\u770bpod\u7684\u91cd\u542f\uff0c\u4ee5\u786e\u4fdd\u4fee\u6539\u5df2\u7ecf\u751f\u6548\uff1a <pre><code>watch oc get pod -n openshift-apiserver\n</code></pre></p> <p><code>projects</code> \u548c <code>projects.config.openshift.io</code></p> <p>\u4e24\u8005\u4e00\u4e2a\u5217\u51fa\u6240\u6709\u9879\u76ee\uff0c\u4e00\u4e2a\u5217\u51fa\u9879\u76ee\u6a21\u7248\uff1a <pre><code># \u6709\u4e00\u5806\u5927\u5bb6\u5efa\u7684projects/ns\noc get projects\noc get projects.project.openshift.io\n\n# \u7ed3\u679c\u4e00\u822c\u53ea\u6709\u4e00\u4e2a\uff0c\u540d\u4e3a cluster\uff0c\u8fd9\u91cc\u53ef\u4ee5\u8bbe\u7f6ebootstrap project template\noc get projects.config.openshift.io\n</code></pre></p>"},{"location":"cloud/openshift/do280/06_developer_self_service/#self-provisioner","title":"\u62e6\u8def\u864e <code>self-provisioner</code>","text":"<p>Note</p> <ul> <li>User with the <code>self-provisioner</code> clusterrole can create projects</li> <li>By default, the self-provisioner role is bound to all authenticated users (as Default User Group <code>system:authenticated:oauth</code>)</li> </ul> <p>\u5728\u4f7f\u7528 Project Template \u7684\u8def\u4e0a\uff0c\u6709\u4e00\u4e2a\u62e6\u8def\u864e - role <code>self-provisioner</code>\u3002\u56e0\u4e3a\u6709\u6743\u521b\u5efa project \u7684\u7528\u6237\uff0c\u4e5f\u6709\u6743\u76f4\u63a5\u521b\u5efa namespace\uff0c\u8fd9\u6837\u6709\u53ef\u80fd\u5bfc\u81f4 namespace \u7f3a\u5c11 Project Template \u4e2d\u81ea\u5b9a\u4e49\u7684\u89c4\u5219\uff01</p> <p>\u67e5\u770b\u8be5role\u7684rolebinding\uff1a <pre><code>[user@host ~]$ oc describe clusterrolebinding.rbac self-provisioners\n\nName:         self-provisioners\nLabels:       &lt;none&gt;\nAnnotations:  rbac.authorization.kubernetes.io/autoupdate: true\nRole:\n  Kind:  ClusterRole\n  Name:  self-provisioner\nSubjects:\n  Kind   Name                        Namespace\n  ----   ----                        ---------\n  Group  system:authenticated:oauth\n</code></pre></p> <p>\u4e24\u4e2a\u4fee\u6539\u65b9\u6cd5:</p> <ol> <li>\u628a <code>system:authenticated:oauth</code> \u4ece\u8fd9\u4e2a clusterrolebinding \u4e2d\u79fb\u9664 (\u6bd4\u5982\u4f8b\u5b50):   <pre><code>oc adm policy remove-cluster-role-from-group &lt;ROLE&gt; &lt;GROUP&gt;\n</code></pre></li> <li>\u76f4\u63a5\u4fee\u6539 clusterrolebinding:   <pre><code>oc edit clusterrolebinding self-provisioners\n</code></pre></li> </ol> <p>Danger</p> <p>\u4e0a\u9762\u8fd9\u4e2aclusterrolebinding\u4e2d\u6709\u8fd9\u4e48\u4e00\u6761 Annotations\uff1a <pre><code>rbac.authorization.kubernetes.io/autoupdate: true\n</code></pre></p> <p>\u5b83\u786e\u4fdd <code>self-provisioners</code> \u8fd9\u6837\u7684 ClusterRoleBinding \u4f1a\u5728\u96c6\u7fa4\u66f4\u65b0\u65f6\u81ea\u52a8\u540c\u6b65\u5230\u6700\u65b0\u7684\u7cfb\u7edf\u7b56\u7565\uff0c\u4fdd\u6301\u96c6\u7fa4\u5b89\u5168\u548c\u7b56\u7565\u4e00\u81f4\u6027\u3002\u5982\u679c\u6211\u8981\u505c\u7528\u8be5\u529f\u80fd\uff1a <pre><code>oc annotate clusterrolebinding/self-provisioners \\\n  --overwrite rbac.authorization.kubernetes.io/autoupdate=false\n</code></pre> \u26a0\ufe0f \u5c0f\u5fc3\u4f7f\u7528\uff01\uff01\uff01</p>"},{"location":"cloud/openshift/do280/06_developer_self_service/#_3","title":"\u4fee\u6539","text":"<p>to disable self-provisioning, using bash: <pre><code>oc annotate clusterrolebinding/self-provisioners \\\n  --overwrite rbac.authorization.kubernetes.io/autoupdate=false\n\noc patch clusterrolebinding.rbac self-provisioners \\\n  -p '{\"subjects\": null}'\n</code></pre></p> <p>or edit YAML: <pre><code>oc edit clusterrolebinding/self-provisioners\n</code></pre></p> <p>\u8fd9\u91cc\u7ee7\u7eed\uff1ahttps://rol.redhat.com/rol/app/courses/do280-4.14/pages/ch06s06</p>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/","title":"7. Kubernetes Operator","text":"<p>The operator pattern  is a way to implement reusable software to manage complex workloads that might have maintenance tasks that can be automated, such as backing up data.</p> <p>An operator typically defines custom resources (CRs). The operator CRs describes the needed information to deploy and manage the workload such as <code>pod</code>, <code>persistentvolume</code>.</p>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#operator","title":"Operator \u7c7b\u578b","text":"<p>Info</p> <p>\u53ef\u4ee5\u5c06 Operator \u6bd4\u4f5c \u4e00\u4e2a\u667a\u80fd\u7684\u7ba1\u5bb6 \ud83d\udd74\ud83c\udffc\uff0c\u5b83\u5e2e\u52a9\u7ba1\u7406 OpenShift \u96c6\u7fa4\u4e2d\u7684\u5e94\u7528\u548c\u670d\u52a1\u3002</p> <ul> <li>\u5c31\u50cf\u4e00\u4e2a\u7ba1\u5bb6\u4f1a\u5b9a\u671f\u68c0\u67e5\u5bb6\u91cc\u7684\u60c5\u51b5\uff0c\u786e\u4fdd\u6bcf\u4e2a\u623f\u95f4\u90fd\u4fdd\u6301\u6574\u6d01\u3001\u8bbe\u5907\u6b63\u5e38\u5de5\u4f5c\uff0c\u5e76\u4e14\u6839\u636e\u9700\u8981\u8c03\u6574\u5bb6\u91cc\u7684\u5e03\u7f6e\uff0cOperator \u4e5f\u4f1a\u76d1\u63a7\u96c6\u7fa4\u4e2d\u7684\u8d44\u6e90\uff0c\u786e\u4fdd\u5b83\u4eec\u6309\u7167\u9884\u5b9a\u7684\u914d\u7f6e\u548c\u89c4\u5219\u8fd0\u884c\u3002</li> <li>\u5982\u679c\u5bb6\u91cc\u7684\u8bbe\u5907\u51fa\u73b0\u6545\u969c\uff0c\u7ba1\u5bb6\u4f1a\u7acb\u523b\u4fee\u7406\u6216\u8005\u66ff\u6362\u3002\u800c Operator \u4e5f\u4f1a\u5728\u96c6\u7fa4\u4e2d\u7684\u5e94\u7528\u6216\u670d\u52a1\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u81ea\u52a8\u4fee\u590d\u6216\u91cd\u65b0\u542f\u52a8\u5b83\u4eec\u3002</li> <li>\u7ba1\u5bb6\u8fd8\u4f1a\u6839\u636e\u9700\u8981\u8c03\u6574\u5bb6\u91cc\u7684\u5e03\u7f6e\u548c\u89c4\u5219\uff0cOperator \u4e5f\u4f1a\u6839\u636e\u96c6\u7fa4\u7684\u9700\u6c42\u81ea\u52a8\u8fdb\u884c\u66f4\u65b0\u3001\u914d\u7f6e\u53d8\u66f4\u6216\u6269\u5c55\u3002</li> </ul>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#1-cluster-operators","title":"1. Cluster Operators","text":"<p>Cluster Operators \u7531 Cluster Version Operator (CVO) \u7ba1\u7406. Cluster Operators \u7ba1\u7406\u6574\u4e2a Kubernetes \u96c6\u7fa4\u7ea7\u522b\u7684\u8d44\u6e90\u548c\u529f\u80fd\u3002\u5b83\u4eec\u901a\u5e38\u8d1f\u8d23\u5173\u952e\u7684\u57fa\u7840\u8bbe\u65bd\u7ec4\u4ef6\uff0c\u5982\u7f51\u7edc\u3001\u5b58\u50a8\u3001\u76d1\u63a7\u548c\u65e5\u5fd7\u8bb0\u5f55\u7b49\u3002\u6bd4\u5982web console\uff0c the OAuth server.</p> <p>Cluster Operator\u53ef\u4ee5\u518dWebconsole\u4e2d\u627e\u5230\uff1a Administration &gt; Cluster Settings &gt; ClusterOperators. --&gt; \u6b64\u6587\u6863 \u5217\u51fa\u4e86\u6240\u6709built-in ClusterOperators (\u7ea635\u4e2a)\u3002</p> <p>CVO</p> <p>The Cluster Version Operator (CVO) installs and updates Cluster Operators - as part of the OpenShift installation and update processes.</p> <p>CVO \u53ef\u4ee5\u7528\u6765\u67e5\u770bcluster operators\u7684\u72b6\u6001\uff1a <pre><code>oc get clusteroperator\n</code></pre></p> <p>Warning</p> Operator \u7c7b\u578b \u7ba1\u7406\u8005 Cluster Operators Cluster Version Operator (CVO) Add-on Operators Operator Lifecycle Manager (OLM)"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#2-add-on-operators","title":"2. Add-on Operators","text":"<p>Add-on Operators \u7531\u6838\u5fc3\u7ec4\u4ef6 Operator Lifecycle Manager (OLM) \u7ba1\u7406\u3002 </p> <p>Openshift\u7684 webconsole \u4e2d\u53ef\u4ee5\u770b\u5230\u56db\u79cd\u7ea7\u522b\u7684 Add-on\uff1a</p> <ul> <li><code>Red Hat</code>: \u7531 Red Hat \u5b98\u65b9\u63d0\u4f9b\u548c\u652f\u6301\uff0c\u8fbe\u5230\u4f01\u4e1a\u7ea7\u7684\u7a33\u5b9a\u6027\u548c\u5b89\u5168\u6807\u51c6</li> <li><code>Certified</code>: \u7531\u7b2c\u4e09\u65b9\u5f00\u53d1\uff0c\u5e76\u901a\u8fc7 Red Hat \u8ba4\u8bc1\uff0c\u786e\u4fdd\u4e86\u4e0e OpenShift \u7684\u517c\u5bb9\u6027\u548c\u8d28\u91cf\u6807\u51c6\u3002\u7531\u7b2c\u4e09\u65b9\u63d0\u4f9b\u6280\u672f\u652f\u6301</li> <li><code>Community</code>: \u7531\u5f00\u6e90\u793e\u533a\u6216\u5f00\u53d1\u8005\u63d0\u4f9b\u548c\u7ef4\u62a4\uff0c\u6ca1\u6709\u6b63\u5f0f\u7684\u5546\u4e1a\u652f\u6301</li> <li><code>Marketplace</code>: \u5728 OpenShift Marketplace \u6216 Kubernetes Marketplace \u4e2d\u63d0\u4f9b\u7684 Operators\u3002</li> </ul> <p></p> <p>\u5176\u4ed6\u5f00\u6e90\u7684 Add-on</p> <p>\u8fd9\u91ccoperatorhub.io\u53ef\u4ee5\u627e\u5230\u53ef\u7528\u7684 Add-on Operators\uff0c\u5176\u4e2d\u5305\u542b\u5404\u79cd \u7ea7\u522b \u7684Operator</p> <p>Note</p> <p>Add-on Operators have a different lifecycle from Cluster Operators. The CVO installs and updates Cluster Operators in lockstep with the cluster. Administrators use the OLM to install, update, and remove operators independently from cluster updates.</p> <p>-&gt; Cluster \u7684\u5b89\u88c5\u4e0e\u66f4\u65b0 \u4e0e (CVO \u5bf9) Cluster Operators \u7684\u5b89\u88c5\u4e0e\u66f4\u65b0 \u540c\u6b65</p> <p>OLM managed Resources</p> <ul> <li>Catalog source: Each catalog source resource references an operator repository.</li> <li>Package manifest: The OLM creates a package manifest for each available operator. </li> <li>Operator group: Operator groups define how the OLM presents operators across namespaces.</li> <li>Subscription: Cluster administrators create subscriptions to install operators.</li> <li>Operator: The OLM creates operator to store information about installed operators.</li> <li>Install plan: The OLM creates install plan as part of the installation and update process. When requiring approvals, administrators must approve install plans.</li> <li>Cluster service version (CSV): Each version of an operator has a corresponding CSV. The CSV contains the information that the OLM requires to install the operator.</li> </ul>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#install-operator-in-cli","title":"Install Operator in CLI","text":"<p>Steps to install an Operator</p> <ol> <li>Locate the operator to install.</li> <li>Review the operator and its documentation for installation options and requirements.<ul> <li>Decide the update channel to use.</li> <li>Decide the installation mode. For most operators, you should make them available to all namespaces.</li> <li>Decide to deploy the operator workload to an existing namespace or to a new namespace.</li> <li>Decide whether the Operator Lifecycle Manager (OLM) applies updates automatically, or requires an administrator to approve updates.</li> </ul> </li> <li>Create an operator group if needed for the installation mode.</li> <li>Create a namespace for the operator workload if needed.</li> <li>Create the operator subscription.</li> <li>Review and test the operator installation.</li> </ol>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#1-examine-the-operator","title":"1. Examine the operator","text":"<pre><code># Examine catalog sources \noc get catalogsource -n openshift-marketplace\n\n# List the package manifests to know which operators are available for installation. \n# a.k.a List Operators in current Catalog\noc get packagemanifests\n\n# check detail of the operator 'lvms-operator'\noc describe packagemanifest lvms-operator -n openshift-marketplace\n</code></pre> <p>example</p> <p> </p> <p>describe Operator details</p> <p> </p> <ul> <li>(1), (2): The catalog source and namespace for the operator,</li> <li>(3), (7): available channels and CSVs to decide which upgrade path to use.</li> <li>(4), (6): description and links for installation</li> <li>(5) install modes</li> </ul>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#2-optional-create-operator-group","title":"2. [OPTIONAL] Create Operator Group","text":"<ul> <li>Many operators recommend to use the existing <code>openshift-operators</code> namespace, or require specific namespaces.</li> <li>The <code>openshift-operators</code> namespace contains a <code>global-operators</code> operator group. Operators installed in this namespace, uses this group</li> </ul> <p>Optionally, you can also - Create an operator group: <pre><code>apiVersion: operators.coreos.com/v1\nkind: OperatorGroup\nmetadata:\n  name: name\n  namespace: namespace  # where OperatorGroup itself is located. Operator will be here too\nspec:\n  targetNamespaces:     # where the operator should be available or operate\n  - namespace\n</code></pre></p>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#3-create-a-subscription","title":"3. Create a subscription","text":"<pre><code>apiVersion: operators.coreos.com/v1alpha1\nkind: Subscription\nmetadata:\n  name: lvms-operator\n  namespace: openshift-storage\nspec:\n  channel: stable-4.14 \n  name: lvms-operator \n  source: do280-catalog-cs \n  installPlanApproval: Automatic  # \u203c\ufe0f or Manual\n  sourceNamespace: openshift-marketplace\n</code></pre>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#4-approve-install-plan","title":"4. Approve Install Plan","text":"<pre><code># check status\noc describe operator file-integrity-operator\n\n# If the install plan mode is set to 'Manual' in the Subscription, \n# then you must manually approve the install plan:\noc patch installplan install-pmh78 --type merge -p \\\n    '{\"spec\":{\"approved\":true}}' -n openshift-file-integrity\n</code></pre> <p>oc patch</p> <p><code>--type</code> has 4 possible values:</p> <ul> <li><code>merge</code>: DEFAULT, only change the given value</li> <li><code>strategic-merge</code>: similar to <code>merge</code>, but specifically designed for Kubernetes resources.</li> <li><code>replace</code>: replace the entire resource</li> <li><code>json</code>: allows you to apply changes based on the JSON Patch standard</li> </ul> <p>\u26a0\ufe0f With an 'Automatic' install plan mode, the OLM applies updates as soon as they are available.</p> <p>Troubleshooting</p> <p>Some operators require additional steps to install or update. Review the documentation to validate whether you performed all necessary steps, and to learn about support options.</p>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#3-other-operators","title":"3. Other Operators","text":"<p>Software providers can create software that follows the operator pattern, and then distribute the software as manifests, Helm charts, or any other software distribution mechanism.</p>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#view-installed-operators","title":"View installed Operators","text":"<p>The Installed Operators page lists the installed cluster service version (CSV) as this:</p> <p></p> <p>or</p> <pre><code>oc get csv\n</code></pre>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#using-installed-operators","title":"Using installed Operators","text":"<p>Custom resources are the most common way to interact with operators. You can create custom resources:</p> <p></p> <p>You can create by view:</p> <p></p> <p>or by yaml:</p> <p></p>"},{"location":"cloud/openshift/do280/07_kubernetes_operator/#debugging","title":"Debugging","text":"<p>for troubleshooting you can check here:</p> <p></p> <p>Check the following:</p> <ul> <li>The status of Kubernetes workload resources, such as deployments or stateful sets </li> <li>Pod logs &amp; status</li> <li>Events</li> </ul>"},{"location":"cloud/openshift/do280/08_application_security/","title":"8. Application Security","text":""},{"location":"cloud/openshift/do280/08_application_security/#1-security-context-constraints-scc","title":"1. Security Context Constraints (SCC)","text":"<p>\u7b80\u5355\u6765\u8bf4\uff0cSCC \u662f OpenShift \u7528\u6765\u9650\u5236\u5bb9\u5668\u884c\u4e3a\u7684\u4e00\u79cd\u673a\u5236\uff0c\u786e\u4fdd\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u5bb9\u5668\u7b26\u5408\u5b89\u5168\u6807\u51c6\u3002SCC \u5b9a\u4e49\u4e86 Pod \u7684\u4ee5\u4e0b\u5b89\u5168\u884c\u4e3a\uff1a</p> <ul> <li>\u662f\u5426\u5141\u8bb8\u7279\u6743\u5bb9\u5668\uff1a\u662f\u5426\u5141\u8bb8\u5bb9\u5668\u4ee5 root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\uff0c\u6216\u4ee5\u66f4\u9ad8\u7684\u6743\u9650\u8bbf\u95ee\u4e3b\u673a\u3002</li> <li>\u5bb9\u5668\u80fd\u5426\u8fd0\u884c\u5728\u4e3b\u673a\u7f51\u7edc\u4e0a\uff1a\u662f\u5426\u5141\u8bb8\u5bb9\u5668\u4f7f\u7528\u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u3002</li> <li>\u7528\u6237\u548c\u7ec4\u7684\u9650\u5236\uff1a\u5bb9\u5668\u662f\u5426\u80fd\u4f7f\u7528\u7279\u5b9a\u7684\u7528\u6237\u3001\u7ec4\u6216 UID\u3002</li> <li>\u662f\u5426\u5141\u8bb8\u8bbf\u95ee\u7279\u5b9a\u8d44\u6e90\uff1a\u5982\u662f\u5426\u5141\u8bb8\u8bbf\u95ee\u4e3b\u673a\u8def\u5f84\u3001\u5141\u8bb8\u5377\u6302\u8f7d\u7b49\u3002</li> </ul> <p>Cluster administrators can list the SCCs that OpenShift defines:</p> <pre><code>oc get scc\n</code></pre> <p>OpenShift provides the some default SCCs such as <code>anyuid</code> and <code>restricted-v2</code>. To get detail of one scc:</p> <pre><code>oc describe scc anyuid\n</code></pre> <p>Most pods that OpenShift creates use the <code>restricted-v2</code> SCC, which provides limited access to resources that are external to OpenShift.To view the scc that a pod uses:</p> <pre><code>oc describe pod console-5df4fcbb47-67c52 -n openshift-console | grep scc\n</code></pre> <p>Warning</p> <p>SCC \u901a\u8fc7 ServiceAccount \u4f5c\u7528\u4e8e Pod\uff0c\u800cRole/ClusterRole \u4f5c\u7528\u4e8e User \u548c API \u8d44\u6e90\u3002</p> <p>Use cases: when to switch SCC</p> <ul> <li>A container image(from DockerHub) that requires running as a specific user ID can fail because the <code>restricted-v2</code> SCC runs the container by using a random user ID.</li> <li>A container image that listens on port 80 or on port 443 can fail for a related reason. The random user ID that the <code>restricted-v2</code> SCC uses cannot start a service that listens on a privileged network port (port numbers that are less than 1024)</li> </ul> <p>\u26a0\ufe0f \u8fd9\u6761\u547d\u4ee4\u5217\u51fa\u4e86\u5728\u5f53\u524d\u914d\u7f6e\u4e0b\uff0c\u7cfb\u7edf\u5141\u8bb8\u8be5\u8d44\u6e90\uff08deployment/nginx\uff09\u4f7f\u7528\u7684 SCC \u5217\u8868 - \u5e76\u4e0d\u4ee3\u8868\u8be5 deployment \u5df2\u7ecf\u5728\u7528\u8fd9\u4e2a SCC \u4e86\uff01  <pre><code>oc get deployment nginx -o yaml | oc adm policy scc-subject-review  -f -\n</code></pre> Result: <pre><code>RESOURCE           ALLOWED BY\nDeployment/nginx   anyuid\n</code></pre></p> <ul> <li>Deployment/nginx\uff1a\u6211\u4eec\u68c0\u67e5\u7684\u662f\u8fd9\u4e2a Deployment\u3002</li> <li>anyuid\uff1a\u8fd9\u4e2a Deployment \u6240\u4f7f\u7528\u7684\u670d\u52a1\u8d26\u53f7\uff08ServiceAccount\uff09\u88ab\u5141\u8bb8\u4f7f\u7528 anyuid SCC</li> </ul> <p><code>oc policy scc-subject-review</code></p> <pre><code>  # Check whether user bob can create a pod specified in myresource.yaml\n  oc policy scc-subject-review -u bob -f myresource.yaml\n\n  # Check whether user bob who belongs to projectAdmin group can create a pod specified in myresource.yaml\n  oc policy scc-subject-review -u bob -g projectAdmin -f myresource.yaml\n\n  # Check whether a ServiceAccount specified in the pod.template.spec in myresourcewithsa.yaml can create the pod\n  oc policy scc-subject-review -f myresourcewithsa.yaml\n</code></pre>"},{"location":"cloud/openshift/do280/08_application_security/#switch-scc","title":"Switch SCC","text":"<ol> <li> <p>create <code>serviceaccount</code> <pre><code>oc create serviceaccount my-sa\n</code></pre></p> </li> <li> <p>associate <code>serviceaccount</code> with an SCC     <pre><code>#  Identify a serviceaccount by using the -z option\noc adm policy add-scc-to-user &lt;SCC-NAME&gt; -z my-sa\n</code></pre>     PS: if assign SCC to a User, just do directly without <code>-z</code> flag: <code>oc adm policy add-scc-to-user restricted user1 user2</code></p> </li> <li> <p>Change an existing deployment to use the <code>serviceaccount</code> <pre><code>oc set serviceaccount deployment/deployment-name my-sa\n</code></pre></p> </li> </ol>"},{"location":"cloud/openshift/do280/08_application_security/#scc","title":"\u5e38\u89c1\u7684 SCC","text":"SCC\u540d\u79f0 \u63cf\u8ff0 \u6743\u9650 <code>restricted</code> \u9650\u5236\u6027\u914d\u7f6e\uff0c\u9002\u7528\u4e8e\u5927\u591a\u6570\u7528\u6237\uff0c\u786e\u4fdd\u6700\u4f4e\u6743\u9650 \u4e0d\u5141\u8bb8\u4f7f\u7528\u7279\u6743\u5bb9\u5668\u3001\u7279\u6743\u64cd\u4f5c\u3001\u8fd0\u884c\u7528\u6237\u4e3a root\uff0c\u9ed8\u8ba4\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u7528\u6237\u662f\u4e00\u4e2a\u975e root \u7528\u6237\u3002 <code>privileged</code> \u5141\u8bb8\u5bb9\u5668\u4ee5 root \u6743\u9650\u8fd0\u884c\uff0c\u9002\u7528\u4e8e\u9700\u8981\u7279\u6743\u7684\u5bb9\u5668 \u5bb9\u5668\u5177\u6709\u5b8c\u5168\u7684\u6743\u9650\uff0c\u53ef\u4ee5\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7684\u5185\u6838\u7a7a\u95f4\u548c\u786c\u4ef6\u3002\u9002\u7528\u4e8e\u9700\u8981 root \u6743\u9650\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5982 Docker \u5b88\u62a4\u8fdb\u7a0b\u3002 <code>anyuid</code> \u5bb9\u8bb8\u5bb9\u5668\u4f7f\u7528\u4efb\u4f55 UID\uff0c\u9002\u7528\u4e8e\u9700\u8981\u7279\u5b9a UID \u7684\u5e94\u7528\u7a0b\u5e8f \u5bb9\u5668\u53ef\u4ee5\u8fd0\u884c\u4f5c\u4e3a\u4efb\u4f55\u7528\u6237\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u9ed8\u8ba4\u7684\u975e root \u7528\u6237\u3002\u5141\u8bb8\u5bb9\u5668\u4ee5 root \u6216\u5176\u4ed6\u7528\u6237\u8eab\u4efd\u8fd0\u884c\u3002 <code>nonroot</code> \u5bb9\u8bb8\u5bb9\u5668\u4f5c\u4e3a\u975e root \u7528\u6237\u8fd0\u884c\uff0c\u907f\u514d\u4f7f\u7528 root \u7528\u6237 \u5bb9\u5668\u5fc5\u987b\u4ee5\u975e root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\uff0c\u907f\u514d root \u6743\u9650\u7684\u4f7f\u7528\u3002 <code>hostaccess</code> \u5141\u8bb8\u5bb9\u5668\u8bbf\u95ee\u4e3b\u673a\u8d44\u6e90\uff0c\u5982\u7f51\u7edc\u6216\u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\uff0c\u9002\u7528\u4e8e\u4e3b\u673a\u7ba1\u7406\u5bb9\u5668 \u5bb9\u5668\u80fd\u591f\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7684\u4e3b\u673a\u7f51\u7edc\u548c\u6587\u4ef6\u7cfb\u7edf\u8d44\u6e90\uff0c\u9002\u7528\u4e8e\u9700\u8981\u76f4\u63a5\u4e0e\u5bbf\u4e3b\u673a\u4ea4\u4e92\u7684\u5e94\u7528\u7a0b\u5e8f\u3002 <code>docker</code> \u4e3a Docker \u5b88\u62a4\u8fdb\u7a0b\u914d\u7f6e\u7684\u7279\u6b8a SCC \u5141\u8bb8\u5bb9\u5668\u4f7f\u7528 Docker \u5b88\u62a4\u8fdb\u7a0b\u7684\u7279\u6743\u8fdb\u884c\u5bb9\u5668\u64cd\u4f5c\u3002"},{"location":"cloud/openshift/do280/08_application_security/#2-access-to-kubernetes-apis","title":"2. Access to Kubernetes APIs","text":"<p>With the Kubernetes APIs, a user or an application can query and modify the cluster state. To protect your cluster from malicious interactions, you must grant access to the different Kubernetes APIs. Role-based access control (RBAC) authorization is preconfigured in OpenShift. An application requires explicit RBAC authorization to access restricted Kubernetes APIs.</p> <p>serviceaccount</p> <p>A <code>serviceaccount</code> is a Kubernetes object within a project. The service account represents the identity of an application that runs in a pod. To grant an application access to a Kubernetes API, take these actions:</p> <ol> <li>Create an application service account.</li> <li>Grant the service account access to the Kubernetes API.</li> <li>Assign the service account to the application pods.</li> </ol> <p>\u26a0\ufe0f If the pod definition does not specify a service account, then the pod uses the <code>default</code> service account. </p>"},{"location":"cloud/openshift/do280/08_application_security/#who-needs-extra-access-to-k8s-api","title":"Who needs extra access to k8s API?","text":"<p>For regular workloads, <code>default</code> service account is enough, but in some \"infrastructure cases\" we might need extra access to monitor/modify cluster resources:</p> <ul> <li>Monitoring Applications: need read access to watch cluster resources - such as Red Hat Advanced Cluster Security (ACS)</li> <li>Controllers: Controllers are applications that constantly watch and try to reach the intended state of a resource  - such as ArgoCD</li> <li>Operators: Operators automate creating, configuring, and managing instances of Kubernetes-native applications. Therefore, operators need permissions for configuration and maintenance tasks - such as a database operator </li> </ul>"},{"location":"cloud/openshift/do280/08_application_security/#how-to-get-the-correct-access-to-k8s-api","title":"How to get the correct access to k8s API?","text":"<ol> <li>create role/clusterrole:     \u5199yaml\u6587\u4ef6     <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: secret-reader             # role name\nrules:\n- apiGroups: [\"\"]                 # The API groups, where an empty string represents the core API\n  resources: [\"secrets\"]          # The resources that the role refers to\n  verbs: [\"get\", \"watch\", \"list\"] # The verbs/actions that the role allows the application to do\n</code></pre>     \u6216\u8005\u7528\u547d\u4ee4\u884c\uff1a     <pre><code>oc create clusterrole secret-reader --verb=get,watch,list --resource=secret\n</code></pre></li> <li>bind role to serviceaccount     <pre><code># role\noc adm policy add-role-to-user &lt;RoleName&gt; -z service-account\n\n# clusterrole\noc adm policy add-cluster-role-to-user &lt;ClusterRoleName&gt; -z service-account\n</code></pre></li> <li>assign <code>serviceaccount</code> to <code>pod</code></li> </ol> <p>Accessing API Resources in a Different Namespace</p> <p>Request: Pod in <code>project-1</code> wants to read Secret in <code>project-2</code></p> <p>Background: you have an application pod in the <code>project-1</code> project that requires access to <code>project-2</code> secrets, then you must take these actions:</p> <ol> <li>Create an <code>app-sa</code> service account in the <code>project-1</code> project.</li> <li>Assign the <code>app-sa</code> service account to your application pod.</li> <li>Create a role binding on the <code>project-2</code> project that references the <code>app-sa</code> service account and the secret-reader role or cluster role.      <pre><code># \u5982\u4f55\u5f15\u7528\u53e6\u4e00\u4e2a project \u4e2d\u7684 sa:\nsystem:serviceaccount:&lt;namespace&gt;:&lt;serviceaccount-name&gt;\n</code></pre>     create role-binding:     <pre><code>oc project project-2\noc adm policy add-role-to-user edit system:serviceaccount:project-1:my-sa\n</code></pre></li> </ol> <p></p>"},{"location":"cloud/openshift/do280/08_application_security/#3-job-cronjob","title":"3. Job &amp; CronJob","text":"<p>Basic knowledge about <code>job</code> and <code>cronjob</code> check here. One of the use case of <code>cronjob</code> is to schedule maintenance tasks in the cluster.</p> <p>Note</p> <p>Cluster maintenance tasks require privileged pods, whereas most applications might not require elevated privileges.</p> <p>Job with dry run:</p> <pre><code>oc create job --dry-run=client -o yaml test \\\n    --image=registry.access.redhat.com/ubi8/ubi:8.6 \\\n    -- curl https://example.com\n</code></pre> <p>CronJob with dry run:</p> <pre><code>oc create cronjob --dry-run=client -o yaml test \\\n  --image=registry.access.redhat.com/ubi8/ubi:8.6 \\\n  --schedule='0 0 * * *' \\\n  -- curl https://example.com\n</code></pre> <p>Schedule specificiation in CronJob</p> <p>The schedule specification for Kubernetes cron jobs is derived from the specification in Linux cron job</p> <pre><code># Example cron job definition:\n# \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute (0 - 59)\n# \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour (0 - 23)\n# \u2502  \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month (1 - 31)\n# \u2502  \u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500 month (1 - 12) or jan,feb,mar,apr ...\n# \u2502  \u2502   \u2502   \u2502   \u250c\u2500\u2500 day of week (0 - 6) or sun,mon,tue,wed,thu,fri,sat\n# \u2502  \u2502   \u2502   \u2502   \u2502    \n# m  h  dom mon dow  command\n  0 */2  *   *   *   /path/to/task_executable arguments\n</code></pre> <p>\u26a0\ufe0f \"dow\"\u4e2d\uff0cSunday \u662f 0</p> <p>Examples:</p> <ul> <li><code>0 0 * * *</code>:  Run the specified task every day at midnight</li> <li><code>0 0 * * 7</code>:  Run the specified task every Sunday at midnight</li> <li><code>0 */4 * * *</code>:    Run the specified task every four hours</li> <li><code>0 * * * *</code>:  Run the specified task every hour<ul> <li><code>0</code> means the job will run at the 0th minute (the start of the hour)</li> <li><code>*</code> runs every hour</li> <li><code>*</code> runs every day of month (dom) </li> <li><code>*</code> runs every month (mon) </li> <li><code>*</code> runs every day of week (dow) </li> </ul> </li> </ul>"},{"location":"cloud/openshift/do280/08_application_security/#cronjob-with-raw-script","title":"Cronjob with raw script","text":"<p>example: <pre><code>apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: wordpress-backup\nspec:\n  schedule: 0 2 * * 7  \n  jobTemplate:  \n    spec:\n      template: \n        spec:  \n          dnsPolicy: ClusterFirst\n          restartPolicy: Never\n          containers: \n          - name: wp-cli\n            image: registry.io/wp-maintenance/wp-cli:2.7 \n            resources: {}\n            command:  \n            - bash\n            - -xc\n            args:  \n            - &gt;\n              wp maintenance-mode activate ;\n              wp db export | gzip &gt; database.sql.gz ;\n              wp maintenance-mode deactivate ;\n              rclone copy database.sql.gz s3://bucket/backups/ ;\n              rm -v database.sql.gz ;\n</code></pre></p> <p>Note</p> <p>The <code>&gt;</code> symbol uses the YAML folded style, which converts all newlines to spaces when parsing. Each command is separated with a semicolon (<code>;</code>), because the string in the <code>args</code> key is passed as a single argument to the <code>bash -xc</code> command.</p> <p>the yaml code above is equivalent to:</p> <pre><code>bash -xc 'wp maintenance-mode activate ; wp db export | gzip &gt; database.sql.gz ; wp maintenance-mode deactivate ; rclone copy database.sql.gz s3://bucket/backups/ ; rm -v database.sql.gz ;'\n</code></pre> <p><code>/bin/sh -c</code> VS <code>bash -xc</code></p> Feature <code>/bin/sh -c</code> <code>bash -xc</code> Flags <code>-c</code> execute <code>-cx</code> execute with debug Type Lightweight shell (POSIX-compliant) Advanced shell with extra features Location Usually /bin/sh (may point to different shells) Usually /bin/bash Scripting Supports basic scripting Supports advanced scripting (arrays, associative arrays, string manipulation, etc.) Command History (history) Not always available Fully supported Tab Completion Minimal or none Fully supported Loops &amp; Conditionals POSIX standard Extended syntax ([[ ... ]], == operator) Process Substitution (&lt;(cmd)) Not supported Supported Array Variables (arr=(a b c)) Not supported Supported"},{"location":"cloud/openshift/do280/08_application_security/#cronjob-with-configmaps-script","title":"Cronjob with ConfigMap's script","text":"<ol> <li>create <code>configmap</code> with the required script:</li> </ol> <p><pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: maintenance\n  app: crictl\ndata:\n  maintenance.sh: |\n    #!/bin/bash\n    NODES=$(oc get nodes -o=name) \n    for NODE in ${NODES} \n    do\n      echo ${NODE}\n      oc debug ${NODE} -- \\ \n        chroot /host \\\n          /bin/bash -xc 'crictl images ; crictl rmi --prune' \n      echo $?\n    done\n</code></pre> 2. mount the <code>configmap</code> to a <code>cronjob</code></p> <pre><code>apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: image-pruner\nspec:\n  schedule: 0 * * * *\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          dnsPolicy: ClusterFirst\n          restartPolicy: Never\n          containers:\n          - name: image-pruner\n            image: quay.io/openshift/origin-cli:4.14\n            resources: {}\n            command:\n            - /opt/maintenance.sh\n            # Mounting the configuration map as a volume\n            volumeMounts:\n            - name: scripts\n              mountPath: /opt\n          volumes:\n          - name: scripts\n            configMap:\n              name: maintenance\n              defaultMode: 0555\n</code></pre>"},{"location":"cloud/openshift/do280/08_application_security/#exercies-notes","title":"Exercies notes","text":"<pre><code>oc debug node/master01 -- \\   # Starts a debug pod on the node master01.\n    chroot /host \\            # Changes Root-Filesystem to /host, which gives access to the node\u2019s actual file system.\n    crictl rmi --prune        # Uses crictl (CRI-O CLI) to remove all unused images from the node.\n</code></pre> <p>crictl</p> <p>Directly interacts with the container runtime (<code>CRI-O</code>), allowing you to manage containers and images at the node level.</p>"},{"location":"cloud/openshift/do280/08_application_security/#-","title":"-----","text":""},{"location":"cloud/openshift/do280/08_application_security/#role-scc","title":"\u4e3a\u4ec0\u4e48\u5373\u4f7f\u5df2\u6709 <code>Role</code> \u4ecd\u7136\u9700\u8981\u4f7f\u7528 <code>SCC</code>","text":"<p><code>Role</code> \u548c <code>SCC (Security Context Constraints)</code> \u662f\u4e24\u79cd\u4e0d\u540c\u7684\u5b89\u5168\u673a\u5236\uff0c\u5b83\u4eec\u5404\u81ea\u63a7\u5236 OpenShift \u4e2d\u7684\u4e0d\u540c\u65b9\u9762\uff0c\u56e0\u6b64\u5b83\u4eec\u662f\u4e92\u8865\u7684\uff0c\u800c\u4e0d\u662f\u4e92\u76f8\u66ff\u4ee3\u7684\u3002\u4e0b\u9762\u8be6\u7ec6\u89e3\u91ca\u4e3a\u4ec0\u4e48\u5373\u4f7f\u5df2\u7ecf\u6709\u4e86 <code>Role</code>\uff0c\u4ecd\u7136\u9700\u8981\u4f7f\u7528 <code>SCC</code>\u3002</p>"},{"location":"cloud/openshift/do280/08_application_security/#1-role-scc","title":"1. <code>Role</code> \u63a7\u5236\u7684\u662f\u6743\u9650\uff0c<code>SCC</code> \u63a7\u5236\u7684\u662f\u5bb9\u5668\u7684\u5b89\u5168\u4e0a\u4e0b\u6587","text":"<ul> <li><code>Role</code> \u7528\u6765\u5b9a\u4e49\u7528\u6237\u6216 ServiceAccount \u5bf9\u96c6\u7fa4\u8d44\u6e90\uff08\u5982 Pods\u3001Services\u3001Deployments \u7b49\uff09\u8fdb\u884c \u8bbf\u95ee\u63a7\u5236 \u7684\u6743\u9650\u3002\u4f8b\u5982\uff1a</li> <li>\u5141\u8bb8\u7528\u6237\u521b\u5efa\u6216\u4fee\u6539\u8d44\u6e90\u3002</li> <li>\u5141\u8bb8\u7528\u6237\u67e5\u770b\u8d44\u6e90\u3002</li> <li> <p>\u63a7\u5236\u7528\u6237\u662f\u5426\u53ef\u4ee5\u6267\u884c\u7279\u5b9a\u64cd\u4f5c\uff08\u5982\u521b\u5efa\u6216\u5220\u9664 Pods\uff09\u3002</p> </li> <li> <p><code>SCC</code> \u7528\u6765\u5b9a\u4e49\u5bb9\u5668\u5728\u6267\u884c\u65f6 \u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9b\u7279\u6743\uff0c\u5373\u5bb9\u5668\u7684 \u5b89\u5168\u4e0a\u4e0b\u6587\u3002\u5b83\u63a7\u5236\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> </li> <li>\u662f\u5426\u5141\u8bb8\u5bb9\u5668\u4ee5 root \u7528\u6237 \u6743\u9650\u8fd0\u884c\u3002</li> <li>\u662f\u5426\u5141\u8bb8\u5bb9\u5668\u4f7f\u7528 \u7279\u6743\u6a21\u5f0f\uff08privileged mode\uff09\u3002</li> <li>\u662f\u5426\u5141\u8bb8\u5bb9\u5668\u8bbf\u95ee \u5bbf\u4e3b\u673a\u7f51\u7edc \u6216 \u6302\u8f7d\u5bbf\u4e3b\u673a\u6587\u4ef6\u7cfb\u7edf \u7b49\u8d44\u6e90\u3002</li> <li>\u63a7\u5236\u5bb9\u5668\u662f\u5426\u4f7f\u7528\u7279\u5b9a\u7684 SELinux \u4e0a\u4e0b\u6587 \u6216 \u7528\u6237/\u7ec4 ID\u3002</li> </ul>"},{"location":"cloud/openshift/do280/08_application_security/#2-role-scc","title":"2. <code>Role</code> \u63a7\u5236\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\uff0c<code>SCC</code> \u63a7\u5236\u5bb9\u5668\u7684\u884c\u4e3a","text":"<ul> <li> <p><code>Role</code> \u66f4\u591a\u7684\u662f\u63a7\u5236\u8c01\u53ef\u4ee5 \u8bbf\u95ee\u8d44\u6e90\uff08\u6bd4\u5982\u8bfb\u53d6\u3001\u5199\u5165\u3001\u4fee\u6539\u3001\u5220\u9664\u8d44\u6e90\uff09\u3002\u4f8b\u5982\uff0c\u7ed9\u7528\u6237 <code>view</code> \u6743\u9650\u8868\u793a\u4ed6\u53ef\u4ee5\u67e5\u770b\u8d44\u6e90\uff0c\u4f46\u4e0d\u5141\u8bb8\u4fee\u6539\u3002</p> </li> <li> <p><code>SCC</code> \u5219\u63a7\u5236\u5bb9\u5668\u5728 \u6267\u884c\u65f6 \u662f\u5426\u7b26\u5408\u67d0\u4e9b\u5b89\u5168\u8981\u6c42\u3002\u4f8b\u5982\uff0c\u5bb9\u5668\u80fd\u5426\u5728\u7279\u6743\u6a21\u5f0f\u4e0b\u8fd0\u884c\uff0c\u80fd\u5426\u4ee5 <code>root</code> \u7528\u6237\u6743\u9650\u542f\u52a8\uff0c\u80fd\u5426\u6302\u8f7d\u5bbf\u4e3b\u673a\u7684\u76ee\u5f55\u7b49\u3002\u8fd9\u4e2a\u4e3b\u8981\u5173\u6ce8\u5bb9\u5668\u7684 \u884c\u4e3a\u5b89\u5168\u6027\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u8d44\u6e90\u8bbf\u95ee\u6743\u9650\u3002</p> </li> </ul>"},{"location":"cloud/openshift/do280/08_application_security/#3-role-scc","title":"3. \u4e3a\u4ec0\u4e48 <code>Role</code> \u548c <code>SCC</code> \u662f\u4e92\u8865\u7684","text":"<ul> <li><code>Role</code> \u5b9a\u4e49\u4e86\u4f60\u662f\u5426\u53ef\u4ee5\u6267\u884c\u67d0\u4e9b\u8d44\u6e90\u7684\u64cd\u4f5c\uff0c\u800c <code>SCC</code> \u5219\u662f\u5b9a\u4e49\u4e86\u4f60\u5728\u6267\u884c\u5bb9\u5668\u65f6\uff0c\u662f\u5426\u6709\u8db3\u591f\u7684\u6743\u9650\u53bb\u4f7f\u7528\u67d0\u4e9b\u654f\u611f\u7684\u7279\u6027\uff08\u5982\u7279\u6743\u5bb9\u5668\u3001root \u7528\u6237\u3001\u5bbf\u4e3b\u673a\u7f51\u7edc\u7b49\uff09\u3002\u5373\u4f7f\u4f60\u6709\u6743\u9650\u521b\u5efa Pod\u3001\u4fee\u6539 Deployment\uff0c\u5982\u679c\u6ca1\u6709\u9002\u5f53\u7684 SCC\uff0c\u5bb9\u5668\u4ecd\u7136\u65e0\u6cd5\u4ee5\u6240\u9700\u7684\u65b9\u5f0f\u8fd0\u884c\u3002</li> </ul> <p>\u6bd4\u5982\uff0c\u5982\u679c\u4f60\u6709\u6743\u9650\u521b\u5efa Pods\uff08\u901a\u8fc7\u67d0\u4e2a Role\uff09\uff0c\u4f46\u662f\u5bb9\u5668\u9700\u8981\u4ee5 root \u7528\u6237 \u8fd0\u884c\uff0c\u6216\u8005\u4f7f\u7528 \u7279\u6743\u6a21\u5f0f\uff0c\u8fd9\u65f6\u4f60\u5c31\u9700\u8981\u914d\u7f6e SCC \u6765\u5141\u8bb8\u8fd9\u4e9b\u64cd\u4f5c\u3002</p>"},{"location":"cloud/openshift/do280/08_application_security/#4-oc-adm-policy-add-role-to-user-vs-oc-adm-policy-add-scc-to-user","title":"4. <code>oc adm policy add-role-to-user</code> vs <code>oc adm policy add-scc-to-user</code>","text":"<ul> <li><code>oc adm policy add-role-to-user</code>\uff1a \u8fd9\u4e2a\u547d\u4ee4\u5c06\u4e00\u4e2a\u89d2\u8272\u6dfb\u52a0\u5230\u67d0\u4e2a\u7528\u6237\uff08\u6216 ServiceAccount\uff09\u3002\u4f8b\u5982\uff0c\u8d4b\u4e88\u7528\u6237\u5bf9\u67d0\u4e2a\u9879\u76ee\u7684\u8bfb\u5199\u6743\u9650\u3002</li> <li><code>oc adm policy add-scc-to-user</code>\uff1a \u8fd9\u4e2a\u547d\u4ee4\u5c06\u4e00\u4e2a SCC \u7ed1\u5b9a\u5230\u67d0\u4e2a\u7528\u6237\uff08\u6216 ServiceAccount\uff09\u3002\u5b83\u51b3\u5b9a\u4e86\u8be5\u7528\u6237\u8fd0\u884c\u7684\u5bb9\u5668\u662f\u5426\u80fd\u4ee5\u67d0\u79cd\u7279\u6743\u6267\u884c\uff08\u4f8b\u5982\u662f\u5426\u5141\u8bb8\u4ee5 root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\u5bb9\u5668\uff09\u3002</li> </ul>"},{"location":"cloud/openshift/do280/08_application_security/#5","title":"5. \u4f8b\u5b50","text":"<p>\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u7528\u6237 <code>developer</code>\uff0c\u4ed6\u9700\u8981\u8fd0\u884c\u4e00\u4e2a\u5bb9\u5668\u6765\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7f51\u7edc\u3002</p> <ul> <li>Role\uff1a \u4f60\u4f1a\u7528 <code>oc adm policy add-role-to-user</code> \u4e3a <code>developer</code> \u5206\u914d <code>edit</code> \u6743\u9650\uff0c\u4f7f\u4ed6\u80fd\u591f\u5728\u9879\u76ee\u4e2d\u521b\u5efa Pods \u548c Deployments\u3002</li> <li>SCC\uff1a \u4f46\u662f\u5982\u679c <code>developer</code> \u9700\u8981\u5728\u5bb9\u5668\u4e2d\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7f51\u7edc\uff0cOpenShift \u9ed8\u8ba4\u7684 SCC \u53ef\u80fd\u4e0d\u5141\u8bb8\u8fd9\u6837\u505a\uff0c\u56e0\u4e3a\u8fd9\u79cd\u884c\u4e3a\u9700\u8981\u7279\u6743\u3002\u4f60\u4f1a\u4f7f\u7528 <code>oc adm policy add-scc-to-user</code> \u4e3a <code>developer</code> \u7ed1\u5b9a <code>privileged</code> \u6216 <code>anyuid</code> \u7b49 SCC\uff0c\u4f7f\u5f97\u5bb9\u5668\u80fd\u591f\u5728\u5bb9\u5668\u4e2d\u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\u3002</li> </ul>"},{"location":"cloud/openshift/do280/08_application_security/#_1","title":"\u603b\u7ed3","text":"<ul> <li><code>Role</code> \u63a7\u5236\u8bbf\u95ee\u6743\u9650\uff0c\u5b83\u51b3\u5b9a\u4e86\u8c01\u53ef\u4ee5\u64cd\u4f5c\u96c6\u7fa4\u8d44\u6e90\uff08\u5982 Pods\u3001Services\uff09\u3002</li> <li><code>SCC</code> \u63a7\u5236\u5bb9\u5668\u7684 \u8fd0\u884c\u65f6\u6743\u9650\uff0c\u5b83\u51b3\u5b9a\u4e86\u5bb9\u5668\u80fd\u5426\u4ee5\u7279\u6743\u6a21\u5f0f\u8fd0\u884c\uff0c\u662f\u5426\u53ef\u4ee5\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7f51\u7edc\uff0c\u662f\u5426\u53ef\u4ee5\u4ee5 root \u7528\u6237\u8eab\u4efd\u8fd0\u884c\u7b49\u3002</li> </ul> <p>\u56e0\u6b64\uff0c\u5373\u4f7f\u6709\u4e86 Role\uff0c\u4f60\u4ecd\u7136\u9700\u8981\u4e3a\u5bb9\u5668\u914d\u7f6e\u9002\u5f53\u7684 SCC \u6765\u786e\u4fdd\u5bb9\u5668\u80fd\u591f\u6309\u7167\u9700\u8981\u7684\u5b89\u5168\u4e0a\u4e0b\u6587\u6267\u884c\u3002\u4e24\u8005\u7ed3\u5408\uff0c\u786e\u4fdd\u4e86\u65e2\u80fd\u5408\u7406\u63a7\u5236\u8d44\u6e90\u8bbf\u95ee\uff0c\u53c8\u80fd\u786e\u4fdd\u5bb9\u5668\u8fd0\u884c\u65f6\u7684\u5b89\u5168\u6027\u3002</p>"},{"location":"cloud/openshift/do280/09_oc_updates/","title":"9. Openshift Updates","text":""},{"location":"cloud/openshift/do280/09_oc_updates/#1-the-cluster-update-process","title":"1. The Cluster Update Process","text":"<p>With the new distribution system Red Hat Enterprise Linux CoreOS, oc cluster can perform Over-the-Air updates (OTA). </p> <p>OTA:</p> <ul> <li>decreases downtime due to upgrades</li> <li>cluster can use new features and the newest bug fixes</li> <li>faster update by skipping intermediate versions. <code>4.14.1</code> -&gt; <code>4.14.3</code></li> </ul> <p>Warning</p> <p>Starting with OpenShift 4.10, the OTA system requires a persistent connection to the internet.</p> <p>Info</p> <p>\u7ea2\u5e3d\u5728 https://console.redhat.com/openshift \u4e0a\u6258\u7ba1\u548c\u7ba1\u7406\u670d\u52a1\uff0c\u200b\u5e76\u5728 https://quay.io \u4e0a\u6258\u7ba1\u96c6\u7fa4\u955c\u50cf\u3002\u200b </p> <p></p>"},{"location":"cloud/openshift/do280/09_oc_updates/#concepts","title":"Concepts","text":"<p>Upgrade Path describes how a cluster upgrades its version, depends on which channel the cluster has, the upgrading behavior differs.</p> <p></p>"},{"location":"cloud/openshift/do280/09_oc_updates/#channel","title":"Channel","text":"<p>Channel is the representation of the upgrade path. The channel controls the frequency and stability of updates. </p> <p>channel name</p> <ol> <li>the tier (<code>candidate</code>, <code>fast</code>, <code>stable</code>, and <code>eus</code> - extended update support)</li> <li>the major version (<code>-4</code>)</li> <li>the minor version (<code>.12</code>)</li> </ol> <p>Examples: <code>candidate-4.14</code>, <code>fast-4.14</code>, <code>stable-4.14</code>, <code>and eus-4.14</code></p> <p>\u7248\u672c\u53f7</p> <p>\u7248\u672c\u53f7\u683c\u5f0f\uff1a</p> <ul> <li>Major version (x)\uff1a\u4e3b\u7248\u672c\u53f7\uff0c\u4f8b\u5982 4\u3002</li> <li>Minor version (y)\uff1a\u6b21\u7248\u672c\u53f7\uff0c\u4f8b\u5982 14\u3002</li> <li>Patch version (z)\uff1a\u8865\u4e01\u7248\u672c\u53f7\uff0c\u4f8b\u5982 1\u30012\u30013 \u7b49\u3002</li> </ul> <p>z-stream updates</p> <p>z-stream updates \u662f\u6307\u5c0f\u7248\u672c\u66f4\u65b0\u6216\u8865\u4e01\u66f4\u65b0\uff0c\u901a\u5e38\u7528\u4e8e\u4fee\u590d\u6f0f\u6d1e\u3001\u5b89\u5168\u8865\u4e01\u3001\u7a33\u5b9a\u6027\u589e\u5f3a\u548c\u5176\u4ed6\u5c0f\u6539\u8fdb\u3002\u8fd9\u79cd\u66f4\u65b0\u53ea\u6d89\u53ca\u8f6f\u4ef6\u7248\u672c\u53f7\u4e2d\u7684\u6700\u540e\u4e00\u4f4d\uff08\u5373 z \u4f4d\uff09\u3002\u4f8b\u5982\uff0c\u4ece\u7248\u672c 4.14.0 \u66f4\u65b0\u5230 4.14.1 \u6216 4.14.2\uff0c\u8fd9\u4e9b\u90fd\u5c5e\u4e8e z-stream updates\u3002</p>"},{"location":"cloud/openshift/do280/09_oc_updates/#candidate-channel","title":"Candidate Channel","text":"<p>The candidate channel delivers updates for testing feature acceptance</p>"},{"location":"cloud/openshift/do280/09_oc_updates/#fast-channel","title":"Fast Channel","text":"<p>The fast channel delivers updates as soon as Red Hat declares the given version as a general availability release (GA\u7248\u672c)</p> <p>Note</p> <p>If you join the Red Hat connected customers program, then your cluster is registered to the fast channel.</p>"},{"location":"cloud/openshift/do280/09_oc_updates/#stable-channel","title":"Stable Channel","text":"<p>After Fast channel version passes additional testing and validation given by the Redhat site reliability engineering (SRE) teams, it comes into Stable Channel. It is best suited to production environments.</p>"},{"location":"cloud/openshift/do280/09_oc_updates/#eusextended-update-support-channel","title":"EUS(extended update support) Channel","text":"<p>Starting with OpenShift Container Platform 4.8, Red Hat denotes all even-numbered minor releases (for example, 4.8, 4.12, and 4.14) as Extended Update Support (EUS) releases.</p> <p>Warning</p> <p>\u5728 OCP \u8fdb\u5165 EUS \u9636\u6bb5\u4e4b\u524d\uff0c<code>stable-4.8</code> \u548c <code>eus-4.8</code>\u8fd9\u4e24\u4e2a\u901a\u9053\u7684\u66f4\u65b0\u5185\u5bb9\u4e00\u81f4\u3002\u4e00\u65e6\u8fdb\u5165 EUS \u9636\u6bb5\uff0c<code>eus-4.8</code> \u901a\u9053\u5c06\u5f00\u59cb\u63a5\u6536\u957f\u671f\u652f\u6301\u7684\u66f4\u65b0\uff0c\u800c stable-4.8 \u901a\u9053\u53ef\u80fd\u7ee7\u7eed\u63d0\u4f9b\u5e38\u89c4\u7684\u66f4\u65b0\u548c\u6539\u8fdb\u3002</p>"},{"location":"cloud/openshift/do280/09_oc_updates/#upgrade-paths","title":"Upgrade Paths","text":"<p>\u4e3e\u4f8b\uff1a\u5047\u8bbe\u7248\u672c<code>4.14.3</code>\u6709\u95ee\u9898\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u5728\u4e0d\u540c channel \u7684cluster\u4f1a\u5982\u4f55\u8fdb\u884cupgrade\uff1a</p> <ul> <li>\u5f53\u524d\u7248\u672c\u662f<code>stable-4.14</code>\uff0c\u6211\u53ef\u4ee5\u4ece<code>4.14.0</code>\u5347\u7ea7\u5230<code>4.14.1</code>\u6216\u8005<code>4.14.2</code>\uff0c\u8df3\u8fc7<code>4.14.3</code>\uff0c\u76f4\u63a5\u5347\u7ea7\u5230<code>4.14.4</code></li> <li>\u5f53\u524d\u7248\u672c\u662f<code>fast-4.14</code>\uff0ccan deliver 4.14.1 and 4.14.2 updates but not 4.14.3. </li> <li>\u5f53\u524d\u7248\u672c\u662f<code>candidate-4.14</code>\uff0c\u6211\u6709\u6743\u9650\u8bbf\u95ee\u6240\u6709\u7684z-stream releases, \u6bd4\u5982 as 4.14.1, 4.14.2, and 4.14.3.</li> <li>When switching to the <code>eus-4.14</code> channel, the <code>stable-4.14</code> channel does not receive z-stream updates until the next EUS version becomes available.</li> </ul>"},{"location":"cloud/openshift/do280/09_oc_updates/#switch-channel","title":"Switch Channel","text":"<p>You can switch channel to <code>eus-4.14</code>, <code>stable-4.14</code>, <code>fast-4.14</code>, or <code>candidate-4.14</code> by using the web console or the OpenShift CLI client:</p> <p>Web console:</p> <p> </p> <p>Command line:</p> <pre><code>oc patch clusterversion version --type=\"merge\" \\\n  --patch '{\"spec\":{\"channel\":\"fast-4.14\"}}'\n</code></pre>"},{"location":"cloud/openshift/do280/09_oc_updates/#pause-health-check","title":"Pause Health Check","text":"<p>During the upgrade process, nodes in the cluster might become temporarily unavailable. In the case of worker nodes, the machine health check might identify such nodes as unhealthy and reboot them. To avoid rebooting such nodes, pause all the machine health check resources before updating the cluster.</p> <ol> <li> <p>list all the available machine health check resources         <pre><code>[user@host ~]$ oc get machinehealthcheck -n openshift-machine-api\nNAME                             MAXUNHEALTHY  EXPECTEDMACHINES  CURRENTHEALTHY\nmachine-api-termination-handler  100%\n</code></pre></p> </li> <li> <p>pause the Health Check with the annotation         <pre><code>oc annotate machinehealthcheck -n openshift-machine-api \\\n    machine-api-termination-handler cluster.x-k8s.io/paused=\"\"\n</code></pre></p> </li> <li> <p>remove the annotation after the cluster is updated.         <pre><code>oc annotate machinehealthcheck -n openshift-machine-api \\\n    machine-api-termination-handler cluster.x-k8s.io/paused-\n</code></pre></p> </li> </ol>"},{"location":"cloud/openshift/do280/09_oc_updates/#ota","title":"OTA","text":"<p>OTA generates all possible update paths for your cluster. </p> <p>The following diagram describes the updates architecture: Red Hat hosts both the cluster images and a \"watcher\", which automatically detects new images that are pushed to Quay. The Cluster Version Operator (CVO) receives its update status from that watcher. The CVO starts by updating the cluster components via their operators, and then updates any extra components that the Operator Lifecycle Manager (OLM) manages.</p> <p></p> <p>With telemetry, Red Hat can determine the update path. The cluster uses a Prometheus-based Telemeter component to report on the state of each cluster operator. The data is anonymized and sent back to Red Hat servers that advise cluster administrators about potential new releases.</p> <p>In the future, Red Hat intends to extend the list of updated operators that are included in the upgrade path to include independent software vendor (ISV) operators.</p> <p></p>"},{"location":"cloud/openshift/do280/09_oc_updates/#update","title":"Update","text":"<p>update related components</p> <p>Machine Config Operator</p> <p>The Machine Config Operator applies the desired machine state to each of the nodes. This component also handles the rolling upgrade of nodes in the cluster, and uses CoreOS Ignition as the configuration format.</p> <p>Operator Lifecycle Manager</p> <p>The OLM orchestrates updates to any operators that are running in the cluster.</p> <p>Web Console:</p> <p></p> <p>CLI:</p> <pre><code># get version info\noc get clusterversion\n\n# get version + channel\noc get clusterversion -o jsonpath='{.items[0].spec.channel}{\"\\n\"}'\n\n# View the available updates \noc adm upgrade\n\n# Apply the latest update\noc adm upgrade --to-latest=true\n# Applz update with version=VERSION\noc adm upgrade --to=VERSION\n\n# review the status of the Cluster Version Operator (CVO) and the installed cluster operators.\noc get clusterversion\noc get clusteroperators\noc describe clusterversion\n</code></pre>"},{"location":"cloud/openshift/do280/09_oc_updates/#2-deprecated-k8s-api","title":"2. Deprecated k8s API","text":"<p>Note</p> <p>The OpenShift Container Platform foundation is based on Kubernetes and therefore shares the underlying technology. </p> <p>The following table lists the OpenShift version and the Kubernetes version that it is based on:  \u26a0\ufe0f \u8bb0\u5fc6\u70b9\uff1amayor\u5dee+3\uff0cminor\u5dee-13</p> OpenShift version Kubernetes version 4.12 1.25 4.13 1.26 4.14 1.27"},{"location":"cloud/openshift/do280/09_oc_updates/#k8s-api","title":"K8s API","text":"<p>Kubernetes API versions are categorized based on feature maturity:</p> API version Category Description <code>v1alpha1</code> Alpha Experimental features <code>v1beta1</code> Beta Pre-release features <code>v1</code> Stable Stable features, generally available <p>Get the current version of the resource <code>cronjobs</code>:</p> <pre><code>oc api-resources | egrep '^NAME|cronjobs'\n</code></pre> <p>Warning</p> <p>When a stable version of a feature is released, the beta versions are marked as deprecated and are removed after three Kubernetes releases. </p> <p>List all deprecated k8s APIs, and in which k8s verstion are they deprecated:</p> <pre><code>[user@host ~]$ oc get apirequestcounts | awk '{if(NF==4){print $0}}'\nNAME                    REMOVEDINRELEASE   REQUESTSINCURRENTHOUR   REQUESTSINLAST24H\ncronjobs.v1beta1.batch  1.25               15                      44\n</code></pre> <p>To count the used request count: <pre><code>FILTER='{range .items[?(@.status.removedInRelease!=\"\")]}{.status.removedInRelease}{\"\\t\"}{.status.requestCount}{\"\\t\"}{.metadata.name}{\"\\n\"}{end}'\n\noc get apirequestcounts -o jsonpath=\"${FILTER}\" | \\\n  column -t -N \"RemovedInRelease,RequestCount,Name\"\n</code></pre></p>"},{"location":"cloud/openshift/do280/09_oc_updates/#rhocp","title":"RHOCP","text":"<p>Red Hat OpenShift Container Platform (RHOCP) is a set of modular components and services that are built on top of a Kubernetes container infrastructure.</p> <p>Some deprecated features:</p> OpenShift 4.12 OpenShift 4.13 OpenShift 4.14 Feature General Availability General Availability Deprecated <code>DeploymentConfig</code> objects General Availability General Availability Deprecated Operator lifecycle and development deprecated Deprecated Deprecated Deprecated CoreDNS wildcard queries for the cluster.local domain Deprecated Deprecated Deprecated Persistent storage that uses <code>FlexVolume</code> Not Available General Availability Removed <code>--include-local-oci-catalogs</code> parameter for oc-mirror <p>Deprecated API Alerts in OpenShift</p> <p>OpenShift includes two alerts that are triggered when a workload uses a deprecated API version:</p> <ul> <li><code>APIRemovedInNextReleaseInUse</code>: This alert is triggered when OC will remove it in the next release.</li> <li><code>APIRemovedInNextEUSReleaseInUse</code>: This alert is triggered when EUS version will remove it in the next release.</li> </ul> <p></p> <p>Alternatively you can also extrat alerts in JSON format from Prometheus StatefulSet:</p> <pre><code>oc exec -it statefulset/prometheus-k8s -c prometheus \\\n    -n openshift-monitoring -- \\\n    curl -fsSL 'http://localhost:9090/api/v1/alerts' | jq . &gt; alerts.json\n</code></pre> <p>Explicit Acknowledgment - before updating the cluster</p> <p>Before upgrading from <code>4.13</code> to <code>4.14</code>, OC requires an administrator to provide a manual acknowledgment - to prevent workloads using deprecated API versions. </p>"},{"location":"cloud/openshift/do280/09_oc_updates/#3-update-operators-with-the-olm","title":"3. Update Operators with the OLM","text":"<p>The OLM updates the operators. However, new versions can introduce bugs and incompatibilities. Cluster administrators should define operator update policies such as:</p>"},{"location":"cloud/openshift/do280/09_oc_updates/#1-automatic-and-manual-updates","title":"1. Automatic and Manual Updates","text":"<p>for each installed operator: <code>Manual approval by administrator</code> or <code>Automatic</code> update</p> <p></p> <p>You can also get the info by CLI:</p> <pre><code># check the sub(subscription) of operator `web-terminal`\noc get sub -n openshift-operators web-terminal -o yaml\n</code></pre> <ul> <li><code>currentCSV</code> shows the latest version</li> <li><code>installedCSV</code> shows the installed version</li> </ul> <p>The OLM also creates an <code>installplan</code> when the operator channel contains a later version of an operator.</p> <pre><code># check the installplan \"install-72vnw\"\noc get installplan -n openshift-operators install-72vnw -o yaml\n\n# approve the installplan &amp; update the operator\noc patch installplan install-72vnw --type merge \\\n    --patch '{\"spec\":{\"approved\":true}}'\n</code></pre> <p>installplan</p> <p>An <code>installplan</code> is a custom resource in OpenShift that describes the steps needed to install or upgrade an Operator. It is automatically generated and managed by the OLM when a new Operator or an update to an existing Operator is available. </p> <p>Example:</p> <pre><code>apiVersion: operators.coreos.com/v1alpha1\nkind: InstallPlan\nspec:\n    approval: Manual    # approval needed?\n    approved: false     # is the update approved?\n    clusterServiceVersionNames:\n        - web-terminal.v1.6.0   # the updated version\n    generation: 2\nstatus:\n    phase: RequiresApproval\n</code></pre> <p></p> <p>automatic VS manual</p> <p>no matter <code>automatic</code> or <code>manual</code>, the OLM always updates an operator as soon as the configured channel has a later version of the operator.</p>"},{"location":"cloud/openshift/do280/09_oc_updates/#2-operator-update-channels","title":"2. Operator Update Channels","text":"<p>Operator providers can create multiple <code>channels</code> for an operator - each <code>channel</code> contains different versions of the operator, e.g.: - <code>stable</code> channel - <code>preview</code> channel: to test new features &amp; bugs-fixing</p> <p>channel</p> <p>channel\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a sub-version\uff0c\u5176\u5b9e\u548cversion\u4e00\u6837\uff0c\u662f\u4e00\u4e2adistribution\u7684\u7248\u672c</p> <p>You can switch channels in the operator subscription.</p>"},{"location":"cloud/openshift/do280/09_oc_updates/#3-you-can-create-custom-catalogs-and-decide-which-versions-of-operators-to-include-in-the-catalog","title":"3. You can create custom catalogs, and decide which versions of operators to include in the catalog.","text":""},{"location":"cloud/openshift/do280/09_oc_updates/#gather-info","title":"Gather info","text":"<p>Gather cluster info for debugging purpose: <pre><code>oc adm must-gather \n</code></pre></p>"},{"location":"cloud/openshift/do280/10/","title":"10","text":""},{"location":"cloud/openshift/do280/10/#special-projects-used-in-do280","title":"Special Projects used in DO280","text":"Project Description Used in <code>openshift</code> \u5e73\u53f0\u9759\u6001\u8d44\u6e90\uff08\u8bc1\u4e66\u3001\u9ed8\u8ba4 SA\u3001\u6a21\u677f\u7b49\uff09 - Ch01: OC Template <code>openshift-config</code> \u7ba1\u7406\u96c6\u7fa4\u8303\u56f4\u7684\u914d\u7f6e\uff0c\u5982\u8eab\u4efd\u9a8c\u8bc1\u65b9\u5f0f\u3001image registry \u914d\u7f6e\u3001\u96c6\u7fa4\u7684\u9ed8\u8ba4\u7b56\u7565\u7b49\u3002 - Ch03: set HTPasswd <code>openshift-authentication</code> \u5904\u7406\u7528\u6237\u767b\u5f55\u8ba4\u8bc1\u529f\u80fd\uff0c\u63d0\u4f9b OAuth \u670d\u52a1\uff0c\u7ba1\u7406 login \u9875\u9762\u53ca\u4e0e\u8eab\u4efd\u63d0\u4f9b\u8005\uff08\u5982 LDAP\u3001GitHub \u7b49\uff09\u7684\u96c6\u6210 <code>openshift-apiserver</code> OpenShift \u7279\u6709\u7684 API Server\uff0c\u5904\u7406 OpenShift \u6269\u5c55 API\uff08\u5982 Projects\u3001Builds\u3001Templates\uff09\uff0c\u5728 Kubernetes API \u57fa\u7840\u4e0a\u63d0\u4f9b\u989d\u5916\u529f\u80fd\u3002 <code>openshift-marketplace</code> \u652f\u6301 OperatorHub\uff0c\u4ece OperatorHub.io \u62c9\u53d6\u548c\u5b89\u88c5 Operator\uff0c\u4f9b\u6574\u4e2a\u96c6\u7fa4\u6216\u547d\u540d\u7a7a\u95f4\u4f7f\u7528 <code>openshift-operators</code> \u90e8\u7f72\u548c\u7ba1\u7406\u96c6\u7fa4\u8303\u56f4\u7684 Operator\uff08\u5373 ClusterServiceVersion \u7b49\u8d44\u6e90\uff09\uff0c\u5305\u62ec Operator Lifecycle Manager\uff08OLM\uff09\u76f8\u5173\u7ec4\u4ef6\u3002 <code>openshift-file-integrity</code> \u63d0\u4f9b\u6587\u4ef6\u5b8c\u6574\u6027\u68c0\u6d4b\u529f\u80fd\uff0c\u786e\u4fdd\u5173\u952e\u7cfb\u7edf\u6587\u4ef6\u672a\u88ab\u7be1\u6539\uff0c\u4e3b\u8981\u7528\u4e8e\u5b89\u5168\u76d1\u63a7 <code>openshift-service-ca</code> \u4e3a\u96c6\u7fa4\u5185\u7684\u670d\u52a1\u81ea\u52a8\u7b7e\u53d1 TLS \u8bc1\u4e66\uff0c\u5b9e\u73b0\u670d\u52a1\u95f4\u52a0\u5bc6\u901a\u4fe1 <code>openshift-machine-api</code> \u7ba1\u7406\u96c6\u7fa4\u8282\u70b9\uff08Machines\uff09\u7684\u751f\u547d\u5468\u671f\uff0c\u63d0\u4f9b\u81ea\u52a8\u6269\u7f29\u5bb9\u3001\u673a\u5668\u90e8\u7f72\u548c\u5220\u9664\u7b49\u529f\u80fd\uff08\u9002\u7528\u4e8e IPI \u5b89\u88c5\u6a21\u5f0f\uff09 <code>openshift-monitoring</code> \u8d1f\u8d23\u96c6\u7fa4\u7684\u76d1\u63a7\u548c\u544a\u8b66\uff0c\u5305\u62ec Prometheus\u3001Alertmanager\u3001Grafana \u7b49\uff0c\u6536\u96c6\u548c\u5c55\u793a\u96c6\u7fa4\u72b6\u6001\u6307\u6807 <code>openshift-console</code> \u63d0\u4f9b Web \u63a7\u5236\u53f0\uff08UI\uff09\uff0c\u4f9b\u7ba1\u7406\u5458\u548c\u5f00\u53d1\u8005\u64cd\u4f5c\u96c6\u7fa4\u8d44\u6e90\uff0c\u67e5\u770b\u72b6\u6001\u548c\u65e5\u5fd7\u7b49\u3002 <code>openshift-ingress-operator</code> \u7ba1\u7406\u4e0e\u7f51\u7edc\u6d41\u91cf\u63a7\u5236\u548c\u8def\u7531\u6709\u5173\u7684\u5404\u7c7b\u64cd\u4f5c\u3002\u5305\u62ec Ingress \u8d44\u6e90\u548c Ingress Controller"},{"location":"cloud/openshift/do280/10/#oc-exec-vs-oc-rsh","title":"<code>oc exec</code> VS <code>oc rsh</code>","text":"<code>oc exec</code> <code>oc rsh</code> Purpose Opens an interactive shell session inside a container. \u9ed8\u8ba4\u662finteractive\u7684 Simply execute a given command. \u53ef\u4ee5\u662f interactive \u6216\u8005 non-interactive\u7684 Grammar <code>oc rsh &lt;pod-name&gt; [-c &lt;container-name&gt;]</code> <code>oc exec &lt;pod-name&gt; [-c &lt;container-name&gt;] -- &lt;command&gt; [args]</code> Example <code>oc rsh my-pod-123 -c my-container</code> <code>oc exec my-pod-123 -- ls /app</code> <code>oc exec -it my-pod-123 -c my-container -- /bin/bash</code> Default Starts <code>/bin/sh</code> Requires explicit command, can be <code>/bin/sh</code> or <code>/bin/bash</code> - depends on what is given by user Use Case Debugging &amp; exploration Scripting, one-off commands"},{"location":"cloud/openshift/do280/10/#scale-vs-autoscale","title":"scale vs autoscale","text":"<pre><code># \u26a0\ufe0f CPU \u6307\u7684\u662f Deployment foo \u4e2d\u6240\u6709 Pod \u7684\u5e73\u5747 CPU \u4f7f\u7528\u7387\noc autoscale deployment foo --max=5 --cpu-percent=80\n</code></pre> <ul> <li>\u9ed8\u8ba4 <code>--min=1</code>\uff0c\u5373\u6700\u5c11\u4fdd\u7559\u4e00\u4e2a\u526f\u672c\u3002</li> <li>OpenShift \u4f1a\u521b\u5efa\u4e00\u4e2a <code>HorizontalPodAutoscaler\uff08HPA\uff09</code> \u5bf9\u8c61\uff0c\u6301\u7eed\u76d1\u63a7 foo Deployment \u4e2d Pod \u7684 CPU \u4f7f\u7528\u7387\uff1a<ul> <li>\u5f53\u5e73\u5747 CPU \u4f7f\u7528\u7387 &gt; 80%\uff0c\u5219\u589e\u52a0\u526f\u672c\u6570\uff08\u6700\u591a\u5230 5 \u4e2a\uff09\uff1b</li> <li>\u5f53\u8d1f\u8f7d\u4e0b\u964d\uff0c\u5e73\u5747 CPU \u4f7f\u7528\u7387 &lt; 80%\uff0c\u5219\u51cf\u5c11\u526f\u672c\u6570\uff08\u6700\u5c11\u5230 1 \u4e2a\uff09\uff1b</li> </ul> </li> </ul> <p>\u6ce8\u610f\u4e8b\u9879</p> <ol> <li>\u524d\u63d0\uff1aPod \u5fc5\u987b\u6709\u8bbe\u7f6e CPU requests\uff0c\u5426\u5219 HPA \u6ca1\u6cd5\u8ba1\u7b97\u767e\u5206\u6bd4\u3002\u4f8b\u5982\uff1a     <pre><code>resources:\n    requests:\n        cpu: \"100m\"\n</code></pre></li> <li>\u4fee\u6539 HPA \u53ef\u7528 <code>oc edit hpa foo</code> \u6216 <code>oc autoscale</code> \u91cd\u65b0\u6267\u884c\u3002</li> <li>\u67e5\u770b\u5f53\u524d\u72b6\u6001\uff1a     <pre><code>oc get hpa\n</code></pre></li> </ol>"},{"location":"cloud/openshift/do280/10/#find-console","title":"find console","text":"<pre><code># check URL of the console\noc whoami \u2014show-console\n</code></pre>"},{"location":"cloud/openshift/do280/10/#use-oc-explain","title":"use \"oc explain\"","text":"<pre><code>oc explain pod.spec.template\noc explain pods --recursive | grep envFrom -A3\n</code></pre>"},{"location":"cloud/openshift/do288/01_deploy_app/","title":"Deploying and Managing Applications","text":""},{"location":"cloud/openshift/do288/01_deploy_app/#deploying-and-managing-applications-on-an-openshift-cluster","title":"Deploying and Managing Applications on an OpenShift Cluster","text":"<ul> <li>CoreOS: \u662f OpenShift \u8fd0\u884c\u65f6\u6240\u57fa\u4e8e\u7684\u57fa\u7840\u64cd\u4f5c\u7cfb\u7edf\u3002\u662f\u4e00\u79cd Linux \u53d1\u884c\u7248\uff0c \u4e13\u6ce8\u4e8e\u4e3a\u5bb9\u5668\u6267\u884c\u63d0\u4f9b\u4e0d\u53ef\u53d8\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</li> <li> <p>CRI-O: an implementation of the <code>Kubernetes CRI (Container Runtime Interface)</code> to enable using <code>OCI (Open Container Initiative)</code> compatible runtimes. \u4f8b\u5982: runc(\u7531 Docker \u670d\u52a1\u4f7f\u7528)\u6216 rkt(\u6765\u81ea\u4e8e CoreOS)\u3002</p> </li> <li> <p>Kubernetes: \u7ba1\u7406\u8fd0\u884c\u5bb9\u5668\u7684\u7269\u7406\u6216\u865a\u62df\u4e3b\u673a\u96c6\u7fa4\u3002\u5b83\u4f7f\u7528\u8d44\u6e90\u63cf\u8ff0\u7531\u591a\u79cd\u8d44\u6e90\u7ec4\u6210\u7684\u591a\u5bb9\u5668\u5e94 \u7528\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u4e92\u8fde\u65b9\u5f0f\u3002</p> </li> <li>CRD / \u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49: \u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49 (CRD) \u662f\u5b58\u50a8\u5728 etcd \u4e2d\u5e76\u7531 Kubernetes \u7ba1\u7406\u7684\u8d44\u6e90\u7c7b\u578b\u3002\u8fd9\u4e9b\u8d44\u6e90\u7c7b\u578b\u6784\u6210 \u4e86 OpenShift \u7ba1\u7406\u7684\u6240\u6709\u8d44\u6e90\u7684\u72b6\u6001\u548c\u914d\u7f6e\u3002</li> <li> <p>etcd: consistent, distributed <code>key-value</code> store</p> </li> <li> <p>Containerized Service / \u5bb9\u5668\u5316\u670d\u52a1: \u5bb9\u5668\u5316\u670d\u52a1\u627f\u62c5\u8bb8\u591a PaaS \u57fa\u7840\u67b6\u6784\u804c\u8d23\uff0c\u5982\u8054\u7f51\u548c\u6388\u6743\u3002RHOCP \u5c06 Kubernetes \u7684\u57fa\u672c\u5bb9\u5668 \u57fa\u7840\u67b6\u6784\u548c\u5e95\u5c42\u5bb9\u5668\u8fd0\u884c\u65f6\u7528\u4e8e\u5927\u90e8\u5206\u5185\u90e8\u529f\u80fd\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5927\u90e8\u5206 RHOCP \u5185\u90e8\u670d\u52a1\u4f5c\u4e3a\u7531 Kubernetes \u7f16\u6392\u7684\u5bb9\u5668\u8fd0\u884c\u3002</p> </li> <li>Runtimes and xPaaS: \u8fd0\u884c\u65f6\u548c xPaaS \u662f\u53ef\u968f\u65f6\u4f9b\u5f00\u53d1\u4eba\u5458\u4f7f\u7528\u7684\u57fa\u7840\u5bb9\u5668\u955c\u50cf\uff0c\u5404\u81ea\u9884\u914d\u7f6e\u4e86\u7279\u5b9a\u7684\u8fd0\u884c\u65f6\u8bed\u8a00 \u6216\u6570\u636e\u5e93\u3002xPaaS \u4ea7\u54c1\u662f JBoss EAP \u548c ActiveMQ \u7b49\u7ea2\u5e3d\u4e2d\u95f4\u4ef6\u4ea7\u54c1\u7684\u4e00\u7ec4\u57fa\u7840\u955c\u50cf\u3002\u7ea2\u5e3d OpenShift \u5e94\u7528\u8fd0\u884c\u65f6 (RHOAR) \u662f\u9488\u5bf9 OpenShift \u4e2d\u4e91\u539f\u751f\u5e94\u7528\u4f18\u5316\u7684\u4e00\u7ec4\u8fd0\u884c\u65f6\u3002\u53ef\u7528\u7684\u5e94 \u7528\u8fd0\u884c\u65f6\u6709\u7ea2\u5e3d JBoss EAP\u3001OpenJDK\u3001Thorntail\u3001Eclipse Vert.x\u3001Spring Boot \u548c Node.js\u3002</li> <li>DevOps Tools &amp; User Experience: RHOCP \u63d0\u4f9b Web UI \u548c CLI \u7ba1\u7406\u5de5\u5177\uff0c\u4ee5\u7528\u4e8e\u7ba1\u7406\u7528\u6236\u5e94\u7528\u548c RHOCP \u670d\u52a1\u3002OpenShift Web UI \u548c CLI \u5de5\u5177\u4ece REST API \u6784\u5efa\uff0c\u540e\u8005\u53ef\u901a\u8fc7 IDE \u548c CI \u5e73\u53f0\u7b49\u5916 \u90e8\u5de5\u5177\u52a0\u4ee5\u5229\u7528\u3002</li> </ul>"},{"location":"cloud/openshift/do288/01_deploy_app/#_1","title":"\u91cd\u8981\u7684\u8d44\u6e90\u7c7b\u578b","text":"<p>Routes / \u8def\u7531\u662f\u53ef\u88ab OpenShift \u8def\u7531\u5668\u8bc6\u522b\u4e3a\u96c6\u7fa4\u4e2d\u90e8\u7f72\u7684 \u5404\u79cd\u5e94\u7528\u548c\u5fae\u670d\u52a1 \u5165\u53e3\u70b9\u7684 DNS \u4e3b\u673a\u540d\u3002</p>"},{"location":"cloud/openshift/do288/01_deploy_app/#oc-new-app","title":"<code>oc new-app</code> \u521b\u5efa\u5e94\u7528","text":"<p>OpenShift \u4e3b\u8981\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd \u90e8\u7f72\u5bb9\u5668\u5316\u5e94\u7528 \u7684\u65b9\u6cd5\uff0c\u7528<code>--strategy</code>\u8fdb\u884c\u533a\u5206: <code>source</code>, <code>docker</code> or <code>pipeline</code></p>"},{"location":"cloud/openshift/do288/01_deploy_app/#1-strategysource","title":"1.<code>--strategy=source</code>","text":"<p>Combines your application source code with a base image.</p> <p>You can choose the base image using <code>[baseImage]~</code>, if NOT, OpenShift will attempt to detect the best-matching builder image by examining the files(<code>requirements.txt</code> or <code>package.json</code>).  \u4ee5\u4e0b 3 \u79cd\u65b9\u6cd5\u90fd\u4f1a\u5f97\u5230\u540c\u6837\u7684\u7ed3\u679c\uff1a</p> <pre><code>oc new-app python:3.9~https://github.com/your-repo\noc new-app -i python:3.9 https://github.com/your-repo\noc new-app -i python:3.9 --strategy source --code https://github.com/your-repo\n</code></pre>"},{"location":"cloud/openshift/do288/01_deploy_app/#2-strategydocker","title":"2. <code>--strategy=docker</code>","text":"<p>searches for a <code>Dockerfile</code> in the repository. Useful when you need full control over how the image is built.</p> <pre><code>oc new-app https://github.com/your-repo --strategy=docker\n</code></pre>"},{"location":"cloud/openshift/do288/01_deploy_app/#3-strategypipeline","title":"3. <code>--strategy=pipeline</code>","text":"<p>requires a pipeline definition file <code>Jenkinsfile</code> or <code>Tekton Pipeline</code>. Suitable for CI/CD workflows where multiple steps (e.g., build, test, deploy)  <pre><code>oc new-app https://github.com/your-repo --strategy=pipeline\n</code></pre></p> <p>Info</p> <p>Customization Level from LOW to HIGH: <code>source</code> &lt; <code>docker</code> &lt; <code>pipeline</code> </p> <p><code>~</code> VS <code>--image-stream (-i)</code></p> <p>\u6ce2\u5f62\u7b26 (~) \u548c --image-stream (-i) \u9009\u9879\u5de5\u4f5c\u65b9\u5f0f\u4e0d\u540c\uff0c-i \u9009\u9879\u8981\u6c42\u5728\u672c\u5730\u5b89\u88c5 git \u5ba2\u6236\u7aef\uff0c\u56e0\u4e3a\u8bed\u8a00\u68c0\u6d4b\u9700\u8981\u514b\u9686\u5b58\u50a8\u5e93\uff0c\u4ece\u800c\u80fd\u68c0\u67e5\u9879\u76ee\uff0c\u800c\u6ce2\u5f62\u7b26 (~) \u8868\u793a\u6cd5\u5219\u4e0d\u4f1a\u8fd9\u6837\u3002</p> <p>\u5bfc\u5165\u955c\u50cf\u6d41</p> <p>\u8981\u521b\u5efa\u955c\u50cf\u6d41\uff0c\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528\u5e26\u6709--confirm \u9009\u9879\u7684 oc import-image \u547d\u4ee4</p> <pre><code>oc import-image myis --confirm \\\n--from registry.acme.example.com:5000/acme/awesome --insecure\n</code></pre>"},{"location":"cloud/openshift/do288/01_deploy_app/#4","title":"4. \u73b0\u6709\u7684 \u955c\u50cf \u76f4\u63a5\u90e8\u7f72","text":"<p>\u67d0\u4e2aregistry\u4e2d\u5df2\u5b58\u5728\u521b\u5efa\u597d\u7684 \u5bb9\u5668\u5316\u5e94\u7528/\u955c\u50cf, \u7528 <code>--docker-image</code>\u65d7\u5e1c\u5b9e\u73b0: <pre><code>oc new-app \\\n--docker-image \\\nregistry.access.redhat.com/rhel7-mysql57\n</code></pre></p>"},{"location":"cloud/openshift/do288/01_deploy_app/#_2","title":"\u53ef\u7528\u65d7\u5e1c","text":"\u9009\u9879 \u63cf\u8ff0 <code>--as-deployment-config</code> create <code>DeploymentConfig</code> instead of <code>Deployment</code>. <code>DC</code> is slowly deprecated! <code>--code</code> Provides Github URL as S2I input <code>--context-dir</code> Directory in git repository <code>--docker-image</code> Use Image from Docker Hub to create App <code>--dry-run</code> \u8bbe\u7f6e\u4e3a true\uff0c\u4ee5\u663e\u793a\u64cd\u4f5c\u7ed3\u679c\u800c\u4e0d\u6267\u884c\u8be5\u64cd\u4f5c\u3002 <code>--docker-image</code> or <code>-i</code> Use Image from Docker Hub to create App <code>--strategy</code> <code>source</code>, <code>docker</code> or <code>pipeline</code> <code>--name</code> \u7ed9\u90e8\u7f72\u4e00\u4e2a\u540d\u5b57 <code>-e</code> \u7ed9Application Pod\u5b9a\u4e49\u73af\u5883\u53d8\u91cf <code>--build-env</code> \u7ed9Builder Pod\u5b9a\u4e49\u73af\u5883\u53d8\u91cf\uff08\u5373\u5728\u6784\u5efa\u8fc7\u7a0b\u4e2d\u9700\u8981\u7684\uff09 <p>OpenShift 4.6</p> <p>OpenShift 4.6 \u4e2d\uff0c<code>oc new-app</code> \u547d\u4ee4\u73b0\u5728\u9ed8\u8ba4\u751f\u6210 Deployment \u8d44\u6e90\uff0c\u800c\u4e0d\u662f DeploymentConfig \u8d44\u6e90</p>"},{"location":"cloud/openshift/do288/01_deploy_app/#_3","title":"\u751f\u6210\u8d44\u6e90","text":"<ol> <li><code>BuildConfig</code> \u548c\u5b83\u7684\u5b9e\u4f8b<code>Build</code></li> <li><code>ImageStream</code>:\u6709\u4e24\u79cd\u60c5\u51b5\uff1a<ul> <li>\u6307\u5411\u5728Internal Registry\u4e2d\u751f\u6210\u7684Image</li> <li>\u6307\u5411external Registry\u4e2d\u5df2\u5b58\u5728\u7684Image</li> </ul> </li> <li><code>Deployment</code>\uff1a\u5305\u62ecDeployment\u81ea\u8eab\u751f\u6210\u7684<code>ReplicaSet</code>\u548c<code>Pod</code></li> <li><code>Service</code>: \u5982\u679c\u4f7f\u7528\u7684image\u6ca1\u7528\u58f0\u660e\u4efb\u4f55port\uff0c\u5219\u4e0d\u4f1a\u751f\u6210<code>Service</code></li> </ol>"},{"location":"cloud/openshift/do288/01_deploy_app/#web-console","title":"Web Console","text":"<p>Web\u63a7\u5236\u53f0\u4e0d\u63d0\u4f9b\u5b8c\u6574\u7684\u96c6\u7fa4\u7ba1\u7406\u529f\u80fd\u3002\u6bd4\u5982\uff1a<code>+Add</code>\u6309\u94ae\u63d0\u4f9b\u548c<code>oc new-app</code>\u547d\u4ee4\u76f8\u4f3c\u7684\u529f\u80fd\uff1a</p> <p></p> <p>Build Config\u7684\u8be6\u60c5\u2eda\u9762\u63d0\u4f9b Details\u3001YAML\u3001Builds\u3001Environment \u548c Events \u9009\u9879\u5361\uff0c\u4ee5\u53ca\u542b\u6709 StartBuild\u64cd\u4f5c\u7684Actions\u6309\u94ae\u3002\u8be5\u64cd\u4f5c\u7684\u529f\u80fd\u4e0e<code>oc start-build</code>\u547d\u4ee4\u76f8\u540c\u3002\u5982\u679c\u5e94\u7528\u6e90\u4ee3\u7801\u5b58\u50a8\u5e93\u672a\u914d\u7f6e\u4e3a\u4f7f\u7528 OpenShift Web hook\uff0c\u90a3\u4e48\u5728\u5c06\u66f4\u65b0\u63a8\u9001\u81f3\u5e94\u7528\u6e90\u4ee3\u7801\u540e\uff0c\u60a8 \u9700\u8981\u4f7f\u7528 Web \u63a7\u5236\u53f0\u6216 CLI \u6765\u89e6\u53d1\u65b0\u6784\u5efa</p> <p>Warning</p> <p>Not all resource management operations can be performed using the web console. Cluster administrator operations, in particular, usually require the CLI.</p>"},{"location":"cloud/openshift/do288/01_deploy_app/#_4","title":"\u7528\u6237\u7c7b\u578b","text":"<ul> <li>\u96c6\u7fa4\u7ba1\u7406\u5458/Cluster Administrator: \u7ba1\u7406\u9879\u76ee\u3001\u6dfb\u52a0\u8282\u70b9(Node)\u3001\u521b\u5efa\u6301\u4e45\u5377(Persistent volumes)\u3001\u5206\u914d\u9879\u76ee\u914d\u989d(project quotas)\uff0c\u4ee5\u53ca\u6267\u884c\u5176\u4ed6\u96c6\u7fa4\u8303\u56f4\u7684\u7ba1\u7406\u4efb\u52a1\u3002</li> <li>\u9879\u76ee\u7ba1\u7406\u5458/Project(Namespace) Administrator: \u7ba1\u7406\u9879\u76ee\u4e2d\u7684\u8d44\u6e90\u3001\u5206\u914d\u8d44\u6e90\u9650\u989d\uff0c\u5e76\u4e14\u5411\u5176\u4ed6\u7528\u6236\u6388\u4e88\u67e5\u770b\u548c\u7ba1\u7406\u9879\u76ee\u8d44\u6e90\u7684\u6743\u9650\u3002</li> <li>\u5f00\u53d1\u8005/Developer\uff1a\u7ba1\u7406\u9879\u76ee\u8d44\u6e90\u7684\u4e00\u4e2a\u5b50\u96c6\u3002\u8be5\u5b50\u96c6\u5305\u62ec\u6784\u5efa\u548c\u90e8\u7f72\u5e94\u7528\u6240\u9700\u7684\u5404\u79cd\u8d44\u6e90\uff0c\u5982\u6784\u5efa\u548c\u90e8\u7f72\u914d\u7f6e\u3001\u6301\u4e45\u5377\u58f0\u660e\u3001\u670d\u52a1\u3001\u673a\u5bc6\u548c\u8def\u7531\u3002\u5f00\u53d1\u4eba\u5458\u65e0\u6cd5\u9488\u5bf9\u8fd9\u4e9b\u8d44\u6e90\u5411\u5176\u4ed6\u7528\u6236\u6388\u4e88\u4efb\u4f55\u6743\u9650\uff0c\u4e5f\u65e0\u6cd5\u7ba1\u7406\u5927\u591a\u6570\u7684\u9879\u76ee\u7ea7\u8d44\u6e90(\u5982\u8d44\u6e90\u9650\u5236)</li> </ul>"},{"location":"cloud/openshift/do288/01_deploy_app/#debug","title":"Debug","text":"\u547d\u4ee4\u7c7b\u578b \u5177\u4f53\u547d\u4ee4 \u72b6\u6001\u4fe1\u606f\uff08status\uff09 <code>oc status</code> <code>oc get</code> \u8d44\u6e90\u63cf\u8ff0\uff08resource description\uff09 <code>oc describe</code> <code>oc get -o</code> \u65e5\u5fd7\u4fe1\u606f\uff08log\uff09 <code>oc logs</code> <p><code>describe</code> VS <code>get</code></p> <ul> <li><code>oc describe</code>\u53ef\u4ee5\u663e\u793a\u8d44\u6e90\u7684\u76f8\u5173\u8be6\u7ec6\u4fe1\u606f</li> <li><code>oc get</code> \u53ea\u4f1a\u663e\u793a\u4e0e\u6240\u8bf7\u6c42\u8d44\u6e90\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u6bd4\u5982<code>oc get buildconfig</code>\u53ea\u4f1a\u663e\u793a\u4e0e<code>buildconfig</code>\u76f8\u5173\u7684\uff0c\u4e0d\u4f1a\u663e\u793a\u4e0e\u4e4b\u5bf9\u5e94\u7684<code>build</code></li> </ul>"},{"location":"cloud/openshift/do288/01_deploy_app/#improving-containerized-application-logs","title":"Improving Containerized Application Logs","text":"<p>OpenShift also provides an optional logging subsystem, based on the EFK stack (<code>Elasticsearch</code>, <code>Fluentd</code>, and <code>Kibana</code>). The logging subsystem provides long-term storage and search capabilities for both OpenShift cluster nodes and application logs.</p>"},{"location":"cloud/openshift/do288/01_deploy_app/#interaction-with-container","title":"Interaction with Container","text":"<p>\u5982\u679c\u4ee5\u4e0a\u547d\u4ee4\u65e0\u6cd5\u63d0\u4f9b\u6709\u6548\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528<code>oc cp</code>\u6216<code>oc rsh</code>\u4e0e\u5bb9\u5668\u76f4\u63a5\u8fdb\u884c\u4ea4\u4e92\u3002</p>"},{"location":"cloud/openshift/do288/01_deploy_app/#1-oc-cp","title":"1. <code>oc cp</code>","text":"<ul> <li>Purpose: Copies files between a local machine and a pod.</li> <li> <p>Usage: <pre><code># oc cp &lt;source&gt; &lt;destination&gt;\noc cp mypod:/path/in/pod /local/path\noc cp /local/path mypod:/path/in/pod\n</code></pre> Now you can check the file on your local machine in <code>/tmp/frontend-server.log</code>.</p> <p><code>oc cp</code></p> <p>this CLI requires tar command installed on the machine, otherwise you will not be able to run it.</p> </li> </ul>"},{"location":"cloud/openshift/do288/01_deploy_app/#2-oc-rsync","title":"2. <code>oc rsync</code>","text":"<ul> <li>Purpose: Synchronizes files or directories between a local machine and a pod.</li> <li> <p>Usage: <pre><code># oc rsync &lt;source&gt; &lt;destination&gt;\noc rsync mypod:/path/in/pod /local/path\noc rsync /local/path mypod:/path/in/pod\n</code></pre></p> <p>\u4f18\u70b9</p> <ul> <li>Handles large files more efficiently than <code>oc cp</code>.</li> <li>Can resume interrupted transfers.</li> </ul> </li> </ul>"},{"location":"cloud/openshift/do288/01_deploy_app/#3-oc-rsh","title":"3. <code>oc rsh</code>","text":"<ul> <li>Purpose: Opens an interactive shell session in a running pod.</li> <li> <p>Usage: <pre><code># oc rsh &lt;pod-name&gt;\noc rsh -t frontend-1-zvjhb\n</code></pre></p> <p>shell</p> <p>\u5bb9\u5668\u4e2d\u6709\u4ec0\u4e48shell\u5de5\u5177\u5c31\u7528\u4ec0\u4e48\u5de5\u5177</p> </li> </ul>"},{"location":"cloud/openshift/do288/01_deploy_app/#_5","title":"\u6a21\u7248","text":"\u547d\u4ee4 \u63cf\u8ff0 <code>oc get template -n openshift</code> \u67e5\u770bOpenShift\u63d0\u4f9b\u7684\u6a21\u7248 <code>oc create -f ~/php-mysql-ephemeral.json -n common-project</code> \u5728\u540d\u4e3a<code>common-project</code>\u7684Project\u4e2d\uff0c\u7528\u7ed9\u51fa\u7684json\u6587\u4ef6\u65b0\u5efa\u4e00\u4e2atemplate <code>oc new-app --template common-project/php-mysql-ephemeral -p DATABASE_USR=user1 -n my-project</code> \u5176\u4e2d\u7684<code>-p</code>\u8868\u793a\u8be5template\u4e2d\u7684\u53c2\u6570/parameter \u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u9f13\u52b1\u5927\u5bb6\u5728\u516c\u7528\u7684\u9879\u76ee\uff08\u6bd4\u5982\u8fd9\u91cc\u7684<code>common-project</code>\uff09\u4e2d\u6dfb\u52a0\u6a21\u7248\uff0c\u4ee5\u65b9\u4fbf\u5728\u79c1\u4eba\u7684\u9879\u76ee\u4e2d\uff08\u8fd9\u91cc\u7684<code>my-project</code>\uff09\u5bf9\u5176\u8fdb\u884c\u5171\u4eab\u548c\u91cd\u7528"},{"location":"cloud/openshift/do288/01_deploy_app/#_6","title":"\u5176\u4ed6\u547d\u4ee4","text":"\u547d\u4ee4 \u63cf\u8ff0 <code>oc status</code> <code>oc logs echo-555xx | tail -n 3</code> <code>oc logs echo-555xx | head -n 3</code> <code>oc describe bc echo</code> <code>oc describe is echo</code> <code>oc start-build bc echo</code> <code>oc delete all -l app=echo</code> <code>oc cp frontend-1-zvjhb:/var/log/httpd/error_log \\ /tmp/frontend-server.log</code> copy the log in the Container to local pc \u6ce8\u610f\uff1a<code>oc cp</code>\u547d\u4ee4\u9700\u8981\u57fa\u7840\u5e94\u7528\u5bb9\u5668\u955c\u50cf\u63d0\u4f9btar\u547d\u4ee4\uff0c\u4ee5\u4fbf\u80fd\u6b63\u5e38\u53d1\u6325\u4f5c\u7528\u3002\u5982\u679c\u5e94\u7528\u5bb9\u5668\u5185\u6ca1\u6709\u5b89\u88c5 tar\uff0c\u90a3\u4e48<code>oc cp</code>\u4f1a\u5931\u8d25\u3002 \u6ce8\u610f\uff1a<code>&lt;Pod\u540d&gt;:&lt;\u6587\u4ef6\u8def\u5f84&gt;</code> <code>oc rsync</code> <code>oc rsync</code>\u547d\u4ee4\u53ef\u4f7f\u672c\u5730\u6587\u4ef6\u5939\u4e0e\u6b63\u5728\u8fd0\u884c\u7684\u5bb9\u5668\u4e2d\u7684\u8fdc\u7a0b\u6587\u4ef6\u5939\u540c\u6b65\u3002\u5b83\u4f1a\u4f7f\u7528\u672c\u5730rsync\u547d\u4ee4 \u6765\u51cf\u5c0f\u5e26\u5bbd\u4f7f\u7528\u91cf\uff0c\u4f46\u65e0\u9700\u5bb9\u5668\u955c\u50cf\u63d0\u4f9b <code>rsync</code> \u6216 <code>ssh</code> \u547d\u4ee4\u3002 <code>oc rsh</code> <code>oc rsh -t frontend-1-zvjhb</code> <code>oc rsh frontend-1-zvjhb ps ax</code> \u521b\u5efa\u8fdc\u7a0b shell \u4ee5\u6267\u884c\u5bb9\u5668\u4e2d \u7684\u547d\u4ee4\u3002\u8be5\u547d\u4ee4\u4f1a\u4f7f\u7528 OpenShift \u4e3b\u63a7\u673a API \u6765\u521b\u5efa\u901a\u5411\u8fdc\u7a0b\u5bb9\u5668\u96c6\u7684\u5b89\u5168\u96a7\u9053 `` `` ``"},{"location":"cloud/openshift/do288/03/","title":"3","text":""},{"location":"cloud/openshift/do288/03/#publishing-enterprise-container-images","title":"Publishing Enterprise Container Images","text":"<p>Container </p>"},{"location":"cloud/openshift/do288/04/","title":"4","text":""},{"location":"cloud/openshift/do288/04/#managing-builds-on-openshift","title":"Managing Builds on OpenShift","text":""},{"location":"cloud/openshift/do288/05/","title":"5","text":""},{"location":"cloud/openshift/do288/05/#customizing-source-to-image-builds","title":"Customizing Source-to-Image Builds","text":""},{"location":"cloud/openshift/do288/06/","title":"6","text":""},{"location":"cloud/openshift/do288/06/#deploying-multi-container-applications","title":"Deploying Multi-container Applications","text":""},{"location":"cloud/openshift/do288/07/","title":"7","text":""},{"location":"cloud/openshift/do288/07/#managing-application-deployments","title":"Managing Application Deployments","text":""},{"location":"cloud/openshift/do288/08/","title":"8","text":""},{"location":"cloud/openshift/do288/08/#building-applications-for-openshift","title":"Building Applications for OpenShift","text":""},{"location":"cloud/openshift/do322/01/","title":"1. Intro to OpenShift Installation","text":"<p>Course Objectives: Installing OpenShift on a cloud, virtual, or physical infrastructure.</p> Installation method \\ Infrastructure Type Cloud Virtual (Hypervisor) Physical UPI \u2705 Chapter 2 \u2705 Chapter 3 \u2705 Chapter 4,5,6 - a.k.a OC installation without Infrastructure Provider IPI \u2705 Chapter 2 \u2705 Chapter 3 IPI on Bare Metal <p>In what case does the Administrator chose UPI over IPI?</p> <p>Two possible cases:</p> <ul> <li>The Administrator does not have access to a cloud environment and has restricted access to the company\u2019s network configuration.       </li> <li>The Administrator wants fine-grained control over the OpenShift installation process.</li> </ul> <p>Linux distribution in Openshift</p> <p>During the installation process. there will be different nodes:</p> <ul> <li>Bastion Node: used for administrative access</li> <li>Bootstrap Node: temporary, used only during installation.</li> <li>Master Nodes: runs control plane components.</li> <li>Worker Nodes: Runs applications and workloads.</li> </ul> <p>They all should use Redhat Linux distribution(e.g. in our tutorial <code>RHCOS</code>)</p> <p>Linux distribution: OC vs K8S</p> <ul> <li>While Kubernetes supports all cloud and Linux distributions, making it widely accessible to organizations using various platforms</li> <li>OpenShift supports only Red Hat distributions, such as Red Hat Enterprise Linux (RHEL), CentOS, and Fedora.</li> </ul>"},{"location":"cloud/openshift/do322/01/#1-installation-methods","title":"1. Installation Methods","text":"<p>Operations</p> <ul> <li>Day-0 - Planning &amp; Alignment: Architecture design, Tool selection, Infrastructure Planning, Security &amp; Compliance</li> <li>Day-1 - Deployment(Automation): Infrastructure provisioning, Code deployment, Database Setup, Security configurations</li> <li>Day-2 - Maintenance, Monitoring, and Optimization: Monitoring and Alerting, Incident response, Routine maintenance, Performance tuning</li> </ul> <p>To deploy an OpenShift Container Platform cluster, administrators must use the openshift-install binary. </p> <p>To deploy an OpenShift Container Platform cluster, administrators must use the <code>openshift-install</code> binary(a.k.a. The OpenShift Installer). This cmd then generates ignition configuration files\uff08\u5b57\u9762\u610f\u601d\uff1a\u70b9\u706b\u6587\u4ef6\uff09 for the bootstrap, control plane nodes, and compute nodes.</p> <p>where to find Ignition File?</p> <p>The ignition process loads the ignition file configuration files from one of the following locations:</p> <ul> <li>Local disk</li> <li>Cloud metadata</li> <li>Over the network using HTTP or HTTPS</li> </ul> <p>Danger</p> <p>The Ignition config files that the installation program generates contain certificates that expire after 24 hours, which are then renewed at that time. If the cluster is shut down before renewing the certificates and the cluster is later restarted after the 24 hours have elapsed, the cluster automatically recovers the expired certificates. The exception is that you must manually approve the pending node-bootstrapper certificate signing requests (CSRs) to recover kubelet certificates. See the documentation for Recovering from expired control plane certificates for more information.</p> <p>Consider using Ignition config files within 12 hours after they are generated, because the 24-hour certificate rotates from 16 to 22 hours after the cluster is installed. By using the Ignition config files within 12 hours, you can avoid installation failure if the certificate update runs during installation.</p> <p>Example of Ignition File</p> <p>For more information check here.</p> <pre><code>{\n\"ignition\": {\n    \"version\": \"3.1.0\"  # Ignition version\n},\n\"passwd\": {             # Configures SSH public keys for the user core.\n    \"users\": [\n    {\n        \"name\": \"core\",\n        \"sshAuthorizedKeys\": [\n        \"ssh-rsa AAA...hlw== lab@utility.lab.example.com\\n\",\n        \"ssh-rsa AAA...3DR\\n\"\n        ]\n    }\n    ]\n},\n\"storage\": {            # Storage section\n    \"files\": [\n    {\n...output omitted...\n    {\n        \"overwrite\": false,\n        \"path\": \"/etc/motd\",  # Appends to the /etc/motd file the base64 encoded source data.\n        \"user\": {\n        \"name\": \"root\"\n        },\n        \"append\": [\n        {\n            \"source\": \"data:text/plain;charset=utf-8;base64,VGh...lCg==\"\n        }\n        ],\n        \"mode\": 420\n    },\n...output omitted...\n\n# Creates a systemd service unit called `bootkube.service` that executes the script:\n#   `/usr/local/bin/bootkube.sh`\n\"systemd\": {\n    \"units\": [\n    {\n        \"contents\": \"[Unit]\\nDescription=Bootstrap a Kubernetes cluster\\nRequires=crio-configure.service\\nWants=kubelet.service\\nAfter=kubelet.service crio-configure.service\\nConditionPathExists=!/opt/openshift/.bootkube.done\\n\\n[Service]\\nWorkingDirectory=/opt/openshift\\nExecStart=/usr/local/bin/bootkube.sh\\n\\nRestart=on-failure\\nRestartSec=5s\\n\",\n        \"name\": \"bootkube.service\"\n    },\n...output omitted...\n    }\n    ]\n}\n}\n</code></pre> <p>By default, the data stored in ignition files is encoded in base64. For inspection, you can decode this data in plain text using the <code>base64 -d</code> command:</p> <pre><code>[user@demo ~]$ echo \"VGh...lCg==\" | base64 -d\nThis is the **bootstrap node**; it will be destroyed when the master is fully up.\nThe primary services are release-image.service followed by bootkube.service. To watch their status, run e.g.\n\n  journalctl -b -f -u release-image.service -u bootkube.service\n</code></pre> <p>Check the ignition configs used in the system: <pre><code>cat /boot/ignition/config.ign\n</code></pre></p> <p>Chekc the ignition logs: <pre><code>journalctl -t ignition\n</code></pre></p>"},{"location":"cloud/openshift/do322/01/#methods","title":"Methods","text":"<p>The OpenShift Installer offers the following installation methods:</p>"},{"location":"cloud/openshift/do322/01/#1-ipi-full-stack-automation","title":"1. IPI / Full-stack Automation","text":"<ul> <li>also called installer-provisioned infrastructure (IPI).</li> <li>administrators install OpenShift with minimal manual intervention in an opinionated manner.</li> <li>The OpenShift installer deploys the cluster on infrastructure that the installer provisions and the cluster maintains.</li> <li>The OpenShift installer controls all installation areas, including infrastructure provisioning</li> </ul>"},{"location":"cloud/openshift/do322/01/#2-upi-pre-existing-infrastructure","title":"2. UPI / Pre-existing Infrastructure","text":"<ul> <li>also called user-provisioned infrastructure (UPI).</li> <li>Administrators can use the OpenShift installer to deploy a cluster on infrastructure that they prepare and maintain themselves.</li> <li>Administrators are responsible for creating and managing their infrastructure</li> </ul> <p>IPI vs UPI</p> <p></p>"},{"location":"cloud/openshift/do322/01/#prerequisites","title":"Prerequisites","text":""},{"location":"cloud/openshift/do322/01/#general-prerequisites","title":"General Prerequisites","text":"<ul> <li>Provision a bastion host.</li> <li>Generate an SSH key on the bastion host: for remote access to the OpenShift nodes (bootstrap, master, and worker nodes)</li> <li>Download and install <code>openshift-install</code> on the bastion host.</li> <li>Download and install <code>oc</code> on the bastion host.</li> <li>Get the registry <code>pull-secret</code>.</li> <li>OpenShift cluster nodes must have access to a Network Time Protocol (NTP) server.</li> <li>Ensure that the infrastructure network firewall fulfills the OpenShift network access requirements.</li> </ul>"},{"location":"cloud/openshift/do322/01/#firewall-prerequisites","title":"Firewall Prerequisites","text":"<p>Some Ports+Protocol prerequisites for:</p> <ul> <li>Connectivity Requirements from All Cluster Nodes to All Cluster Nodes</li> <li>Connectivity Requirements from All Cluster Nodes to Control Plane Nodes</li> <li>API Load Balancer Ports</li> <li>Application Ingress Load Balancer Ports</li> </ul>"},{"location":"cloud/openshift/do322/01/#ipi-specific-prerequisites","title":"IPI specific Prerequisites","text":"<ul> <li>Verify infrastructure permissions and quotas.</li> <li>For cloud environments, a cloud account with required permissions and quotas is required.</li> </ul>"},{"location":"cloud/openshift/do322/01/#upi-specific-prerequisites","title":"UPI specific Prerequisites","text":"<ul> <li>Configure network services: DNS etc.</li> <li>Provide hardware (physical or virtual) for cluster nodes.</li> <li>Install RHCOS on cluster nodes.</li> </ul>"},{"location":"cloud/openshift/do322/01/#dns-service","title":"DNS service","text":"<p>When installing OpenShift using the UPI, one of the network services that administrators must configure is the DNS service. Administrators must configure the DNS service using DNS records. A complete DNS record takes the form <code>&lt;component&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</code>:</p> <ul> <li><code>&lt;cluster_name&gt;</code> is the name of the cluster (for instance ocp4).</li> <li><code>&lt;base_domain&gt;</code> is the cluster base domain configured in the <code>install-config.yaml</code> configuration file (for instance <code>example.com</code>).</li> <li>The reverse DNS records (PTR) are also required</li> </ul> <p>The following DNS Records are needed:</p> Component Record Description Kubernetes API <code>api.&lt;cluster_name&gt;.&lt;base_domain&gt;</code> DNS A/AAAA or CNAME and PTR records to identify the API load balancer for the control plane nodes (resolvable by both clients external to the cluster and from all the nodes within the cluster). Kubernetes API <code>api-int.&lt;cluster_name&gt;.&lt;base_domain&gt;</code> DNS A/AAAA or CNAME and PTR records to identify the API load balancer for the control plane nodes (resolvable from all the nodes within the cluster). Routes <code>*.apps.&lt;cluster_name&gt;.&lt;base_domain&gt;</code> Wildcard DNS A/AAAA or CNAME record to identify the Application Ingress load balancer that targets the cluster nodes that run the ingress router pod (resolvable by both clients external to the cluster and from all the nodes within the cluster). Cluster nodes <code>&lt;name&gt;.&lt;cluster_name&gt;.&lt;base_domain&gt;</code> DNS A/AAAA or CNAME and PTR records to identify each cluster node, including Bootstrap Node (resolvable by the nodes within the cluster). <p>BIND</p> <p>BIND(Berkeley Internet Name Domain) is one of the most widely used Domain Name System (DNS) server software. The BIND configuration is typically managed via two main files:</p> <ul> <li><code>named.conf</code>: The primary configuration file defining server settings, zones, and ACLs.</li> <li>Zone files: Contain the actual DNS records for each managed domain. File name and extension are defined in the <code>*.conf</code> file</li> </ul> <p><pre><code>[root@utility ~]# cat /etc/named.conf\n\n...output omitted...\nzone \"example.com\" {\n    type master;\n    file \"example.com.db\";\n    allow-update { none; };\n};\n</code></pre> The zone file <code>example.com.db</code> might looks like this:</p> <pre><code>[root@utility ~]# cat /var/named/example.com.db\n\n$TTL  1D\n@     IN  SOA dns.ocp4.example.com. root.example.com. (\n                2019022400 ; serial\n                3h         ; refresh\n                15         ; retry\n                1w         ; expire\n                3h         ; minimum\n            )\n            IN NS dns.ocp4.example.com.\ndns.ocp4      IN A 192.168.50.254\napi.ocp4      IN A 192.168.50.254\napi-int.ocp4  IN A 192.168.50.254\n*.apps.ocp4   IN A 192.168.50.254\nbootstrap.ocp4 IN A 192.168.50.9\nmaster01.ocp4 IN A 192.168.50.10\nmaster02.ocp4 IN A 192.168.50.11\nmaster03.ocp4 IN A 192.168.50.12\nworker01.ocp4 IN A 192.168.50.13\nworker02.ocp4 IN A 192.168.50.14\n</code></pre> <p>Setup and enable BIND</p> <ol> <li>install Bind</li> <li>Create config file and zone file</li> <li>update file permission</li> <li>restart Bind</li> <li>Test the config:     <pre><code>&lt;!-- Check the configuration syntax: --&gt;\nsudo named-checkconf\n\n&lt;!-- Check zone files --&gt;\nsudo named-checkzone example.com /var/named/example.com.zone\n\n&lt;!-- Query DNS Server --&gt;\ndig @localhost example.com\ndig @localhost -x 192.168.0.1\n</code></pre></li> </ol> <p>Warning</p> <p>By default, when installing OpenShift using the full-stack automation method on supported cloud providers, the OpenShift installer automatically performs the DNS service configuration.</p> <p>Administrators must configure the DNS service when installing OpenShift using the full-stack automation method on the following infrastructures:</p> <ul> <li>(Cloud) Red Hat OpenStack Platform cloud provider using an external DNS</li> <li>(Virtual) VMware vSphere</li> <li>(Physical) Bare metal</li> </ul>"},{"location":"cloud/openshift/do322/01/#installation-modes","title":"Installation Modes","text":"<p>Depending on the external connectivity of the cluster, administrators can use one of the following installation modes:</p>"},{"location":"cloud/openshift/do322/01/#1-connected","title":"1. Connected","text":"<p>The cluster nodes have internet access to pull container images from the <code>quay.io</code> and <code>registry.redhat.io</code> registries. The connected installation mode is supported when using the full-stack automation (IPI) or the pre-existing infrastructure installation (UPI) methods.</p>"},{"location":"cloud/openshift/do322/01/#2-disconnected","title":"2. Disconnected","text":"<p>Administrators use this installation mode when a connected installation is not possible. The OpenShift installer uses a local container registry to pull container images. \u27a1\ufe0f Not all cloud providers support installation in disconnected mode.</p> <ol> <li>mirror the required images to the local container registry and obtain the imageContentSources data for your OpenShift version</li> <li>start OpenShift Installation Process, you can customize <code>install-config.yaml</code> file</li> </ol>"},{"location":"cloud/openshift/do322/01/#2-cluster-installation","title":"2. Cluster Installation","text":"<p>\u65e0\u8bba\u662f UPI \u8fd8\u662f IPI, \u90fd\u6709\u4e00\u4e2a\u6b65\u9aa4\u662fInstaller\u5b8c\u6210\u7684\uff0c\u90a3\u5c31\u662f Cluster Installation. \u8be5\u6b65\u9aa4\u7684\u5177\u4f53\u539f\u7406\u89c1\u8fd9\u91cc\u3002</p> <p>\u9700\u8981\u7684\u6267\u884c\u6b65\u9aa4\u6709\uff1a</p> <ol> <li>Fulfill the installation prerequisites.</li> <li>Create the installation directory.This directory stores all the files created by the OpenShift installer. <pre><code>[user@demo ~]$ mkdir ${HOME}/ocp4-cluster\n</code></pre></li> <li>Create config YAML file. Use the Openshift Installer to create the configuration file (<code>install-config.yaml</code>), and save it in the folder <code>/ocp4-cluster</code>: <pre><code># generate a cluster SSH public key `ocp4-cluster.pub`\n# \u26a0\ufe0f The **cluster SSH key** enables access from the bastion host to the cluster nodes!\nssh-keygen -t rsa -b 4096 -N '' -f ${HOME}/.ssh/ocp4-cluster\n</code></pre> Use the SSH key in the <code>install-config.yaml</code> file generation <pre><code>[user@demo ~]$ openshift-install create install-config \\\n&gt; --dir=${HOME}/ocp4-cluster\n? SSH Public Key /home/user/.ssh/ocp4-cluster.pub\n? Platform aws\nINFO Credentials loaded from the \"default\" profile in file \"/home/user/.aws/credentials\"\n? Region us-east-2\n? Base Domain mydomain.com\n? Cluster Name ocp4\n? Pull Secret [? for help] +++++\nINFO Install-Config created in: /home/user/ocp4-cluster\n</code></pre></li> <li> <p>Generate the Kubernetes manifests. A Kubernetes manifest is a file that describes one or more Kubernetes API objects, such as Pods, Services, Deployments or MachineConfigs. This cmd takes the <code>install-config.yaml</code> as input, and gerates manifest under the folder <code>/home/user/ocp4-cluster/manifests</code> and <code>/home/user/ocp4-cluster/openshift</code>:     <pre><code>openshift-install create manifests \\\n    &gt; --dir=${HOME}/ocp4-cluster\n</code></pre></p> <p>Manifest customization</p> <p>You can ONLY modify the manifest if its documented in Redhat support instruction. No free styles pls</p> </li> <li> <p>Generate the ignition configuration files. This cmd generates ignition files (<code>master.ign</code>, <code>worker.ign</code>, <code>bootstrap.ign</code>) under the folder <code>/home/user/ocp4-cluster</code>:     <pre><code>openshift-install create ignition-configs \\\n    &gt; --dir=${HOME}/ocp4-cluster\n</code></pre></p> <p>Ignition files valid time period</p> <p>Ignition files are valid for 24 hours, after which the included certificates expire. If so, create new ignition files.</p> <p>ignition file customization</p> <p>You can ONLY modify the ignition file if its documented in Redhat support instruction. No free styles pls </p> </li> <li> <p>(Only in IPI) Deploy the OpenShift cluster.      <pre><code>openshift-install create cluster \\\n&gt; --dir=${HOME}/ocp4-cluster --log-level=debug\n</code></pre></p> <p>Skip step 6 in UPI Environment</p> <p>In a UPI / pre-existing infrastructure installation, you don't nned to run the <code>openshift-install create cluster</code> command, because you have already:</p> <ul> <li>Installed RHCOS on the cluster nodes (masters, workers, and bootstrap).</li> <li>Set up networking, storage, and load balancers.</li> <li>Configured DNS, ignition files, and more.</li> </ul> <p>Therefore, just do the following to observe the installation:</p> <pre><code>openshift-install wait-for bootstrap-complete \\\n    &gt; --dir=${HOME}/ocp4-cluster --log-level=debug\n\nopenshift-install wait-for install-complete \\\n    &gt; --dir=${HOME}/ocp4-cluster --log-level=debug\n</code></pre> </li> <li> <p>Verify the OpenShift cluster health. You can start using the <code>oc</code> command once the Bootstrap has the Kubernetes API running on the temporary control plane.</p> <pre><code># 1. Configuring the KUBECONFIG environment variable to use the kubeconfig file.\nexport KUBECONFIG=${HOME}/ocp4-cluster/auth/kubeconfig\n\n# 2. Using the kubeadmin credentials stored in the kubeadmin-password file.\n\n# 3. Login to the Kubernetes API as cluster-admin\noc login -u cluster-admin -p [PASSWORD]\n\n# 4. monitoring:\n# the installation process\nwatch 'oc get clusterversion; oc get clusteroperators; \\\n    &gt; oc get pods --all-namespaces | grep -v -E \"Running|Completed\"; oc get nodes'\n\n# how the cluster version operator (CVO) installs the cluster operators\nwatch 'oc get clusterversion; oc get clusteroperators; \\\n    &gt; oc get pods --all-namespaces | grep -v -E \"Running|Completed\"; oc get nodes'\n\n# print events\noc get events -A -w\n</code></pre> </li> </ol> <p>Warning</p> <p>Kubernetes manifests and ignition configuration files are created automatically in the create cluster step, if they do not exist already. (True or False)</p>"},{"location":"cloud/openshift/do322/01/#3-troubleshooting","title":"3. Troubleshooting","text":"<p>Stages</p> <p>The cluster installation has 3 main stages:</p> <ol> <li>Bootstrap(Bootkube) Stage:<ul> <li>The OpenShift installation process deploys the bootstrap node. </li> <li>The <code>release-image</code> systemd service running on the Bootstrap Node downloads the container images required to start the temporary control plane.</li> <li><code>bootkube</code> systemd service running on the Bootstrap Node starts the temporary control plane.</li> </ul> </li> <li>Bootstrap(Temporary Control Plane) Stage<ul> <li>The Kubernetes API and the temporary control plane are running on the bootstrap node. </li> <li>the Bootstrap Node waits until the control plane nodes boot and form an etcd cluster. </li> <li>the Bootstrap Node schedules the production control plane to the control plane nodes.</li> </ul> </li> <li>Production Control Plane Stage:      After the production control plane runs on the control plane nodes, the cluster version operator (CVO) finishes the OpenShift cluster deployment.</li> </ol>"},{"location":"cloud/openshift/do322/01/#1-bootstrapbootkube-stage","title":"1. Bootstrap(Bootkube) Stage","text":"<p>At this stage, the Kubernetes API is not yet available, use <code>ssh</code> to get logs</p> <p>Assumes that <code>192.168.50.9</code> is the Bootstrap Node IP address. Use the cluster SSH private key to connect to the Bootstrap Node from the bastion host:</p> <pre><code># login to Bootstrap Node\nssh -i ${HOME}/.ssh/ocp4-cluster core@192.168.50.9\n\n# debug two services: release-image &amp; bootkube\njournalctl -b -f -u release-image.service -u bootkube.service\n\n# use `crictl` command on the **Bootstrap Node** to look for failed containers and print their logs:\nsudo bash\ncrictl ps -a\ncrictl ps logs &lt;container_id&gt;\n</code></pre>"},{"location":"cloud/openshift/do322/01/#2-bootstraptemporary-control-plane-stage","title":"2. Bootstrap(Temporary Control Plane) Stage","text":"<p>Here, the Kubernetes API is available on the Bootstrap Node --&gt; You can use <code>SSH</code> to get logs from the Bootstrap Node with the following config:</p> <pre><code># export login config\nexport KUBECONFIG=${HOME}/ocp4-cluster/auth/kubeconfig\n</code></pre>"},{"location":"cloud/openshift/do322/01/#download-log","title":"download log","text":"<pre><code># pull log from bootstrap machine to a *.tar.gz file\nopenshift-install gather bootstrap \\\n    &gt; --dir=${HOME}/ocp4-cluster\n\n# unzip and check the log\ncd ocp4-cluster \ntar -xvzf log-bundle-20210107135825.tar.gz\ncd log-bundle-xxxx\n# check the log of the bootstrap systemd services\nls bootstrap/journals/\n# check the bootstrap containers\nls bootstrap/containers/\n# check the control plane nodes,\nls control-plane/\n</code></pre> <p>UPI for <code>openshift-install gather</code></p> <p>when using UPS, you must specify the IP addresses of the bootstrap and control plane nodes when running the <code>openshift-install gather</code> bootstrap command.</p> <pre><code>openshift-install gather bootstrap \\\n    &gt; --dir=${HOME}/ocp4-cluster \\\n    &gt; --bootstrap &lt;bootstrap_address&gt; \\\n    &gt; --master &lt;master_1_address&gt; \\\n    &gt; --master &lt;master_2_address&gt; \\\n    &gt; --master &lt;master_3_address&gt;\" \n</code></pre>"},{"location":"cloud/openshift/do322/01/#check-log-in-cluster","title":"check log in cluster","text":"<pre><code>oc get nodes\noc get clusterversion\noc get clusteroperators\n\noc get events -A -w\noc adm node-logs -u crio master01\noc adm node-logs -u kubelet master01\n\noc debug node/master01\n# after starting the debug node, you can do:\nsh-4.2# chroot /host\nsh-4.2# journalctl -f\nsh-4.2# sudo bash\nsh-4.2# crictl ps -a\nsh-4.2# crictl logs &lt;container_id&gt;\n</code></pre> <p>crio &amp; kubelet</p> <p>The OpenShift cluster nodes run very few local services because most of the system services run as containers. The main exceptions are the <code>cri-o</code> container engine and the <code>kubelet</code>, which are systemd service units.</p>"},{"location":"cloud/openshift/do322/01/#4-verifying-installation","title":"4. Verifying Installation","text":"<p>Checklist</p>"},{"location":"cloud/openshift/do322/01/#6-hosted-openshift","title":"6. Hosted Openshift","text":"<p>OpenShift can be installed using either IPI or UPI methods, and both options can be used on either on-premise data centers or IaaS cloud providers.</p>"},{"location":"cloud/openshift/do322/01/#iaas-cloud-providers-that-can-host-openshift","title":"IaaS cloud providers that can host Openshift","text":"Hosted offering Cloud hosted Billed by Managed by Supported by Doc Microsoft Azure Red Hat OpenShift Azure Microsoft Red Hat and Microsoft Red Hat and Microsoft Doc Red Hat OpenShift Dedicated AWS or GCP Red Hat (OpenShift), AWS or GCP (Infrastructure) Red Hat Red Hat Doc Red Hat OpenShift on IBM Cloud IBM Cloud IBM IBM Red Hat and IBM Doc Red Hat OpenShift Service on AWS AWS AWS Red Hat and AWS Red Hat and AWS Doc"},{"location":"cloud/openshift/do322/01/#oc-adm","title":"oc adm","text":"<p>reference</p>"},{"location":"cloud/openshift/do322/02/","title":"2. IPI on Cloud","text":""},{"location":"cloud/openshift/do322/02/#ipi-on-a-cloud-provider","title":"IPI on a Cloud Provider","text":"<p>When using IPI on a supported IaaS cloud provider, the installer automatically provisions the following:</p> <ul> <li>OS images</li> <li>VMs or cloud instances</li> <li>Load balancers</li> <li>Storage</li> <li>Networking</li> </ul> <p>Why IPI?</p> <p>On supported cloud providers, Red Hat recommends using IPI, why?</p> <ul> <li>minimal intervention</li> <li>installer auto-creates required resources </li> <li>installer fully integrates the OpenShift Machine API resource with the cloud provider services.<ul> <li><code>MachineSets</code> enables automatic node provisiong, cluster autoscaling</li> </ul> </li> </ul> <p>UPI</p> <p>Administrators can also install OpenShift using the pre-existing infrastructure method on a cloud provider. Using this approach, administrators must create manually the required cloud resources before installing OpenShift, for examples: EC2 Instances, Network Resources (VPC, Subnet etc), Elastic Block Store (EBS) volumes, IAM</p>"},{"location":"cloud/openshift/do322/02/#cloud-provider-services-used-during-an-openshift-ipi","title":"Cloud Provider Services Used During an OpenShift IPI","text":"<p>Each cloud provider uses specific terminology to refer to different services used during the installation - Terminology Table of Cloud Providers:</p> OpenShift resources AWS provider RHOSP(Red Hat OpenStack Platform) provider Azure provider GCP provider Internal registry storage Amazon S3 Swift Azure Blob Google Cloud Object Storage Persistent volume Amazon EBS Cinder Azure Disk Google Cloud Block Storage RHCOS images Amazon AMI Glance Azure Images (VHD) Google Compute Engine Images Networking Amazon VPC Neutron Azure VNet Google VPC SDN / OVN Amazon VPC Neutron + Kuryr Azure VNet Google VPC Load balancer Amazon ELB Static pods/Octavia LBaaS Azure LB Google Networking Suites DNS Amazon Route53 External Azure DNS Google Cloud DNS Compute instances Amazon EC2 Nova Azure Compute Google Compute Engine"},{"location":"cloud/openshift/do322/02/#ipi-on-aws","title":"IPI on AWS","text":""},{"location":"cloud/openshift/do322/02/#prerequisites","title":"Prerequisites","text":"<p>Before installing OpenShift on MS Azure, administrators must perform the following actions (details check here):</p> <ol> <li>Review the general and full-stack automation prerequisites described in the Describing OpenShift Installation Prerequisites lecture.</li> <li>Create a public DNS hosted zone for the cluster in the Azure DNS service, if it does not already exist. This zone must be authoritative for the domain.</li> <li>Use an Azure Identity and Access Management (IAM) user account to run the installation. This account must have the User Access Administrator role permission.</li> <li>Ensure that the IAM Azure account fulfills the required quotas and permissions to install OpenShift.</li> <li>Create a service principal for representing the OpenShift installer in the Azure Resource Manager.</li> <li>Verify the supported Azure regions. The OpenShift installer dynamically generates a list of available Azure regions based on the MS Azure account subscription.</li> <li>Check the Azure resource name restrictions.</li> </ol>"},{"location":"cloud/openshift/do322/02/#sizing","title":"Sizing","text":"<p>Azure Limits That Can Impact the Ability to Install and Run a \"small\" OpenShift Clusters:</p> Resource Required Default Azure limit vCPU 40 20 per region -&gt; to increase it, check here VNet 1 1000 per region Network interfaces 6 65536 Network security groups 2 5000 Network load balancers 3 1000 per region Public IP addresses (PIP) 3 - Private IP addresses 7 - <p>By default, the virtual machine (VM) sizes used on an OpenShift installation on Azure are <code>Standard_D8s_v3</code> for Controlplane nodes and <code>Standard_D4s_v3</code> for compute nodes. --&gt; use bigger VM for production!</p>"},{"location":"cloud/openshift/do322/02/#what-does-intaller-do-in-ipi","title":"What does Intaller do in IPI?","text":"<ol> <li>Resource Creation Stage</li> </ol> <p>the OpenShift installer creates and configures the required cloud resources: (refer to the Terminology Table)</p> <p></p> <ol> <li>Bootstrap Stage</li> </ol> <p>the bootstrap node runs the Kubernetes API and the temporary control plane. The OpenShift installer begins to install the cluster nodes.</p> <p></p> <ol> <li>Production Control Plane Stage</li> </ol> <p>At this stage, the Kubernetes API and the production control plane are running on the control plane nodes. The cluster version operator (CVO), running on the production control plane, installs the operators that build the cluster and then finishes the installation.</p> <p></p>"},{"location":"cloud/openshift/do322/02/#ipi-on-rhosp","title":"IPI on RHOSP","text":"<p>When installing OpenShift on a Red Hat OpenStack Platform (RHOSP), Red Hat recommends using the Kuryr SDN(Software-defined networking). </p> <p>Kuryr</p> <p>Kuryr is a container network interface (CNI) plug-in solution. It uses the Neutron and Octavia RHOSP services to provide networking for pods and services. Advantages:</p> <ul> <li>Improves the network performance by plugging OpenShift pods into the RHOSP SDN directly.</li> <li>Provides internal connectivity between pods and RHOSP virtual instances.</li> <li>Avoids network traffic double encapsulation.</li> </ul>"},{"location":"cloud/openshift/do322/02/#prerequisites_1","title":"Prerequisites","text":""},{"location":"cloud/openshift/do322/02/#sizing_1","title":"Sizing","text":""},{"location":"cloud/openshift/do322/02/#verifying-ipi-on-aws","title":"Verifying IPI on AWS","text":""},{"location":"cloud/openshift/do322/03/","title":"3. IPI & UPI on Virtual","text":""},{"location":"cloud/openshift/do322/03/#oc-installation-on-hypervisors","title":"OC Installation on Hypervisors","text":""},{"location":"cloud/openshift/do322/03/#hypervisor","title":"Hypervisor","text":"<p>Hypervisor = virtual machine monitor\uff08VMM\uff09= \u865a\u62df\u673a\u76d1\u89c6\u5668\uff0c\u662f\u7528\u6765\u5efa\u7acb\u4e0e\u6267\u884c\u865a\u62df\u673a\u7684\u8f6f\u4ef6\u3001\u56fa\u4ef6\u6216\u786c\u4ef6\u3002</p> <p>Prior to the adoption of hypervisors, physical computers only leveraged one operating system. Although this resulted in a stable physical server that could effectively and efficiently handle requests from a single operating system, unused resources were wasted. The hypervisor provides a software layer that enables multiple operating systems to run in parallel.</p> <p>A hypervisor is a specific layer of software that builds and runs virtual machines. A hypervisor is sometimes called a virtual machine (VM) monitor due to its operating system isolation features.</p> <p>Virtualization hypervisors are categorized into 2 types:</p>"},{"location":"cloud/openshift/do322/03/#1-native-hypervisor-bare-metal-hypervisor","title":"1. Native Hypervisor / Bare Metal Hypervisor","text":"<p>\u539f\u751f\u6216\u88f8\u673a hypervisor\uff1a\u8fd9\u4e9b\u865a\u62df\u673a\u7ba1\u7406\u7a0b\u5e8f\u76f4\u63a5\u8fd0\u884c\u5728\u7269\u7406\u670d\u52a1\u5668\u7684\u786c\u4ef6\u4e0a\uff0c \u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u5e95\u5c42\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u800c\u662f\u76f4\u63a5\u63a7\u5236CPU\u3001\u5185\u5b58\u3001\u5b58\u50a8\u548c\u7f51\u7edc\u8d44\u6e90\u3002\u7279\u70b9\uff1a</p> <ul> <li>\u9700\u8981\u786c\u4ef6\u652f\u6301</li> <li>\u865a\u62df\u673a\u76d1\u89c6\u5668\u4f5c\u4e3a\u4e3b\u64cd\u4f5c\u7cfb\u7edf</li> <li>\u8fd0\u884c\u6548\u7387\u9ad8</li> </ul> <p>\u4e3e\u4f8b\uff1a</p> <ul> <li>RHV</li> <li>Microsoft Hyper-V</li> <li>vSphere ESXi</li> </ul> <p>\u9002\u7528\u4e8e\uff1a</p> <ul> <li>\u4f01\u4e1a\u7ea7\u6570\u636e\u4e2d\u5fc3\u3001\u4e91\u8ba1\u7b97\u5e73\u53f0\uff08\u5982 OpenShift \u8fd0\u884c\u5728 vSphere\u3001OpenStack \u4e0a\uff09\u3002</li> </ul> <p></p>"},{"location":"cloud/openshift/do322/03/#2-hosted-hypervisor","title":"2. Hosted Hypervisor","text":"<p>\u5bc4\u5c45\u6216\u6258\u7ba1 hypervisor\uff1a \u4f5c\u4e3a\u7ba1\u7406\u7a0b\u5e8f\uff0c\u8fd0\u884c\u5728\u5df2\u6709\u7684\u64cd\u4f5c\u7cfb\u7edf\uff08\u5982 Windows\u3001Linux\u3001macOS\uff09\u4e4b\u4e0a\uff0c\u5c31\u50cf\u5176\u4ed6\u8ba1\u7b97\u673a\u7a0b\u5e8f\u90a3\u6837\u8fd0\u884c\u3002\u5b83\u4f9d\u8d56\u5e95\u5c42\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u8d44\u6e90\u8c03\u5ea6\uff0c\u56e0\u6b64\u4e0d\u50cf\u88f8\u91d1\u5c5e Hypervisor \u90a3\u6837\u76f4\u63a5\u4e0e\u786c\u4ef6\u4ea4\u4e92\u3002</p> <p>\u7279\u70b9\uff1a</p> <ul> <li>\u865a\u62df\u673a\u76d1\u89c6\u5668\u4f5c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728\u4e3b\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u5185</li> <li>\u8fd0\u884c\u6548\u7387\u4e00\u822c\u6bd4 native hypervisor \u4f4e</li> </ul> <p>\u4e3e\u4f8b\uff1a</p> <ul> <li>VMware workstation</li> <li>Oracle VirtualBox</li> </ul> <p>\u9002\u7528\u4e8e\uff1a</p> <ul> <li>\u5f00\u53d1\u548c\u6d4b\u8bd5\uff1a\u56e0\u4e3a\u5b83\u8fd0\u884c\u5728\u5df2\u6709\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u53ef\u4ee5\u8f7b\u677e\u521b\u5efa\u548c\u5220\u9664 VM\uff0c\u4e0d\u5f71\u54cd\u4e3b\u673a\u7cfb\u7edf\u3002</li> <li>\u4e2a\u4eba\u7528\u6237</li> </ul> <p>Note</p> <p>On supported hypervisors, Red Hat recommends using the IPI method for the following reasons:</p> <ul> <li>minimal intervention</li> <li>Installer \u505a\u8fd9\u4e9b\u4e8b\u60c5\uff1a<ul> <li>creates Virtual Machines</li> <li>installs Red Hat Enterprise Linux CoreOS (<code>RHCOS</code>)</li> <li>starts the OpenShift install process</li> <li>uses the credentials provided to connect to the virtualization management services(a.k.a. hypervisors), upload a template, then clone that template to be used for the bootstrap and control plane nodes.</li> <li>fully integrates the OpenShift Machine API resource with the virtualization management services(a.k.a. hypervisors), it automatically creates <code>MachineSets</code></li> <li>The Only DNS requirement are two entries, Ingress and k8s/openshift API(<code>oc</code>/<code>k8s</code>).</li> </ul> </li> </ul> <p>OpenShift Machine API</p> <p>Doc: Machine API overview</p> <p>The Machine API performs all node host provisioning management actions after the cluster installation finishes.</p> <p>There are 2 primary resources:</p> <ol> <li><code>Machines</code>: A fundamental unit that describes the host for a Node.</li> <li><code>MachineSets</code>: Group of <code>Machines</code>. <code>MachineSets</code> are to <code>machines</code> as <code>ReplicaSets</code> are to <code>Pods</code>.</li> </ol> <p>And some optional custom resources:</p> <ul> <li><code>MachineAutoscaler</code></li> <li><code>ClusterAutoscaler</code></li> <li><code>MachineHealthCheck</code></li> </ul> <p>A successful deployment of OpenShift Container Platform also requires other services besides the hypervisor, such as a traffic load balancer or DNS zone management.</p>"},{"location":"cloud/openshift/do322/03/#ipi-on-vsphere","title":"IPI on vSphere","text":""},{"location":"cloud/openshift/do322/03/#upi-on-vsphere","title":"UPI on vSphere","text":""},{"location":"cloud/openshift/do322/04/","title":"4. UPI without Infrastructure Provider","text":"<p>without Infrastructure Provider == UPI == installing OpenShift in a way that does NOT leverage automation/direct management of infrastructure resources such as networking, storage, or compute provisioning. The underlying infrastructure could be Physical, Virtual or Cloud-based</p>"},{"location":"cloud/openshift/do322/04/#prepare-oc-installation-without-infrastructure-provider","title":"Prepare: OC Installation without Infrastructure Provider","text":""},{"location":"cloud/openshift/do322/04/#configure-network-services-host-without-infrastructure-provider","title":"Configure Network Services &amp; Host without Infrastructure Provider","text":""},{"location":"cloud/openshift/do322/04/#oc-installation-without-infrastructure-provider","title":"OC Installation without Infrastructure Provider","text":""},{"location":"cloud/openshift/do322/05/","title":"5. Operations & Maintainance","text":""},{"location":"cloud/openshift/do322/05/#day-1-and-day-2-operations","title":"Day 1 and Day 2 Operations","text":""},{"location":"cloud/openshift/do322/05/#replacing-controlplane-node","title":"Replacing Controlplane Node","text":""},{"location":"cloud/openshift/do322/installation_process/","title":"Installation process","text":"<p>Step 1: The user runs the OpenShift installer. The installer asks for the necessary cluster information and then creates the installation configuration file <code>install-config.yaml</code> accordingly.</p> <p></p> <p>Step 2: From the <code>install-config.yaml</code> installation configuration file content, the OpenShift installer creates the Kubernetes manifests. The Kubernetes manifests contain the necessary instructions to build the resources for the OpenShift installation.</p> <p></p> <p>Step 3: From the manifests content, the OpenShift installation process creates the ignition configuration files for the bootstrap node <code>bootstrap.ign</code>, control plane nodes <code>master.ign</code>, and compute nodes <code>worker.ign</code>.</p> <p></p> <p>Step 4: The bootstrap node boots and fetches its remote resources (<code>bootstrap.ign</code>) from the initial ignition data source, and then finishes booting. \u27a1\ufe0f At this stage, the Kubernetes API is running on the bootstrap node. The bootstrap node hosts the remote resources required for control plane nodes to boot (ignition configuration files) in the Machine Configuration Server (MCS). It also runs a single instance of the etcd cluster.</p> <p></p> <p>Step 5: The control plane nodes boot and fetch their remote resources (the master.ign ignition configuration file) from the bootstrap node, and then finish booting.</p> <p></p> <p>Step 6: The bootstrap node starts a temporary control plane and installs the etcd operator.</p> <p></p> <p>Step 7: The etcd operator running on the bootstrap node scales up the etcd cluster to 3 instances using two control plane nodes.</p> <p></p> <p>Step 8: The temporary control plane running on the bootstrap node schedules the production control plane to the control plane nodes. The OpenShift installation process transfers the etcd cluster to the control plane nodes.</p> <p></p> <p>Step 9: The temporary control plane shuts down, yielding to the production control plane. At this stage, the Kubernetes API is running on the production control plane.</p> <p></p> <p>Step 10: For full-stack automation installations, the installer shuts down the bootstrap node. Since this stage, the bootstrap node is no longer needed.</p> <p></p> <p>Step 11: At this stage, the Production Control Plane hosts the cluster remote resources (ignition configuration files) for Control Plane Nodes and Compute Nodes in their MCS.</p> <p>The Compute Nodes boot and fetch their remote resources (the worker.ign ignition configuration file) from the control plane nodes, finish booting, and join the cluster.</p> <p>Notice</p> <ul> <li>Red Hat only supports the use of 3 control plane nodes.</li> <li>Red Hat has tested a maximum of 2000 compute nodes on a Red Hat OpenShift Container Platform 4.6 cluster.</li> <li>Red Hat recommends the use of at least two compute nodes to ensure the high availability of the applications running on the cluster.</li> <li>For more information, refer to the Planning your environment according to object maximums section of the Red Hat OpenShift Container Platform 4.6 documentation at https://access.redhat.com/documentation/en-us/openshift_container_platform/4.6/html-single/scalability_and_performance</li> </ul>"},{"location":"cloud/openshift/installation/","title":"Intro","text":""},{"location":"cloud/openshift/installation/#installation-methods","title":"Installation Methods","text":"<p>Reference: https://www.redhat.com/zh/blog/red-hat-openshift-disconnected-installations</p> <p>There are 4 installation methods. Under each methods there are installation options</p>"},{"location":"cloud/openshift/installation/#1-interactive","title":"1. Interactive","text":"<p>deploy cluster with a web-based Assisted Installer. \u9002\u5408\u8fde\u63a5\u5230\u4e92\u8054\u7f51\u7684\u73af\u5883\u3002</p> <p>focus on bare metal, Nutanix, vSphere, and Oracle Cloud Infrastructure. The Assisted Installer also supports various CPU architectures, including x86_64, s390x (IBM Z\u00ae), arm64, and ppc64le (IBM Power\u00ae).</p> <p>Basic steps</p> <p>Check a walk-through video here</p> <ol> <li>Configure the web-based Assisted Installer<ul> <li>The cluster configurator</li> </ul> </li> <li>Generate url to download ISO(Optical Disc Image)</li> <li>Put the downloaded ISO in a HTTP server</li> <li>When creating a Machine(Node), mount the ISO image from your HTTP server </li> <li>Power on the Node</li> <li>back to web-based Assisted Installer to see Nodes populating in the the Host Inventory List</li> </ol>"},{"location":"cloud/openshift/installation/#2-local-agent-based","title":"2. Local Agent-based","text":"<p>\u9700\u8981\u5148\u4e0b\u8f7d\u5e76\u914d\u7f6eAgent-based Installer\uff0c\u914d\u7f6e\u901a\u8fc7\u547d\u4ee4\u884c\u5b8c\u6210\u3002\u9002\u7528\u4e8e\u65ad\u5f00\u8fde\u63a5\u7684\u73af\u5883\u6216\u53d7\u9650\u7f51\u7edc\u3002</p> <p>-&gt; \u4e0eweb-based Assisted Installer\u7c7b\u4f3c\uff0c\u4f46\u4e0d\u8054\u7f51</p>"},{"location":"cloud/openshift/installation/#3-ipi","title":"3. IPI","text":"<p>Installer-Provisioned Infrastructure</p> <ul> <li>OpenShift installer automates the provisioning of infrastructure.</li> <li>Less manual control over node placement, networking, and resource assignment.</li> <li>Customizations, such as ensuring site affinity, require post-install configuration or creative use of installer features (e.g., node labels, taints).</li> </ul> <p>Note</p> <p>This method has the following installation options:</p> <ul> <li>Default </li> <li>Custom</li> <li>Network customization </li> <li>Restricted network</li> <li>Private clusters</li> <li>Existing virtual private networks</li> <li>Government region </li> <li>Secret regions </li> <li>China regions</li> </ul>"},{"location":"cloud/openshift/installation/#4-upi","title":"4. UPI","text":"<p>User-Provisioned Infrastructure</p> <ul> <li>You are responsible for provisioning the underlying infrastructure (e.g., VMs, networking, storage) before installing OpenShift.</li> <li>Offers full control over how nodes are distributed across sites, which allows:<ul> <li>Pre-assigning nodes to specific data centers or availability zones.</li> <li>Customizing networking, storage, and VM placement based on your requirements.</li> </ul> </li> </ul> <p>Note</p> <p>This method has the following installation options:</p> <ul> <li>Custom</li> <li>Network customization</li> <li>Restricted network </li> <li>Shared VPC hosted outside of cluster project</li> </ul>"},{"location":"cloud/openshift/installation/#interactive-vs-ipi","title":"Interactive vs IPI","text":"\u65b9\u9762 Web-based Assisted Installer IPI (Installer-Provisioned Infrastructure) \u63a7\u5236\u6743 \u7531 Red Hat \u63d0\u4f9b\u7684 \u6258\u7ba1\u670d\u52a1\uff0c\u5b89\u88c5\u8fc7\u7a0b\u53d1\u751f\u5728 web \u754c\u9762\u4e2d\uff0c\u7528\u6237\u53ea\u9700\u63d0\u4f9b\u57fa\u672c\u4fe1\u606f\u3002 \u7528\u6237\u5728\u672c\u5730\u6216\u4e91\u7aef\u8fd0\u884c openshift-install\uff0c\u5b8c\u5168\u63a7\u5236\u6574\u4e2a\u96c6\u7fa4\u7684\u90e8\u7f72\u8fc7\u7a0b\u3002 \u90e8\u7f72\u73af\u5883 \u9002\u7528\u4e8e\u88f8\u91d1\u5c5e\uff08Bare Metal\uff09\u73af\u5883\uff0cRed Hat OpenShift Assisted Installer \u8d1f\u8d23 PXE \u542f\u52a8\u3001\u5f15\u5bfc\u5b89\u88c5\u7b49\u3002 \u9002\u7528\u4e8e \u4e91\uff08AWS, GCP, Azure\uff09\u6216 vSphere \u7b49 IPI \u652f\u6301\u7684\u5e73\u53f0\uff0c\u7531 openshift-install \u76f4\u63a5\u7ba1\u7406\u8d44\u6e90\u521b\u5efa\u3002 \u57fa\u7840\u8bbe\u65bd\u51c6\u5907 \u81ea\u52a8\u5f15\u5bfc\u8282\u70b9\uff08bootstrap\uff09\u3001\u5206\u914d IP\u3001\u5b89\u88c5 OpenShift\uff0c\u7528\u6237\u51e0\u4e4e\u4e0d\u9700\u8981\u624b\u52a8\u64cd\u4f5c\u3002 openshift-install \u81ea\u52a8\u521b\u5efa\u6240\u9700\u7684\u57fa\u7840\u8bbe\u65bd\uff08\u5982 VMs\u3001\u7f51\u7edc\u3001\u5b58\u50a8\u7b49\uff09\uff0c\u4f46\u9700\u8981\u7528\u6237\u63d0\u4f9b cloud \u8bbf\u95ee\u6743\u9650\u3002 \u9002\u7528\u573a\u666f \u4e3b\u8981\u7528\u4e8e\u88f8\u91d1\u5c5e\u90e8\u7f72\uff0c\u7279\u522b\u9002\u5408\u6ca1\u6709 PXE \u6216 DHCP \u7684\u73af\u5883\uff0c\u9002\u5408 PoC \u548c\u751f\u4ea7\u73af\u5883\u3002 \u9002\u7528\u4e8e\u4e91\u7aef\u6216\u865a\u62df\u5316\u73af\u5883\uff0c\u662f OpenShift \u5728\u516c\u6709\u4e91\u4e0a\u7684\u5b98\u65b9\u63a8\u8350\u5b89\u88c5\u65b9\u5f0f\u3002"},{"location":"cloud/openshift/installation/#methods-x-platform","title":"Methods x Platform","text":"<p>not in all the Platforms can do all the Installation Options. Check the table </p> <p>-&gt; Supported installation methods for different platforms</p>"},{"location":"cloud/openshift/installation/#failure-domain","title":"Failure Domain","text":"<p>There are 2 ways to configure Failure Domain:</p> <ol> <li>Before Install, add customization to <code>install-config.yaml</code></li> <li>After Install, modify the <code>infrastructures.config.openshift.io</code> resource</li> </ol> <p>Comparison: pre vs post</p> Feature install-config.yaml (Before Install) infrastructures.config.openshift.io (After Install) Initial VM placement \u2705 Controls where nodes are created \u274c Cannot move existing nodes Failure domains \u2705 Defined in platform.vsphere.failureDomains \u2705 Can update existing failure domains Load balancing &amp; networking \u2705 Can configure in advance \u26a0\ufe0f Limited to post-install tweaks Effectiveness \u2705 Ensures correct setup from the start \u26a0\ufe0f May require additional manual steps Doc for vSphere Configure Failure Domain while installing Add Failure Domain configuration after Install"},{"location":"cloud/openshift/installation/#vsphere","title":"vSphere","text":"<p>vSphere is VMware\u2019s virtualization platform. vCenter and ESXi Hosts are components that work within that platform t - vCenter provides centralized mgmt for both VMs and ESXi Hosts - ESXi: is a bare-metal hypervisor that installs directly onto a physical machine and creates the separation necessary to divide it into one or more VMs</p> <p></p> <p>Note</p> <p>You can deploy an OpenShift Container Platform cluster to multiple vSphere data centers that run in a single VMware vCenter.  Each data center can run multiple clusters. This configuration reduces the risk of a hardware failure or network outage that can cause your cluster to fail.  --&gt; \u901a\u8fc7\u5c06\u96c6\u7fa4\u5206\u6563\u5230\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3\uff0c\u5373\u4f7f\u4e00\u4e2a\u6570\u636e\u4e2d\u5fc3\u53d1\u751f\u6545\u969c\uff0c\u5176\u4ed6\u6570\u636e\u4e2d\u5fc3\u7684\u8282\u70b9\u4ecd\u7136\u53ef\u4ee5\u4fdd\u6301\u96c6\u7fa4\u7684\u8fd0\u884c\u3002</p> <p>To enable regions and zones, you must define multiple failure domains/\u6545\u969c\u57df for your OpenShift Container Platform cluster.</p> <p>OpenShift \u5b89\u88c5\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u5c06 \u63a7\u5236\u5e73\u9762\u8282\u70b9 \u548c \u5de5\u4f5c\u8282\u70b9\u5206\u5e03 \u5230\u4e0d\u540c\u7684\u6545\u969c\u57df\u4e2d\u3002</p>"},{"location":"cloud/openshift/installation/#stretched-cluster","title":"Stretched Cluster","text":"<p>In a Stretched Cluster setup, you can have one vCenter managing both data centers or two vCenters (linked mode) depending on your architecture.</p> <ol> <li>Single vCenter (Common Setup): The two data centers are configured as separate failure domains within the same vCenter.</li> <li>Two vCenters (Linked Mode)</li> </ol>"},{"location":"cloud/openshift/installation/#zone-vs-region","title":"Zone vs Region","text":"<p>OpenShift \u4f1a\u5728 \u540c\u4e00\u4e2a region \u5185\u8de8\u591a\u4e2a zone \u8fdb\u884c\u8c03\u5ea6\u3002\u4f46\u4e0d\u4f1a\u5728\u4e0d\u540c\u7684 region \u4e4b\u95f4\u81ea\u52a8\u8c03\u5ea6 Pod\u3002</p> <p>\u4e3a\u4ec0\u4e48 OpenShift \u4e0d\u4f1a\u81ea\u52a8\u8de8 region \u8c03\u5ea6\uff1f</p> <ul> <li>\u533a\u57df\u4e4b\u95f4\u7684\u7f51\u7edc\u5ef6\u8fdf\uff1a\u4e0d\u540c\u7684 region \u53ef\u80fd\u4f4d\u4e8e\u4e0d\u540c\u7684\u5730\u7406\u4f4d\u7f6e\uff0c\u7f51\u7edc\u5ef6\u8fdf\u8f83\u5927\uff0c\u8fd9\u4f1a\u5f71\u54cd\u8de8\u533a\u57df\u7684\u8c03\u5ea6\u6548\u7387\u548c\u5e94\u7528\u6027\u80fd\u3002</li> <li>\u53ef\u7528\u6027\u548c\u5197\u4f59\u6027\uff1a\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4e00\u4e2a region \u5df2\u7ecf\u5177\u5907\u4e86\u5145\u5206\u7684\u5197\u4f59\u8bbe\u8ba1\uff0c\u80fd\u6ee1\u8db3\u9ad8\u53ef\u7528\u7684\u9700\u6c42\u3002\u8de8 region \u7684\u8c03\u5ea6\u9700\u8981\u7279\u522b\u7684\u914d\u7f6e\u548c\u7ba1\u7406\uff0c\u5982\u591a\u6d3b\u67b6\u6784\u548c\u8de8\u533a\u57df\u7684\u6570\u636e\u5e93\u540c\u6b65\u7b49\u3002</li> <li>\u8d44\u6e90\u4f18\u5316\uff1a\u8de8 region \u8c03\u5ea6\u53ef\u80fd\u4f1a\u589e\u52a0\u5b58\u50a8\u548c\u8ba1\u7b97\u8d44\u6e90\u7684\u5206\u5e03\u590d\u6742\u6027\uff0c\u56e0\u6b64 OpenShift \u9ed8\u8ba4\u4f1a\u9650\u5236\u8de8 region \u7684\u8c03\u5ea6\uff0c\u4ee5\u4fdd\u6301\u96c6\u7fa4\u7684\u9ad8\u6548\u6027\u548c\u7b80\u5355\u6027\u3002</li> </ul>"},{"location":"cloud/openshift/installation/#rhcos-vs-rhel","title":"RHCOS vs RHEL","text":"RHCOS\uff08Red Hat Enterprise Linux <code>CoreOS</code>) RHEL\uff08Red Hat Enterprise Linux\uff09 <code>CentOS</code> \u9002\u7528\u573a\u666f \u4e13\u95e8\u7528\u4e8e OpenShift \u7684\u5bb9\u5668\u64cd\u4f5c\u7cfb\u7edf\uff0c\u57fa\u4e8e RHEL \u6280\u672f\uff0c\u4f46\u66f4\u8f7b\u91cf\u3001\u81ea\u52a8\u5316\u7a0b\u5ea6\u66f4\u9ad8\u3002 \u901a\u7528\u4f01\u4e1a Linux\uff0c\u9002\u7528\u4e8e\u5404\u79cd\u670d\u52a1\u5668\u548c\u4e91\u8ba1\u7b97\u3001\u865a\u62df\u5316\u3001\u6570\u636e\u5e93\u7b49 \u8f6f\u4ef6\u7ba1\u7406 OSTree \u8fdb\u884c\u7cfb\u7edf\u66f4\u65b0\u3002 dnf/yum \u8fd0\u884c\u65f6 \u9ed8\u8ba4\u8fd0\u884c CRI-O \u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u4f18\u5316\u4e86 OpenShift/Kubernetes \u96c6\u7fa4\u7684\u8fd0\u884c\u3002 \u9700\u8981\u8ba2\u9605 Red Hat \u8ba2\u9605\u670d\u52a1\uff0c\u624d\u80fd\u83b7\u53d6\u66f4\u65b0\u548c\u652f\u6301\u3002"},{"location":"cloud/openshift/installation/#integrated-vs-not-integrated","title":"Integrated vs not-integrated","text":"<p>in <code>install-config.yaml</code> file, you can see whether the current installation is integrated or not by checking:</p> <pre><code>platform: none: {}\n</code></pre> <p>This means NOT integrated.</p> Integrated Installation NOT-integrated installation openshift has control on the infrastructure, e.g. can create VMs, can mount *.iso files can NOT do such a thing"},{"location":"cloud/openshift/installation/ipi/","title":"IPI","text":""},{"location":"cloud/openshift/installation/ipi/#ibm-cloud-default","title":"IBM Cloud (Default)","text":"<p>Installing a customized cluster on IBM Cloud</p> <p>Bare Metal Server - Infrastructures</p> <p>IBM Cloud provides 2 infrastructures:</p> <ul> <li>IBM Cloud\u00ae Classic: highly customizable --&gt; NOT supported for OC installation!</li> <li>IBM Cloud\u00ae VPC: high availability, performance</li> </ul> <p>Check this doc or this video to see the difference</p>"},{"location":"cloud/openshift/installation/mirror_registry/","title":"Mirror Registry","text":"<ul> <li>Doc: Mirroring in disconnected environments</li> <li>Blogs: Introducing Mirror Registry for Red Hat OpenShift</li> </ul> <p>Warning</p> <p>\u4e5f\u6709\u53ef\u80fd\u51fa\u73b0\u6709Proxy\u914d\u7f6e\uff0c\u4f46\u662f\u6ca1\u6709 Mirror Registry \u7684\u60c5\u51b5\u3002</p> <p>\u5728\u67d0\u4e9b\u53d7\u9650\u7f51\u7edc\u73af\u5883\u4e0b\uff0c\u96c6\u7fa4\u53ef\u4ee5\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u5668\uff08http_proxy/https_proxy\uff09\u76f4\u63a5\u8bbf\u95ee \u5916\u90e8\u4ed3\u5e93\uff08\u4f8b\u5982 registry.redhat.io \u6216 quay.io\uff09\uff0c\u800c\u4e0d\u9700\u8981\u672c\u5730\u955c\u50cf\u4ed3\u5e93\uff08mirror registry\uff09\u3002</p>"},{"location":"cloud/openshift/installation/mirror_registry/#mirroring","title":"\u4e24\u79cd mirroring \u7c7b\u578b","text":"<p>Mirror Registry  \u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u7528\u6765\u653e Images \u7684 App\uff01</p>"},{"location":"cloud/openshift/installation/mirror_registry/#1-connected-mirroring","title":"1. Connected Mirroring\uff08\u8fde\u63a5\u6a21\u5f0f\u955c\u50cf\uff09","text":"<p>\u9002\u7528\u4e8e \u53d7\u9650\u7f51\u7edc\uff08Restricted Network\uff09\uff0c\u4f46\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7 \u4ee3\u7406\uff08proxy\uff09 \u8bbf\u95ee\u5916\u90e8\u955c\u50cf\u4ed3\u5e93\uff08\u5982 quay.io\u3001registry.redhat.io\uff09\u3002</p> <pre><code>Internet &lt;--&gt; [Optional] Proxy &lt;--&gt; A random Machine &lt;--&gt; Registry\n</code></pre> <p>\u5de5\u4f5c\u539f\u7406\uff1a</p> <ul> <li>\u4f60\u7684\u672c\u5730\u955c\u50cf\u4ed3\u5e93\uff08Mirror Registry\uff09\u4f5c\u4e3a\u7f13\u5b58\uff0c\u5b58\u50a8\u5e38\u7528\u7684 OpenShift \u7ec4\u4ef6\u955c\u50cf\u3002</li> <li>\u5982\u679c\u672c\u5730\u4ed3\u5e93\u7f3a\u5c11\u67d0\u4e2a\u955c\u50cf\uff0c\u96c6\u7fa4\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7\u4ee3\u7406\u8bbf\u95ee\u5b98\u65b9\u4ed3\u5e93\u62c9\u53d6\u3002</li> <li>\u5b9a\u671f\u81ea\u52a8\u540c\u6b65\u672c\u5730\u4ed3\u5e93\u4e0e <code>registry.redhat.io</code>\uff0c\u4ee5\u83b7\u53d6\u6700\u65b0\u66f4\u65b0\u3002</li> </ul>"},{"location":"cloud/openshift/installation/mirror_registry/#2-disconnected-mirroring","title":"2. Disconnected Mirroring\uff08\u79bb\u7ebf\u6a21\u5f0f\u955c\u50cf\uff09","text":"<p>Some time ppl also call it \"Local Proxy Registry\"</p> <pre><code>Internet &lt;--&gt; A random Machine | (\u624b\u52a8\u4e0b\u8f7d &amp; \u7269\u7406\u5bfc\u5165) | Registry (as Local File)\n</code></pre> <p>\u5de5\u4f5c\u539f\u7406\uff1a</p> <ul> <li>\u4f60\u9700\u8981\u5728\u4e00\u53f0\u80fd\u8bbf\u95ee\u4e92\u8054\u7f51\u7684\u673a\u5668\u4e0a\uff0c\u624b\u52a8\u4e0b\u8f7d OpenShift \u6240\u9700\u7684\u6240\u6709\u955c\u50cf\uff08\u4f7f\u7528 oc adm release mirror \u547d\u4ee4\uff09\u3002</li> <li>\u7136\u540e\u628a\u8fd9\u4e9b\u955c\u50cf \u624b\u52a8\u4f20\u8f93 \u5230\u5185\u90e8\u7684\u79c1\u6709 Registry\u3002</li> <li> <p>\u96c6\u7fa4\u6240\u6709\u8282\u70b9\u53ea\u80fd\u8bbf\u95ee\u672c\u5730\u955c\u50cf\u4ed3\u5e93\uff0c\u4e0d\u80fd\u8bbf\u95ee quay.io \u6216 registry.redhat.io\u3002</p> </li> <li> <p>create Mirror registry</p> </li> <li>use the Mirror registry, there are 2 ways:<ul> <li>old tool: <code>oc adm command</code></li> <li>new tool <code>oc-mirror</code> plugin</li> </ul> </li> </ul> Connected Mirroring Disconnected Mirroring \u9002\u7528\u573a\u666f Restricted Network:- \u4f01\u4e1a\u53d7\u9650\u7f51\u7edc\uff0c\u53ef\u4ee5\u8bbf\u95ee\u5916\u7f51\u4f46\u9700\u8981\u964d\u4f4e\u5bf9\u5916\u7f51\u4f9d\u8d56\u3002 - \u79c1\u6709\u4e91\u73af\u5883\uff0c\u60f3\u8981\u52a0\u901f OpenShift \u955c\u50cf\u62c9\u53d6\uff0c\u51cf\u5c11\u5916\u90e8\u6d41\u91cf\u6d88\u8017\u3002 Airgap: - \u653f\u5e9c\u3001\u94f6\u884c\u3001\u519b\u4e8b\u3001\u4f01\u4e1a\u5c01\u95ed\u73af\u5883\u3002- \u8fdc\u7a0b\u7ad9\u70b9\uff08\u5982\u6d77\u4e0a\u94bb\u4e95\u3001\u536b\u661f\u57fa\u7ad9\u7b49\uff09\uff0c\u6ca1\u6709\u7a33\u5b9a\u7684\u7f51\u7edc\u8fde\u63a5\u3002"},{"location":"cloud/openshift/installation/mirror_registry/#concepts-understanding","title":"Concepts Understanding","text":"<p>mirror registry - \u955c\u50cf\u4ed3\u5e93 \u662f\u4e00\u4e2a\u5b58\u50a8 images \u7684\u4ed3\u5e93\uff0c\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u529e\u6cd5\u76f4\u63a5\u8bbf\u95ee \u5728\u7f51\u7edc\u4e0a\u7684\u4ed3\u5e93</p>"},{"location":"cloud/openshift/installation/mirror_registry/#1-mirror-registry","title":"1. \u751f\u6210 Mirror Registry","text":"<p>Prerequisites</p> <ul> <li>OC subscription</li> <li>Host OS: RHEL8,9</li> <li>Podman 3.4.2 or later</li> <li>OpenSSL</li> <li>DNS to Redhat Quary</li> <li>vCPU: 2+</li> <li>RAM: 8GB+</li> <li>Storage: 1TB+</li> </ul> <p>It should be a registry that supports <code>Docker v2-2</code>, for instances:</p> <ul> <li>Mirror registry for Red Hat OpenShift<ul> <li>a small-scale version of Red Hat Quay</li> <li>Prerequisites of <code>mirror-registry</code> CLI tool</li> </ul> </li> <li>Red Hat Quay ??</li> <li>JFrog Artifactory</li> <li>Sonatype Nexus Repository</li> <li>Harbor</li> </ul>"},{"location":"cloud/openshift/installation/mirror_registry/#mirror-registry-for-red-hat-openshift","title":"Mirror registry for Red Hat OpenShift","text":"<p>Choice of Local Mirror Registry</p> <p>\u6211\u4eec\u8fd9\u91cc\u7528 Mirror registry for Red Hat OpenShift \u4e3a\u4f8b\uff1a</p> <ul> <li>registry runs on port <code>443</code></li> <li>\u91cd\u8981\u6587\u4ef6\u5939\uff1a<code>$HOME/quay-install</code></li> <li>\u521d\u8bd5\u7528\u6237 <code>init</code> + \u81ea\u52a8\u751f\u6210\u5bc6\u7801</li> </ul> <p>\u6b65\u9aa4\uff1a</p> <ol> <li> <p>Install depenedencies     <pre><code># check\nwhich podman tar jq openssl\n\n# install in RHEL/CentOS\nyum install -y podman tar jq openssl  \n</code></pre></p> </li> <li> <p>\u4e0b\u8f7d <code>mirror-registry.tar.gz</code> \u5305</p> </li> <li> <p>\u914d\u7f6e\uff1a     <pre><code>tar -xzf mirror-registry-amd64.tar.gz\n\n./mirror-registry install \\\n    --quayHostname &lt;host_example_com&gt; \\\n    --quayRoot &lt;example_directory_name&gt;\n\n# ./mirror-registry install --quayHostname $(hostname -f)\n</code></pre></p> <ul> <li>registry hostname: system\u2019s hostname in long form </li> <li>self-signed TLS certificates</li> <li>Container images &amp; configuration data(including <code>rootCA.key</code>, <code>rootCA.pem</code>, and <code>rootCA.srl certificates</code>) saved at <code>$HOME/quay-install</code></li> <li>Credentials for initial users will be auto-generated and reported when the install completes.</li> </ul> </li> <li> <p>\u767b\u9646 mirror registry     <pre><code>podman login -u init \\\n    -p &lt;password&gt; \\\n    &lt;host_example_com&gt;:8443&gt; \\\n    --tls-verify=false\n</code></pre></p> </li> <li>run <code>--tls-verify=false</code> or \"configuring your system to trust the generated rootCA certificates\"??</li> </ol>"},{"location":"cloud/openshift/installation/mirror_registry/#known-bugs","title":"Known Bugs","text":"<p>An error occurred: exit status 127</p> <p>dependencies missing, check: <pre><code># check\nwhich podman tar jq openssl\n\n# install in RHEL/CentOS\nyum install -y podman tar jq openssl  \n</code></pre></p> <p>TASK [mirror_appliance : Waiting up to 3 minutes</p> <pre><code>...\"stderr\": \"Unit quay-app.service could not be found.\"...\n</code></pre> <p>Check with journalctl: <pre><code>journalctl -u quay-app.service --no-pager --full\n</code></pre></p> <p>Error msg: <pre><code>Redis                  | Could not connect to Redis with values provided in BUILDLOGS_REDIS. Error: WRONGPASS invalid username-password pair or user is disabled.   | \ud83d\udd34     |\n</code></pre> Check: <pre><code>TASK [mirror_appliance : Create Redis Password Secret] **************************************************************************************************************\nok: [USERNAME@HOSTNAME]   &lt;&lt;&lt;&lt; HERE, check if this task was executed or not. If \"ok\" was shown, it means not executing this task.\n</code></pre></p> <p>Solution: https://access.redhat.com/solutions/7090795 <pre><code>podman secret ls\npodman secret rm redis_pass\n</code></pre></p>"},{"location":"cloud/openshift/installation/mirror_registry/#red-hat-quay","title":"Red Hat Quay","text":""},{"location":"cloud/openshift/installation/mirror_registry/#jfrog-artifactory","title":"JFrog Artifactory","text":""},{"location":"cloud/openshift/installation/mirror_registry/#sonatype-nexus-repository","title":"Sonatype Nexus Repository","text":"<pre><code>docker run -d --name nexus \\\n  -p 8081:8081 -p 5000:5000 \\\n  sonatype/nexus3\n</code></pre>"},{"location":"cloud/openshift/installation/mirror_registry/#harbor","title":"Harbor","text":""},{"location":"cloud/openshift/installation/mirror_registry/#docker","title":"Docker","text":"<ul> <li>use official registry image from Docker</li> <li>Docu check here</li> </ul> <pre><code>colima start\ndocker run -d -p 5000:5000 --name registry registry:latest\n\n# observe the logs in another terminal window\ndocker logs -f registry\n\n# pull, tag and push the Image to my local registry\ndocker pull ubuntu\ndocker tag ubuntu localhost:5000/ubuntu\ndocker push localhost:5000/ubuntu\n\n# remove the copy (this is not in my local registry)\ndocker rmi localhost:5000/ubuntu\ndocker images\n\n# Validation: try to pull image from the registry\ndocker pull localhost:5000/ubuntu\ndocker images\n\n# verifying that your local registry is reachable\ncurl -v http://localhost:5000/v2/\n</code></pre>"},{"location":"cloud/openshift/installation/mirror_registry/#2-mirroring-openshift-images","title":"2. Mirroring OpenShift images","text":"<p>Mirroring the OpenShift Container Platform image repository</p>"},{"location":"cloud/openshift/installation/mirror_registry/#oc-adm","title":"\u65b9\u6cd5\u4e00\uff1a \u7528<code>oc adm</code>\u914d\u7f6e","text":"<p>\u5373\u7528 oc CLI\u3002\u53ef\u7528\u7cfb\u7edf\uff1aLinux\uff0cRHEL8\uff0c9, MacOS, Windows</p>"},{"location":"cloud/openshift/installation/mirror_registry/#1","title":"1. \u62f7\u8d1d","text":"<p><pre><code>OCP_RELEASE=&lt;release_version&gt;\nLOCAL_REGISTRY='&lt;local_registry_host_name&gt;:&lt;local_registry_host_port&gt;'\nLOCAL_REPOSITORY='&lt;local_repository_name&gt;'\nPRODUCT_REPO='openshift-release-dev'\nLOCAL_SECRET_JSON='&lt;path_to_pull_secret&gt;'\nRELEASE_NAME=\"ocp-release\"\nARCHITECTURE=&lt;cluster_architecture&gt;\nREMOVABLE_MEDIA_PATH=&lt;path&gt;\n\noc adm release mirror -a ${LOCAL_SECRET_JSON}  \\\n     --from=quay.io/${PRODUCT_REPO}/${RELEASE_NAME}:${OCP_RELEASE}-${ARCHITECTURE} \\\n     --to=${LOCAL_REGISTRY}/${LOCAL_REPOSITORY} \\\n     --to-release-image=${LOCAL_REGISTRY}/${LOCAL_REPOSITORY}:${OCP_RELEASE}-${ARCHITECTURE} \\\n     --print-mirror-instructions=idms\n</code></pre> \u26a0\ufe0f Record the entire imageContentSources section from the output!</p>"},{"location":"cloud/openshift/installation/mirror_registry/#2-cluster-samples-operator","title":"2. \u62f7\u8d1d Cluster Samples Operator","text":""},{"location":"cloud/openshift/installation/mirror_registry/#3-mirroring-operator-catalogs","title":"3. \u62f7\u8d1d Mirroring Operator catalogs","text":"<p>restricted: https://docs.redhat.com/en/documentation/openshift_container_platform/4.17/html/disconnected_environments/mirroring-in-disconnected-environments#olm-mirror-catalog-colocated_installing-mirroring-installation-images</p> <p>airgapped: https://docs.redhat.com/en/documentation/openshift_container_platform/4.17/html/disconnected_environments/mirroring-in-disconnected-environments#olm-mirror-catalog-airgapped_installing-mirroring-installation-images</p>"},{"location":"cloud/openshift/installation/mirror_registry/#oc-mirror-v2","title":"\u65b9\u6cd5\u4e8c\uff1a \u7528<code>oc mirror</code> v2 \u914d\u7f6e","text":"<ul> <li>\u53ef\u7528\u7cfb\u7edf\uff1aRHEL8\uff0c9</li> <li>Doc</li> </ul>"},{"location":"cloud/openshift/installation/mirror_registry/#1-oc-mirrortargz","title":"1. \u4e0b\u8f7doc-mirror.tar.gz","text":"<pre><code>wget https://mirror.openshift.com/pub/openshift-v4/x86_64/clients/ocp/latest/oc-mirror.rhel9.tar.gz\ntar -xzf oc-mirror.rhel9.tar.gz\n</code></pre>"},{"location":"cloud/openshift/installation/mirror_registry/#2-configure-pull-secretjson","title":"2. configure pull-secret.json","text":""},{"location":"cloud/openshift/installation/mirror_registry/#3-create-imagesetconfiguration","title":"3. Create <code>ImageSetConfiguration</code>","text":"<p>Manully create an yaml file. Example: <pre><code>kind: ImageSetConfiguration\napiVersion: mirror.openshift.io/v2alpha1\nmirror:\n  platform:\n    channels:\n    - name: stable-4.17 \n      minVersion: 4.17.2\n      maxVersion: 4.17.2\n    graph: true \n  operators:\n    - catalog: registry.redhat.io/redhat/redhat-operator-index:v4.17 \n      packages: \n       - name: aws-load-balancer-operator\n       - name: 3scale-operator\n       - name: node-observability-operator\n  additionalImages: \n   - name: registry.redhat.io/ubi8/ubi:latest\n   - name: registry.redhat.io/ubi9/ubi@sha256:20f695d2a91352d4eaa25107535126727b5945bff38ed36a3e59590f495046f0\n</code></pre></p>"},{"location":"cloud/openshift/installation/mirror_registry/#performance-requirement","title":"Performance Requirement","text":"<p>Highly available</p>"},{"location":"cloud/openshift/installation/mirror_registry/#mirror-registry","title":"\u5982\u4f55\u4f7f\u7528 Mirror Registry","text":""},{"location":"cloud/openshift/installation/mirror_registry/#mirror-registry_1","title":"\u67e5\u770b Mirror Registry","text":"<p>\u67e5\u770b image content source policy \uff08ICSP\uff09 <pre><code>oc get image.config.openshift.io cluster -o jsonpath='{.spec.registrySources}' | jq\n</code></pre></p>"},{"location":"cloud/openshift/installation/mirror_registry/#image","title":"\u67e5\u770bimage\u6765\u6e90","text":"<p>When using mirrored registries in OpenShift, the system pulls images from your internal (mirrored) registry instead of the original Red Hat registry (<code>registry.redhat.io</code>). </p> <p>\u4f46\u662f\uff0c\u6709\u5de5\u5177\u53ef\u4ee5\u67e5\u770b\u8be5 image \u771f\u6b63\u7684\u6e90\u5934\uff1a <pre><code># \u65b9\u6cd5\u4e00\uff1aCheck CRI-O Logs (Best Method)\njournalctl -u crio --since \"10 minutes ago\" | grep \"Trying to access\"\n# Example Output: journalctl -u crio --since \"10 minutes ago\" | grep \"Trying to access\"\n\n# \u65b9\u6cd5\u4e8c\uff1acrictl (May Be Misleading)\ncrictl images\n</code></pre></p> <p>\u539f\u7406</p> <p>Why Does This Happen?</p> <ul> <li>OpenShift uses <code>imageContentSources</code> to define mirrors. When an image pull request is made, OpenShift redirects it to the mirror - but keeps the original image name in metadata.</li> </ul>"},{"location":"cloud/openshift/installation/mirror_registry_convert_connect_to_disconnect/","title":"Mirror registry convert connect to disconnect","text":"<p>\u4ee5\u4e0b\u662fChapter 2. Converting a connected cluster to a disconnected cluster \u7684\u5185\u5bb9</p> <p>https://docs.redhat.com/en/documentation/openshift_container_platform/4.17/html-single/disconnected_environments/index#connected-to-disconnected</p> <p>## 2. Configure Mirror Registry Adding the Mirror Registry certificates to the list of trusted CAs on your host. <pre><code>cp &lt;/path/to/cert.crt&gt; /usr/share/pki/ca-trust-source/anchors/\n\n# Update the CA trust. For example, in Linux:\nupdate-ca-trust\n</code></pre></p>"},{"location":"cloud/openshift/installation/mirror_registry_convert_connect_to_disconnect/#3-grant-access-to-registry-on-internet","title":"3. Grant Access to Registry on Internet","text":"<p>Creating a <code>.dockerconfigjson</code> file that contains your image pull secret, which is from the cloud.openshift.com token.</p>"},{"location":"cloud/openshift/installation/mirror_registry_convert_connect_to_disconnect/#4","title":"4. \u62f7\u8d1d \u6838\u5fc3\u955c\u50cf","text":"<p>Copy 3 types of INDISPENSABLE images from your external repositories on Internet to the Mirror Registry.</p>"},{"location":"cloud/openshift/installation/mirror_registry_convert_connect_to_disconnect/#41-operator-lifecycle-manager-olm-images","title":"4.1 \u62f7\u8d1d Operator Lifecycle Manager (OLM) images","text":"<p>OLM \u8d1f\u8d23\u5728 OpenShift \u96c6\u7fa4\u4e2d \u5b89\u88c5\u3001\u66f4\u65b0\u3001\u7ba1\u7406 Operators\u3002\u6bd4\u8f83\u7279\u6b8a\uff0c\u6240\u4ee5\u9700\u8981\u5355\u72ec\u540c\u6b65\uff0c\u56e0\u4e3a\u5b83\u662f\u6240\u6709 Operator \u7684\u7ba1\u7406\u5c42\uff0c\u5fc5\u987b\u5148\u5b89\u88c5 OLM \u540e\uff0c\u624d\u80fd\u5b89\u88c5\u5177\u4f53\u7684 Operators\u3002 <pre><code>oc adm catalog mirror registry.redhat.io/redhat/redhat-operator-index:v{product-version} &lt;mirror_registry&gt;:&lt;port&gt;/olm -a &lt;reg_creds&gt;\n# example: oc adm catalog mirror registry.redhat.io/redhat/redhat-operator-index:v4.8 mirror.registry.com:443/olm -a ./.dockerconfigjson  --index-filter-by-os='.*'\n</code></pre></p>"},{"location":"cloud/openshift/installation/mirror_registry_convert_connect_to_disconnect/#42-red-hat-provided-operator","title":"4.2 \u62f7\u8d1d\u5176\u4ed6 Red Hat-provided Operator","text":"<p>\u4f8b\u5982 etcd\u3001Prometheus\u3001Logging \u7b49 Operators\u3002\u8fd9\u4e2a\u547d\u4ee4\u4f1a\u62c9\u53d6 \u6240\u6709\u53ef\u7528\u7684 Operator\uff0c\u5982\u679c\u53ea\u9700\u8981\u90e8\u5206 Operators\uff0c\u9700\u8981\u81ea\u5b9a\u4e49 <code>catalogSource</code>. <pre><code>oc adm catalog mirror &lt;index_image&gt; &lt;mirror_registry&gt;:&lt;port&gt;/&lt;namespace&gt; -a &lt;reg_creds&gt;\n# example: oc adm catalog mirror registry.redhat.io/redhat/community-operator-index:v4.8 mirror.registry.com:443/olm -a ./.dockerconfigjson  --index-filter-by-os='.*'\n</code></pre></p>"},{"location":"cloud/openshift/installation/mirror_registry_convert_connect_to_disconnect/#43-the-openshift-container-platform-image-repository","title":"4.3 \u62f7\u8d1d the OpenShift Container Platform image repository:","text":"<p>\u955c\u50cf \u6838\u5fc3 OpenShift \u7ec4\u4ef6\uff08\u5982 Kubernetes\u3001etcd\u3001SDN\u3001\u63a7\u5236\u5e73\u9762\u7b49\uff09\u3002 <pre><code>oc adm release mirror -a .dockerconfigjson --from=quay.io/openshift-release-dev/ocp-release:v&lt;product-version&gt;-&lt;architecture&gt; --to=&lt;local_registry&gt;/&lt;local_repository&gt; --to-release-image=&lt;local_registry&gt;/&lt;local_repository&gt;:v&lt;product-version&gt;-&lt;architecture&gt;\n# example: oc adm release mirror -a .dockerconfigjson --from=quay.io/openshift-release-dev/ocp-release:4.8.15-x86_64 --to=mirror.registry.com:443/ocp/release --to-release-image=mirror.registry.com:443/ocp/release:4.8.15-x86_64\n</code></pre></p>"},{"location":"cloud/openshift/installation/mirror_registry_convert_connect_to_disconnect/#5","title":"5. \u62f7\u8d1d \u6240\u9700\u7684\u955c\u50cf","text":"<p>\u9664\u4e86 OpenShift \u5b98\u65b9\u7ec4\u4ef6\uff0c\u6709\u4e9b\u4f01\u4e1a\u53ef\u80fd\u8fd8\u9700\u8981 \u989d\u5916\u7684\u5bb9\u5668\u955c\u50cf\uff0c\u4f8b\u5982 Nginx\u3001PostgreSQL\u4e4b\u7c7b\u7684\uff1a <pre><code>oc image mirror &lt;online_registry&gt;/my/image:latest &lt;mirror_registry&gt;\n</code></pre></p>"},{"location":"cloud/openshift/installation/network/","title":"Network","text":""},{"location":"cloud/openshift/installation/network/#_1","title":"\u6982\u5ff5","text":""},{"location":"cloud/openshift/installation/network/#node","title":"\u8282\u70b9\uff08Node\uff09\u7f51\u7edc","text":"<p>\u4e3b\u673a=Machine=VM=Host</p> <p>\u6307\u7ed9Bastion Host\uff0cBootstrap\uff0cMasters\u548cWorkers\u6bcf\u4e2aVM\u5206\u914d\u7684IP - \u4e3a\u7269\u7406/\u865a\u62df\u673a\u8282\u70b9\u5206\u914d IP\u3002 \u6709\u4e24\u79cd\u9009\u62e9\uff1a</p> <ol> <li>\u901a\u8fc7 DHCP\uff08dhcpd.conf\uff09 </li> <li>Static IP</li> </ol> <p>\u8282\u70b9 IP \u4ec5\u7528\u4e8e\u4e3b\u673a\u95f4\u5e95\u5c42\u901a\u4fe1\uff08\u5982 kubelet \u4e0e API Server \u901a\u4fe1\uff09\u3002</p>"},{"location":"cloud/openshift/installation/network/#pod-clusternetworks","title":"Pod \u7f51\u7edc \uff08clusterNetworks\uff09","text":"<p>\u96c6\u7fa4\u5185 Pod \u7684\u865a\u62df\u7f51\u7edc\uff08\u901a\u8fc7 SDN \u5982 OpenShift SDN \u6216 OVN-Kubernetes \u5b9e\u73b0\uff09- \u7531 CNI \u63d2\u4ef6\u7ba1\u7406\u3002</p>"},{"location":"cloud/openshift/installation/network/#service-servicenetwork","title":"Service \u7f51\u7edc\uff08serviceNetwork\uff09","text":"<p>ClusterIP \u7c7b\u578b Service \u7684\u865a\u62df IP \u8303\u56f4\u3002 - \u7531 Kubernetes/Openshift \u63a7\u5236\u5e73\u9762\u5206\u914d</p> <p>Danger</p> <p>\u552f\u4e00\u8981\u6c42\uff1a\u4e09\u8005\uff08\u8282\u70b9\u3001Pod\u3001Service\uff09\u5fc5\u987b\u65e0\u51b2\u7a81! \u5982\u679c\u8282\u70b9\u7f51\u7edc\u548c Pod/Service \u7f51\u7edc\u91cd\u53e0\uff0c\u4f1a\u5bfc\u81f4\u8def\u7531\u6df7\u4e71\uff0c\u96c6\u7fa4\u65e0\u6cd5\u901a\u4fe1\u3002</p>"},{"location":"cloud/openshift/installation/network/#install-configyaml","title":"install-config.yaml","text":"<pre><code>apiVersion: v1\nbaseDomain: example.com\nmetadata:\n  name: test\nnetworking:\n  clusterNetwork:                 # \u865a\u62df\u79c1\u6709 IP\uff0c\u7531 Cluster \u5206\u914d\u7ed9 Pod\n    - cidr: 10.128.0.0/14         \n      hostPrefix: 23\n  networkType: OVNKubernetes\n  serviceNetwork:                 # \u865a\u62df\u79c1\u6709 IP\uff0c\u7531 Cluster \u5206\u914d\u7ed9 Service\n    - 172.30.0.0/16\n</code></pre> <p>clusterNetwork</p> <ul> <li><code>clusterNetwork</code>\u662f Pod \u7684\u7f51\u7edc\u8303\u56f4</li> <li><code>clusterNetwork</code> \u5206\u914d\u7684IP\uff0c\u5982\u679c\u4f7f\u7528 Headless Service \u6765\u66b4\u9732\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u88ab\u7528\u6237\u4ece\u5916\u90e8\u8bbf\u95ee\u5230</li> <li>Pod \u4e0e Pod \u901a\u4fe1\uff08\u65e0\u8bba\u662f\u5426\u5728\u540c\u4e00 Node \u4e0a\uff09\u90fd\u8d70\u8fd9\u4e2a\u7f51\u6bb5\u3002</li> </ul> <p>\u4f8b\u5b50\u4e2d\uff1a</p> <ul> <li>\u5b50\u7f51\u662f<code>/14</code>\u3002\u5373 Pod \u7684\u5730\u5740\u8303\u56f4\u662f <code>10.128.0.0 - 10.131.255.255</code></li> <li><code>cidr</code>\u662f\u6240\u6709\u7684Pod\u53ef\u7528\u7684\u4e00\u4e2a\u5927\u8303\u56f4\uff0c\u4f46\u6bcf\u4e2aNode\u4e0a\u5176\u5b9e\u4e00\u822c\u4e0d\u9700\u8981\u90a3\u4e48\u591aIP\uff0c\u6240\u4ee5\u6211\u4eec\u7528<code>hostPrefix</code>\u7f29\u5c0fIP\u6570\u91cf</li> <li><code>hostPrefix</code> \u5b9a\u4e49\u4e86 \u6bcf\u4e2a Node \u4e0a Pod \u5730\u5740\u8303\u56f4: \u5b50\u7f51\u662f <code>/23</code>. \u6bcf\u4e2a Node \u5305\u542b 2^(32-23) = 512 \u4e2a IP \u5730\u5740\uff08\u5176\u4e2d 510 \u4e2a\u53ef\u7528\u4e8e Pod\uff09</li> </ul> <p>TODO: clusterNetwork vs serviceNetwork</p> <p>\u2705 1. Pod IP \u662f\u5b9e\u9645\u5b58\u5728\u7684\uff1a</p> <ul> <li>\u662f \u7f51\u7edc\u63d2\u4ef6\uff08\u5982 OVN\uff09 \u901a\u8fc7 Overlay \u7f51\u7edc\u5206\u914d\u7684\u3002</li> <li>\u6bcf\u4e2a Pod \u542f\u52a8\u65f6\u5c31\u83b7\u5f97\uff0c\u7f51\u7edc\u5c42\u80fd\u76f4\u63a5\u8def\u7531\u5230\u3002</li> <li>\u662f \u201c\u771f\u5b9e\u7684\u7ec8\u70b9\u201d\u3002</li> </ul> <p>\u2705 2. Service IP \u662f\u865a\u62df\u5b58\u5728\u7684\uff1a</p> <ul> <li>\u662f Kubernetes \u63a7\u5236\u9762\u901a\u8fc7 kube-proxy \u6216 OVN \u7684 LoadBalancer \u673a\u5236\u865a\u62df\u51fa\u6765\u7684\u3002</li> <li>\u6ca1\u6709\u771f\u5b9e\u7f51\u5361\u6216\u5bb9\u5668\u7ed1\u5b9a\u8fd9\u4e2a IP\u3002</li> <li>\u76f8\u5f53\u4e8e DNS \u8d1f\u8f7d\u5747\u8861\u5165\u53e3\uff0c\u7528\u6765\u8f6c\u53d1\u5230 Pod\u3002</li> </ul> <p></p> <p>Danger</p> <p>When installing OpenShift, its important to make sure in the current network setting, NONE of the IP ranges that you defined in <code>clusterNetwork</code> and <code>serviceNetwork</code> are already occupied</p>"},{"location":"cloud/openshift/installation/upi/","title":"UPI","text":""},{"location":"cloud/openshift/installation/upi/#on-vsphere","title":"on vSphere","text":"<ul> <li>Amazing walk-through video</li> <li>OC official doc</li> </ul>"},{"location":"cloud/openshift/installation/upi/#bastion-host","title":"Bastion Host","text":"<ol> <li>download <code>openshift-install-linux.tar</code> and <code>openshift-client-linux.tar</code> </li> <li>configure DNS/Ingress?, so that:<ul> <li><code>api.openshift.mycluster</code>: IP1 pointing to Master Node and Bootstrap Node</li> <li><code>apps.openshift.mycluster</code>: IP2 pointing to Worker Node</li> <li>note: you can also use the same IP and do port-forwarding</li> </ul> </li> <li>generate/write &amp; modify <code>install-config.yaml</code></li> <li>generate manifests</li> <li>generate ignition files for the VMs</li> <li>encode ignition files with base64 - results: <code>master.64</code>, <code>worker.64</code></li> <li>run a HTTP server</li> <li>copy the ignition files to the HTTP server location (<code>var/www/html</code>)</li> <li>create an append file that points to the base64-encoded ignition file in the HTTP server<ul> <li>the reason behind this: while creating a VM machine, you can configure it with ignition file</li> <li>however the ignition file that generated in step 5 is too big </li> <li>the maximal ignition file you can directly upload while creating is 300kb</li> <li>so we need the the base64 encoded append file(<code>append-bootstrap.64</code>) - which is in fact a small ignition file - to provide the source of a REAL ignition file</li> </ul> </li> </ol> <p>-- Now we take a break from the Bastion Host and go to create the Boostrap, Master and Worker Node --</p> <ol> <li>export kubeconfig <code>expoert KUBECONFIG=~/openshift/mycluster/auth/kubeconfig</code></li> <li>now we can see the nodes: <code>oc get nodes</code></li> <li>list all pending Certificate Signing Requests (CSRs) for both Master and Worker Nodes: <code>oc get csr | grep Pending</code></li> <li>approve pending CSRs: <code>oc adm certificate approve &lt;CSR-Name-1&gt; &lt;CSR-Name-2&gt; ...</code></li> <li>check status of the Cluster Operator: <code>oc get co</code> --&gt; we need the <code>console</code> CO to be able to access the UI</li> <li>login to UI with credential:<ul> <li>username: `kubeadmin</li> <li>you get the password from <code>cat mycluster/auth/kubeadmin-password</code></li> </ul> </li> </ol> <p>when do I need to approve a CSR?</p> <ol> <li>NEW (Master/Workder) Node joins OpenShift clusterWhen a new worker node starts, it sends a CSR to request a client certificate.</li> <li>Cluster certificate rotation OpenShift automatically rotates node certificates when they expire, generating new CSRs.</li> </ol>"},{"location":"cloud/openshift/installation/upi/#boostrap-node","title":"Boostrap Node","text":"<p>create VM machine for the Boostrap Node with the following configuration parameters:     - <code>disk_EnableUUID=TRUE</code>     - <code>guestinfo.ignition.config.data.encoding=base64</code>     - <code>guestinfo.ignition.config.data=append-bootstrap.64</code> &lt;- the base64 encoded append file     - <code>guestinfo.afterburn.initrd.network-kargs=&lt;Network Parameters&gt;</code>, example:         - <code>ip=172.16.1.13::172.16.1.1:255.255.255.192:bootstrap.mycluster.land:ens192:none nameserver=172.16.1.1</code>         - the example has the format of <code>ip=&lt;Boostrap Node's IP&gt;::&lt;Default Gateway&gt;:&lt;Subnet&gt;...</code></p>"},{"location":"cloud/openshift/installation/upi/#master-nodes-0-2","title":"Master Nodes 0-2","text":"<p>create VM machine for the Master Nodes 0-2 with the following configuration parameters:     - <code>disk_EnableUUID=TRUE</code>     - <code>guestinfo.ignition.config.data.encoding=base64</code>     - <code>guestinfo.ignition.config.data=master.64</code> &lt;- the base64 ignition file for master node     - <code>guestinfo.afterburn.initrd.network-kargs=&lt;Network Parameters&gt;</code>, example:         - <code>ip=172.16.1.10::172.16.1.1:255.255.255.192:bootstrap.mycluster.land:ens192:none nameserver=172.16.1.1</code>         - the example has the format of <code>ip=&lt;Master Node's IP&gt;::&lt;Default Gateway&gt;:&lt;Subnet&gt;...</code></p>"},{"location":"cloud/openshift/installation/upi/#worker-nodes-0-2","title":"Worker Nodes 0-2","text":"<p>create VM machine for the Master Nodes 0-2 with the following configuration parameters:     - <code>disk_EnableUUID=TRUE</code>     - <code>guestinfo.ignition.config.data.encoding=base64</code>     - <code>guestinfo.ignition.config.data=workder.64</code> &lt;- the base64 ignition file for worker node     - <code>guestinfo.afterburn.initrd.network-kargs=&lt;Network Parameters&gt;</code>, example:         - <code>ip=172.16.1.20::172.16.1.1:255.255.255.192:bootstrap.mycluster.land:ens192:none nameserver=172.16.1.1</code>         - the example has the format of <code>ip=&lt;Worker Node's IP&gt;::&lt;Default Gateway&gt;:&lt;Subnet&gt;...</code></p> <p>Worker Node's IP depends on the current machine. Our 3 nodes have: - <code>172.16.1.20</code> - <code>172.16.1.21</code> - <code>172.16.1.22</code></p>"},{"location":"data_scientist/elastic_search/","title":"ElasticSearch","text":""},{"location":"data_scientist/elastic_search/#recall","title":"Recall","text":"<p>Recall = True Positives / ( True Positives + False negatives)</p> <p>It answers: what portion of relevant data is being returned as search result.</p>"},{"location":"data_scientist/elastic_search/#term-frequency-tf","title":"Term Frequency (TF)","text":"<p>In the question(or Search Query) \"How to form good habits?\", every word is a Search Terms. Term Frequency determines the frequency of a word, for example - \"habits\" appears in the document</p>"},{"location":"data_scientist/elastic_search/#inverse-document-frequency-idf","title":"Inverse Document Frequency (IDF)","text":"<p>If certain terms occur very frequently in all the documents, such as \"how\" or \"is\" - which are actually useless.</p>"},{"location":"data_scientist/embedding/","title":"Embedding","text":"<p>Reference video from StatQuest</p> <p>Turn words into numbers. Words with similar meanings will have similar numbers. For example:</p> <p>great --&gt; 4.2 awesome --&gt; 3.9</p> <p>So, in order to create a Neural Network to figure out what numbers we should associate with each word, the first thing we do is create inputs for each unique word.</p> <p>Activation Function</p> <p>Number of Activation Functions = Amount of numbers we want to associate with each word</p> <p>In the following example, we have 2 Activation Functions, the weights represents the word:</p> <p> <p>However the weights are now all random, and we will optimize them with Backpropagation. To do the Backpropagation, we need to use 1 word to predict another word. </p> <p>E.g.: Use <code>Troll 2</code> to predict <code>is</code>:  Current word is <code>Troll 2</code> therefore the <code>1</code>, other words all receive <code>0</code>, hence 1000. And we expect the next word to be <code>is</code>, a.k.a 0100.</p> <p> <p>To make the predictions:</p> <ol> <li>we connect the Activation Functions to the outputs</li> <li>add weights to the connections with random initialization values</li> <li>Run the outputs through SoftMax function: because we have multiple outputs for classification</li> <li>We use Cross Entropy loss function for Backpropagation</li> </ol> <p>Now looking at the initial state, we can plot the weights of the Activation Functions(AF) by putting the first AF on the X-axis, and second AF on the Y-axis. The diagram looks like this: </p> <p> <p>Since <code>Troll 2</code> and <code>Gymkata</code> are both movies and appear in the same position in the sentence, we expect Backpropagation will make them close on the diagram like this:</p> <p> <p>We call the \"backpropagated\" weight - Embeddings</p> <p>Summary</p> <p>We ask Neural Network to assign numbers to the words</p>"},{"location":"data_scientist/embedding/#word2vec","title":"Word2Vec","text":"<p>Word2Vec is the process to create Word Embeddings</p>"},{"location":"data_scientist/embedding/#1-continuous-bag-of-words","title":"1. Continuous Bag of Words","text":"<p>This increases the context by using the surrounding words to predict what occurs in the middle.</p> <p>Use <code>Troll 2</code> and <code>great</code> to predict <code>is</code></p>"},{"location":"data_scientist/embedding/#2-skip-gram","title":"2. Skip Gram","text":"<p>This increases the context by using the word in the middle to predict the surrounding words.</p> <p>Use <code>is</code> to predict <code>Troll 2</code> and <code>great</code></p> <p>Convention</p> <p>We usually use 100 or more AF to create loooots of Embeddings per word.</p> <p>We use 3 Million words as training data.</p> <p>So the total amount of weights in the NN is: 3,000,0001002</p>"},{"location":"design_thinking/","title":"Design Thinking","text":""},{"location":"design_thinking/#introduction","title":"Introduction","text":"<p>Design Thinking is a problem solving approach that aims to improve people's experiences.</p> <p>Why do we need Design Thinking?</p> <p>Check the difference between:</p> <ul> <li>Design a vase</li> <li>Design a better way to enjoy flowers in your home.</li> </ul>"},{"location":"design_thinking/#enterprise-design-thinking","title":"Enterprise Design Thinking","text":"<p>a tailor-made approach for large, distributed teams to help them quickly deliver human-centered outcomes to the market.</p>"},{"location":"design_thinking/#the-principles","title":"\u27a1\ufe0f The Principles","text":"<ul> <li>Focus on user outcomes</li> <li>Restless reinvention</li> <li>Diverse Empowered Teams</li> </ul>"},{"location":"design_thinking/#the-loop","title":"The Loop","text":"<p>a continuous cycle of:</p> <p>Observe -&gt; Reflext -&gt; Make</p>"},{"location":"design_thinking/#the-keys","title":"The Keys","text":"<ul> <li>Hills: statements of intent written as user enablements. They follow a format of <code>Who, What, Wow</code></li> <li>Playbacks: to get feedbacks</li> <li>Sponsor Users</li> </ul>"},{"location":"dev_ops/observability/","title":"Observability","text":"<p>The goal of observability is to identify/debug the Problem.</p> <p>Observability</p> <p>How well you can reason through the software state by using telemetric outputs.</p> <p>\"\u9065\u6d4b\" (telemetry) refers to the collection and transmission of data from remote sources, while \"\u8f93\u51fa\" (outputs) denotes the data that is generated and provided by the system.</p> <p>Nowaday, Microservice is the trend. However, they also create a much more complex and diverse software architecture - since there are not so much central governance of these systems.</p> <p>\u27a1\ufe0f \u27a1\ufe0f \u27a1\ufe0f The system has become more complex, therefore we need Observability</p>"},{"location":"dev_ops/observability/#what-are-we-observing","title":"What are we observing?","text":"<p>Taking e-commerce shop as example. When a customer places an order, the system checks if the product is in stock, if the payment method is valid, and whether the customer has provided all necessary information (e.g., shipping address).</p> <ul> <li>Business Logic: The number of validation failures and the average time taken for validation checks.</li> <li>Application Logic: how many HTTP requests</li> <li>Runtime: if the App is writen in Go, how much time it spends in Garbage collection</li> <li>Kernel:  how is the CPU and memory utilization</li> <li>Hardware: The temperature of the CPU, or the speed of the fans</li> </ul> <p></p>"},{"location":"dev_ops/observability/#problem-types","title":"Problem Types","text":"<ul> <li>Known Known: I send a request to a server and get a 503, I know the app is unavailable.</li> <li>Known Unknown: I send a request to a server but it doesnt work, I have the hypothesize that the application is attempting to write to disk, but the disk is full - but we cannot validate this as we have no telemetry on the disk.</li> <li>Unknown Unknown: we've validated everything that we can think of. But still couldn't find where the problem is</li> <li>Unknown Known: We are sure that the app works, but someons has overridden the DNS record, which points to our service.</li> </ul>"},{"location":"dev_ops/observability/#effective-observability","title":"Effective Observability","text":"<p>A system requires two things in order to be observable:</p> <ol> <li>The telemetric data: that describe its internal state at some specific time.</li> <li>Understanding of the system. E.p. read the code</li> </ol>"},{"location":"dev_ops/observability/#pillars-of-observability","title":"Pillars of Observability","text":""},{"location":"dev_ops/observability/#pillar-1-logs","title":"Pillar 1: Logs","text":"<p>Three Standard Streams in computer programs: <code>STDIN</code>, <code>STDOUT</code>, <code>STDERR</code>, the <code>STDOUT</code> and <code>STDERR</code> are where the logs are. </p>"},{"location":"dev_ops/observability/#log-components","title":"Log Components","text":"<ol> <li>Trigger Event</li> <li>Context: that you want to associate with the Trigger Event</li> </ol>"},{"location":"dev_ops/observability/#syslog-severity-levels","title":"Syslog Severity Levels","text":"Level Severity Keyword Description 0 Emergency emerg System is unusable 1 Alert alert Action must be taken immediately 2 Critical crit Critical conditions 3 Error err Error conditions 4 Warning warning Warning conditions 5 Notice notice Normal but significant condition 6 Informational info Informational messages 7 Debug debug Debug-level messages"},{"location":"dev_ops/observability/#log-destination","title":"Log Destination","text":"<ol> <li>Standard Stream (<code>STDERR</code>)</li> <li>File</li> <li>Network Socket</li> <li>Pipe</li> </ol> <p>Some log Destination may require a single owner process to coordinates:</p> <p></p> <p>However, a process will periodically flush these logs to the final destination, but many things might have written records to that buffer in the meantime.\u27a1\ufe0f \u27a1\ufe0f \u27a1\ufe0f This means that as we're actually consuming the logs, they might be in a wrong order. The 2 sides of Log Stream:</p> Advantages Disadvantages 1. Easy to implement 2. Well supported 3. Arbitrarily complex 4. Useful in production  1. Expensive  2. Structured <p>When to use logs?</p> <p>For the app that:</p> <ol> <li>Low traffic</li> <li>Single Instance</li> <li>Isolated</li> </ol>"},{"location":"dev_ops/observability/#log-consumption","title":"Log Consumption","text":"<ol> <li>in Terminal     Locally in your PC, or if you have the app on Cloud, you can do <code>kubectl log [Pod Name]</code> to view the logs.  Tools like <code>grep</code>(search tool) and <code>jq</code>(a JSON processor) are also useful for searching info.</li> <li> <p>Log Aggregation &amp; Indexing. Advantages:</p> <ul> <li>These indexes can be handy to establish patterns in the data. </li> <li>Beyond that they centralized logs and they can provide this like grep like or jq like functionality</li> <li>that's not tied to your local machine and can be much faster to process a really large amounts of material.</li> </ul> <p>Break down</p> <p>(1) Log IngestionLogs from various sources (applications, servers, etc.) are collected using agents (e.g., Filebeat, Fluentd) in JSON format (JSON is suitable for indexing)  <pre><code>{\n    \"timestamp\": \"2024-10-22T08:00:00Z\",\n    \"log_level\": \"ERROR\",\n    \"message\": \"Failed to connect to database\",\n    \"service\": \"payment-service\"\n}\n</code></pre> (2) Log IndexingAn index is a data structure that allows quick lookups. For example, <code>Elasticsearch</code> builds inverted indexes which map terms  (3) QueryingOnce indexed, logs can be queried     <pre><code># QUERY:\nGET /logs/_search\n\n# RESULT:\n{\n    \"query\": {\n        \"bool\": {\n        \"must\": [\n            { \"match\": { \"log_level\": \"ERROR\" }},\n            { \"match\": { \"service\": \"payment-service\" }}\n        ]\n        }\n    }\n}\n</code></pre></p> </li> </ol>"},{"location":"dev_ops/observability/#pillar-2-distributed-tracing","title":"Pillar 2: Distributed Tracing","text":"<p>Nowaday we have microservices architecture, instead of the monolithic. But microservices is more complex. For instance, imagine a user of an online-shop is trying to order sth:</p> Problem: There is error in the order process, we don't know which microservice caused the error The system become extremely slow, when the request increases Only certain users have this slow order problem Illustration:"},{"location":"dev_ops/observability/#history","title":"History","text":"Year Approach Description 2010 Dapper, a large-scale distributed systems tracing infrastructure by Google, they describe the core challenge, specific designs and the trade-offs they made, and an evaluation of how well it works 2012 Zipkin by Twitter, replicated many benefits from Dapper 2015 T channel, a new RPC protocol by Uber, one of the protocol goals is the Dapper tracing being part of the format, similar to what Zipkin is doing, but it has limitations of how data is stored 2015 OpenTracing It provides turnkey tracing by providing common standards for span management and inter-process propagation. 2017 Jaeger by Uber, release it as open-source, and donated to CNCF 2018 OpenCensus by Google, This framework went beyond OpenTracing, implementing APIs for metric collection and solving another really critical component of observability need. However, the OpenTracing and OpenCensus projects were now competing projects, both implementing a tracing API, and neither was especially compatible with each other 2019 Open Telemetry = OpenTracing + OpenCensus, it seeks to provide high quality, ubiquitous and portable transport telemetry to enable effective observability. It contains ALL required technologies to export <code>metrics</code>, <code>logs</code> and <code>traces</code>. Advantages: - support multiple programming languages- vendor-neutral <p>Turnkey Tracing</p> <p>Turnkey\u8868\u793a\u201c\u5f00\u7bb1\u5373\u7528\u7684\u201d\u6216\u8005\u201cready to use\u201d): refers to providing an easy, ready-to-use solution for distributed tracing.</p> <p>Imagine a web request that goes through three services:     <pre><code>Service A (frontend) \u2192 Service B (authentication) \u2192 Service C (payment processing).\n</code></pre> A turnkey tracing system automatically generates and collects trace data for each of these services, allowing you to see the entire lifecycle of a request without any heavy setup.</p> <p>Span Management</p> <p>\u8de8\u6bb5\u7ba1\u7406, is the process of managing individual spans within a trace. Continuing the previous example:     <pre><code>Span 1: Request starts in Service A (frontend).\nSpan 2: Request is forwarded to Service B (authentication) and processed.\nSpan 3: Service C (payment) completes the transaction.\n</code></pre> Each of these spans is collected and linked to form the complete picture of a request\u2019s flow across services. Span management ensures that spans are tracked and organized correctly.</p> <p>Inter-Process Propagation</p> <p>\u8fdb\u7a0b\u95f4\u4f20\u64ad, automatically passes tracing information between services, linking spans into a complete trace.</p>"},{"location":"dev_ops/observability/#trace","title":"Trace","text":"<p>Traces give us the big picture of what happens when a request is made to an application. Whether your application is a monolith with a single database or a sophisticated mesh of services, traces are essential to understanding the full \u201cpath\u201d a request takes in your application.</p>"},{"location":"dev_ops/observability/#tracer","title":"Tracer","text":"<p>A Tracer creates spans containing more information about what is happening for a given operation, such as a request in a service. Tracers are created from Tracer Providers.</p>"},{"location":"dev_ops/observability/#tracer-provider","title":"Tracer Provider","text":"<p>A Tracer Provider is a factory for Tracers. In most applications, a Tracer Provider is initialized once and its lifecycle matches the application\u2019s lifecycle. </p>"},{"location":"dev_ops/observability/#trace-exporters","title":"Trace Exporters","text":"<p>Trace Exporters send traces to a consumer. This consumer can be standard output for debugging and development-time, the OpenTelemetry Collector, or any open source or vendor backend of your choice.</p>"},{"location":"dev_ops/observability/#span","title":"Span","text":"<p>A Span represents a single operation unit within a trace. A span can includes another span\u3002It can be represented in JSON: <pre><code>{\n  \"name\": \"hello\",\n  \"context\": {\n    \"trace_id\": \"5b8aa5a2\",\n    \"span_id\": \"051581bf\"\n  },\n  \"parent_id\": null,    # \ud83d\udca1 this indicates the parent/child relationship\n  \"start_time\": \"2022-04-29T18:52:58.114201Z\",\n  \"end_time\": \"2022-04-29T18:52:58.114687Z\",\n  \"attributes\": {\n    \"http.route\": \"some_route1\",\n    \"net.transport\": \"IP.TCP\",\n    \"net.peer.ip\": \"172.17.0.1\"\n  },\n  \"events\": [\n    {\n      \"name\": \"Guten Tag!\",\n      \"timestamp\": \"2022-04-29T18:52:58.114561Z\",\n      \"attributes\": {\n        \"event_attributes\": 1\n      }\n    },\n    {\n      \"name\": \"\",\n      \"message\": \"OK\",\n      \"timestamp\": \"2021-10-22 16:04:01.209512872 +0000 UTC\"\n    }\n  ],\n  \"status_code\": \"STATUS_CODE_OK\",\n  \"status_message\": \"\",\n}\n</code></pre></p> <p>Usually, a span includes the following informations:</p> <ul> <li>Name</li> <li>Parent span ID (empty for root spans)</li> <li>Start and End Timestamps</li> <li>Span Context: an immutable object on every span that contains <code>TraceID</code>, <code>SpanID</code>, <code>TraceFlags</code>, <code>TraceState</code></li> <li>Attributes: key-value pairs that contain metadata</li> <li>Span Events: a structured log message (or annotation) on a Span, such as: </li> <li>Span Links: to associate one span with one or more spans, implying a causal relationship. </li> <li>Span Status: possible values are <code>Unset</code>, <code>Error</code>, <code>Ok</code></li> </ul> <p>! info \"Types of Span\"     They are 5 types of Span: </p> <pre><code>- `Client`: a synchronous outgoing remote call such as: an outgoing HTTP request or database call. Note that in this context, \u201csynchronous\u201d does not refer to `async/await`, but to the fact that it is not queued for later processing.\n- `Server`: a synchronous incoming remote call such as: an incoming HTTP request\n- `Internal`: an operation which does not cross a process boundary such as: instrumenting a function call \n- `Producer`: the creation of a job which may be asynchronously processed later such as: a remote job such as one inserted into a job queue \n- `Consumer`: the processing of a job created by a producer and may start long after the producer span has already ended.\n</code></pre>"},{"location":"dev_ops/observability/#pillar-3-metrics","title":"Pillar 3: Metrics","text":"<p>A metric is a measurement of a service captured at runtime. </p>"},{"location":"dev_ops/observability/#other-jargons","title":"Other Jargons","text":"<p>Lots of definitions are found here</p>"},{"location":"dev_ops/observability/#endpoints","title":"Endpoints","text":"<p>Endpoints define the API of a service. Every endpoint has a single, automatically discovered type: <code>BATCH</code>, <code>Database</code>, <code>HTTP</code>, <code>MESSAGING</code>, <code>RPC</code>, <code>GraphQL</code></p>"},{"location":"dev_ops/observability/#inbound-calls-incoming-calls","title":"Inbound Calls = Incoming Calls","text":"<p>the requests that your service or application receives from other services or clients. </p> <p>Antonym: Outbound/Outgoing Calls</p>"},{"location":"dev_ops/observability/#latency","title":"Latency","text":"<p>Latency is a measure of delay, usually in milliseconds. Endpoint Latency indicates how quickly an endpoint responds to incoming requests.</p>"},{"location":"dev_ops/observability/#service","title":"Service","text":"<p>Service can be seen as a logical component that provides a public API. </p>"},{"location":"dev_ops/observability/#stream","title":"Stream","text":"<p>Upstream vs Downstream</p> <p>up and down are relative concepts according to the direction of how the data flows</p> <p></p>"},{"location":"ecommerce/wordpress/","title":"Wordpress","text":""},{"location":"ecommerce/wordpress/#installation","title":"Installation","text":"<p>2 Ways to install:</p> <ol> <li>local computer: for testing purpose</li> <li>web host: for real use</li> </ol>"},{"location":"ecommerce/wordpress/#difference-between-wordpresscom-wordpressorg","title":"Difference between wordpress.com &amp; wordpress.org","text":"<ul> <li>wordpress.com:</li> <li>free version, suitable for blogs</li> <li>you dont have the control of the site</li> <li>wordpress can close it down</li> <li>you cannot put your own advertisement</li> <li>you cannot install plugins</li> <li>wordpress.org:</li> <li>for business &amp; economics</li> <li>100% customizable</li> <li>plugins installation possible</li> <li>has control of advertisement</li> </ul> <p>!!! attention: we will use wordpress.org!</p>"},{"location":"ffmpeg/","title":"ffmpeg","text":""},{"location":"ffmpeg/#trim-video","title":"Trim video","text":"<pre><code>ffmpeg -ss 00:01:00 -to 00:02:00 -i input.mp4 -c copy output.mp4\n</code></pre>"},{"location":"frontend/cra/","title":"CRA","text":""},{"location":"frontend/cra/#create-react-app-cra","title":"Create React App (CRA)","text":"<p>In CRA, the src directory is the root of the project, and by default, you cannot import files from outside the src directory due to security reasons. Therefore this will not work:</p> <pre><code>import DE from '../public/languages/german.json';\n</code></pre> <p>Error</p> <p>The <code>public</code> directory is served as-is and not processed by webpack!</p> <p>The solution will be: <pre><code>// Move the file to src/languages/german.json\nimport GM from './languages/german.json';\n</code></pre></p>"},{"location":"frontend/css/css-in-depth/","title":"CSS In Depth","text":""},{"location":"frontend/css/css-in-depth/#_1","title":"\u6837\u5f0f\u8868\u6765\u6e90","text":"<ol> <li>\u4f5c\u8005\u6837\u5f0f\u8868</li> <li>\u7528\u6237\u4ee3\u7406\u6837\u5f0f\u8868/user agent stylesheet\uff1a\u5373\u6d4f\u89c8\u5668\u9ed8\u8ba4\u6837\u5f0f    \u5176\u4e2d\u7684 \u4f5c\u8005\u6837\u5f0f\u8868 \u4f1a\u8986\u76d6 \u7528\u6237\u4ee3\u7406\u6837\u5f0f\u8868</li> </ol> <p>\u5c42\u53e0\u7684\u9ad8\u7ea7\u6d41\u7a0b\u56fe\uff0c\u5c55\u793a\u4e86\u58f0\u660e\u7684\u4f18\u5148\u987a\u5e8f\uff1a</p>"},{"location":"frontend/css/css-in-depth/#_2","title":"\u5168\u5c40\u9009\u62e9\u5668","text":"<pre><code>:root {\n\n}\n\n*,\n::before,\n::after {\n\n}\n</code></pre>"},{"location":"frontend/css/css-in-depth/#_3","title":"\u5355\u4f4d","text":"<p><code>em</code> \u5f53\u524d\u5b57\u4f53\u5927\u5c0f\u7684\u76f8\u5bf9\u5355\u4f4d\u3002 <code>rem=Root em</code>\uff0c\u6839CSS\u6587\u4ef6\u4e2d\u5b57\u4f53\u5927\u5c0f\u7684\u76f8\u5bf9\u5355\u4f4d</p> <p>tipps</p> <p>\u6211\u4e00\u822c\u4f1a\u7528rem\u8bbe\u7f6e\u5b57\u53f7\uff0c\u7528px\u8bbe\u7f6e\u8fb9\u6846\uff0c\u7528em\u8bbe\u7f6e\u5176\u4ed6\u5927\u90e8\u5206\u5c5e\u6027\uff0c\u5c24\u5176\u662f\u5185\u8fb9\u8ddd\u3001\u5916\u8fb9\u8ddd\u548c\u5706\u89d2\uff08\u4e0d\u8fc7\u6211\u6709\u65f6\u7528\u767e\u5206\u6bd4\u8bbe\u7f6e\u5bb9\u5668\u5bbd\u5ea6\uff09\u3002 </p> <ul> <li>vh\uff1a\u89c6\u53e3\u9ad8\u5ea6\u76841/100\u3002</li> <li>vw\uff1a\u89c6\u53e3\u5bbd\u5ea6\u76841/100\u3002</li> <li>vmin\uff1a\u89c6\u53e3\u5bbd\u3001\u9ad8\u4e2d\u8f83\u5c0f\u7684\u4e00\u65b9\u76841/100\uff08IE9\u4e2d\u53ebvm\uff0c\u800c\u4e0d\u662fvmin\uff09\u3002</li> <li>vmax\uff1a\u89c6\u53e3\u5bbd\u3001\u9ad8\u4e2d\u8f83\u5927\u7684\u4e00\u65b9\u76841/100\uff08\u672c\u4e66\u5199\u4f5c\u65f6IE\u548cEdge\u5747\u4e0d\u652f\u6301vmax\uff09\ufffc\u3002</li> </ul> <p>\u53ef\u5728Can I Use\u7f51\u7ad9\u4e2d\u68c0\u7d22Viewport units: vw, vh, vmin, vmax\u4e2d\u7684\u201cKnown Issues\u201d\u3002</p>"},{"location":"frontend/css/css-in-depth/#_4","title":"\u65e0\u5355\u4f4d\u7684\u6570\u5b57\u5c5e\u6027\u503c","text":"<p>\u6709\u4e9b\u5c5e\u6027\u5141\u8bb8\u65e0\u5355\u4f4d\u7684\u503c\uff08\u5373\u4e00\u4e2a\u4e0d\u6307\u5b9a\u5355\u4f4d\u7684\u6570\uff09\u3002\u652f\u6301\u8fd9\u79cd\u503c\u7684\u5c5e\u6027\u5305\u62ecline-height\u3001z-index\u3001font-weight\uff08700\u7b49\u4e8ebold,400\u7b49\u4e8enormal\uff0c\u7b49\u7b49\uff09\u3002\u65e0\u5355\u4f4d\u7684\u6570\u503c\uff0c\u56e0\u4e3a\u5b83\u4eec\u7ee7\u627f\u7684\u65b9\u5f0f\u4e0d\u4e00\u6837\u3002\u4f7f\u7528\u65e0\u5355\u4f4d\u7684\u6570\u503c\u65f6\uff0c\u7ee7\u627f\u7684\u662f\u58f0\u660e\u503c</p> <p>\u6bb5\u843d\u5b57\u53f7\u662f32px\uff082em \u00d7 16px\uff0c\u6d4f\u89c8\u5668\u9ed8\u8ba4\u5b57\u53f7\uff09\uff0c\u6240\u4ee5\u6b64\u65f6\u884c\u9ad8\u7684\u8ba1\u7b97\u503c\u4e3a38.4px\uff0832px\u00d71.2\uff09</p>"},{"location":"frontend/css/css-in-depth/#_5","title":"\u9009\u62e9\u5668","text":"<ul> <li><code>&gt;</code> \u662f\u4e00\u4e2a\u76f4\u63a5\u540e\u4ee3\u7ec4\u5408\u5668\u3002 </li> <li><code>*</code> \u6240\u6709\u540e\u4ee3recursively</li> </ul>"},{"location":"frontend/css/css-in-depth/#_6","title":"\u51fd\u6570","text":"<p>calc()\u51fd\u6570\u5185\u53ef\u4ee5\u5bf9\u4e24\u4e2a\u53ca\u5176\u4ee5\u4e0a\u7684\u503c\u8fdb\u884c\u57fa\u672c\u8fd0\u7b97\u3002\u5f53\u8981\u7ed3\u5408\u4e0d\u540c\u5355\u4f4d\u7684\u503c\u65f6\uff0ccalc()\u7279\u522b\u5b9e\u7528\u3002\u5b83\u652f\u6301\u7684\u8fd0\u7b97\u5305\u62ec\uff1a\u52a0\uff08+\uff09\u3001\u51cf\uff08\u2212\uff09\u3001\u4e58\uff08\u00d7\uff09\u3001\u9664\uff08\u00f7\uff09\u3002</p> <p> \u52a0\u53f7\u548c\u51cf\u53f7\u4e24\u8fb9\u5fc5\u987b\u6709\u7a7a\u767d </p>"},{"location":"frontend/css/css-in-depth/#_7","title":"\u53d8\u91cf","text":"<p>\u53d8\u91cf\u540d\u524d\u9762\u5fc5\u987b\u6709\u4e24\u4e2a\u8fde\u5b57\u7b26\uff08--\uff09\uff0c\u7528\u6765\u8ddfCSS\u5c5e\u6027\u533a\u5206\uff0c\u5269\u4e0b\u7684\u90e8\u5206\u53ef\u4ee5\u968f\u610f\u547d\u540d\u3002  \u26a0\ufe0f \u5728\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49\u5c5e\u6027\u7684\u6d4f\u89c8\u5668\u4e0a\uff0c\u4efb\u4f55\u4f7f\u7528ver\uff08\uff09\u7684\u58f0\u660e\u90fd\u4f1a\u88ab\u5ffd\u7565\u3002\u8bf7\u5c3d\u91cf\u4e3a\u8fd9\u4e9b\u6d4f\u89c8\u5668\u63d0\u4f9b\u56de\u9000\u65b9\u6848(fallback)\uff1a <pre><code>color: black;\ncolor: var (--main-color);\n</code></pre></p> <p>\u5e94\u7528\u573a\u666f\u6709\u5207\u6362\u7f51\u7ad9\u4e3b\u9898\u7b49\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7528JS\u8bbf\u95ee\u5230\u8be5\u53d8\u91cf\u7684\u503c\uff1a <pre><code>&lt;script&gt;\n   var rootElement = document.documentElement;\n   var styles = getComputedStyle(rootElement);\n   var mainColor = styles.getPropertyValue('--main-bg');\n   console.log(String(mainColor).trim());\n&lt;/script&gt;\n</code></pre></p>"},{"location":"frontend/css/css-in-depth/#_8","title":"\u5e03\u5c40","text":"<p>\u9ad8\u7ea7\u7684\u5e03\u5c40\u8bdd\u9898\u57fa\u4e8e<code>\u6587\u6863\u6d41 / flow</code>\u548c`\u76d2\u6a21\u578b / box-model \u7b49\u6982\u5ff5\uff0c\u8fd9\u4e9b\u662f\u51b3\u5b9a\u7f51\u9875\u5143\u7d20\u7684\u5927\u5c0f\u548c\u4f4d\u7f6e\u7684\u57fa\u672c\u89c4\u5219\u3002</p>"},{"location":"frontend/css/css-in-depth/#_9","title":"\u6a2a\u5411\uff1a\u4e24\u5217\u5e03\u5c40","text":"<p>\u4f7f\u7528\u6d6e\u52a8\u5e03\u5c40\uff0c\u5c06main\u548csidebar\u5411\u5de6\u6d6e\u52a8\uff0c\u5206\u522b\u8bbe\u7f6e70%\u548c30%\u7684\u5bbd\u5ea6\u3002 <pre><code>.main {\n   float: left; \n   width: 70%;\n}\n.sidebar {\n   float: left;\n   width: 30%;\n}\n</code></pre> \u867d\u7136\u5c06\u4e24\u5217\u5bbd\u5ea6\u8bbe\u7f6e\u4e3a70%\u548c30%\uff0c\u4f46\u5b83\u4eec\u603b\u5171\u5360\u636e\u7684\u5bbd\u5ea6\u8d85\u8fc7\u4e86\u53ef\u7528\u7a7a\u95f4\u7684100%\u3002\u8fd9\u662f\u56e0\u4e3a\u5176\u4e2d\u7684width\u6307\u7684\u662f\u7eaf\u5185\u5bb9\u7684\u5bbd\u5ea6\uff0c\u5373 <code>box-sizing: content-box</code>\uff08\u6ca1\u6709\u7b97\u4e0apadding\uff0cborder\u548cmargin\uff09</p> <p></p> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <ol> <li>\u5c06<code>sidecar</code>\u7684\u5bbd\u5ea6\u8bbe\u7f6e\u6210 <code>calc(30%-3em)</code></li> <li>\u8c03\u6574 \u76d2\u6a21\u578b <code>box-sizing: border-box</code></li> </ol> <p></p> <p>Best Practise: <pre><code>:root {\n   box-sizing: border-box;\n}\n\n*,\n::before,\n::after {\n   box-sizing: inherit;\n}\n</code></pre></p> <p>\u666e\u901a\u6587\u6863\u6d41 / Workflow</p> <p>\u666e\u901a\u6587\u6863\u6d41\u2014\u2014\u6307\u7684\u662f\u7f51\u9875\u5143\u7d20\u7684\u9ed8\u8ba4\u5e03\u5c40\u884c\u4e3a\u3002\u884c\u5185\u5143\u7d20\u8ddf\u968f\u6587\u5b57\u7684\u65b9\u5411\u4ece\u5de6\u5230\u53f3\u6392\u5217\uff0c\u5f53\u5230\u8fbe\u5bb9\u5668\u8fb9\u7f18\u65f6\u4f1a\u6362\u884c\u3002\u5757\u7ea7\u5143\u7d20\u4f1a\u5360\u636e\u5b8c\u6574\u7684\u4e00\u884c\uff0c\u524d\u540e\u90fd\u6709\u6362\u884c\u3002</p> <p>\u666e\u901a\u6587\u6863\u6d41\u662f\u4e3a\u9650\u5b9a\u7684\u5bbd\u5ea6\u548c\u65e0\u9650\u7684\u9ad8\u5ea6\u8bbe\u8ba1\u7684\u3002</p>"},{"location":"frontend/css/css-in-depth/#_10","title":"\u9ad8\u5ea6","text":"<p>\u666e\u901a\u6587\u6863\u6d41\u662f\u4e3a\u9650\u5b9a\u7684\u5bbd\u5ea6\u548c\u65e0\u9650\u7684\u9ad8\u5ea6\u8bbe\u8ba1\u7684\u3002\u5f53\u660e\u786e\u8bbe\u7f6e\u4e00\u4e2a\u5143\u7d20\u7684\u9ad8\u5ea6\u65f6\uff0c\u5185\u5bb9\u53ef\u80fd\u4f1a\u6ea2\u51fa\u5bb9\u5668\u3002\u7528overflow\u5c5e\u6027\u53ef\u4ee5\u63a7\u5236\u6ea2\u51fa\u5185\u5bb9\u7684\u884c\u4e3a\uff0c\u8be5\u5c5e\u6027\u652f\u6301\u4ee5\u4e0b4\u4e2a\u503c\uff1a</p> <ul> <li>visible\uff08\u9ed8\u8ba4\u503c\uff09: \u6240\u6709\u5185\u5bb9\u53ef\u89c1\uff0c\u5373\u4f7f\u6ea2\u51fa\u5bb9\u5668\u8fb9\u7f18\u3002</li> <li>hidden: \u6ea2\u51fa\u5bb9\u5668\u5185\u8fb9\u8ddd\u8fb9\u7f18\u7684\u5185\u5bb9\u88ab\u88c1\u526a\uff0c\u65e0\u6cd5\u770b\u89c1\u3002</li> <li>scroll: \u5bb9\u5668\u51fa\u73b0\u6eda\u52a8\u6761\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u6eda\u52a8\u67e5\u770b\u5269\u4f59\u5185\u5bb9\u3002\u5728\u4e00\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u4e0a\uff0c\u4f1a\u51fa\u73b0\u6c34\u5e73\u548c\u5782\u76f4\u4e24\u79cd\u6eda\u52a8\u6761\uff0c\u5373\u4f7f\u6240\u6709\u5185\u5bb9\u90fd\u53ef\u89c1\uff08\u4e0d\u6ea2\u51fa\uff09\u3002\u4e0d\u8fc7\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6eda\u52a8\u6761\u4e0d\u53ef\u6eda\u52a8\uff08\u7f6e\u7070\uff09\u3002</li> <li>auto: \u53ea\u6709\u5185\u5bb9\u6ea2\u51fa\u65f6\u5bb9\u5668\u624d\u4f1a\u51fa\u73b0\u6eda\u52a8\u6761\u3002</li> </ul> <p> \u8c28\u614e\u5730\u4f7f\u7528\u6eda\u52a8\u6761!</p>"},{"location":"frontend/css/css-in-depth/#_11","title":"\u5782\u76f4\u5c45\u4e2d","text":"<p>!!! \"info\" IE     IE\u6709\u4e00\u4e2abug\uff0c\u5b83\u4f1a\u9ed8\u8ba4\u5c06<code>&lt;main&gt;</code>\u5143\u7d20\u6e32\u67d3\u6210\u884c\u5185\u5143\u7d20\uff0c\u800c\u4e0d\u662f\u5757\u7ea7\u5143\u7d20\uff0c\u6240\u4ee5\u4ee3\u7801\u4e2d\u6211\u4eec\u7528\u58f0\u660e<code>display: block</code>\u6765\u7ea0\u6b63\u3002</p>"},{"location":"frontend/css/css-in-depth/#_12","title":"\u7b49\u9ad8\u5217","text":""},{"location":"frontend/css/notes/","title":"Notes","text":""},{"location":"frontend/css/notes/#clearfix","title":"clearfix","text":""},{"location":"frontend/css/notes/#method-1","title":"Method 1","text":"<p>To ensure that mainContainer has at least the height of the content in leftContent when both leftContent and rightContent are floating elements, you can use the clearfix technique. This technique is used to clear the float and make the container wrap around its floated children. <pre><code>#mainContainer {\n    overflow: auto; /* or overflow: hidden; */\n}\n\n#leftContent {\n    float: left;    /* your other styles for leftContent */\n}\n\n#rightContent {\n    float: left;    /* your other styles for rightContent */\n}\n</code></pre> the overflow: auto; property on mainContainer triggers a new block formatting context, causing it to contain its floated children. This prevents the container from collapsing when all of its children are floated.</p>"},{"location":"frontend/css/notes/#method-2","title":"Method 2","text":"<p>Alternatively, you can use a clearfix class in your HTML: <pre><code>&lt;div id=\"mainContainer\" class=\"clearfix\"&gt;\n    &lt;div id=\"leftContent\"&gt;\n        &lt;!-- content of leftContent --&gt;\n    &lt;/div&gt;\n    &lt;div id=\"rightContent\"&gt;\n        &lt;!-- content of rightContent --&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre></p> <p>and css: <pre><code>.clearfix::after {\n    content: \"\";\n    display: table;\n    clear: both;\n}\n</code></pre></p>"},{"location":"frontend/css/shapes/","title":"Shape","text":""},{"location":"frontend/css/shapes/#resource","title":"Resource","text":"<ul> <li>Julia Miocene's Youtube channel</li> <li>Artist: Mark Rise</li> </ul>"},{"location":"frontend/css/shapes/#useful-css-attributes","title":"Useful CSS attributes","text":"<p>Here we collect some important CSS attributes for drawing in CSS: </p>"},{"location":"frontend/css/shapes/#content","title":"content","text":"<p><code>content: normal|none|counter|attr|string|open-quote|close-quote|no-open-quote|no-close-quote|url|initial|inherit;</code> is usually used with pseudo-selector <code>::after</code> or <code>::before</code>. For instance: <pre><code>.item::before {\n    content: \"- \";\n}\n</code></pre></p>"},{"location":"frontend/css/shapes/#translate","title":"translate","text":"<p><code>translate: x-axis y-axis z-axis|initial|inherit;</code> change position of an element:</p>"},{"location":"frontend/css/shapes/#border-radius","title":"border-radius","text":"<p><code>border-radius: 1-4 length|% / 1-4 length|%|initial|inherit;</code> defines the radius of the element's corners.</p> <pre><code>border-radius: 2em 1em 4em / 0.5em 3em;\n</code></pre> <p>Note: forward slash(\"/\")</p> <p>The forward slash (\"/) is used to separate the horizontal (x-axis) and vertical (y-axis) radii: <code>[horizontal radius] / [vertical radius]</code></p> <p>An equivalent way to write them separately: <pre><code>border-top-left-radius: 2em 0.5em;\nborder-top-right-radius: 1em 3em;\nborder-bottom-right-radius: 4em 0.5em;\nborder-bottom-left-radius: 1em 3em;\n</code></pre></p>"},{"location":"frontend/css/shapes/#background","title":"background","text":"<p>The background property is a shorthand property for the followings</p> <ul> <li>background-color</li> <li>background-image</li> <li>background-position</li> <li>background-size</li> <li>background-repeat</li> <li>background-origin</li> <li>background-clip</li> <li>background-attachment</li> </ul> <pre><code>background: bg-color bg-image position/bg-size bg-repeat bg-origin bg-clip bg-attachment initial|inherit;\n</code></pre> <p>Note: forward slash(\"/\")</p> <p>If one of the properties in the shorthand declaration is the <code>bg-size</code> property, you must use a / (slash) to separate it from the bg-position property: <code>bg-position / bg-size</code></p> <p>CSS allows you to add multiple background. The different backgrounds are separated by commas (<code>,</code>), and the images are stacked on top of each other, where the first image is closest to the viewer. For example: <pre><code>#example1 {\n  background-image: url(img_flwr.gif), url(paper.gif);\n  background-position: right bottom, left top;\n  background-repeat: no-repeat, repeat;\n}\n/*This can be compressed into 1 sentence:*/\n\n#example1 {\n  background: \n    url(img_flwr.gif) right bottom no-repeat, \n    url(paper.gif) left top repeat;\n}\n</code></pre></p>"},{"location":"frontend/css/shapes/#mask-image","title":"mask-image","text":"<p>to create a mask layer to place over an element to partially or fully hide portions of the element. The mask layer can be one of the following formats: - a PNG image - an SVG image - a CSS gradient - an SVG  element <p>Attention</p> <p>Most browsers only have partial support for CSS masking. You will need to use the -webkit- prefix in addition to the standard property in most browsers.</p> <p>More example of masking technics: https://www.w3schools.com/css/css3_masking.asp </p>"},{"location":"frontend/css/shapes/#box-shadow","title":"box-shadow","text":"<p>besides using this property for shadowing, we can also use it to duplicate existing element.</p> <p><code>box-shadow: none|h-offset v-offset blur spread color |inset|initial|inherit;</code></p> <ul> <li><code>spread</code>: Optional. The spread radius. A positive value increases the size of the shadow, a negative value decreases the size of the shadow</li> <li><code>inset</code>: Optional. Changes the shadow from an outer shadow (outset) to an inner shadow    </li> </ul> <p>To define multiple <code>box-shadow</code>, use <code>,</code> to separate</p> <pre><code>box-shadow: \n    inset   /* inner shadow */\n     0      /* horizontal offset */\n     -13px  /* vertical offset */\n     0      /* blur radius */\n     -10px  /* spread - to resize */\n     var(--dark-skin);  \n</code></pre>"},{"location":"frontend/css/shapes/#aspect-ratio","title":"aspect-ratio","text":"<p>to define the ratio between width and height of an element.</p>"},{"location":"frontend/css/shapes/#useful-css-functions","title":"Useful CSS functions","text":"<p>You can find a full list of CSS functions here.</p>"},{"location":"frontend/css/shapes/#linear-gradient","title":"linear-gradient()","text":"<p><code>background-image: linear-gradient(direction, color-stop1, color-stop2, ...);</code></p> <p><code>direction</code> value could be: - <code>to right</code> - <code>to bottom right</code> - <code>180deg</code></p> <p>Example: <pre><code>background: linear-gradient(\n  140deg,            /* Gradient angle */\n  var(--skin) 50%,   /* Color at 50% position */\n  transparent calc(50% + 1px) /* Transparent color at 50% + 1px position */\n);\n</code></pre></p>"},{"location":"frontend/css/shapes/#calc","title":"calc()","text":"<p>to perform a calculation to be used as the property value.</p> <p>space</p> <p>In the the expression of <code>calc(expression)</code>, you need to add space before and after the mathematic operation. For instance: <code>calc(50% + 1px)</code></p>"},{"location":"frontend/css/shapes/#max","title":"max()","text":""},{"location":"frontend/css/shapes/#min","title":"min()","text":""},{"location":"frontend/gsap/","title":"GSAP","text":""},{"location":"frontend/gsap/#installation","title":"Installation","text":"<ol> <li><code>cdnjs</code> url</li> <li><code>npm install gsap</code></li> <li>download local copy in format of <code>zip</code></li> </ol>"},{"location":"frontend/gsap/#what-can-gsap-move","title":"What can GSAP move?","text":"<ul> <li>SVG</li> <li>Canvas</li> <li>WebGL</li> <li>JS Object</li> </ul>"},{"location":"frontend/gsap/#basic-grammar","title":"Basic Grammar","text":"<pre><code>// 1.param: html element selector: \n//      - could be class-name-selector, id-selector and s.o.\n//      - select list of elements: `.logo, .icon`\n// 2.param: configuratoin for the animation: is a JSON object\ngsap.to(\".logo\", {duration: 2, x: 300})\n</code></pre> <p>In the background, the <code>gsap</code> tool changes the CSS style of the html element <code>.logo</code> using <code>transform: translate(x, y)</code></p>"},{"location":"frontend/gsap/#configuration","title":"Configuration","text":"<p>2rd param: configuration</p> <ol> <li><code>backgroundColor</code> instead of <code>background-color</code>: Because <code>-</code> is interpreted as \"minus\" in JS.</li> <li><code>\"20%\"</code> instead of <code>20%</code>: quotes ensure the string format, because <code>%</code> is an operator in JS.</li> <li>border attribute also give in string format like this: <code>border: \"5px solid white\"</code></li> <li><code>ease</code> controls the movement style of the animation. See doc</li> </ol> <p>Callback functions can also be used as part of the configuration, the available callbacks are:</p> <ul> <li><code>onComplete</code>: invoked when the animation has completed.</li> <li><code>onStart</code>: invoked when the animation begins</li> <li><code>onUpdate</code>: invoked every time the animation updates (on every frame while the animation is active).</li> <li><code>onRepeat</code>: invoked each time the animation repeats.</li> <li><code>onReverseComplete</code>: invoked when the animation has reached its beginning again when reversed.</li> </ul> <p>Except the <code>gsap.to()</code>, there are various other GSAP Attributes &amp; Methods.</p>"},{"location":"frontend/gsap/#utility-functions","title":"Utility functions","text":"<p>In the configuration, for the numeric values like <code>y</code>, you can either give it a number, or a randomization function which generates a random number for you, there are 2 different methods: <pre><code>{\n    duration: 1,\n\n    // Method 1: Math.random() generates a number from 0 to &lt;1\n    y: () =&gt; Math.random()*400 - 200,\n\n    // Method 2: \n    x: \"random(-200, 200)\"\n}\n</code></pre></p> <p>\\\"random(x,y)\\\"</p> <p>this function as string is one of the utility functions provided by GSAP. More to read here</p>"},{"location":"frontend/gsap/#tween","title":"Tween","text":"<p>We call the result of a <code>gsap.to()</code> a <code>tween</code>. All the GSAP Methods returns an instance of <code>tween</code>: <pre><code>let tween = gsap.to(\".logo\", {duration: 2, x: 300})\n</code></pre></p> <p>The tween has attributes and methods to control the animation. For instance: <pre><code>//now we can control it!\ntween.pause();\ntween.seek(2);\ntween.progress(0.5);\ntween.play();\n</code></pre></p>"},{"location":"frontend/gsap/#timeline","title":"Timeline","text":"<p>We can give the animations a sequence using <code>timeline</code>: <pre><code>var tl = gsap.timeline();\n\n// start at exactly 1 second into the timeline (absolute)\ntl.to(\".green\", { x: 600, duration: 2 }, 1);\n\n// insert at the start of the previous animation\ntl.to(\".purple\", { x: 600, duration: 1 }, \"&lt;\");\n\n// insert 1 second after the end of the timeline (a gap)\ntl.to(\".orange\", { x: 600, duration: 1 }, \"+=1\");\n</code></pre></p> <p>The third params is the <code>position</code>, this is used to decide the sequence of the tweens. Timeline itself also provides some special properties, for example: <pre><code>let tl = gsap.timeline({repeat: -1, repeatDelay: 1, yoyo: true})\n</code></pre></p> <p>More possible possibilities checkout here</p>"},{"location":"frontend/gsap/#plugins","title":"Plugins","text":"<p>Besides the GSAP Basic functions in the gsap package, there are also plenty of plugins that offered only in <code>cdn</code> format. For instance ScrollTrigger is super cool and free of charge! Check here for more information. </p>"},{"location":"frontend/js/","title":"JavaScript","text":""},{"location":"frontend/js/#things-to-repeat-remember","title":"Things to repeat &amp; remember","text":""},{"location":"frontend/js/#remove-an-element-from-an-array-by-id","title":"Remove an Element from an Array by ID","text":"<p><pre><code>function removeObjectWithId(arr, id) {\n  return arr.filter((obj) =&gt; obj.id !== id);\n}\nconst arr = [\n  { id: 1, name: 'John' },\n  { id: 2, name: 'Kate' },\n  { id: 3, name: 'Peter' },\n];\nconst newArr = removeObjectWithId(arr, 2);\nconsole.log(newArr);\n</code></pre> Result: <pre><code>[ { id: 1, name: 'John' }, { id: 3, name: 'Peter' } ]\n</code></pre></p> <p>The original array is not modified <pre><code>console.log(arr);\n</code></pre></p> <pre><code>[\n  { id: 1, name: 'John' },\n  { id: 2, name: 'Kate' },\n  { id: 3, name: 'Peter' }\n]\n</code></pre>"},{"location":"frontend/js/#http-request","title":"HTTP Request","text":""},{"location":"frontend/js/#built-in-fetch-api","title":"built-in fetch API","text":"<p>This <code>fetch()</code> function is a browser function, inrelevant to React. <pre><code>fetch('https://postman-echo.com', {\n  method: 'POST',\n  body: JSON.stringify([\"apple\", \"banana\"]),\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n}).then(response =&gt; {   // Do stuffs after receiving the result from the request - its async\n  // Parse the RESPONSE, get the real DATA from the RESPONSE\n  return response.json()\n}).then(data =&gt; {\n  // data\n  console.log(data)\n}).catch(error =&gt; {\n  // handle the error\n  console.log(error.message)\n})\n</code></pre></p>"},{"location":"frontend/nginx/","title":"Nginx","text":"<p>nignx.conf\u4e2d\u7684 <pre><code>http {\n    ...\n    server {\n        listen 3000;\n    }\n}\n</code></pre></p> <p>\u5176\u4e2d\u76843000\u5e94\u8be5\u4e0eDockerfile\u4e2dexpose\u7684port\u662f\u4e00\u6837\u7684\uff01\u6bd4\u5982: <pre><code>...\n\nEXPOSE 3000\n...\n</code></pre></p>"},{"location":"frontend/react/basics/","title":"Basics","text":""},{"location":"frontend/react/basics/#materials","title":"Materials","text":"<ul> <li> <p>Udemy Course To continue, I'm here: https://ibm-learning.udemy.com/course/react-the-complete-guide-incl-redux/learn/lecture/15700342#overview</p> </li> <li> <p>React official tutorial</p> </li> <li>git repo</li> </ul>"},{"location":"frontend/react/basics/#running-project-for-practise","title":"Running Project for practise","text":""},{"location":"frontend/react/basics/#running-local-react-project-mss-way","title":"Running local React project - MS's way","text":"<ol> <li>install nodeJS</li> <li>download <code>*.zip</code> file</li> <li>open the zip file in VSCode</li> <li>run <code>npm install</code> and <code>npm start</code></li> </ol>"},{"location":"frontend/react/basics/#creating-local-new-project","title":"Creating local new project","text":"<p>using <code>create-react-app</code>(or <code>vite</code>) toolkit</p>"},{"location":"frontend/react/basics/#creating-online-new-project","title":"Creating online new project","text":"<p>by type in <code>https://react.new/</code> in the browser in sandbox platform</p>"},{"location":"frontend/react/basics/#react-vs-vanillajs","title":"React vs VanillaJS","text":"<ul> <li>React is declarative, you define the target UI, not the steps to get there. </li> <li>Pure Vanilla JavaScript is imperative, it defines the steps, not the target.</li> </ul>"},{"location":"frontend/react/basics/#component","title":"Component","text":"<p>A component is a piece of the UI (user interface) that has its own logic and appearance.</p> <p>Some rules about Component:</p> <ul> <li>name of a React component is capitalized</li> <li>A <code>*.jsx</code> file can contains multiple components!</li> <li><code>export default</code> specify the main component in current file. </li> <li>JSX is stricter than HTML. You have to close tags like .</li> <li>one component can only return one JSX tag. Wrap the returning content in <code>&lt;&gt;</code></li> <li>use <code>className</code> instead of <code>class</code></li> </ul>"},{"location":"frontend/react/basics/#functional-component","title":"Functional Component","text":"<pre><code>const myComponent = (props) =&gt; {\n    // props.name\n    // props.age\n    // props.setStatus(true)\n}\n</code></pre> <p>or using object destruction for the props:</p> <pre><code>const myComponent = ({name, age, setStatus}) =&gt; {\n    // name\n    // age\n    // setStatus(true)\n}\n</code></pre>"},{"location":"frontend/react/basics/#displaying-data","title":"Displaying data","text":"<p>Displaying data in jsx using curly brackets:  <pre><code>&lt;h1&gt;{user.name}&lt;/h1&gt;\n</code></pre></p> <p>or in attribute  <pre><code>&lt;img src={user.imageUrl} /&gt;\n</code></pre></p>"},{"location":"frontend/react/basics/#string-concatenation","title":"String concatenation","text":"<p>You could also use string concatenation: <pre><code>&lt;img\n    className=\"avatar\"\n    alt={'Photo of ' + user.name}\n  /&gt;\n</code></pre></p>"},{"location":"frontend/react/basics/#using-object","title":"Using object","text":"<p>Using object in JSX: we use a regular <code>{}</code>object inside the <code>style={ }</code> JSX curly braces.  <pre><code>&lt;img\n    className=\"avatar\"\n    style={{\n      width: user.imageSize,\n      height: user.imageSize\n    }}\n  /&gt;\n</code></pre></p>"},{"location":"frontend/react/basics/#rendering-list","title":"Rendering list","text":"<pre><code>const products = [\n  { title: 'Cabbage', id: 1 },\n  { title: 'Garlic', id: 2 },\n  { title: 'Apple', id: 3 },\n];\n\nconst listItems = products.map(product =&gt;\n  &lt;li key={product.id}&gt;\n    {product.title}\n  &lt;/li&gt;\n);\n\nreturn (\n  &lt;ul&gt;{listItems}&lt;/ul&gt;\n);\n</code></pre>"},{"location":"frontend/react/basics/#conditional-rendering","title":"Conditional rendering","text":"<p>\"outsourced\" mode: <pre><code>let content;\nif (isLoggedIn) {\n  content = &lt;AdminPanel /&gt;;\n} else {\n  content = &lt;LoginForm /&gt;;\n}\nreturn (\n  &lt;div&gt;\n    {content}\n  &lt;/div&gt;\n);\n</code></pre></p> <p>\"compact\" mode: <pre><code>&lt;div&gt;\n  {isLoggedIn ? (\n    &lt;AdminPanel /&gt;\n  ) : (\n    &lt;LoginForm /&gt;\n  )}\n&lt;/div&gt;\n</code></pre></p> <p>\"compact\" mode without <code>else</code> branch: <pre><code>&lt;div&gt;\n  {isLoggedIn &amp;&amp; &lt;AdminPanel /&gt;}\n&lt;/div&gt;\n</code></pre></p>"},{"location":"frontend/react/basics/#event","title":"Event","text":"<pre><code>function MyButton() {\n  function handleClick() {\n    alert('You clicked me!');\n  }\n\n  return (\n    &lt;button onClick={handleClick}&gt;\n      Click me\n    &lt;/button&gt;\n  );\n}\n</code></pre> <p>warning</p> <p> <code>onClick={handleClick}</code> has no parentheses at the end! If there is a <code>()</code>, the function will be called IMMEDIATELY!, without <code>()</code> we ONLY pass it through!</p>"},{"location":"frontend/react/basics/#passing-state-across-components","title":"Passing State across Components","text":"<p>Example: <pre><code>const [currentCars, setCurrentCars] = useState([]);\n\nconst addNewCar = car =&gt; {\n    setCurrentCars(prev =&gt; [..prev, car])\n}\n\n// Passing variable &amp; function_referece to another Component\n&lt;carList cars={currentCars} onAddNewCar={addNewCar}&gt;\n</code></pre></p>"},{"location":"frontend/react/basics/#prop-vs-state","title":"<code>prop</code> vs <code>state</code>","text":"<ul> <li><code>prop</code> has the following use cases:<ul> <li>when the data won't change</li> <li>when its passed from a parent</li> <li>can be computed based on existing state/prop</li> </ul> </li> <li><code>state</code> is reserved only for interactivity, that is, data that changes over time</li> </ul>"},{"location":"frontend/react/basics/#hooks","title":"Hooks","text":"<p>Hooks in react</p>"},{"location":"frontend/react/bugs/","title":"Bugs","text":""},{"location":"frontend/react/bugs/#optionsallowedhosts","title":"options.allowedHosts...","text":"<p>\ud83d\udc1e</p> <pre><code>Invalid options object. Dev Server has been initialized using an options object that does not match the API schema.\n- options.allowedHosts[0] should be a non-empty string.\n</code></pre> <p>\ud83c\udf43 I stumbled on this error when updating to node 18.0.0, it works normally with node 17.0.0. Solution: in <code>.env</code> file, add:</p> <pre><code>DANGEROUSLY_DISABLE_HOST_CHECK=true\n</code></pre>"},{"location":"frontend/react/hooks/","title":"Hooks","text":""},{"location":"frontend/react/hooks/#hooks-in-react","title":"Hooks in React","text":"<p>React hook is a complementary function for React Functional Component. In the functionality perspective, we could understand as:</p> <pre><code>Hook + Functional Component = Class Component\n</code></pre> <p>React Hooks are special functions that can only be used in Functional Component. They are have the format of <code>useXXX()</code>. In React@18.20.0, there are 6 types of built-in hooks, plus your own hook - the customized hook.</p> <p></p> <p>Data type in hook</p> <p>the data that saved in hook is an object! Means it can be everything</p>"},{"location":"frontend/react/hooks/#render","title":"render/\u6e32\u67d3","text":"<p>\u4ec0\u4e48\u65f6\u5019\u4e00\u4e2a React \u7684\u7ec4\u5efa\u4f1a render\uff1f</p> <ol> <li>\u521d\u6b21\u6e32\u67d3</li> </ol> <p>\u5f53\u7ec4\u4ef6\u7b2c\u4e00\u6b21\u88ab\u63d2\u5165\u5230 DOM \u4e2d\u65f6\uff0c\u4f1a\u89e6\u53d1\u521d\u6b21\u6e32\u67d3\u3002\u6b64\u65f6 React \u4f1a\u8c03\u7528\u7ec4\u4ef6\u7684\u6e32\u67d3\u65b9\u6cd5\uff0c\u5c06\u7ec4\u4ef6\u7684\u5185\u5bb9\u6e32\u67d3\u5230\u9875\u9762\u4e0a\u3002</p> <ol> <li>\u72b6\u6001\u66f4\u65b0 (State Update)</li> </ol> <p>\u7ec4\u4ef6\u7684 state \u53d1\u751f\u53d8\u5316\u65f6\uff0c\u7ec4\u4ef6\u4f1a\u91cd\u65b0\u6e32\u67d3\u3002React \u4f1a\u6bd4\u8f83\u65b0\u65e7\u72b6\u6001\u7684\u4e0d\u540c\uff0c\u5e76\u6839\u636e\u9700\u8981\u66f4\u65b0 DOM\u3002</p> <ol> <li>\u5c5e\u6027\u66f4\u65b0 (Props Update)</li> </ol> <p>\u7236\u7ec4\u4ef6\u4f20\u9012\u7ed9\u5b50\u7ec4\u4ef6\u7684 props \u53d1\u751f\u53d8\u5316\u65f6\uff0c\u5b50\u7ec4\u4ef6\u4f1a\u91cd\u65b0\u6e32\u67d3\u3002React \u4f1a\u6bd4\u8f83\u65b0\u65e7 props \u7684\u4e0d\u540c\uff0c\u5e76\u6839\u636e\u9700\u8981\u66f4\u65b0 DOM\u3002</p> <ol> <li>\u4e0a\u4e0b\u6587\u66f4\u65b0 (Context Update)</li> </ol> <p>\u5982\u679c\u7ec4\u4ef6\u4f7f\u7528\u4e86 React \u7684 Context\uff0c\u5f53\u4e0a\u4e0b\u6587\u6570\u636e\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u6240\u6709\u4f7f\u7528\u8be5\u4e0a\u4e0b\u6587\u7684\u7ec4\u4ef6\u90fd\u4f1a\u91cd\u65b0\u6e32\u67d3\u3002</p> <ol> <li>\u7236\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3</li> </ol> <p>\u5f53\u7236\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3\u65f6\uff0c\u6240\u6709\u5b50\u7ec4\u4ef6\u4e5f\u4f1a\u91cd\u65b0\u6e32\u67d3\uff0c\u9664\u975e\u5728\u5b50\u7ec4\u4ef6\u4e2d\u4f7f\u7528\u4e86 shouldComponentUpdate \u6216 React \u7684 memo \u7b49\u4f18\u5316\u624b\u6bb5\u3002</p> <ol> <li>\u5f3a\u5236\u66f4\u65b0 (Force Update)</li> </ol> <p>\u8c03\u7528\u7ec4\u4ef6\u5b9e\u4f8b\u7684 forceUpdate \u65b9\u6cd5\uff0c\u4f1a\u5f3a\u5236\u7ec4\u4ef6\u91cd\u65b0\u6e32\u67d3\u3002\u901a\u5e38\u4e0d\u63a8\u8350\u4f7f\u7528\u8fd9\u79cd\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5b83\u4f1a\u8df3\u8fc7 React \u7684\u4f18\u5316\u3002</p> <p>\u6211\u4eec\u4f7f\u7528 hook \u7684\u76ee\u7684\u662f\u201c\u5728\u60f3\u8981\u7684\u65f6\u95f4\u70b9\u6e32\u67d3\u60f3\u8981\u7684\u4e1c\u897f\u201d\uff1a</p> <pre><code>function TodoList({ todos, name }) {\n  // Executes on every render, before the DOM updates.\n\n  useEffect(() =&gt; {\n    // Executes after the DOM updates and only when name changes.\n  }, [name]);\n\n  return &lt;&gt;{todos}&lt;/&gt;;\n}\n</code></pre>"},{"location":"frontend/react/hooks/#general-rules-for-all-the-hooks","title":"General rules for all the Hooks","text":"<ol> <li>Hooks can ONLY be used either in React Functional Component or other custom Hooks</li> <li>Hooks can ONLY be used in the root level: you can not use Hook in some nested function, for example:</li> </ol> <pre><code>const MyComponent = () =&gt; {\n  const submitHandler = () =&gt; {\n    const [name, setName] = useState(\"Martin\"); // \u274c wrapped in a function\n  };\n\n  if (true) {\n    const [name, setName] = useState(\"Martin\"); // \u274c wrapped in a if statement\n  }\n};\nexport default MyComponent;\n</code></pre> <p>Workaround</p> <p>If you want to use <code>useState</code> in a condition or a loop, extract a new component and put it there.</p>"},{"location":"frontend/react/hooks/#1-state-hooks","title":"1. State Hooks","text":""},{"location":"frontend/react/hooks/#usestate","title":"\ud83e\ude9d<code>useState</code>","text":"<p><code>useState(initialState)</code>declares a state variable in component that you can update directly. <code>initialState</code> is the initial value of the state, it can be:</p> <ul> <li>a variable in any type (could also be an <code>object</code>)</li> <li>a pure function, which takes 0 arguments, and returns a value in any type</li> </ul> <p>State</p> <p>The State that created by <code>useState</code> decides when the Component (re)renders! Every time the State changes, the Component will rerender!</p> <p>State Batching</p> <p>The <code>setXXX()</code> functions in the same synchronous execution cycle (scope) will be batched together, and cause ONLY one re-render. <code>js     setName(\"Max\");     setAge(\"5\")</code> The updates in both <code>name</code> and <code>age</code> will be applied simultaneously! That's why the following code will NOT work: <code>js     console.log(name); // prints name state, e.g. 'Manu'     setName('Max');     console.log(name); // ??? what gets printed? Still 'Manu'?</code></p> <p>Example:</p> <pre><code>import { useState } from \"react\";\n\nfunction MyComponent() {\n  // multiple States\n  const [name, setName] = useState(\"Taylor\");\n  const [age, setAge] = useState(42);\n\n  // ... or put multiple States in 1 object:\n  const [person, setPerson] = useState({ name: \"Taylor\", age: 42 });\n}\n</code></pre> <p>Array Destruction</p> <p>The way we write the LEFT-HAND side <code>[name, setName]</code> is called \"Array Destruction\"</p> <p>A classic use case for useState as \"Controlled Component\":</p> <pre><code>&lt;form&gt;\n  &lt;div&gt;\n    &lt;label htmlFor=\"title\"&gt;Name&lt;/label&gt;\n    &lt;input\n      type=\"text\"\n      id=\"title\"\n      value={name}\n      //   onChange={(event) =&gt; setName(event.target.value)}\n\n      onChange={(event) =&gt; {\n        // ! This new variable `newName` solve the \"wrong object\" error caused by how React handles the state\n        const newName = event.target.value;\n        setName((prevState) =&gt; ({\n          name: newName,\n          age: prevState.age,\n        }));\n      }}\n\n    &gt;&lt;/input&gt;\n  &lt;/div&gt;\n&lt;/form&gt;\n</code></pre> <p><code>setXXX()</code> ONLY affects what <code>useState</code> returns in the beginning of the next render. Therefore this will not work:</p> <pre><code>function handleClick() {\n  setName(\"Robin\");\n  console.log(name); // Still \"Taylor\"!\n}\n</code></pre> <p>Warning</p> <p>if a variable depends on its previous value, to make sure the value is updated. We pass an updater function instead of a value to the <code>setXXX()</code>:</p> <pre><code>```js\n// by convention, we use `a` or `prevAge` to represent the previous/old/pending state\nsetAge(age + 1); // \u274c\nsetAge((age) =&gt; age + 1); // \u2705 pass a updater function as parameter!\n```\n</code></pre>"},{"location":"frontend/react/hooks/#usereducer","title":"\ud83e\ude9d<code>useReducer</code>","text":"<p><code>useReducer(reducer, initialArg, init?)</code> sources out multiple <code>useState()</code> to keep the code cleaner. Ususally we use it when there are several actions on one State. The defined <code>reducer</code> is outside of the Component. <code>useReducer()</code> has 3 input parameters:</p> <ol> <li><code>reducer</code>: the <code>function reducer(state, action)</code> returns the next state. State and action can be any types.</li> <li><code>initialArg</code>: initial state, can be any type.</li> <li><code>[OPTIONAL]init</code>: The initializer function that should return the initial state. If exists, then <code>init(initialArg)</code> will replace the <code>initialArg</code>.</li> </ol> <p>Example:</p> <pre><code>import { useReducer } from \"react\";\n\n// define a `reducer`\nfunction reducer(state, action) {\n  switch (action.type) {\n    case \"incremented_age\":\n      return {\n        age: state.age + state.amount,\n      };\n    case \"decreased_age\":\n      return {\n        age: state.age - state.amount,\n      };\n  }\n\n  throw Error(\"Unknown action.\");\n}\n\nexport default function Counter() {\n  /*\n   * [variable, function] =\n   */\n  const [state, dispatch] = useReducer(reducer, { age: 42 });\n\n  return (\n    &lt;&gt;\n      &lt;button\n        onClick={() =&gt; {\n          dispatch({ type: \"incremented_age\", amount: 2 });\n          {\n            /* \ud83d\udc49 `dispatch()` with input parameter */\n          }\n        }}\n      &gt;\n        Increase\n      &lt;/button&gt;\n      &lt;p&gt;Hello! You are {state.age}.&lt;/p&gt; {/* \ud83d\udc49 `state` */}\n    &lt;/&gt;\n  );\n}\n</code></pre>"},{"location":"frontend/react/hooks/#2-context-hooks","title":"2. Context Hooks","text":""},{"location":"frontend/react/hooks/#usecontext","title":"\ud83e\ude9d<code>useContext</code>","text":"<p><code>useContext(SomeContext)</code> is used to manage global variable in the App, such as:</p> <ul> <li>theme</li> <li>authentication.</li> </ul> <p>It lets a component receive information from distant parents without passing the props through the tree! Implement it in three steps:</p> <p>1.Define Context and ContextProvider(as a wrapper)</p> <p>For convention we put the Context in a separate folder <code>/context</code>. The <code>createContext()</code> function includes initial values.</p> <pre><code>// ./context/theme-context.jsx\nimport React from 'react';\n\n// create Context\nexport const ThemeContext = React.createContext({\n  darkTheme: false,\n  setDarkTheme: () =&gt; {}\n});\n\n// create ContextProvider, and wrap all the given Children\nexport const ThemeContextProvider = props =&gt; {\n  const [darkTheme, setDarkTheme] = useState(true);\n\n  const darkThemeHandler = () =&gt; {\n    setDarkTheme(true)\n  }\n\n  return (\n    {/*\u26a0\ufe0f value\u4e2d\u6709\u4e24\u4e2a\u82b1\u62ec\u53f7\uff0c\u91cc\u9762\u90a3\u4e2a\u82b1\u62ec\u53f7\u8868\u793aObject */}\n    &lt;ThemeContext.Provider value={{ darkTheme: darkTheme, setDarkTheme: darkThemeHandler }}&gt;\n      {props.children}\n    &lt;/ThemeContext.Provider&gt;\n  )\n}\n</code></pre> <p>2.Use ContextProvider</p> <p>The <code>Provider</code> has the <code>value</code> which is the implementation and overwrites the initial values. All the childeren elements that want to use the Context are wrapped in this <code>Provider</code>.</p> <pre><code>// index.jsx\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport \"./index.css\";\nimport App from \"./App\";\nimport { ThemeContextProvider } from \"./context/theme-context\";\n\nReactDOM.render(\n  &lt;ThemeContextProvider&gt;\n    &lt;App /&gt;\n  &lt;/ThemeContextProvider&gt;,\n  document.getElementById(\"root\")\n);\n</code></pre> <p>\u8be5\u4f8b\u5b50\u4e2d\uff0c<code>&lt;ThemeContextProvider&gt;</code>\u88ab\u7528\u4e8e\u4e8e\u6700\u9876\u5c42\u7684 <code>index.js</code> \u4e2d\uff0c\u5305\u88f9\u7740<code>&lt;App/&gt;</code>\u3002\u8fd9\u610f\u5473\u7740\uff0c\u6240\u6709 App \u7ec4\u4ef6\u7684\u5b50\u7ec4\u4ef6\u90fd\u80fd\u8bbf\u95ee\u5230\u8be5 Context \u7684\u503c\u3002</p> <p>3.Use/Change the Context Here with the <code>useContext</code> you can actually apply the change: in this case, change the theme type.</p> <pre><code>import { useContext } from 'react';\nimport { ThemeContext } from './context/ThemeContext';\n\nconst ThemeChanger = () =&gt; {\n    // Now we have the Context available!\n    const themeContext = useContext(ThemeContext);\n\n    const themeStyle = {\n        backgroundColor: themeContext.darkTheme? \"#333\":\"#CCC\";\n        color: themeContext.darkTheme?\"white\":\"black\";\n    }\n\n    return (\n        &lt;div style={themeStyle}&gt;Functional Component Style&lt;/div&gt;\n        &lt;button onClick={()=&gt;themeContext.setDarkTheme(false)}&gt;Turn off Dark Theme&lt;/button&gt;\n    )\n\n};\n\nexport default ThemeChanger;\n</code></pre> <p>Warning</p> <p><code>useContext()</code> call in a component is not affected by providers returned from the same component. The corresponding <code>&lt;Context.Provider&gt;</code> needs to be above the component doing the <code>useContext()</code> call.</p>"},{"location":"frontend/react/hooks/#3-ref-hooks","title":"3. Ref Hooks","text":""},{"location":"frontend/react/hooks/#useref","title":"\ud83e\ude9d<code>useRef</code>","text":"<p><code>useRef(initialValue)</code> is a React Hook that lets you reference a value that\u2019s not needed for rendering. --&gt; The ref value is independent from render times!</p> <pre><code>import { useRef } from \"react\";\n\nconst MyComponent = () =&gt; {\n  let count_ref = useRef(0);\n\n  const handleClick = () =&gt; {\n    count_ref.current = count_ref.current + 1;\n    alert(\"You clicked \" + count_ref.current + \" times!\");\n  };\n\n  return &lt;button onClick={handleClick}&gt;Click me!&lt;/button&gt;;\n};\n</code></pre> <p>Another example:</p> <pre><code>const input_ref = useRef();\n\nreturn (\n  &lt;&gt;\n    &lt;input type=\"text\" ref={input_ref} /&gt;\n  &lt;/&gt;\n);\n</code></pre> <p>Note</p> <p>useRef returns an object with a single property <code>current</code>, to use the ref, you always need to write <code>myRef.current</code></p> <pre><code>To change the value in ref, you can assign new value:\n\n```js\ncount_ref.current = 5;\n```\n</code></pre> <p>\u26a0\ufe0f Do NOT write/read your Ref during the component rendering:</p> <pre><code>function MyComponent() {\n  // ...\n  // \ud83d\udea9 Don't write a ref during rendering\n  myRef.current = 123;\n  // ...\n  // \ud83d\udea9 Don't read a ref during rendering\n  return &lt;h1&gt;{myOtherRef.current}&lt;/h1&gt;;\n}\n</code></pre> <p>Instead, ONLY read or write refs from event handlers or effects instead.</p> <pre><code>\n</code></pre>"},{"location":"frontend/react/hooks/#useimperativehandle","title":"\ud83e\ude9d<code>useImperativeHandle</code>","text":"<p><code>useImperativeHandle</code> is...</p>"},{"location":"frontend/react/hooks/#4-effect-hooks","title":"4. Effect Hooks","text":""},{"location":"frontend/react/hooks/#useeffect","title":"\ud83e\ude9d<code>useEffect</code>","text":"<p><code>useEffect(setup, dependencies?)</code></p> <p>The second parameter <code>dependencies</code> has 3 possibilities:</p> <ol> <li><code>[a, b]</code>: a dependency array --&gt; runs after the component initial render and after re-renders of variable a AND b</li> <li><code>[]</code>: an empty array --&gt; only run after the component initial render --&gt; similar to <code>componentDidMount()</code></li> <li><code></code>: empty --&gt; runs after EVERY single render (and re-render when State changes)</li> </ol>"},{"location":"frontend/react/hooks/#clean-up","title":"Clean up","text":"<p>Sometimes we need to clean up the content in <code>useEffect</code>, we do so by returning a function in the end, this function will be executed before the next round executes:</p> <pre><code>useEffect(() =&gt; {\n  // do sth...\n  const timer = setTimeout(() =&gt; {\n    //...\n  }, 500);\n\n  // clean up\n  return () =&gt; {\n    clearTimeout(timer);\n  };\n}, [name]);\n</code></pre> <ul> <li>if <code>dependencies</code> is <code>[]</code>, then the clean up happens when the Component gets unmounted!</li> </ul>"},{"location":"frontend/react/hooks/#uselayouteffect","title":"\ud83e\ude9d<code>useLayoutEffect</code>","text":"<p><code>useLayoutEffect(setup, dependencies?)</code> is a version of <code>useEffect(setup, dependencies?)</code> that fires before the browser repaints the screen.</p>"},{"location":"frontend/react/hooks/#useinsertioneffect","title":"\ud83e\ude9d<code>useInsertionEffect</code>","text":"<p><code>useInsertionEffect(setup, dependencies?)</code> is a version of <code>useEffect(setup, dependencies?)</code> that fires before any DOM mutations.</p>"},{"location":"frontend/react/hooks/#5-performance-hooks","title":"5. Performance Hooks","text":""},{"location":"frontend/react/hooks/#usememo","title":"\ud83e\ude9d<code>useMemo</code>","text":"<p><code>useMemo(calculateValue, dependencies)</code> is a React Hook that lets you cache a value/component between re-renders.</p> <p>Example - cache a value:</p> <pre><code>import { useMemo } from \"react\";\n\nfunction TodoList({ todos, tab }) {\n  // the function filterTodos returns a value - and this value is to be cached\n  const visibleTodos = useMemo(() =&gt; filterTodos(todos, tab), [todos, tab]);\n}\n</code></pre> <p>Example - cache a component:</p> <pre><code>// Ingredients.jsx\nimport { useMemo } from \"react\";\nconst Ingredients = () =&gt; {\n  // cache the component &lt;IngredientList /&gt;\n  const ingredientList = useMemo(() =&gt; {\n    return (\n      &lt;IngredientList\n        ingredients={userIngredients}\n        onRemoveItem={removeIngredientHandler}\n      /&gt;\n    );\n  }, [userIngredients, removeIngredientHandler]);\n\n  return (\n    &lt;section&gt;\n      &lt;Search onLoadIngredients={filteredIngredientsHandler} /&gt;\n      {ingredientList}\n    &lt;/section&gt;\n  );\n};\n</code></pre> <p>!!! note \"<code>useMemo</code> vs <code>useCallback</code>\" - <code>useMemo</code> cache a value/component - <code>useCallback</code> cache a function</p>"},{"location":"frontend/react/hooks/#usecallback","title":"\ud83e\ude9d<code>useCallback</code>","text":"<p><code>useCallback(fn, dependencies)</code> is a React Hook that lets you cache a function between re-renders. This could avoid unnecessary re-render. The dependency array indicates that when the function ONLY re-renders when the dependency changes, if the array is empty, then it means this function should NEVER be re-rendered.</p> <pre><code>// original function:\nconst handleSubmit = (orderDetails) =&gt; {\n  post(\"/product/\" + productId + \"/buy\", {\n    referrer,\n    orderDetails,\n  });\n};\n\n// function in useCallback:\nconst handleSubmit = useCallback(\n  (orderDetails) =&gt; {\n    post(\"/product/\" + productId + \"/buy\", {\n      referrer,\n      orderDetails,\n    });\n  },\n  [productId, referrer]\n);\n</code></pre>"},{"location":"frontend/react/hooks/#usetransition","title":"\ud83e\ude9d<code>useTransition</code>","text":"<p><code>useTransition()</code> is a React Hook that lets you update the state without blocking the UI, it does NOT take any parameters.</p>"},{"location":"frontend/react/hooks/#usedeferredvalue","title":"\ud83e\ude9d<code>useDeferredValue</code>","text":""},{"location":"frontend/react/hooks/#6-other-hooks","title":"6. Other Hooks","text":""},{"location":"frontend/react/hooks/#usedebugvalue","title":"\ud83e\ude9d<code>useDebugValue</code>","text":""},{"location":"frontend/react/hooks/#useid","title":"\ud83e\ude9d<code>useId</code>","text":""},{"location":"frontend/react/hooks/#usesyncexternalstore","title":"\ud83e\ude9d<code>useSyncExternalStore</code>","text":""},{"location":"frontend/react/hooks/#7-customized-hook","title":"7. Customized Hook","text":"<p>Name convention is <code>useSOMETHING</code>, and its actually just a function. Whenever this customized hook is called, a new snapshot of this hook will be created. So the logic of this hook can be shared between different component, but not the data of this hook.</p> <p>TODO: https://ibm-learning.udemy.com/course/react-the-complete-guide-incl-redux/learn/lecture/25599852#overview</p>"},{"location":"frontend/react/oblivion/","title":"Oblivion","text":""},{"location":"frontend/react/oblivion/#routes","title":"Routes","text":"<pre><code>import { BrowserRouter, Route, Routes } from 'react-router-dom';\n\n...\n\nreturn (\n     &lt;BrowserRouter&gt;\n        &lt;Routes&gt;\n            &lt;Route path=\"/cases_list\" element={&lt;TablePage /&gt;} /&gt;\n            &lt;Route path=\"/cases/:case_id\" element={&lt;DetailPage /&gt;} /&gt;\n        &lt;/Routes&gt;\n     &lt;/BrowserRouter&gt;\n    )\n</code></pre> <p>For the detailPage we use <code>useParameter</code> to get the id of the page: <pre><code>import { useParams } from 'react-router-dom';\n\nconst DetailPage = () =&gt; {\n  const { case_id } = useParams();\n\n  return (\n    &lt;&gt;\n       &lt;h1&gt;Detail Page: {case_id}&lt;/h1&gt;\n    &lt;/&gt;\n  );\n};\n\nexport default DetailPage;\n</code></pre></p>"},{"location":"frontend/react/oblivion/#string-with-format","title":"String with format","text":"<p>In the React Componnent attribute where usually its string, you can do this:</p> <pre><code>&lt;MyComponent\n    labelDescription={\n        &lt;&gt;\n            Zeile 1&lt;br /&gt;\n            Zeile 2\n        &lt;/&gt;\n    }\n/&gt;\n</code></pre>"},{"location":"frontend/react/resources/","title":"Resources","text":"<ul> <li>how to update a nested object</li> <li>Pure function in react</li> </ul>"},{"location":"frontend/react/todos/","title":"Todos","text":""},{"location":"frontend/react/todos/#default-export-vs-named-export","title":"Default export vs named export","text":"<p>in <code>components.jsx</code> there are 2 components:</p> <pre><code>// Named export\nexport const Car = () =&gt; {\n\n}\n\nconst Bike = () =&gt; {\n\n}\n\n// Default export\nexport default Bike;\n</code></pre> <p>usage: <pre><code>// Named export\nimport { Car } from './components'\n\n// Default export\nimport Bike from \"./components\"\n</code></pre></p>"},{"location":"frontend/web_design/","title":"Web Design","text":""},{"location":"frontend/web_design/#web-design-for-web-developers","title":"Web Design for Web Developers","text":""},{"location":"frontend/web_design/#rules","title":"Rules","text":""},{"location":"frontend/web_design/#typography","title":"Typography","text":"<ol> <li>Use font size 15-25 pixels for main content</li> <li>Use (really) big font size for headlines - no limitations</li> <li>either big size or heavy weight, dont do both</li> <li>Use line spacing betwwen 120-150%</li> <li>45-90 characters per line</li> <li>Use general \"good\" fonts &amp; only use ONE typeface e.g.:</li> <li>sans-serif:<ul> <li>more neutral, clean, simple, modern</li> <li>example: Open Sans, Lato, Raleway, Montserrat, PT Sans - all available on Google Fonts</li> </ul> </li> <li>serif:<ul> <li>traditional purposes, Storytelling, long reading</li> <li>examples: Cardo, Merriweather, PT Serif</li> </ul> </li> </ol>"},{"location":"frontend/web_design/#color","title":"Color","text":"<ol> <li>Use only one \"base color\" other than gray, black and white, starting with flatcolor, after choose one Base-Color, you can choose some variants, and make it to a Color-Palette:</li> </ol> <ol> <li> <p>If you REALLY need to take more than one color, use tool to combine the best color palette</p> </li> <li> <p>Use color to draw attention</p> </li> <li> <p>Never use black in your design</p> </li> <li> <p>Choose colors wisely</p> </li> <li>color: passion</li> <li>orange: creativity, confidence, draw attention but not too much as Red</li> <li>yello: pleasent</li> <li>green: health, money, nature</li> <li>blue: truth, most beloved</li> <li>purple: wealth, loyalty</li> <li>pink: romance</li> <li>brown: confidence, comfort</li> </ol>"},{"location":"frontend/web_design/#image","title":"Image","text":"<ol> <li>Put text directly on the image: need high contrast between the Image and Text</li> <li>Overlay the image: image+half-transparent-color-bg</li> <li>Put text in Box: box should be still opaque, bg of the box can be all possible color</li> <li>Blur the image: the whole pic, or just one spot of blur</li> <li>The floor fade: use one corner of image which has very high contrast against the text</li> </ol> <pre><code># Overlay the image. Example: http://jsfiddle.net/drpak8vy/1/\n.darken {\n  background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),\n    url(YOUR IMAGE HERE);\n}\n\n# Put text in a box. Example: http://jsfiddle.net/qg83m36p/\n.text-box {\n  background-color: rgba(0, 0, 0, 0.5);\n  color: #fff;\n  display: inline;\n  padding: 10px;\n}\n\n# Floor fade. Example: http://jsfiddle.net/gRzPF/409/\n.floor-fade {\n  background: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.6)),\n    url(YOUR IMAGE HERE);\n}\n</code></pre>"},{"location":"frontend/web_design/#icons","title":"Icons","text":"<ol> <li>to list Features/Steps</li> <li>for Actions and Links:</li> <li>should be clear</li> <li>still use labels besides the icon</li> <li>Icons should NOT take a center stage</li> <li>Use Icon Fonts:</li> <li>Static Image will get blur when you scale 300x</li> <li>Vector icon font will never get blur</li> </ol>"},{"location":"frontend/web_design/#spacing-layout","title":"Spacing &amp; Layout","text":"<ol> <li>Use but NOT exaggrate whitespace between:</li> <li>elements</li> <li>groups of elements</li> <li>sections</li> <li>Define hierarchy:</li> <li>Decide where you want your audience to look first</li> <li>establish a flow that corresponds to your content's msg</li> <li>use whitespace to build that flow</li> </ol>"},{"location":"frontend/web_design/#inspiration","title":"Inspiration","text":"<ol> <li>Collect designs you like</li> <li>Why do they look good?</li> <li>what do these sites have in common?</li> <li>How were they built in HTML &amp; CSS? (use google chrome)</li> </ol> <p>First make you website alike your favorite web.</p>"},{"location":"frontend/web_design/#conversion-rate","title":"Conversion rate","text":"<ol> <li>offer free gift first (e-book)</li> <li>strong call to action btn: appear as often as possible</li> <li>Grab user attention: e.g. pop-up box for email-subscription</li> <li>tell your user the benefit: \"Try it for free\"</li> <li>dont ask more info that you dont need: only email address (and name?)</li> <li>use social references: customer comments</li> <li>use urgency: \"limited time remaining\" or \"over 320 bought\", \"only 1 left in stock\"</li> </ol> <p>Where to find inperation? codingheroes</p>"},{"location":"ide/vscode/","title":"VSCode","text":""},{"location":"ide/vscode/#vscode","title":"VSCode","text":""},{"location":"ide/vscode/#vscodelaunchjson","title":".vscode/launch.json","text":"<p>Example for python fastapi runtime: <pre><code>{\n  // Use IntelliSense to learn about possible attributes.\n  // Hover to view descriptions of existing attributes.\n  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Python: FastAPI\",\n      \"type\": \"python\",\n      \"request\": \"launch\",\n      \"module\": \"uvicorn\",\n      \"python\": \"${workspaceFolder}/venv/bin/python\",\n      \"args\": [\"app.main:app\", \"--port\", \"4000\", \"--reload\"],\n      \"jinja\": true,\n      \"justMyCode\": true,\n      \"env\": {\n        \"secret_url\": \"https://pretty-little-liars.com\",\n        \"secret_api_key\": \"oneliarsonedies\",\n      }\n    }\n  ]\n}\n</code></pre></p>"},{"location":"ide/vscode/#great-plugins","title":"Great plugins","text":"<ul> <li>EditorConfig for VSCode</li> <li>Auto Close Tag</li> <li>Auto Rename Tag</li> <li>Guides</li> </ul>"},{"location":"ide/vscode/#preferences-open-user-settings-json","title":"Preferences: Open User Settings (JSON)","text":"<pre><code>    \"editor.formatOnSave\": true,\n    // Sort imports and automatically remove unused imports when pressing CTRL + S\n    \"editor.codeActionsOnSave\": {\n        \"source.organizeImports\": true\n    },\n</code></pre>"},{"location":"ide/vscode/#languages","title":"Languages","text":""},{"location":"ide/vscode/#typescript","title":"TypeScript","text":"<pre><code>{\n    \"tslint.configFile\": \"./tslint.json\",\n    \"tslint.autoFixOnSave\": true,\n    \"editor.formatOnSave\": true\n}\n</code></pre>"},{"location":"network/ip/","title":"IP","text":""},{"location":"network/ip/#ip","title":"IP","text":"<p>Find IP address in MacOS, in the following result there are several parts:</p> <ol> <li><code>lo</code> (loopback interface) - ignore this</li> <li>Network Interface such as <code>ens192</code>, <code>eth0</code>, <code>enpXsY</code><ul> <li>the IPv4 address is shown after <code>inet</code></li> <li>The <code>/24</code> means the subnet mask (255.255.255.0).</li> </ul> </li> </ol> <pre><code>$ ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n\n2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:50:56:aa:bb:cc brd ff:ff:ff:ff:ff:ff\n    inet 192.168.100.10/24 brd 192.168.100.255 scope global dynamic ens192\n       valid_lft 86300sec preferred_lft 86300sec\n    inet6 fe80::250:56ff:feaa:bbcc/64 scope link \n       valid_lft forever preferred_lft forever\n</code></pre> <p>Note</p> <p>https://www.geeksforgeeks.org/differences-between-ipv4-and-ipv6/</p> <p>ipv4: binary ipv6: hexadecimal</p>"},{"location":"network/ip/#cidr","title":"CIDR","text":""},{"location":"network/ip/#cidr-blocks","title":"CIDR blocks","text":"<p>A CIDR block is a group of IP addresses that share the same start and size. Big blocks have more IP addresses. Big internet groups give out large CIDR blocks to smaller groups. These smaller groups then give them to companies. If you\u2019re at home, you get your CIDR block from your internet company.</p>"},{"location":"network/ip/#cidr-notation","title":"CIDR notation","text":"<p>CIDR notation shows an IP address with a number at the end. This number tells how much of the address is for the network. For example the 192.168.1.0/22 means the first 22 bits of the address are for a network. This way of writing a IP addresses helps the routers know where to send the data.</p>"},{"location":"network/ip/#ssh","title":"ssh","text":"<p><code>SSH</code> \u5c31\u50cf\u662f\u4e00\u628a \u8fdc\u7a0b\u63a7\u5236\u7684\u94a5\u5319\uff0c\u53ef\u4ee5\u5b89\u5168\u5730\u8fde\u63a5\u5230\u53e6\u4e00\u53f0\u7535\u8111\u3002\u5177\u4f53\u539f\u7406\u89c1\u535a\u5ba2\u3002</p> <p></p> <p>Note</p> <p>SSH\uff08Secure Shell\uff09\u4f9d\u8d56\u4e8e TCP \u6765\u5efa\u7acb\u5b89\u5168\u7684\u8fdc\u7a0b\u8fde\u63a5\uff1a</p> <ul> <li>TCP \u662f \u8fd0\u8f93\u5c42\u534f\u8bae\uff0c\u8d1f\u8d23\u53ef\u9760\u7684\u6570\u636e\u4f20\u8f93\uff0c\u5c31\u50cf\u4e00\u6761 \u7a33\u5b9a\u7684\u516c\u8def\u3002</li> <li>SSH \u662f \u5e94\u7528\u5c42\u534f\u8bae\uff0c\u4f7f\u7528 TCP \u4f5c\u4e3a \u5e95\u5c42\u4f20\u8f93\u901a\u9053\uff0c\u5c31\u50cf\u5728\u516c\u8def\u4e0a\u8dd1\u7684 \u52a0\u5bc6\u90ae\u8f66\u3002</li> </ul>"},{"location":"network/ip/#gateway","title":"Gateway","text":"<p>The gateway is the device that routes traffic from your local network to the internet (or other networks).</p> <p><pre><code>ip route show\n</code></pre> Example output:</p> <pre><code>default via 192.168.1.1 dev eth0\n...\n</code></pre> <p><code>default via</code> shows the current gateway.</p>"},{"location":"network/ip/#etchosts","title":"/etc/hosts","text":""},{"location":"network/ip/#private-ip","title":"Private IP","text":"<p>\u79c1\u6709IP\u5730\u5740\u8303\u56f4\u662f\u4e13\u95e8\u4e3a\u5728\u79c1\u6709\u7f51\u7edc\uff08\u5982\u5bb6\u5ead\u3001\u529e\u516c\u5ba4\u6216\u4f01\u4e1a\u5185\u90e8\u7f51\u7edc\uff09\u4e2d\u4f7f\u7528\u800c\u9884\u7559\u7684IP\u5730\u5740\u3002\u8fd9\u4e9b\u5730\u5740\u4e0d\u4f1a\u5728\u516c\u5171\u4e92\u8054\u7f51\u4e0a\u8def\u7531\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u79c1\u6709\u7f51\u7edc\u4e2d\u91cd\u590d\u4f7f\u7528\uff0c\u800c\u4e0d\u4f1a\u9020\u6210\u51b2\u7a81\u3002\u79c1\u6709IP\u5730\u5740\u8303\u56f4\u7531Internet Assigned Numbers Authority (IANA) \u5b9a\u4e49\uff0c\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u4e09\u4e2a\u533a\u5757\uff1a</p> <ol> <li>\u3010A\u7c7b\u301110.0.0.0 \u5230 10.255.255.255\uff1a\u8fd9\u662f\u4e00\u4e2aA\u7c7b\u5730\u5740\u8303\u56f4\uff0c\u5305\u542b\u7ea61677\u4e07\u4e2aIP\u5730\u5740\u3002<ul> <li>\u5b50\u7f51\u63a9\u7801\u901a\u5e38\u4e3a255.0.0.0\uff08/8\uff09\u3002</li> <li>\u9002\u7528\u4e8e\u5927\u578b\u7f51\u7edc\u3002</li> </ul> </li> <li>\u3010B\u7c7b\u3011172.16.0.0 \u5230 172.31.255.255\uff1a\u8fd9\u662f\u4e00\u4e2aB\u7c7b\u5730\u5740\u8303\u56f4\uff0c\u5305\u542b\u7ea6104\u4e07\u4e2aIP\u5730\u5740\u3002<ul> <li>\u5b50\u7f51\u63a9\u7801\u901a\u5e38\u4e3a255.240.0.0\uff08/12\uff09\u3002</li> <li>\u9002\u7528\u4e8e\u4e2d\u578b\u7f51\u7edc\u3002</li> </ul> </li> <li>\u3010C\u7c7b\u3011192.168.0.0 \u5230 192.168.255.255\uff1a\u8fd9\u662f\u4e00\u4e2aC\u7c7b\u5730\u5740\u8303\u56f4\uff0c\u5305\u542b\u7ea665536\u4e2aIP\u5730\u5740\u3002<ul> <li>\u5b50\u7f51\u63a9\u7801\u901a\u5e38\u4e3a255.255.0.0\uff08/16\uff09\u3002</li> <li>\u9002\u7528\u4e8e\u5c0f\u578b\u7f51\u7edc\uff0c\u5982\u5bb6\u5ead\u6216\u5c0f\u578b\u529e\u516c\u5ba4\u7f51\u7edc\u3002</li> </ul> </li> </ol>"},{"location":"network/ip/#proxy","title":"Proxy","text":"<p>What is a Proxy Server</p> <ul> <li>act as a Middle Man between you and Internet</li> <li>Proxy \u4ee3\u66ff User \u53bbinternet\u4e0a\u7d22\u8981\u6570\u636e</li> </ul>"},{"location":"network/ip/#benefits","title":"Benefits","text":"<ul> <li>Privacy: hide your IP address</li> <li>Speed: cache webpage on Proxy Server's centralised Database</li> <li>Saves Bandwidth</li> <li>Activity logging:<ul> <li>block certain websites</li> <li>track user activities</li> </ul> </li> </ul>"},{"location":"network/ip/#shortage","title":"Shortage","text":"<ul> <li>Proxy Server can NOT encrypt data</li> </ul> <p>Therefore we needs VPN (Virtual Private Network) which encrypts the data</p> <p>in Openshift Installation Context</p> <p>OpenShift installations often require access to container registries (<code>registry.redhat.io</code>, <code>quay.io</code>, <code>docker.io</code>). If these are blocked in a corporate network, the proxy ensures the nodes can reach them.</p>"},{"location":"network/ip/#env","title":"ENV","text":"<p><code>HTTP_PROXY</code>\u3001<code>HTTPS_PROXY</code> \u548c <code>NO_PROXY</code> \u8fd9\u4e9b\u73af\u5883\u53d8\u91cf\u7528\u4e8e\u5728\u547d\u4ee4\u884c\u6216\u7a0b\u5e8f\u4e2d\u914d\u7f6e HTTP(S) \u4ee3\u7406\uff0c\u7279\u522b\u662f\u5728\u9700\u8981\u901a\u8fc7\u4ee3\u7406\u670d\u52a1\u5668\u8bbf\u95ee\u5916\u90e8\u7f51\u7edc\u65f6\uff08\u4f8b\u5982\uff0c\u516c\u53f8\u5185\u90e8\u7f51\u7edc\u6216\u4e91\u73af\u5883\uff09\u3002</p> <ul> <li><code>HTTP_PROXY</code>: \u9002\u7528\u4e8e HTTP \u8bf7\u6c42\u7684\u4ee3\u7406\u5730\u5740\u3002</li> <li><code>HTTPS_PROXY</code>: \u9002\u7528\u4e8e HTTPS \u8bf7\u6c42\u7684\u4ee3\u7406\u5730\u5740\u3002</li> <li><code>NO_PROXY</code>: \u6307\u5b9a\u4e0d\u4f7f\u7528\u4ee3\u7406\u7684 IP \u6216\u57df\u540d\u5217\u8868\u3002</li> </ul> <p>Info</p> <p>\u5c0f\u5927\u5199\u90fd\u884c</p>"},{"location":"network/ip/#env_1","title":"\u8bbe\u7f6eENV","text":"<p>\uff081\uff09\u4e34\u65f6\u8bbe\u7f6e\uff08\u4ec5\u5f53\u524d\u7ec8\u7aef\u4f1a\u8bdd\u6709\u6548\uff09</p> <pre><code>export HTTP_PROXY=\"http://username:password@proxy.example.com:8080\"\nexport HTTPS_PROXY=\"http://username:password@proxy.example.com:8080\"\nexport NO_PROXY=\"localhost,127.0.0.1,.example.com\"\n</code></pre> <p>\uff082\uff09\u6c38\u4e45\u751f\u6548 <pre><code>echo 'export HTTP_PROXY=\"http://proxy.example.com:8080\"' &gt;&gt; ~/.zshrc\necho 'export HTTPS_PROXY=\"http://proxy.example.com:8080\"' &gt;&gt; ~/.zshrc\necho 'export NO_PROXY=\"localhost,127.0.0.1,.example.com\"' &gt;&gt; ~/.zshrc\nsource ~/.zshrc  # \u4f7f\u914d\u7f6e\u7acb\u5373\u751f\u6548\n</code></pre></p> <p>\uff083\uff09\u5728\u7279\u5b9a\u547d\u4ee4\u4e2d\u4f7f\u7528 <pre><code>HTTP_PROXY=\"http://proxy.example.com:8080\" curl -I https://www.google.com\n</code></pre></p>"},{"location":"network/ip/#env_2","title":"\u89e3\u9664ENV","text":"<pre><code>unset HTTP_PROXY HTTPS_PROXY NO_PROXY\n</code></pre>"},{"location":"network/ip/#dns","title":"DNS","text":"<pre><code>$TTL 1W\n@   IN  SOA ns1.example.com.    root (\n            2019070700  ; serial\n            3H      ; refresh (3 hours)\n            30M     ; retry (30 minutes)\n            2W      ; expiry (2 weeks)\n            1W )        ; minimum (1 week)\n    IN  NS  ns1.example.com.\n    IN  MX 10   smtp.example.com.\n;\n;\nns1.example.com.        IN  A   192.168.1.5\nsmtp.example.com.       IN  A   192.168.1.5\n;\nhelper.example.com.     IN  A   192.168.1.5\nhelper.ocp4.example.com.    IN  A   192.168.1.5\n;\napi.ocp4.example.com.       IN  A   192.168.1.5 \napi-int.ocp4.example.com.   IN  A   192.168.1.5 \n;\n*.apps.ocp4.example.com.    IN  A   192.168.1.5 \n;\nbootstrap.ocp4.example.com. IN  A   192.168.1.96 \n;\ncontrol-plane0.ocp4.example.com.    IN  A   192.168.1.97 \ncontrol-plane1.ocp4.example.com.    IN  A   192.168.1.98 \ncontrol-plane2.ocp4.example.com.    IN  A   192.168.1.99 \n;\ncompute0.ocp4.example.com.  IN  A   192.168.1.11 \ncompute1.ocp4.example.com.  IN  A   192.168.1.7 \n;\n;EOF\n</code></pre> <p>\u8be5\u6587\u4ef6\u4e2d\uff0cDNS record \u53ef\u4ee5\u7528\u7b80\u5355\u7684host\u540d\u4ee3\u66ff to use just <code>helper</code> instead of <code>helper.example.com.</code>, but it depends on how your DNS resolution is configured.</p> <p>Example of a /etc/resolv.conf file: <pre><code>search example.com\nnameserver 192.168.1.5\n</code></pre> \u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u53ea\u7528 <code>helper</code>  \u6bd4\u5982\uff1a <pre><code>helper      IN  A   192.168.1.5\n</code></pre></p>"},{"location":"network/loadbalancer/","title":"LoadBalancer","text":"<p>\u5f53\u524d\u53d7\u6b22\u8fce\u7684\u8d1f\u8f7d\u5747\u8861\u5668\uff08Load Balancer\uff09\uff1a</p> Load Balancer Features Use Cases HAProxy Open-source, high-performance, supports TCP/HTTP LB and reverse proxy Web applications, Kubernetes, OpenShift, microservices NGINX Acts as a web server, reverse proxy, and load balancer, supports HTTP/HTTPS, TCP/UDP High-traffic websites, API gateways, microservices Envoy Modern proxy, supports gRPC, HTTP/2, dynamic service discovery Kubernetes, microservices, service mesh (Istio) F5 BIG-IP Hardware/software combo, enterprise-grade LB, advanced security features Large enterprises, banks, data centers AWS Elastic Load Balancer (ELB) Cloud-native LB, supports ALB (Application), NLB (Network), CLB (Classic) AWS cloud applications, auto-scaling, high availability"},{"location":"network/loadbalancer/#haproxy","title":"HAProxy","text":"<p>haproxy.cfg \u662f HAProxy \u7684\u6838\u5fc3\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u4e8e\u5b9a\u4e49 \u8d1f\u8f7d\u5747\u8861\u548c\u4ee3\u7406\u89c4\u5219\u3002\u5728 OpenShift \u548c\u5176\u4ed6\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0cHAProxy \u901a\u5e38\u7528\u4e8e \u6d41\u91cf\u5206\u53d1 \u548c \u9ad8\u53ef\u7528\u6027\uff08HA\uff09\uff0c\u786e\u4fdd\u591a\u4e2a\u540e\u7aef\u670d\u52a1\u5668\u4e4b\u95f4\u8d1f\u8f7d\u5747\u8861\uff0c\u5e76\u63d0\u4f9b\u5065\u5eb7\u68c0\u67e5\u3001SSL \u7ec8\u7ed3\u7b49\u529f\u80fd\u3002</p> <p>\u914d\u7f6e\u7ed3\u6784</p> <p>\u4e00\u4e2a\u5178\u578b\u7684 haproxy.cfg \u6587\u4ef6\u5305\u542b\u591a\u4e2a\u90e8\u5206\uff0c\u4e3b\u8981\u5305\u62ec\uff1a</p>"},{"location":"network/loadbalancer/#global","title":"\u5168\u5c40\u8bbe\u7f6e\uff08global\uff09","text":""},{"location":"network/loadbalancer/#defaults","title":"\u9ed8\u8ba4\u8bbe\u7f6e\uff08defaults\uff09","text":""},{"location":"network/loadbalancer/#frontend","title":"\u524d\u7aef\uff08frontend\uff09","text":"<pre><code>frontend http_front         #  \u5b9a\u4e49\u524d\u7aef\nbind *:80                   #  \u76d1\u542c 80 \u7aef\u53e3\ndefault_backend http_back   #  \u9ed8\u8ba4\u8f6c\u53d1\u5230 http_back \u8fd9\u4e2a\u540e\u7aef\n</code></pre> <p>Info</p> <p>\u5728 haproxy.cfg \u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u524d\u7aef\uff08frontend\uff09 \u548c \u540e\u7aef\uff08backend\uff09 \u662f \u8bf7\u6c42\u6d41\u91cf\u7684\u5165\u53e3\u548c\u51fa\u53e3\uff0c\u7528\u4e8e\u5b9a\u4e49 \u8d1f\u8f7d\u5747\u8861\u89c4\u5219\u3002</p> <ul> <li>\u524d\u7aef\uff08frontend\uff09 \u2192 \u8d1f\u8d23\u63a5\u6536\u8bf7\u6c42\uff0c\u51b3\u5b9a\u5982\u4f55\u8def\u7531</li> <li>\u540e\u7aef\uff08backend\uff09 \u2192 \u8d1f\u8d23\u5904\u7406\u8bf7\u6c42\uff0c\u6267\u884c\u8d1f\u8f7d\u5747\u8861</li> </ul>"},{"location":"network/loadbalancer/#backend","title":"\u540e\u7aef\uff08backend\uff09","text":"<pre><code>backend http_back                   # \u5b9a\u4e49\u540e\u7aef\u670d\u52a1\u5668\u6c60\nbalance roundrobin                  # \u8f6e\u8be2\u8c03\u5ea6\uff08leastconn \u2192 \u9009\u62e9\u8fde\u63a5\u6700\u5c11\u7684\u670d\u52a1\u5668, source \u2192 \u6839\u636e\u5ba2\u6237\u7aef IP \u8fdb\u884c\u4f1a\u8bdd\u4fdd\u6301\uff09\nserver web1 192.168.1.101:80 check  # \u6307\u5b9a\u540e\u7aef\u670d\u52a1\u5668\uff0c\u5e76\u5f00\u542f\u5065\u5eb7\u68c0\u67e5\nserver web2 192.168.1.102:80 check  # \u5907\u7528\u670d\u52a1\u5668\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\n</code></pre>"},{"location":"network/loadbalancer/#listen","title":"\u76d1\u542c\uff08listen\uff09\uff08\u53ef\u9009\uff09","text":"<pre><code>listen stats                    # \u76d1\u542c\u7ba1\u7406\u9875\u9762\n   bind *:9000                  # \u76d1\u542c 9000 \u7aef\u53e3\n   stats enable             \n   stats uri /haproxy?stats     # \u7528\u4e8e\u67e5\u770b statistics \u7684URL\n   stats auth admin:password    # \u8ba4\u8bc1\u4fe1\u606f\n</code></pre>"},{"location":"network/protocols/","title":"Protocols","text":""},{"location":"network/protocols/#protocols","title":"Protocols / \u534f\u8bae","text":"<p>protocol = set of rules. \u201c\u534f\u8bae\u201d\u5c31\u662f\u8bbe\u5907\u6216\u7cfb\u7edf\u4e4b\u95f4\u901a\u4fe1\u65f6\u7ea6\u5b9a\u7684\u4e00\u5957\u201c\u8bf4\u8bdd\u89c4\u5219\u201d\u3002</p> <p>\u4f8b\u5b50</p> <p>\u5982\u679c\u4f60\u8bf4\u4e2d\u6587\uff0c\u6211\u8bf4\u82f1\u6587\uff0c\u6211\u4eec\u53ef\u80fd\u542c\u4e0d\u61c2\u5bf9\u65b9 \u2014\u2014 \u540c\u6837\uff0c\u5982\u679c\u4e24\u53f0\u7535\u8111\u6ca1\u6709\u7528\u540c\u4e00\u79cd\u534f\u8bae\uff0c\u5b83\u4eec\u4e5f\u65e0\u6cd5\u901a\u4fe1\u3002 \u6bd4\u5982\uff1a</p> <ul> <li>\u4f60\u8bbf\u95ee\u4e00\u4e2a\u7f51\u7ad9\uff0c\u7528\u7684\u662f <code>HTTP</code> \u534f\u8bae\uff1b</li> <li>\u4f60\u767b\u5f55\u670d\u52a1\u5668\uff0c\u662f\u7528 <code>SSH</code> \u534f\u8bae\uff1b</li> <li>\u4f60\u770b\u5728\u7ebf\u89c6\u9891\uff0c\u80cc\u540e\u53ef\u80fd\u7528\u7684\u662f <code>RTMP</code> \u6216 <code>HLS</code> \u534f\u8bae\u3002</li> </ul> <p>\u91cd\u8981\u4e14\u5e38\u89c1\u7684\u901a\u4fe1\u534f\u8bae\u6e05\u5355\uff0c\u6309\u7167\u5e94\u7528\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u7684\u903b\u8f91\u5c42\u6b21\u5206\u7ec4:</p>"},{"location":"network/protocols/#_1","title":"\ud83d\udd1d \u5e94\u7528\u5c42\u534f\u8bae","text":"<p>\u7528\u6237\u6700\u76f4\u63a5\u63a5\u89e6\u7684</p> \u534f\u8bae \u5168\u79f0 \u7528\u9014 \u5e38\u89c1\u573a\u666f HTTP/HTTPS HyperText Transfer Protocol (Secure) \u4e07\u7ef4\u7f51\u901a\u4fe1\uff08\u7f51\u9875\u3001API\uff09 \u6d4f\u89c8\u7f51\u9875\u3001\u8c03\u7528 REST API FTP/SFTP File Transfer Protocol / Secure FTP \u6587\u4ef6\u4e0a\u4f20/\u4e0b\u8f7d \u7f51\u7ad9\u90e8\u7f72\u3001\u6587\u4ef6\u670d\u52a1\u5668 SMTP Simple Mail Transfer Protocol \u53d1\u9001\u90ae\u4ef6 \u90ae\u4ef6\u670d\u52a1\u5668\u53d1\u9001\u7aef IMAP/POP3 Internet Message Access Protocol / Post Office Protocol \u63a5\u6536/\u8bfb\u53d6\u90ae\u4ef6 \u90ae\u4ef6\u5ba2\u6237\u7aef\u6536\u4fe1 DNS Domain Name System \u57df\u540d\u89e3\u6790 \u6d4f\u89c8\u5668\u8f93\u5165\u7f51\u5740\uff0c\u627e\u670d\u52a1\u5668 IP SSH Secure Shell \u5b89\u5168\u8fdc\u7a0b\u767b\u5f55\u670d\u52a1\u5668 \u8fdc\u7a0b\u8fd0\u7ef4\u3001\u90e8\u7f72 Telnet Teletype Network \u975e\u52a0\u5bc6\u8fdc\u7a0b\u63a7\u5236 \u8fc7\u65f6\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528 SNMP Simple Network Management Protocol \u7f51\u7edc\u8bbe\u5907\u76d1\u63a7 \u8def\u7531\u5668\u3001\u4ea4\u6362\u673a\u72b6\u6001\u67e5\u8be2 MQTT Message Queuing Telemetry Transport \u7269\u8054\u7f51\u6d88\u606f\u4f20\u8f93 \u4f20\u611f\u5668\u3001\u5d4c\u5165\u5f0f\u8bbe\u5907 WebSocket - \u5b9e\u65f6\u53cc\u5411\u901a\u4fe1 \u804a\u5929\u7cfb\u7edf\u3001\u5728\u7ebf\u6e38\u620f\u3001\u5b9e\u65f6\u76d1\u63a7 SOAP Simple Object Access Protocol \u4f01\u4e1a\u7ea7 Web \u670d\u52a1\uff08\u57fa\u4e8e XML\uff09 \u94f6\u884c/\u4fdd\u9669\u7cfb\u7edf REST Representational State Transfer \u73b0\u4ee3 Web \u670d\u52a1\uff08\u57fa\u4e8e HTTP/JSON\uff09 \u79fb\u52a8/\u7f51\u9875\u5e94\u7528\u7684\u540e\u53f0\u63a5\u53e3"},{"location":"network/protocols/#_2","title":"\ud83d\udce6 \u4f20\u8f93\u5c42\u534f\u8bae","text":"<p>\u4fdd\u969c\u6570\u636e\u4f20\u8f93\u7684\u53ef\u9760\u6027\u6216\u5b9e\u65f6\u6027</p> \u534f\u8bae \u7528\u9014 \u7279\u70b9 \u5e38\u89c1\u5e94\u7528 TCP \u9762\u5411\u8fde\u63a5\u7684\u53ef\u9760\u4f20\u8f93 \u6709\u5e8f\u3001\u53ef\u9760\u3001\u91cd\u4f20\u673a\u5236 HTTP\u3001FTP\u3001SSH\u3001SMTP \u7b49 UDP \u65e0\u8fde\u63a5\u7684\u5feb\u901f\u4f20\u8f93 \u8f7b\u91cf\u3001\u4f4e\u5ef6\u8fdf\u3001\u4e0d\u4fdd\u8bc1\u53ef\u9760 \u89c6\u9891\u6d41\u3001\u8bed\u97f3\u901a\u8bdd\u3001DNS \u67e5\u8be2 QUIC \u57fa\u4e8e UDP \u7684\u5b89\u5168\u4f20\u8f93 \u7ed3\u5408\u4e86 TCP+TLS \u4f18\u52bf\uff0c\u4f4e\u5ef6\u8fdf \u65b0\u7248 HTTP/3 \u534f\u8bae\u7684\u57fa\u7840"},{"location":"network/protocols/#_3","title":"\ud83c\udf10 \u7f51\u7edc\u5c42\u534f\u8bae","text":"<p>\u5b9e\u73b0\u8bbe\u5907\u95f4\u901a\u4fe1</p> \u534f\u8bae \u7528\u9014 \u8bf4\u660e IP\uff08IPv4/IPv6\uff09 \u552f\u4e00\u6807\u8bc6\u8bbe\u5907\u3001\u8def\u7531\u6570\u636e\u5305 \u4e92\u8054\u7f51\u7684\u57fa\u7840\u534f\u8bae ICMP \u8bca\u65ad\u7f51\u7edc\u72b6\u6001 ping \u547d\u4ee4\u5c31\u662f\u57fa\u4e8e ICMP ARP IP\u5730\u5740\u8f6cMAC\u5730\u5740 \u5c40\u57df\u7f51\u4e2d\u901a\u4fe1\u65f6\u67e5\u627e\u8bbe\u5907"},{"location":"network/protocols/#_4","title":"\ud83d\udd04 \u5176\u4ed6\u534f\u8bae","text":"\u7c7b\u578b \u534f\u8bae\u793a\u4f8b \u7528\u9014 \u6d88\u606f\u961f\u5217 AMQP, STOMP, MQTT, JMS \u5f02\u6b65\u3001\u89e3\u8026\u7684\u7cfb\u7edf\u901a\u4fe1 \u8fdc\u7a0b\u8c03\u7528 gRPC, Thrift, RMI \u8de8\u670d\u52a1\u8c03\u7528\uff0c\u652f\u6301\u7ed3\u6784\u5316\u6570\u636e \u6570\u636e\u540c\u6b65 Rsync, SCP \u8fdc\u7a0b\u6587\u4ef6/\u6570\u636e\u590d\u5236 \u6d41\u5a92\u4f53 RTMP, HLS, RTP \u89c6\u9891\u76f4\u64ad\u3001\u97f3\u9891\u6d41"},{"location":"network/protocols/#_5","title":"\u4e0d\u540c\u5c42\u7684\u534f\u8bae\u4e4b\u95f4\u7684\u5173\u7cfb","text":"<p>Q\uff1a\u5982\u4f55\u7406\u89e3\u4e0d\u540c\u5c42\u4e2d\u7684 \u534f\u8bae/Protocol \u4e4b\u95f4\u7684\u5173\u7cfb\uff1f A\uff1a\u7c7b\u6bd4\uff1a\u5feb\u9012\u5bc4\u9001\u5305\u88f9\u7684\u8fc7\u7a0b, \u60f3\u8c61\u4f60\u8981\u628a\u4e00\u5c01\u4fe1\u5bc4\u5230\u56fd\u5916\u670b\u53cb\u90a3\u91cc\uff1a</p> <ol> <li>\u4f60\u5199\u7684\u4fe1\u5185\u5bb9 \ud83d\udc49 \u5c31\u662f\u5e94\u7528\u5c42\u7684\u6570\u636e\uff0c\u6bd4\u5982\u7f51\u9875\u5185\u5bb9\uff08HTML\uff09\u3001API \u54cd\u5e94\uff08JSON\uff09\u3002</li> <li>\u4f60\u653e\u8fdb\u4fe1\u5c01 \ud83d\udc49 \u662f\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u6bd4\u5982 HTTP \u628a\u6570\u636e\u5c01\u88c5\u597d\u3002</li> <li>\u4ea4\u7ed9\u5feb\u9012\u516c\u53f8\u5305\u88c5\u3001\u8d34\u5730\u5740 \ud83d\udc49 \u5c31\u50cf\u4f20\u8f93\u5c42\u7684 TCP \u628a HTTP \u6570\u636e\u518d\u5c01\u88c5\u3002</li> <li>\u88c5\u4e0a\u5361\u8f66\u3001\u8fd0\u8f93\u8def\u7ebf\u89c4\u5212 \ud83d\udc49 \u5c31\u50cf\u7f51\u7edc\u5c42\u7684 IP \u534f\u8bae\u8d1f\u8d23\u627e\u8def\uff08\u8def\u7531\uff09\u3002</li> <li>\u7269\u7406\u9001\u8fbe\u8fc7\u7a0b\uff08\u8d70\u516c\u8def\u3001\u6d77\u8fd0\uff09 \ud83d\udc49 \u5c31\u662f\u6570\u636e\u94fe\u8def\u5c42\u3001\u7269\u7406\u5c42\u3002</li> </ol> <p>\u534f\u8bae\u5206\u5c42\u7406\u89e3\uff1aHTTP \u4e0e TCP \u7684\u5173\u7cfb</p> \u534f\u8bae\u5c42\u7ea7 \u534f\u8bae\u793a\u4f8b \u804c\u8d23 \u4e3e\u4f8b\u8bf4\u660e \u5e94\u7528\u5c42 HTTP\u3001FTP\u3001SMTP\u3001DNS \u63d0\u4f9b\u5177\u4f53\u529f\u80fd\u7684\u901a\u4fe1\uff0c\u6bd4\u5982\u6d4f\u89c8\u7f51\u9875\u3001\u53d1\u90ae\u4ef6 \u6d4f\u89c8\u5668\u53d1 HTTP \u8bf7\u6c42\u62ff\u7f51\u9875 \u4f20\u8f93\u5c42 TCP\u3001UDP \u63d0\u4f9b\u53ef\u9760\u4f20\u8f93/\u901f\u5ea6\u4f18\u5316\uff0c\u4fdd\u8bc1\u6570\u636e\u80fd\u6b63\u786e\u4f20\u8fbe TCP \u4fdd\u8bc1\u7f51\u9875\u5185\u5bb9\u987a\u5e8f\u3001\u65e0\u4e22\u5931 \u7f51\u7edc\u5c42 IP\uff08IPv4/IPv6\uff09 \u8d1f\u8d23\u6570\u636e\u4ece\u6e90\u5934\u5230\u76ee\u6807\u5730\u5740\u7684\u4f20\u9012 \u8d1f\u8d23\u627e\u5230\u670d\u52a1\u5668\u7684\u5730\u5740 \u6570\u636e\u94fe\u8def\u5c42 Ethernet\u3001Wi-Fi \u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\u901a\u4fe1 \u5728\u5bb6\u4e2d Wi-Fi \u8def\u7531\u5668\u4f20\u8f93\u6570\u636e \u7269\u7406\u5c42 \u7535\u7f06\u3001\u5149\u7ea4\u3001\u65e0\u7ebf\u4fe1\u53f7 \u5b9e\u9645\u7684\u7269\u7406\u4f20\u8f93\u65b9\u5f0f \u7535\u4fe1\u53f7\u3001\u5149\u4fe1\u53f7\u7b49"},{"location":"network/protocols/#http","title":"HTTP","text":"<p>HTTP vs HTTPS</p> <p>Source: HTTP, HTTPS, CA, Certificate</p> <ul> <li>insecure connection == HTTP(Hypertext Transfer Protocol)</li> <li>secure connection == HTTPS(Hypertext Transfer Protocol Secure)</li> </ul> <p>Data Transmission in Internet</p> <p>Q: How is data transmitted through the Internet\uff1f A: </p> <p>1.Cleart Text (human-readable) -&gt; Binary (machine-readable)</p> <pre><code>&lt;img src=\"../imgs/conversion.png\" width=\"400\" /&gt;\n</code></pre> <ol> <li> <p>Binary -&gt; Radio Wave Device -&gt; Electrical Signals (0=0Volt, 1=+5Volt)</p> <p></p> </li> </ol> <p>\u9ed8\u8ba4\u7aef\u53e3<code>80</code>.</p> <p>Why is HTTP not secure?</p> <p>the Electrical Signals are opening accessible, anyone who with a RW Detector can catch your data</p> <p></p>"},{"location":"network/protocols/#concepts-to-understand","title":"Concepts to understand","text":""},{"location":"network/protocols/#encryption","title":"Encryption","text":"<p>with use a Key for encryption, Key is nothing more than a STRING! </p>"},{"location":"network/protocols/#symmetric-encryption","title":"Symmetric Encryption","text":"<p>Encrypt and decrypt the text with the SAME key: \u5371\u9669\uff01\u56e0\u4e3a\u9664\u4e86encrypted Text\uff0c\u4f60\u4e5f\u9700\u8981\u901a\u8fc7\u7f51\u7edc\u53d1\u9001Key\uff0c\u800c\u9ed1\u5ba2\u6709\u53ef\u80fd\u540c\u65f6\u62ff\u5230\u4e24\u8005</p> <pre><code>&lt;img src=\"../imgs/symmetric.png\" width=\"400\" /&gt;\n</code></pre>"},{"location":"network/protocols/#asymmetric-encryption","title":"Asymmetric Encryption","text":"<p>Encrypt and decrypt the text with DIFFERENT keys:  Public Key and Private Key</p> <p>Note</p> <ul> <li>Private Key: ONLY keeps for itself</li> <li>Public Key: public accessible, you could also google it</li> </ul>"},{"location":"network/protocols/#steps-2-steps","title":"Steps-2-steps","text":""},{"location":"network/protocols/#1-symmetric-asymmetric-keys","title":"1. Symmetric + Asymmetric Keys","text":"<p>system has:</p> <ul> <li>Client has one Symmetric Key for encrypt/decrypt the text - <code>keyT</code></li> <li>Server has Asymmetric Keys(<code>keyPub</code>, <code>keyPri</code>), and sends ONLY the <code>keyPub</code> to the Client</li> </ul> <pre><code>sequenceDiagram\n    participant Client\n    participant Server\n    Client--&gt;&gt;Server: I want to send you sth\n    Server--&gt;&gt;Client: Here is my Public Key `keyPub`\n    activate Client\n    Client--&gt;&gt;Server: I encrypted `keyT` with your `keyPub`\n    deactivate Client\n    activate Server\n    Server--&gt;&gt;Client: I decrypted `keyT` with my `keyPri`\n    deactivate Server\n    Client--&gt;&gt;Server: \"xxxxxxxXXXxxx\"\n    activate Server\n    Server--&gt;&gt;Client: Decrypting with `keyT`\n    deactivate Server</code></pre> <p>Danger</p> <p>This method can NOT avoid Middle Man Attack!</p> <p>The Hacker could pretend to be the Server!</p>"},{"location":"network/protocols/#2-symmetric-asymmetric-keys-certificate-authority","title":"2. Symmetric + Asymmetric Keys + Certificate Authority","text":"<p>CA</p> <p>A certificate authority (CA) is a trusted entity that issues digital certificates to authenticate content sent from web servers. There are around 12 CAs in the world.</p> <p>In the following example, each actor has something we need:</p> Client Server\u6bd4\u5982Facebook CA\u6bd4\u5982DigiCert - Sensitive Information - Public Key <code>KeyPub</code> - Private Key <code>KeyPri</code> - Public Key <code>CAKeyPub</code> - Private Key <code>CAKeyPri</code>- Certificate <p>Certificate</p> <p>CA \u53d1\u5e03\u7684 X.509 Certificate \u91cc\u5230\u5e95\u6709\u4ec0\u4e48</p> <ol> <li>Metadata <ul> <li>Issued to</li> <li>Issued from</li> </ul> </li> <li>Public Key - <code>KeyPub</code> received from Facebook</li> <li>Signature  = <code>CAKeyPri</code> encrypted <code>KeyPub</code> </li> </ol> <p></p> <pre><code>sequenceDiagram\n    participant Client\n    participant Server\n    participant CA\n    Client--&gt;&gt;Server: I want to send you sth\n    Server--&gt;&gt;CA: Here is my Public Key `keyPub`\n    activate CA\n    CA-&gt;&gt;Server: Certificate\n    deactivate CA\n    Server-&gt;&gt;Client: Certificate\n    activate Client\n    Client-&gt;&gt;CA: Did you signed the Certificate? If so, send me the `CAKeyPub`\n    deactivate Client\n    CA-&gt;&gt;Client: `CAKeyPub`\n    activate Client\n    Client-&gt;&gt;Server: I decrypted Certificate's Signature with `CAKeyPub`, &lt;br/&gt; Now I know You are You\n    deactivate Client\n\n    Client--&gt;&gt;Server: I encrypted `keyT` with your `keyPub`\n    activate Server\n    Server--&gt;&gt;Client: I decrypted `keyT` with my `keyPri`\n    deactivate Server\n    Client--&gt;&gt;Server: \"xxxxxxxXXXxxx\"\n    activate Server\n    Server--&gt;&gt;Client: Decrypting with `keyT`\n    deactivate Server</code></pre>"},{"location":"network/protocols/#x509-certificate","title":"x509 Certificate","text":"<p>Note</p> \u573a\u666f \u8bc1\u4e66\u683c\u5f0f \u7528\u9014 HTTPS X.509 \u7f51\u7ad9\u52a0\u5bc6\u548c\u8eab\u4efd\u9a8c\u8bc1 \u4ee3\u7801\u7b7e\u540d X.509 \u8f6f\u4ef6\u53d1\u5e03\u8005\u9a8c\u8bc1\uff08\u5982\u5fae\u8f6f\u7b7e\u540d\uff09 \u7535\u5b50\u90ae\u4ef6\u52a0\u5bc6 PGP/GPG \u7aef\u5230\u7aef\u52a0\u5bc6\uff08\u975e X.509\uff09 \u5185\u90e8\u6d4b\u8bd5 Self-Signed X.509 \u65e0 CA \u7b7e\u540d\u7684\u4e34\u65f6\u8bc1\u4e66 <p>\u4e3a\u4ec0\u4e48\u6709\u4e9b HTTPS \u8bc1\u4e66\u663e\u793a\u201c\u4e0d\u5b89\u5168\u201d\uff1f</p> <p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ul> <li>\u8bc1\u4e66\u8fc7\u671f\u6216\u57df\u540d\u4e0d\u5339\u914d\u3002</li> <li>\u81ea\u7b7e\u540d\u8bc1\u4e66\uff08\u65e0 CA \u7b7e\u53d1\uff09\u3002</li> <li>\u6d4f\u89c8\u5668\u4e0d\u4fe1\u4efb\u7b7e\u53d1 CA\uff08\u5982\u4f01\u4e1a\u5185\u79c1\u6709 CA \u672a\u9884\u88c5\uff09\u3002</li> </ul> <p>\u5982\u4f55\u83b7\u53d6 X.509 \u8bc1\u4e66\uff1f</p> <p>\u901a\u8fc7 CA \u673a\u6784\u8d2d\u4e70\uff08\u5982 DigiCert\uff09\u6216\u514d\u8d39\u7533\u8bf7\uff08\u5982 Let's Encrypt\uff09\u3002</p>"},{"location":"network/protocols/#3-chain-of-trust","title":"3. Chain of Trust","text":"<p>Its VERY dangerous if the Private key of a CA (<code>CAKeyPri</code>) get compromised., To minimize the possibility, we use Chain of Trust to make the <code>CAKeyPri</code> is as far as possible from the internet.</p> <pre><code>&lt;img src=\"../imgs/chain_of_trust.png\" width=\"400\" /&gt;\n</code></pre>"},{"location":"network/protocols/#https","title":"HTTPS","text":"<p>S=Security</p> <p>HTTPS= HTTP + Encryption through SSL/TLS Protocol</p> <p>\u9ed8\u8ba4\u7aef\u53e3<code>443</code>.</p> <p>Why is HTTPS secure? [#2. Symmetric + Asymmetric Keys + Certificate Authority] + [#3. Chain of Trust]</p> <p>SSL/TLS\u534f\u8bae</p> <p>SSL/TLS\u534f\u8bae\u4e0d\u4ec5\u5b9a\u4e49\u4e86\u5982\u4f55\u5efa\u7acb\u5b89\u5168\u901a\u4fe1\u7684\u6d41\u7a0b\uff08\u5982\u63e1\u624b\u534f\u8bae\uff09\uff0c\u8fd8\u8be6\u7ec6\u89c4\u5b9a\u4e86\u52a0\u5bc6\u89c4\u5219\uff0c\u5305\u62ec\u52a0\u5bc6\u7b97\u6cd5\u3001\u5bc6\u94a5\u751f\u6210\u65b9\u5f0f\u3001\u6570\u636e\u5b8c\u6574\u6027\u6821\u9a8c\u7b49\u3002</p> <ul> <li>SSL\uff08Secure Sockets Layer\uff09</li> <li>TLS\uff08Transport Layer Security\uff09</li> </ul> <p>TLS\u662fSSL\u7684\u540e\u7eed\u7248\u672c\uff01</p>"},{"location":"network/protocols/#tls-ssh","title":"TLS / SSH","text":""},{"location":"network/protocols/#why-does-ssh-key-generation-create-both-public-and-private-keys-but-tls-does-not","title":"Why Does SSH Key Generation Create Both Public and Private Keys, but TLS Does Not?","text":"<p>Good observation! The difference comes from the purpose and design of SSH keys versus TLS certificates.</p>"},{"location":"network/protocols/#1-ssh-key-pair-private-public-keys-are-always-generated-together","title":"1. SSH Key Pair: Private &amp; Public Keys Are Always Generated Together","text":"<ul> <li>SSH uses asymmetric cryptography, where the private key is kept secret, and the public key is shared.</li> <li>When you generate an SSH key (<code>ssh-keygen</code>), it automatically creates both:</li> <li>Private key (<code>id_rsa</code> or similar): Used for authentication.</li> <li>Public key (<code>id_rsa.pub</code>): Placed on the remote server to allow authentication.</li> <li>This is because SSH is designed for direct authentication (like logging into a server), so both keys are needed from the start.</li> </ul>"},{"location":"network/protocols/#2-tls-certificates-private-key-and-public-certificate-are-separate","title":"2. TLS Certificates: Private Key and Public Certificate Are Separate","text":"<ul> <li>TLS (used in HTTPS, etc.) also uses asymmetric cryptography, but it requires a Certificate Authority (CA) to issue a certificate.</li> <li>When you generate a private key (<code>private.key</code>), it is not automatically paired with a public certificate because:</li> <li>The public certificate needs to be issued and signed by a trusted CA.</li> <li>You first generate a Certificate Signing Request (CSR), which contains the public key and identity details.</li> <li>A CA (like Let's Encrypt, DigiCert) verifies the CSR and issues a signed certificate.</li> <li>Only after this process do you get a valid TLS certificate (<code>certificate.crt</code>).</li> </ul>"},{"location":"network/protocols/#why-this-difference","title":"Why This Difference?","text":"Feature SSH Keys TLS Certificates Purpose Authentication for SSH access Encrypting HTTPS connections Key Pairing Automatically generates both keys Only the private key is generated first Public Key Use Directly used for authentication Must be signed by a CA before use Validation No external validation needed Requires CA validation for trust"},{"location":"network/protocols/#conclusion","title":"Conclusion","text":"<p>SSH keys are self-sufficient, while TLS certificates involve a trusted third party (CA) to issue and verify them. That\u2019s why SSH key generation is immediate, while TLS requires extra steps to get a certificate.</p>"},{"location":"network/protocols/#telnet","title":"Telnet","text":"<p>Telnet(Teletype Network) is a CLI Tool developed in 1969 that is used to access remote servers. Because it is invented before internet, there is no security concerns designed for telnet. Later <code>SSH</code> is invented as a better alternative to <code>Telnet</code></p>"},{"location":"project_mgmt/agile/","title":"Agile","text":""},{"location":"project_mgmt/agile/#agile","title":"Agile","text":""},{"location":"project_mgmt/agile/#agile-values","title":"Agile values","text":"<ol> <li>Trust:<ul> <li>Show vulnerability to your team by admitting to any mistakes you made.</li> <li>Show vulnerability to your team by asking team members for help.</li> </ul> </li> <li>Empathy:<ul> <li>Take the time to consider the perspectives of team members during heated discussions when they offer suggestions and ideas different from your own or the group.</li> <li>Ask thoughtful, non-judgmental questions to understand their perspectives.</li> </ul> </li> <li>Respect:<ul> <li>Treat all members of your team with dignity by ensuring all have a chance to express their viewpoints, suggestions, and ideas on how to get the work done.</li> </ul> </li> <li>Openness:<ul> <li>Listen to others\u2019 viewpoints, suggestions, and ideas without judgment or dismissiveness. Ask thoughtful questions to understand their viewpoints.</li> <li>Be transparent to the team by sharing your ideas and suggestions.</li> </ul> </li> <li>Courage:<ul> <li>Share any idea even though it might be different than what others think.</li> <li>Speak up when you see something isn\u2019t working and suggest another idea or ideas to get back on the right track.</li> </ul> </li> </ol>"},{"location":"project_mgmt/agile/#agile-principles","title":"Agile Principles","text":"<ol> <li>Clarity of Outcome: <ul> <li>Outcome-oriented</li> <li>Focused on user &amp; business value</li> </ul> </li> <li>Iteration and Learning: <ul> <li>Iterative and fast</li> <li>Flexible, adaptive and continuously improving</li> </ul> </li> <li>Self-Directed Teams: <ul> <li>Collaborative and multi-disciplinary</li> <li>Empowered and self-directed</li> </ul> </li> </ol>"},{"location":"project_mgmt/agile/#agile-practices","title":"Agile practices","text":"<ol> <li>Social contract: a simple agreement that defines how a group will work together \u201cat its best.\u201d</li> <li>Mood marbles: a simple tool that help you gauge the mood of a group</li> <li>Wall of work: a simple, visual way to track progress. (TODO, In Progress, Done in Trello board)</li> <li>Stand-up: short status meetings, usually done daily.<ul> <li>What have you completed since the last stand-up?</li> <li>What will you complete by the next stand-up?</li> <li>What are the blockers keeping you from successfully completing your tasks?</li> </ul> </li> <li>Retrospective: to look back in thought or to reflect. </li> <li>Showcase: a meeting where the team presents the completed work to the stakeholders and obtains feedback for moving forward. </li> <li>Shuhari:<ul> <li>shu (protect): to follow with no deviation.</li> <li>ha (detach): become innovativ</li> <li>ri(leave): create new path</li> </ul> </li> </ol>"},{"location":"project_mgmt/agile/#agile-patterns","title":"Agile patterns:","text":"<ol> <li>Strategy and governance pattern: helps leaders develop the direction in which the company will go. \u6218\u7565\u54a8\u8be2\u5c42\u9762\u7684\uff0c\u662fC level\u7684\u4eba\u8981\u8003\u8651\u7684</li> <li>Operations pattern is for continuous, repeatable, and day-to-day work. \u4e00\u4e9b\u65e5\u5e38\u91cd\u590d\u5de5\u4f5c</li> <li>Programs pattern is for project work that has a definite start and end. \u9879\u76ee\uff08\u6709\u5934\u6709\u5c3e\uff09</li> </ol> <p>All three patterns follow the same five steps or phases:</p> <ol> <li>Mobilize</li> <li>Understand</li> <li>Explore and strategize</li> <li>Build, test, and implement</li> <li>Manage and evolve</li> </ol> <p>Attention</p> <p>But different pattern has different practices.</p>"},{"location":"project_mgmt/agile/#design-thinking","title":"Design thinking","text":"<p>is a method for creative problem solving.</p>"},{"location":"project_mgmt/git/","title":"Git","text":""},{"location":"project_mgmt/git/#see-log","title":"see log","text":"<pre><code>git log origin/main..HEAD\n</code></pre>"},{"location":"project_mgmt/git/#reset-to-previous-version","title":"reset to previous version","text":"<pre><code>git reset \u2014soft HEAD~\ngit restore --staged // Removes the file from the Staging Area, but leaves its actual modifications untouched\n</code></pre>"},{"location":"project_mgmt/git/#revert-what-has-been-git-add-xxx","title":"revert what has been <code>git add xxx</code>","text":"<p>If this has been done:</p> <pre><code>git add .gitignore\n</code></pre> <p>This will be taken back from \"added file\":</p> <pre><code>git reset .gitignore\n</code></pre>"},{"location":"project_mgmt/ibm_internal/","title":"IBM PM","text":""},{"location":"project_mgmt/ibm_internal/#project-management-orientation","title":"Project Management Orientation","text":"<p>It's an introduction to project mgmt concepts, the same from WWPMM and PMI. Such as: - baselines - work breakdown structures - Seven Keys to Success - risk management - estimating - scheduling - project control - closeout</p>"},{"location":"project_mgmt/ibm_internal/#project-phases","title":"Project phases","text":""},{"location":"project_mgmt/ibm_internal/#project-stakeholders","title":"Project stakeholders","text":""},{"location":"python/build_dependency/","title":"Build Own Dependency","text":"<p>This is a python package for testing purpose.</p>"},{"location":"python/build_dependency/#1-install-twine","title":"1. Install <code>twine</code>","text":"<p>You\u2019ll need <code>twine</code> to upload your project distributions to PyPI (see below). <pre><code>python3 -m pip install twine\n</code></pre></p>"},{"location":"python/build_dependency/#2-setuppy","title":"2. setup.py","text":"<ol> <li>it contains a global <code>setup()</code> function, which contains important arguments!</li> <li>It\u2019s the command line interface for running various commands that relate to packaging tasks. To get a listing of available commands, run <code>python3 setup.py --help-commands</code></li> </ol>"},{"location":"python/build_dependency/#3-readmemd","title":"3. README.md","text":"<p>It covers the goal of the project.</p>"},{"location":"python/build_dependency/#4-manifestin","title":"4. MANIFEST.in","text":"<p>A <code>MANIFEST.in</code> is needed when you need to package additional files that are not automatically included in a source distribution.</p>"},{"location":"python/build_dependency/#5-licensetxt","title":"5. LICENSE.txt","text":"<p>consulting this website</p>"},{"location":"python/build_dependency/#6-folder","title":"6.  folder <p>Although it\u2019s not required, the most common practice is to include your Python modules and packages under a single top-level package that has the same name as your project, or something very close.   </p>","text":""},{"location":"python/build_dependency/#7-build-project","title":"7. Build project <pre><code># install `build` package\npython3 -m pip install build\n\n# build the package\npython3 -m build --sdist\n</code></pre>","text":""},{"location":"python/build_dependency/#8-create-wheel-for-the-project","title":"8. Create wheel for the project <p>A wheel is a built package that can be installed without needing to go through the \u201cbuild\u201d process. Installing wheels is substantially faster for the end user than installing from a source distribution. - If your project is pure Python then you\u2019ll be creating a \u201cPure Python Wheel\u201d - If your project contains compiled extensions, then you\u2019ll be creating what\u2019s called a Platform Wheel </p>","text":""},{"location":"python/build_dependency/#81-pure-wheel","title":"8.1 Pure wheel","text":"<p>This command pack your project into a <code>dist</code> folder:</p> <p><pre><code>python3 -m build --wheel\n</code></pre> * If you run build without --wheel or --sdist, it will build both files for you; this is useful when you don\u2019t need multiple wheels.</p>"},{"location":"python/build_dependency/#82-platform-wheels","title":"8.2 Platform Wheels","text":"<p>Platform Wheels are wheels that are specific to a certain platform like Linux, macOS, or Windows, usually due to containing compiled extensions. <pre><code>python3 -m build --wheel\n</code></pre></p>"},{"location":"python/build_dependency/#9-setup-pypi-account-in-your-pc","title":"9. Setup PyPI account in your PC <p>Create a <code>$HOME/.pypirc</code> file: <pre><code>[pypi]\nusername = __token__\npassword = &lt;the token value, including the `pypi-` prefix&gt;\n</code></pre></p>","text":""},{"location":"python/build_dependency/#10-check-upload-to-pypi","title":"10. Check &amp; upload to PyPI <p>The directory <code>dist/</code> was created under your project\u2019s root directory. Check the generated distribution of the project: <pre><code># check the grammar in dist/ directory\ntwine check dist/*\n\n# upload distribution\ntwine upload dist/*\n</code></pre></p>  <p>Example: <code>setup.py</code>: <pre><code>from setuptools import find_packages, setup\n\nsetup(\n    name='alice',\n    version='1.0.0',\n    description=\"CH's first python dependency\",\n    long_description=\"CH's first python dependency\",\n    long_description_content_type=\"CH's first python dependency\",\n    author='CH.He',\n    author_email='Chuying.He@ibm.com',\n    license='MIT',\n    keywords='test project alice',\n    packages=find_packages(),    # Set packages to a list of all packages in your project, including their subpackages, sub-subpackages, etc. Although the packages can be listed manually, setuptools.find_packages() finds them automatically. \n    install_requires=[\n        'setuptools',\n        'panda',\n    ],\n    # url='https://github.com/pypa/sampleproject',\n    # include_package_data=True,\n    # cmdclass={\n    #     \"package\": Package\n    # }\n    # python_requires='&gt;=3',    # if your project only runs on certain Python versions,\n    # package_data={            # additional files need to be installed into a package. For example, documentation that might be of interest to programmers using the package.\n    #     'sample': ['package_data.dat'],\n    # },\n    # data_files=[('my_data', ['data/data_file'])], # Sometimes you may need to place data files outside of your packages. The data_files directive allows you to do that. \n\n)\n</code></pre></p>  <p>Example: <code>main.py</code>: <pre><code>def greet(name):\n    return f\"Hello, {name}!\"\n\ndef add_numbers(a, b):\n    return a + b\n\nif __name__ == \"__main__\":\n    print(greet(\"Alice\"))\n    print(add_numbers(5, 7))\n</code></pre></p>","text":""},{"location":"python/dependencies/","title":"Use dependencies","text":"<p>Best practise</p> <p>Specify Exact Versions: Whenever possible, specify exact versions of your dependencies in your requirements file. This ensures that the exact same versions are installed across different environments, reducing the chances of compatibility issues.</p>"},{"location":"python/dependencies/#requirement-specification","title":"Requirement Specification","text":"<p>There are different ways to specify dependencies in the <code>requirements.txt</code> file:</p>"},{"location":"python/dependencies/#exact-version","title":"Exact Version","text":"<p>You can specify an exact version of a dependency by using the == operator followed by the version number. For example:</p> <pre><code>package1==1.0.0\n</code></pre>"},{"location":"python/dependencies/#version-range","title":"Version Range","text":"<p>You can specify a range of acceptable versions using comparison operators (&lt;, &lt;=, &gt;, &gt;=) or hyphens (-). For example:</p> <pre><code>package2&gt;=2.3.0\npackage3&lt;1.5.0\npackage4&gt;=1.0.0,&lt;=2.0.0\npackage5~=1.2.0  # Compatible release operator (approximately equivalent to &gt;=1.2.0, &lt;1.3.0)\n</code></pre>"},{"location":"python/dependencies/#wildcard","title":"Wildcard","text":"<p>You can use a wildcard (*) to indicate that any version of the dependency is acceptable. However, this is generally not recommended for production environments as it can lead to unpredictability. For example:</p> <pre><code>package6==*\n</code></pre>"},{"location":"python/dependencies/#urls-and-file-paths","title":"URLs and File Paths","text":"<p>You can specify dependencies using URLs or file paths, which can be useful for referencing packages hosted on version control repositories or local directories. For example:</p> <pre><code>git+https://github.com/user/repo.git@branch\nfile:///path/to/package.tar.gz\n</code></pre>"},{"location":"python/dependencies/#environment-markers","title":"Environment Markers","text":"<p>You can use environment markers to specify dependencies that are only installed under certain conditions, such as the Python version or operating system. For example:</p> <pre><code>package8; python_version &gt;= '3.6'\npackage9; os_name == 'posix'\n</code></pre>"},{"location":"python/dependencies/#extras","title":"Extras","text":"<p>Some packages provide extra features that can be installed optionally. You can specify these extras using square brackets ([]). For example:</p> <pre><code>package10[extra1,extra2]\n</code></pre>"},{"location":"python/dependencies/#comments","title":"Comments","text":"<p>You can include comments in requirements.txt using the # character. Comments are ignored by pip when installing dependencies. For example:</p> <pre><code># This is a comment\npackage7==1.0.0  # This is another comment\n</code></pre>"},{"location":"python/grammars/","title":"Grammars","text":"<p>Source</p>"},{"location":"python/grammars/#basics","title":"Basics","text":""},{"location":"python/grammars/#lamda-function","title":"Lamda function","text":"<p>double = [x*2 for x in Sequence] double = map(func, Sequence) # apply each item in Squence with func() double = map(lambda x: x*2, Sequence)</p>"},{"location":"python/grammars/#postion-args","title":"Postion args","text":"<p>func(*args)</p>"},{"location":"python/grammars/#keyword-args","title":"Keyword args","text":"<p>func(**kwargs)</p>"},{"location":"python/grammars/#magic-methods","title":"Magic methods","text":"<p>Magic methods are the auto-called methods in CLASS:</p> <ul> <li><code>__init__()</code>: when CLASS object is created</li> <li><code>__str__()</code>: when you want to print object</li> <li><code>__repr__()</code>: to print xxx in order to reproduce the CLASS object</li> </ul>"},{"location":"python/grammars/#methods-types","title":"Methods types","text":"<ol> <li>instance methods    need the object -&gt; in order to call them</li> </ol> <pre><code>@classmethod\ndef instance_method(self):\n</code></pre> <ol> <li>class methods    need the CLASS -&gt; in order to call them    --&gt; can be used to create Object</li> </ol> <pre><code>@classmethod\ndef class_method(cls):\n</code></pre> <ol> <li>static methods    a function instead of method. It has no info about the CLASS or OBJECT</li> </ol> <pre><code>@staticmethod\ndef static_method():\n</code></pre>"},{"location":"python/grammars/#inheritance","title":"Inheritance","text":"<pre><code>class Child(Parent):\ndef **init**(self):\nsuper().**init**()\n</code></pre>"},{"location":"python/grammars/#type-hinting","title":"Type hinting","text":"<pre><code>def func(sequence: list) -&gt; float\n</code></pre> <ul> <li>input(sequence): has LIST type</li> <li>return a FLOAT type</li> <li>return the own class: \"Book\"</li> <li>return another class: Bookshelf</li> </ul>"},{"location":"python/grammars/#useful-env-variables","title":"Useful env variables","text":"<pre><code>import sys\nsys.path # to see where to look for the python packages\nsys.modules #to see all imported modules\n__name__ # current file\n</code></pre>"},{"location":"python/grammars/#errors","title":"Errors","text":"<pre><code>def divide():\n  if ... raise ZeroDivisionError(\"msg...\")\n</code></pre> <p>Example:</p> <pre><code>try: ...\nexcept ZeroDivisionError as e :\nelse: # when no error\nfinally: # always output\n</code></pre>"},{"location":"python/grammars/#custom-error-class","title":"Custom Error Class","text":"<pre><code>class SportInconsistency(ValueError):\n    pass\n</code></pre>"},{"location":"python/grammars/#first-class-function","title":"First-class function","text":"<p>to pass Function as Parameter</p> <pre><code>func # pass a function\nfunc() # call a function\n</code></pre>"},{"location":"python/grammars/#decorators","title":"Decorators","text":"<p>make functions secure Decorators: @make_secure &lt;-- the secure function import functools @functools.wrap(func) Decorators: pass with variable</p>"},{"location":"python/grammars/#multability","title":"Multability","text":"<p>Do not use default-parameter-values that are mutable</p>"},{"location":"python/grammars/#comment","title":"Comment","text":"<p>This is the official document that shows when hover on the class/method</p> <pre><code>\"\"\"\nDocument\n\"\"\"\n</code></pre>"},{"location":"python/grammars/#error-handlung","title":"Error Handlung","text":"<p>When you deliver your program to your client. You should always try to \"catch the errors\" so that your program doesn't crash!</p> ERROR TYPE Reason IndexError out of range KeyError used wrong key NameError var is not defined AttributeError attr of a list not exit NotImplementedError the same as <code>pass</code> RuntimeError basically could be anything SyntaxError wrong python syntax IndentationError indentation missing TabError Should have use \"spaces\" instead of \"tabs\" TypeError wrong type ValueError correct type, but invalid value ImportError DeprecationWarning"},{"location":"python/grammars/#raise-error","title":"Raise Error","text":"<pre><code>raise NotImplementedError('This function is not implemented yet')\n\nif not isintance(car, Car):\n    raise TypeError(f'Tried to add a `{car.__class__.__name__}` to the garage')\n\n# in the new specification, this Error can be prevent by using \"type specification\":\ndef myfunc(self, car: Car):\n</code></pre>"},{"location":"python/grammars/#create-own-error","title":"Create Own Error","text":"<pre><code>class RuntimeErrorWithCode(TypeError):\n    def __init__(self, message, code):\n        super().__init__(f'Error code {code}: {message}')\n        self.code = code\n</code></pre>"},{"location":"python/grammars/#dealing-with-error","title":"Dealing with Error","text":"<ol> <li>Silence the ERROR <p>with finally you silenced the ERROR -&gt; no error info will be printed. for PROD</p> </li> </ol> <pre><code>try:\n    # do sth\nexcept TypeError:\n   print(\"TypeError: your car is not a Car\")\nexcept ValueError:\n   print(\"ValueError...\")\nfinally:\n    #code that always run\n   print(f'The garage now has {}')\n</code></pre> <ol> <li>Make the ERROR laut <p>for DEV</p> </li> </ol> <pre><code>try:\n    user.score = perform_calculation(user.engagement_metrics)\nexcept KeyError:\n    print('Incorrect values provided to our calculation function.')\n    raise\nelse:\n    if user.score &gt; 500:\n        send_engagement_notification(user)\n</code></pre> <p>!!! `raise`` has 2 use cases: - raise NotImplementedError() --&gt; outside, to call an Error - raise --&gt; inside a except Error, to unsilence the Error</p>"},{"location":"python/grammars/#string-operation","title":"String operation","text":"Operation Explaination <code>print(\"hello world\")</code> <code>print(\"hello world\", end=\"\")</code> <code>end=\"\"</code> overwrites the default 'newline' after print <code>strip()</code> <code>if... elif... else</code> <code>elif</code> instead of <code>else if</code> <code>!=</code> <code>==</code> <code>a = int(input())</code> Read input value from STDIN, as Integer <code>.strip()</code>,<code>.lstrip()</code>,<code>.rstrip()</code> \u5220\u6389\u591a\u4f59\u7a7a\u683c <code>.title()</code>\uff0c<code>.upper()</code>\uff0c<code>.lower()</code> \u6539\u7f57\u9a6c\u5b57\u6bcd\u5927\u5c0f\u5199"},{"location":"python/grammars/#python-arithmetic-operators","title":"Python Arithmetic Operators","text":"Operator Description Example <code>+</code> Addition Adds values on either side of the operator. <code>-</code> Subtraction Subtracts right hand operand from left hand operand. <code>*</code> Multiplication Multiplies values on either side of the operator <code>/</code> Division Divides left hand operand by right hand operand <code>%</code> Modulus Returns remainder <code>**</code> Exponent Performs exponential (power) calculation on operators <code>//</code> Floor Division - The division of operands where the result is the quotient in which the digits after the decimal"},{"location":"python/grammars/#python-comparison-operators","title":"Python Comparison Operators","text":"Operator Description Example <code>==</code> If the values of two operands are equal, then the condition becomes true. (a == b) is not true. <code>!=</code> If values of two operands are not equal, then condition becomes true.  it is NOT <code>!==</code> (a != b) is true. <code>&lt;&gt;</code> If values of two operands are not equal, then condition becomes true. (a &lt;&gt; b) is true. This is similar to != operator. <code>&gt;</code> If the value of left operand is greater than the value of right operand, then condition becomes true. (a &gt; b) is not true. <code>&lt;</code> If the value of left operand is less than the value of right operand, then condition becomes true. (a &lt; b) is true. <code>&gt;=</code> If the value of left operand is greater than or equal to the value of right operand, then condition becomes true. (a &gt;= b) is not true. <code>&lt;=</code> If the value of left operand is less than or equal to the value of right operand, then condition becomes true."},{"location":"python/grammars/#loop","title":"Loop","text":""},{"location":"python/grammars/#for-loop","title":"<code>for</code> loop","text":"<p>Using an array:</p> <pre><code>fruits = [\"apple\", \"banana\", \"cherry\"]\nfor x in fruits:\n  print(x)\n</code></pre> <p>Using a string:</p> <pre><code>for x in \"banana\":\n  print(x)\n</code></pre> <p>Using a number as range:</p> <pre><code>for x in range(2, 30, 3):\n  print(x)\n</code></pre>"},{"location":"python/grammars/#while-loop","title":"<code>while</code> loop","text":"<p>TODO</p>"},{"location":"python/grammars/#python-collections","title":"Python Collections","text":"List Tuple Set Dictionary Ordered? Yes Yes No Yes Changeable? Yes No No Yes Allow duplicates? Yes Yes No No Operations: Create <code>my_list = [\"apple\", \"banana\", \"cherry\"]</code> <code>my_list = list((\"apple\", \"banana\", \"cherry\"))</code> - allows different type <code>my_list = [\"abc\", 34, True, 40, \"male\"]</code> Length <code>len(my_list)</code> Get Type <code>type(my_list)</code> Access items <code>my_list[1]</code> <code>my_list[-1]</code> Get the last one  <code>my_list[2:5]</code> Get a range of elements [2,5)  <code>my_list[:4]</code> Checking existence <code>if \"apple\" in my_list:</code> Change <code>my_list[1]=\"kiwi\"</code> <code>my_list[1:3]=[\"kiwi\", \"passionfruit\"]</code> Add <code>my_list.insert(2, \"watermelon\")</code> <code>my_list.append(\"orange\")</code> Concatenate <code>my_list.extend(list2)</code> <code>my_list.extend(tuple)</code> Concatenate List and Tuple Remove <code>my_list.remove(\"banana\")</code> Remove the first occurance of \"banana\"  <code>my_list.pop(1)</code> removes specified index and get the value for return  <code>del my_list[1]</code> Just removes the one with index, no return Clear up <code>my_list.clear()</code>"},{"location":"python/oblivion/","title":"Oblivion","text":""},{"location":"python/oblivion/#oblivion","title":"Oblivion","text":""},{"location":"python/oblivion/#subprocess-exited-with-error","title":"subprocess-exited-with-error","text":""},{"location":"python/oblivion/#422-unprocessable-entity","title":"422 unprocessable entity","text":"<p>the order of the routers in the controller matters!</p> <p>for example: <pre><code># wrong\n/{item_id}/details\n/all\n# here in the /all endpoint, fastapi will also ask for a {item_id} even though its not written\n\n# correct\n/all\n/{item_id}/details\n</code></pre></p>"},{"location":"python/oblivion/#object-is-not-json-serializable","title":"Object is not JSON serializable","text":"<pre><code>json.dumps(result)\n</code></pre> <p>json.dumps() function will convert a subset of Python objects into a json string. Not all objects are convertible and you may need to create a dictionary of data you wish to expose before serializing to JSON.</p>"},{"location":"python/oblivion/#object-not-iterable","title":"Object not iterable","text":"<p>Error msgs:</p> <pre><code>ValueError: [TypeError(\"'EntityMention' object is not iterable\"), TypeError('vars() argument must have __dict__ attribute')]\n</code></pre> <p>Solution:</p> <pre><code>json.dumps(result)\n</code></pre>"},{"location":"python/oblivion/#iterable","title":"Iterable?","text":"<pre><code># Testing: check wether an Object is iterable of not: If you can see the magic method __iter__, then the data are iterable. If not, then the data are not iterable and you shouldn\u2019t bother looping through them.\nprint(\"is watson_nlp.data_model.text_primitives.Span iterable?\",dir(Span))\nprint(\"is watson_nlp.data_model.entities iterable?\",dir(EntityMention))\n</code></pre>"},{"location":"python/oblivion/#no-validator-found-for-see-arbitrary_types_allowed-in-config","title":"no validator found for , see <code>arbitrary_types_allowed</code> in Config <p>class NLPResponse(BaseModel): results: List[EntityMention]</p> <p>--&gt; doesnt work</p>","text":""},{"location":"python/oblivion/#how-to-load-local-file-in-source-code-using-relative-path","title":"How to load local file in source code using relative path? <pre><code># file location:            project/src/app/asset/location_search.csv\n# current code location:    project/src/app/core/services/watson_nlp_service.py\nimport os\n\nscript_path = os.path.abspath(__file__)\nproject_root = os.path.dirname(os.path.dirname(os.path.dirname(script_path)))\n\nfile_path = os.path.join(project_root, \"asset/location_search.csv\")\n</code></pre>","text":""},{"location":"python/virtual_env/","title":"Virtual environment","text":""},{"location":"python/virtual_env/#how-to-use-different-python-version-with-pyenv","title":"How to use different Python Version with <code>pyenv</code>","text":"<p>https://www.freecodecamp.org/news/python-version-on-mac-update/</p>"},{"location":"python/fastapi/","title":"FastAPI","text":"<p>Goal</p> <p>The goal of this page is to give you a quick recap of important FastAPI concepts after you detached from it for a while</p>"},{"location":"python/fastapi/#concurrency-vs-parallelism","title":"Concurrency vs Parallelism","text":"Concurrent Parallel Ordering burger in Burger King Odering Burrito + good for the task that takes long waiting time + good for quick tasks <p>Coroutine</p> <p>co.routine has 2 possible meanings: 1. Result of a async function 2. Technique that uses <code>async</code> and <code>await</code> to write code</p> <p>Once async, always async - all the function that uses async function have to be async too!</p>"},{"location":"python/fastapi/#path","title":"Path","text":"<p>Endpoint, route or path are all the same thing, they are mean <code>@app.get(\"/users/{user_id}\")</code></p>"},{"location":"python/fastapi/#parameters","title":"Parameters","text":"<p>There are 4 types of Parameters. They all inherit from the same common <code>Param</code> class. Though <code>Header</code> has some extra functionality.</p>"},{"location":"python/fastapi/#1-path-parameter","title":"1. Path parameter","text":"<p>Path parameter needs to be defined \"twice\":</p> <ul> <li>in path</li> <li>in the function head in parentheses ()   <pre><code>@app.get(\"/users/{user_id}\")\nasync def read_user(user_id: str):\n</code></pre></li> </ul> <p>Besides <code>str</code> there are also other type annotation, for example <code>Enum</code> will lead to a dropdown UI in swagger doc. You need to define the enum:</p> <pre><code>class ModelName(str, Enum):\n    alexnet = \"alexnet\"\n    resnet = \"resnet\"\n    lenet = \"lenet\"\n</code></pre> <p>optional: <code>python     q: str | None = None</code></p> <pre><code>default:\n```python\nq: str = \"hi\"\n```\n</code></pre>"},{"location":"python/fastapi/#2-query-parameter","title":"2. Query parameter","text":"<p>When declare other parameters that are NOT a part of the path.</p> <ul> <li>key-value pairs</li> <li>use it after <code>?</code>, separated by <code>&amp;</code>. E.g. <code>http://127.0.0.1:8000/items/?skip=0&amp;limit=10</code></li> <li>it can be mixed with path parameters: order doesnt matter</li> </ul> <p>required: just give no default values</p>"},{"location":"python/fastapi/#3-cookie-parameter","title":"3. Cookie parameter","text":"<p>To declare cookies, you need to use Cookie, because otherwise the parameters would be interpreted as query parameters. E.g.</p> <pre><code>from typing import Annotated\nfrom fastapi import Cookie\n\n@app.get(\"/items/\")\nasync def read_items(ads_id: Annotated[str | None, Cookie()] = None):\n    return {\"ads_id\": ads_id}\n</code></pre> <p>Annotated</p> <p><code>Annotated</code> is used to specify that the <code>ads_id</code> parameter is a cookie parameter and can be either a <code>string</code> or <code>None</code>.</p>"},{"location":"python/fastapi/#4-header-parameter","title":"4. Header parameter","text":"<p>To declare cookies, you need to use Header, e.g.:</p> <pre><code>from typing import Annotated\nfrom fastapi import  Header\n\n@app.get(\"/items/\")\nasync def read_items(user_agent: Annotated[str | None, Header()] = None):\n    return {\"User-Agent\": user_agent}\n</code></pre> <p>Header parameter has extra functionality comparison to other 3 parameters:</p> <ul> <li>Header will convert the parameter names from hyphen (-) to underscore (_) (because name user-agent is invalid)</li> <li>its case-sensitve</li> <li>Duplicate headers:   <pre><code>async def read_items(x_token: Annotated[list[str] | None, Header()] = None):\n</code></pre></li> </ul>"},{"location":"python/fastapi/#request-body","title":"Request Body","text":"<p>operations that have Request Body:</p> <ul> <li>POST</li> <li>PUT</li> <li>DELETE</li> <li>PATCH</li> </ul> <p>Data type: use <code>Pydantic</code>! It also adds support in your IDE</p> <pre><code>from pydantic import BaseModel\n\nclass Item(BaseModel):\n    name: str\n    description: str | None = None\n    price: float\n    tax: float | None = None\n\n@app.post(\"/items/\")\nasync def create_item(item: Item):\n    return item.name\n</code></pre> <p>!!! note \"How does it work in background?\" 1. FastAPI reads the Request Body as JSON 2. convert the corresponding types 3. validate</p> <p>!!! tip \"Differentiation: Parameter vs Body\" - If the parameter is also declared in the path, it will be used as a path parameter. - If the parameter is of a singular type (like int, float, str, bool, etc) it will be interpreted as a query parameter. - If the parameter is declared to be of the type of a Pydantic model, it will be interpreted as a request body.</p> <pre><code>\ud83d\udca1 **query parameter** and **request body** ONLY differ in data-type!\n</code></pre>"},{"location":"python/fastapi/#typing","title":"Typing","text":""},{"location":"python/fastapi/#annotated","title":"Annotated","text":"<p><code>Annotated</code> is a Python type hint that allows you to attach additional metadata or annotations to a type. This metadata can provide extra context or instructions for how the type should be interpreted or used. Here's an explanation of the code:</p>"},{"location":"python/fastapi/#onion-architecture","title":"Onion Architecture","text":"<ol> <li>Domain: This is the innermost layer and represents the core domain logic of the application. It contains domain models, business rules, and interfaces defining the contracts for interacting with domain objects. It can includes <code>models/</code> for domain model definitions, and <code>repositories/</code> for interface definitions for interacting with data.</li> <li>Service: This layer sits around the domain layer and contains the application-specific business logic. It orchestrates interactions between different domain objects, applies business rules, and handles use cases.</li> <li>Infrastructure: This layer wraps around both the domain and application layers and deals with external concerns such as databases, file systems, external services, and configuration settings. It provides implementations for interacting with external resources while keeping the core domain and application layers decoupled from such details. It can also be further refined into subfolder such as <code>database/</code>, <code>external_service/</code></li> <li>API: This is the outermost layer and represents the user interface or the entry point of the application. It handles HTTP requests, translates them into application-specific commands, and sends them to the application layer for processing. This layer is responsible for presenting information to the user and accepting user inputs.</li> </ol>"},{"location":"regex/","title":"Regex","text":""},{"location":"regex/#in-python","title":"in Python:","text":"<p><pre><code>import re\nimport sys\n\nregex_pattern = r\"_________\"    # Do not delete 'r'.\n\ntest_string = input()\n\nmatch = re.match(regex_pattern, test_string) is not None\n\nprint(str(match).lower())\n</code></pre> |regex expression|Description| |:--|:--| |<code>.</code>|The dot (.) matches anything (except for a newline).| |<code>$</code>|Ending of the match| |<code>|| |</code>|| |<code>|| |</code>||</p> <p>...............</p> <p>r\"(.{3}.){3}.{3}$\"</p>"},{"location":"sketch/procreate/","title":"Procreate","text":""},{"location":"sketch/procreate/#workspace","title":"Workspace","text":"<p>Basic operations: </p> <ul> <li>duplicate</li> <li>import</li> <li>delete</li> <li>stack(a.k.a. group)</li> <li>photo(import photo)</li> <li>create new canvas:<ul> <li>Custom Canvas: width, height, dpi, color(sRGB=standard RGB is better for digital work, cmyk is better for work to print)</li> </ul> </li> </ul> <p>Preview mode: 2 fingers zoom-in</p>"},{"location":"sketch/procreate/#main-drawing-interface","title":"Main Drawing Interface","text":""},{"location":"sketch/procreate/#top-left-tools-menu","title":"Top-left tools menu","text":"<ol> <li> <p>Gallery:</p> </li> <li> <p>Actions:</p> </li> <li>Add</li> <li>Canvas<ul> <li>Crop &amp; Resize: you can crop, rotate your canvas, also resample? TODO</li> </ul> </li> <li>Share: to share the whole canvas or seperated layers</li> <li>Video</li> <li>Prefs<ul> <li>configure the drawing interface</li> <li>project canvas to extended screen!</li> </ul> </li> <li> <p>Help</p> <ul> <li>Advanced settings: will jump directly to iOS setting</li> </ul> </li> <li> <p>Adjustments</p> </li> <li> <p>Selection</p> </li> <li> <p>Point: to move things around</p> </li> </ol>"},{"location":"sketch/procreate/#top-right-tools-menu","title":"Top-right tools menu","text":"<ol> <li> <p>Brush Library</p> </li> <li> <p>Smudge(\u6d82\u62b9)</p> </li> <li> <p>Eraser</p> </li> <li> <p>Layers</p> </li> <li> <p>Color Picker Panel</p> </li> </ol>"},{"location":"sketch/procreate/#sidebar","title":"Sidebar","text":"<ol> <li> <p>Brush size slider</p> </li> <li> <p>Assignable button for color picking:</p> </li> <li> <p>Brush opacity slider</p> </li> <li> <p>Undo</p> </li> <li> <p>Redo</p> </li> </ol>"},{"location":"sketch/procreate/#canvas","title":"Canvas","text":"<p>Adjust to fit current screen: You can use two fingers and pinch quickly and move away</p>"},{"location":"working_notes/01_2025/","title":"202501","text":""},{"location":"working_notes/01_2025/#cluster-vm-installation","title":"Cluster VM installation","text":"<p>Redhat Documentation</p>"},{"location":"working_notes/01_2025/#_1","title":"\u6982\u5ff5\u7406\u89e3","text":""},{"location":"working_notes/01_2025/#_2","title":"\u865a\u62df\u673a\u5c42\u9762","text":"<ul> <li>DC / Data Center / \u6570\u636e\u4e2d\u5fc3\uff1a\u6bd4\u5982\u4e00\u4e2a\u4f01\u4e1a\u6709\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3\uff0c\u5206\u522b\u4f4d\u4e8e\u4e0d\u540c\u7684\u57ce\u5e02</li> <li>Host Group / Hostgruppen / \u4e3b\u673a\u7ec4\uff1a\u4e3a\u4e86\u65b9\u4fbf\u7ba1\u7406\u6570\u636e\u4e2d\u5fc3\u4e2d\u7684 \u7269\u7406\u4e3b\u673a\uff08host\uff09\uff0c\u5e38\u89c1\u7684\u662f\u4e3a\u6bcf\u4e2aDC\u521b\u5efa\u4e00\u4e2aHost Group\uff0c\u6bd4\u5982 \"\u7ebd\u7ea6\u6570\u636e\u4e2d\u5fc3\u4e3b\u673a\u7ec4\" \u6216 \"\u4f26\u6566\u6570\u636e\u4e2d\u5fc3\u4e3b\u673a\u7ec4\"</li> <li>\u8d44\u6e90\u6807\u7b7e / Resource Labels / Ressource-labels\uff1a\u8d44\u6e90\u6807\u7b7e\u662f\u5bf9 VMware \u4e2d\u8d44\u6e90\uff08\u5982\u865a\u62df\u673a\u3001\u5b58\u50a8\u3001\u7f51\u7edc\u7b49\uff09\u8fdb\u884c\u6807\u8bb0\u548c\u5206\u7c7b\u7684\u4e00\u79cd\u65b9\u6cd5\u3002</li> </ul> <p>\u901a\u8fc7\u4e3b\u673a\u7ec4\u548c\u8d44\u6e90\u6807\u7b7e\u53ef\u4ee5\u89c4\u5b9a \u865a\u62df\u673a \u4f4d\u4e8e\u54ea\u4e9b \u7269\u7406\u4e3b\u673a \u4e0a\u3002</p>"},{"location":"working_notes/01_2025/#oc","title":"OC\u5c42\u9762","text":"<ul> <li>Zone: \u5e76\u4e0d\u662f\u4e00\u4e2aOC\u7684\u8d44\u6e90\uff0c\u662f\u901a\u8fc7label OC Node\u5b9e\u73b0\uff0cOpenshift\u53ef\u4ee5\u6bcf\u4e2a Host Group \u5efa\u7acbZones\uff0c\u6bd4\u5982\uff1a<code>zone-newyork</code> \u5bf9\u5e94 \"\u7ebd\u7ea6\u6570\u636e\u4e2d\u5fc3\u4e3b\u673a\u7ec4\"\uff0c\u6bd4\u5982\uff1a     <pre><code>oc label node &lt;node-name&gt; topology.kubernetes.io/zone=us-east-1a\n</code></pre></li> <li>MachineSet: \u662f OpenShift \u4e2d\u7684\u4e00\u79cd\u8d44\u6e90\u5bf9\u8c61\uff0c\u7528\u4e8e\u7ba1\u7406\u4e00\u7ec4\u5177\u6709\u76f8\u540c\u914d\u7f6e\u7684\u865a\u62df\u673a\uff08\u6216\u8282\u70b9\uff09\u3002MachineSet \u901a\u8fc7\u5b9a\u4e49\u8282\u70b9\u7684\u6a21\u677f\uff0c\u786e\u4fdd\u96c6\u7fa4\u4e2d\u80fd\u591f\u6309\u9700\u521b\u5efa\u6216\u9500\u6bc1\u8282\u70b9\uff0c\u4ee5\u5b9e\u73b0\u81ea\u52a8\u6269\u5c55\u6216\u7f29\u51cf\u3002</li> </ul>"},{"location":"working_notes/01_2025/#more","title":"More","text":"<p>Zone ~= Host Group</p> <p>\u4e3e\u4f8b\uff1a</p> <ul> <li>\u5047\u8bbe\u6211\u4eec\u8981\u5728\u4e24\u4e2azones\uff08<code>zone-newyork</code>\u548c<code>zone-london</code>\uff09\u4e0a\u5b89\u88c53 \u4e2aControlplanes\uff08a.k.a. Master Node\uff09\uff0c\u4ed6\u4eec\u4e09\u4e2a\u4f1a\u81ea\u52a8\u968f\u673a\u5206\u914d\u5230\u4e24\u4e2azone\u4e0a\uff0c\u4f46\u6211\u4eec\u65e0\u6cd5\u6307\u5b9a\u54ea\u4e2acontrolplane\u5728\u54ea\u4e2azone\u3002</li> <li>\u5047\u8bbe\u6211\u4eec\u521b\u5efa6\u4e2aWorker Nodes\uff0c\u5219\u4ed6\u4eec\u4f1a\u88ab\u5e73\u5747\u5206\u914d\u5230\u4e24\u4e2azone\u4e0a</li> </ul>"},{"location":"working_notes/01_2025/#background","title":"Background","text":"<p>OC bootstrap node: A temporary bootstrap node is required for OpenShift cluster creation.</p> <ul> <li>Terraform is an infrastructure-as-code(IaC) software tool created by HashiCorp. <ul> <li>Users define and provide data center infrastructure using a declarative configuration language known as HashiCorp Configuration Language (HCL), or optionally JSON.</li> <li>It supports most of the Cloud Providers, such as: AWS, GCloud, IBM Cloud, Azure, Cloudflare, VMware vSphere etc</li> </ul> </li> </ul> <p>Example: Configuration File (*.hcl) - here you can configure cloud provider, resources, variable <pre><code>provider \"aws\" {\n  region = \"us-east-1\"\n}\n\nresource \"aws_s3_bucket\" \"my_bucket\" {\n  bucket = \"my-unique-bucket-name\"\n  acl    = \"private\"\n}\n</code></pre></p> <p>Note</p> <p>Terraform can manage VMware vSphere environments, you can define and manage VMware vSphere resources, such as:</p> <ul> <li>virtual machines</li> <li>networks</li> <li>datastores</li> </ul>"},{"location":"working_notes/01_2025/#mirror-registry","title":"Mirror registry","text":"<p>OpenShift Documentation</p> <p>If you already have a container image registry, such as <code>Red Hat Quay</code>, you can use it as your mirror registry. If you do not already have a registry, you can create a mirror registry using the mirror registry for Red Hat OpenShift.</p> <p>Now you have your own mirror registry, there are 2 tools can be used to copy images from public to mirror:</p> <ol> <li><code>oc adm</code> command</li> <li><code>oc-mirror</code> plugin</li> </ol> <p>Tipps</p> <ul> <li>registry: a location to save images</li> <li>mirror registry: a location that copies images from Public Registry</li> </ul> <p>\u6bd4\u55bb\uff1apublic registry\u6bd4\u5982Netflix\uff0c\u4e3a\u4e86\u67d0\u4e2a\u5f71\u7247\uff08image\uff09\u7684\u53ef\u7528\u6027\uff0c\u6211\u4eceNetflix\u4e0a\u4e0b\u8f7d\u8be5\u5f71\u7247\uff0c\u5e76\u5b58\u50a8\u5230\u6211\u7684\u79c1\u4ebaUSB\u4e0a\uff08mirror registry\uff09</p> <p>Taking Nexus Repository as example\uff1a</p> <p></p>"}]}