
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ckad-1/">
      
      
        <link rel="next" href="../ckad-3/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>2.配置 - Chuying's notebook</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-dockerfile" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Chuying&#39;s notebook" class="md-header__button md-logo" aria-label="Chuying's notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chuying's notebook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2.配置
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Chuying&#39;s notebook" class="md-nav__button md-logo" aria-label="Chuying's notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Chuying's notebook
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Administrator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Administrator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hardware
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Hardware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/hardware/disk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Disk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/linux/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architect
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architect
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/architectural_thinking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architectural Thinking
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    AWS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            AWS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/cp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud Practitioner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/saa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Architect Associate
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/sap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Solution Architect Professional
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    IBM
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            IBM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/ibm/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/ibm/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guide from MemiLavi
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Guide from MemiLavi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Welcome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. What is a Software Architect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. The Architect's Mindset
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. The Architecture Process
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. Working with System Requirements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. Types of Applications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7. Selecting Technology Stack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8. Meet the *-ilities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9. Components' Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10. Design Patterns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    11. System Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    12. Additional Considerations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    13. Architecture Document
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    14. Case Study
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    15. Advanced Architecture Topics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    16. Soft Skills
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Design Patterns (DP)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Design Patterns (DP)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/1_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/2_creational/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. Creational DP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/3_structural/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. Structural DP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/4_behavioral/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. Behavioral DP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    GCP PCAC
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            GCP PCAC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/gcp/1.preparation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Preparation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Automation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Automation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/benthos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Benthos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/grafana/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grafana
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Instana
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Instana
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/clis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLIs, Namespaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/1.jargons/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jargons
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/2.agent_sensor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent, Sensor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/3.trace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trace, Call, Span
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/4.event/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Event, Alert
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/5.api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integration, SKD, API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/6.ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    n8n
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            n8n
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/n8n/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    NodeRed
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            NodeRed
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/nodered/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/iCalBuddy.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    iCalBuddy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bash Script
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Bash Script
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../bash_script/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../bash_script/exercises/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exercises
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cloud
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../helm/helm-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Helm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" checked>
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_1" >
        
          
          <label class="md-nav__link" for="__nav_6_3_1" id="__nav_6_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CKA
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_1">
            <span class="md-nav__icon md-icon"></span>
            CKA
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read before exam
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.Storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-9
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-10
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-11
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-12
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-13
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-14
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-15
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cka-16
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_6_3_2" id="__nav_6_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CKAD
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_3_2">
            <span class="md-nav__icon md-icon"></span>
            CKAD
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Read before exam
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.核心概念介绍
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    2.配置
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    2.配置
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Table of Contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      1. Dockerfile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Dockerfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cmd" class="md-nav__link">
    <span class="md-ellipsis">
      CMD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entrypoint" class="md-nav__link">
    <span class="md-ellipsis">
      ENTRYPOINT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entrypoint-cmd" class="md-nav__link">
    <span class="md-ellipsis">
      ENTRYPOINT + CMD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      使用Dockerfile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-poddeployment" class="md-nav__link">
    <span class="md-ellipsis">
      2. Pod和Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Pod和Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod" class="md-nav__link">
    <span class="md-ellipsis">
      Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-env" class="md-nav__link">
    <span class="md-ellipsis">
      3. 环境变量（env）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-configmap" class="md-nav__link">
    <span class="md-ellipsis">
      4. ConfigMap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. ConfigMap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configmap" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigMap的使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configmap_1" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigMap的创建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConfigMap的创建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k" class="md-nav__link">
    <span class="md-ellipsis">
      用k命令创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yaml" class="md-nav__link">
    <span class="md-ellipsis">
      用*.yaml定义
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-secret" class="md-nav__link">
    <span class="md-ellipsis">
      5. Secret
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Secret">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secret" class="md-nav__link">
    <span class="md-ellipsis">
      Secret的使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret_1" class="md-nav__link">
    <span class="md-ellipsis">
      Secret的创建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secret的创建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k_1" class="md-nav__link">
    <span class="md-ellipsis">
      用k命令创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yaml_1" class="md-nav__link">
    <span class="md-ellipsis">
      用*.yaml定义
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret_2" class="md-nav__link">
    <span class="md-ellipsis">
      Secret的加密
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret_3" class="md-nav__link">
    <span class="md-ellipsis">
      Secret的类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-dockersecuritycontext" class="md-nav__link">
    <span class="md-ellipsis">
      6. Docker的安全性（SecurityContext）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Docker的安全性（SecurityContext）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#process-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Process isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#users" class="md-nav__link">
    <span class="md-ellipsis">
      安全角度的Users
    </span>
  </a>
  
    <nav class="md-nav" aria-label="安全角度的Users">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#root-vs-root" class="md-nav__link">
    <span class="md-ellipsis">
      容器root VS 主机root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      修改容器用户
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-k8ssecuritycontext" class="md-nav__link">
    <span class="md-ellipsis">
      7. k8s的安全性（SecurityContext）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-serviceaccount" class="md-nav__link">
    <span class="md-ellipsis">
      8. ServiceAccount
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. ServiceAccount">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      使用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sa" class="md-nav__link">
    <span class="md-ellipsis">
      从集群外使用sa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sa_1" class="md-nav__link">
    <span class="md-ellipsis">
      从集群内使用sa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-sa" class="md-nav__link">
    <span class="md-ellipsis">
      default sa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-sa_1" class="md-nav__link">
    <span class="md-ellipsis">
      叫停默认default sa的挂载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#poddeploymentsa" class="md-nav__link">
    <span class="md-ellipsis">
      修改Pod/Deployment使用的sa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-resource-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      9. 资源需求（Resource Requirements）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. 资源需求（Resource Requirements）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container" class="md-nav__link">
    <span class="md-ellipsis">
      Container的资源配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Container的资源配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      资源的默认值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pod资源配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_2" class="md-nav__link">
    <span class="md-ellipsis">
      当Pod对资源的使用超出限制时
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-podnode" class="md-nav__link">
    <span class="md-ellipsis">
      10. Pod和Node的关系
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Pod和Node的关系">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#taints-toleration" class="md-nav__link">
    <span class="md-ellipsis">
      Taints 和 Toleration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Taints 和 Toleration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-nodetaint" class="md-nav__link">
    <span class="md-ellipsis">
      1. 给Node加上Taint：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-podtoleration" class="md-nav__link">
    <span class="md-ellipsis">
      2. 给所属的Pod加上Toleration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-selectors-node-affinity" class="md-nav__link">
    <span class="md-ellipsis">
      节点选择器和节点关联性（Node Selectors &amp; Node Affinity）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="节点选择器和节点关联性（Node Selectors &amp; Node Affinity）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-selector" class="md-nav__link">
    <span class="md-ellipsis">
      方法一：Node Selector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-affinity" class="md-nav__link">
    <span class="md-ellipsis">
      方法二： Node Affinity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#taints-toleration-node-affinity" class="md-nav__link">
    <span class="md-ellipsis">
      组合拳：Taints Toleration 和 Node Affinity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      小结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubectl" class="md-nav__link">
    <span class="md-ellipsis">
      &gt;&gt;&gt; 本章kubectl命令整理
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.多容器Pod
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.容器状态监测
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.Pod设计
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6.服务与网络
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7.容器数据的可持久化
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8.2021更新的考试内容
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    其他
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    OpenShift
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            OpenShift
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    App Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_2" >
        
          
          <label class="md-nav__link" for="__nav_6_4_2" id="__nav_6_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/ipi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/upi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/mirror_registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mirror Registry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/internal_registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Internal Registry
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_6" >
        
          
          <label class="md-nav__link" for="__nav_6_4_6" id="__nav_6_4_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DO288
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4_6">
            <span class="md-nav__icon md-icon"></span>
            DO288
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/01_deploy_app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deploying and Managing Applications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_7" >
        
          
          <label class="md-nav__link" for="__nav_6_4_7" id="__nav_6_4_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DO280
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4_7">
            <span class="md-nav__icon md-icon"></span>
            DO280
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/01_manifest_kustimize/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Manifest & Kustomize
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/02_template_helm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. OC Template & Helm Chart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/03_auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. Authentication and Authorization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/04_network_security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. Network Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/05_expose_sni_app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. Expose SNI Application
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/06_developer_self_service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. Enable Developer Self-Service
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/07_kubernetes_operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7. Kubernetes Operator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/08_application_security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    8. Application Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/09_oc_updates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    9. Openshift Updates
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    10
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_8" >
        
          
          <label class="md-nav__link" for="__nav_6_4_8" id="__nav_6_4_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DO322
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4_8">
            <span class="md-nav__icon md-icon"></span>
            DO322
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1. Intro to OpenShift Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. IPI on Cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. IPI & UPI on Virtual
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. UPI without Infrastructure Provider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. Operations & Maintainance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Scientist
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Data Scientist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_scientist/embedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embedding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_scientist/elastic_search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ElasticSearch
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../design_thinking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design Thinking
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    DevOps
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            DevOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/observability/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Observability
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ecommerce
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Ecommerce
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ecommerce/wordpress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Wordpress
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Frontend
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Frontend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_1" >
        
          
          <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CSS
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_1">
            <span class="md-nav__icon md-icon"></span>
            CSS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/css/css-in-depth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSS In Depth
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/css/shapes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Shape
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/cra/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CRA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/gsap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GSAP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/js/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JavaScript
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/nginx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nginx
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_6" >
        
          
          <label class="md-nav__link" for="__nav_11_6" id="__nav_11_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    React
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_6">
            <span class="md-nav__icon md-icon"></span>
            React
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/hooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hooks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/bugs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bugs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/oblivion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Oblivion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/web_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Design
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ffmpeg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ffmpeg
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    IDEs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            IDEs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ide/vscode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Network
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            Network
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/ip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/loadbalancer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LoadBalancer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/protocols/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protocols
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project Mgmt
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            Project Mgmt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/agile/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agile
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Git
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/ibm_internal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IBM PM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/grammars/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grammars
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/fastapi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FastAPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/oblivion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Oblivion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/dependencies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use dependencies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/build_dependency/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build Own Dependency
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/virtual_env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtual environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../regex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regex
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sketch
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            Sketch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../sketch/procreate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Procreate
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19" >
        
          
          <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Working Notes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19">
            <span class="md-nav__icon md-icon"></span>
            Working Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../working_notes/01_2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    202501
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Table of Contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      1. Dockerfile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Dockerfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cmd" class="md-nav__link">
    <span class="md-ellipsis">
      CMD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entrypoint" class="md-nav__link">
    <span class="md-ellipsis">
      ENTRYPOINT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entrypoint-cmd" class="md-nav__link">
    <span class="md-ellipsis">
      ENTRYPOINT + CMD
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    <span class="md-ellipsis">
      使用Dockerfile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-poddeployment" class="md-nav__link">
    <span class="md-ellipsis">
      2. Pod和Deployment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Pod和Deployment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pod" class="md-nav__link">
    <span class="md-ellipsis">
      Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-env" class="md-nav__link">
    <span class="md-ellipsis">
      3. 环境变量（env）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-configmap" class="md-nav__link">
    <span class="md-ellipsis">
      4. ConfigMap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. ConfigMap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configmap" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigMap的使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configmap_1" class="md-nav__link">
    <span class="md-ellipsis">
      ConfigMap的创建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ConfigMap的创建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k" class="md-nav__link">
    <span class="md-ellipsis">
      用k命令创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yaml" class="md-nav__link">
    <span class="md-ellipsis">
      用*.yaml定义
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-secret" class="md-nav__link">
    <span class="md-ellipsis">
      5. Secret
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Secret">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#secret" class="md-nav__link">
    <span class="md-ellipsis">
      Secret的使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret_1" class="md-nav__link">
    <span class="md-ellipsis">
      Secret的创建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Secret的创建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k_1" class="md-nav__link">
    <span class="md-ellipsis">
      用k命令创建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yaml_1" class="md-nav__link">
    <span class="md-ellipsis">
      用*.yaml定义
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret_2" class="md-nav__link">
    <span class="md-ellipsis">
      Secret的加密
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secret_3" class="md-nav__link">
    <span class="md-ellipsis">
      Secret的类型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-dockersecuritycontext" class="md-nav__link">
    <span class="md-ellipsis">
      6. Docker的安全性（SecurityContext）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Docker的安全性（SecurityContext）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#process-isolation" class="md-nav__link">
    <span class="md-ellipsis">
      Process isolation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#users" class="md-nav__link">
    <span class="md-ellipsis">
      安全角度的Users
    </span>
  </a>
  
    <nav class="md-nav" aria-label="安全角度的Users">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#root-vs-root" class="md-nav__link">
    <span class="md-ellipsis">
      容器root VS 主机root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      修改容器用户
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-k8ssecuritycontext" class="md-nav__link">
    <span class="md-ellipsis">
      7. k8s的安全性（SecurityContext）
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-serviceaccount" class="md-nav__link">
    <span class="md-ellipsis">
      8. ServiceAccount
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8. ServiceAccount">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      使用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sa" class="md-nav__link">
    <span class="md-ellipsis">
      从集群外使用sa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sa_1" class="md-nav__link">
    <span class="md-ellipsis">
      从集群内使用sa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-sa" class="md-nav__link">
    <span class="md-ellipsis">
      default sa
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-sa_1" class="md-nav__link">
    <span class="md-ellipsis">
      叫停默认default sa的挂载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#poddeploymentsa" class="md-nav__link">
    <span class="md-ellipsis">
      修改Pod/Deployment使用的sa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9-resource-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      9. 资源需求（Resource Requirements）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="9. 资源需求（Resource Requirements）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container" class="md-nav__link">
    <span class="md-ellipsis">
      Container的资源配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Container的资源配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      资源的默认值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pod资源配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pod_2" class="md-nav__link">
    <span class="md-ellipsis">
      当Pod对资源的使用超出限制时
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10-podnode" class="md-nav__link">
    <span class="md-ellipsis">
      10. Pod和Node的关系
    </span>
  </a>
  
    <nav class="md-nav" aria-label="10. Pod和Node的关系">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#taints-toleration" class="md-nav__link">
    <span class="md-ellipsis">
      Taints 和 Toleration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Taints 和 Toleration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-nodetaint" class="md-nav__link">
    <span class="md-ellipsis">
      1. 给Node加上Taint：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-podtoleration" class="md-nav__link">
    <span class="md-ellipsis">
      2. 给所属的Pod加上Toleration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-selectors-node-affinity" class="md-nav__link">
    <span class="md-ellipsis">
      节点选择器和节点关联性（Node Selectors &amp; Node Affinity）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="节点选择器和节点关联性（Node Selectors &amp; Node Affinity）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-selector" class="md-nav__link">
    <span class="md-ellipsis">
      方法一：Node Selector
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node-affinity" class="md-nav__link">
    <span class="md-ellipsis">
      方法二： Node Affinity
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#taints-toleration-node-affinity" class="md-nav__link">
    <span class="md-ellipsis">
      组合拳：Taints Toleration 和 Node Affinity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      小结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubectl" class="md-nav__link">
    <span class="md-ellipsis">
      &gt;&gt;&gt; 本章kubectl命令整理
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>2.配置</h1>

<h3 id="1-dockerfile">1. Dockerfile<a class="headerlink" href="#1-dockerfile" title="Permanent link">&para;</a></h3>
<h4 id="cmd">CMD<a class="headerlink" href="#cmd" title="Permanent link">&para;</a></h4>
<p>假设我们用<code>Dockerfile</code>创建了自己的镜像<code>myImg</code>。</p>
<p><code>CMD</code> 是容器跑起来之后默认会跑的命令，如果<code>docker run</code>中重新定义了命令，那么<code>CMD</code>中的内容会被<strong>完全重写</strong>，比如：</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>myImg<span class="w"> </span>sleep<span class="w"> </span><span class="m">10</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1"># 用于创建镜像`myImg`的Dockerfile：</span>
<span class="n">FROM</span> <span class="n">ubuntu</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">]</span>
</code></pre></div>
结果： <code>sleep 10</code> 会覆盖<code>CMD sleep 5</code>。最终，容器会睡10秒钟。</p>
<h4 id="entrypoint">ENTRYPOINT<a class="headerlink" href="#entrypoint" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="c1"># 用于创建镜像`myImg`的Dockerfile：</span>
<span class="n">FROM</span> <span class="n">ubuntu</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">]</span>
</code></pre></div>
<code>ENTRYPOINT</code>会把<code>docker run</code>中的命令，添加到<code>ENTRYPOINT</code>命令的后面。比如：</p>
<p><div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>myImg<span class="w"> </span><span class="m">10</span>
</code></pre></div>
结果：<code>sleep</code>这个命令来自<code>ENTRYPOINT</code>，而秒数来自<code>docker run</code>中给的参数。最终执行的命令是：</p>
<p><div class="highlight"><pre><span></span><code>sleep<span class="w"> </span><span class="m">10</span>
</code></pre></div>
容器会睡10秒钟。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<pre><code>如果`docker run`中没有给参数，那就会报错
</code></pre>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<pre><code>Dockerfile中定义的命令，可以是`shell`格式，或者`json`格式：

- SHELL格式：`CMD sleep 5` 
- JSON格式：`CMD ["sleep", "5"]`
</code></pre>
</div>
<p>以上两者效果是一样的</p>
<h4 id="entrypoint-cmd">ENTRYPOINT + CMD<a class="headerlink" href="#entrypoint-cmd" title="Permanent link">&para;</a></h4>
<p><code>ENTRYPOINT</code>的使用感觉更合理，但是当没有给参数时，会报错，要是有个默认值就好了。这时候我们可以同时使用<code>ENTRYPOINT</code>和<code>CMD</code>：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 用于创建镜像`myImg`的Dockerfile：</span>
<span class="n">FROM</span> <span class="n">ubuntu</span>
<span class="n">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;sleep&quot;</span><span class="p">]</span>
<span class="n">CMD</span> <span class="p">[</span><span class="s2">&quot;5&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>myImg<span class="w">                            </span><span class="c1"># 使用默认值参数 5</span>
docker<span class="w"> </span>run<span class="w"> </span>myImg<span class="w"> </span><span class="m">10</span><span class="w">                     </span><span class="c1"># 或者自定义参数为 10</span>
</code></pre></div>
<h4 id="dockerfile">使用Dockerfile<a class="headerlink" href="#dockerfile" title="Permanent link">&para;</a></h4>
<p>用最后那个同时用了<code>ENTRYPOINT</code>和<code>CMD</code>的<code>Dockerfile</code>建的镜像来创建Pod：</p>
<p><div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>myFolder
ls<span class="w">                                              </span><span class="c1"># 这里应该能看到你写的Dockerfile</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>myImg<span class="w"> </span>.<span class="w">     </span><span class="c1"># 用当前路径下的Dockerfile建镜像，名字叫`myImg`</span>
</code></pre></div>
现在镜像有了，可以直接用<code>docker run myImg --name myPod --entrypoint sleep2.0 myImg 10</code>来创建容器，或者用下面这个YAML文件：（这里我们用了命令的新版本<code>sleep2.0</code>）
<div class="highlight"><pre><span></span><code><span class="c1"># pod.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myPod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myContainer</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myImg</span>
<span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sleep2.0&quot;</span><span class="p p-Indicator">]</span><span class="w">         </span><span class="c1"># 执行命令</span>
<span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;10&quot;</span><span class="p p-Indicator">]</span><span class="w">                  </span><span class="c1"># 可变参数</span>
</code></pre></div></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Platform</th>
<th style="text-align: left;">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Dockerfile</td>
<td style="text-align: left;"><code>ENTRYPOINT ['sleep2.0']</code><br/><code>CMD ['10']</code></td>
</tr>
<tr>
<td style="text-align: left;">YAML file</td>
<td style="text-align: left;">-.spec.containers.command: <code>['sleep2.0']</code><br/>-.spec.containers.args: <code>['10']</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>docker run</code></td>
<td style="text-align: left;"><code>docker run myPod --image=myImg</code><br/><code>--entrypoint sleep2.0</code><br/><code>10</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>k run</code></td>
<td style="text-align: left;"><code>k run myPod --image=myImg</code><br/><code>--command sleep2.0</code><br/><code>-- 10</code></td>
</tr>
</tbody>
</table>
<h3 id="2-poddeployment">2. Pod和Deployment<a class="headerlink" href="#2-poddeployment" title="Permanent link">&para;</a></h3>
<h4 id="pod">Pod<a class="headerlink" href="#pod" title="Permanent link">&para;</a></h4>
<p>Pod在建成之后，除了以下这些属性，其他的内容是无法修改的：</p>
<ul>
<li><code>spec.containers[*].image</code></li>
<li><code>spec.initContainers[*].image</code></li>
<li><code>spec.activeDeadlineSeconds</code></li>
<li><code>spec.tolerations</code></li>
</ul>
<p>如果想要修改已存在的Pod的话，可以这样：</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>xxx<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>&gt;<span class="w"> </span>new-pod.yml
vi<span class="w"> </span>new-pod.yml<span class="w">          </span><span class="c1"># 然后按照你的要求修改new-pod.yaml</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>xxx
kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>new-pod.yml
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">注意</p>
<p>该设计不是最合理的，因为<code>Pod</code>是<code>Deployment</code>生成的产物。如果想要修改<code>Pod</code>的某个参数，那么 <strong>更合理的方法</strong> 是修改<code>Deployment</code>，然后让<code>Deployment</code>生成新的<code>Pod</code>，而不是直接删除<code>Pod</code>！</p>
</div>
<h4 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h4>
<p>和<code>Pod</code>不同，<code>Deployment</code>可以简单的通过<code>k edit deployment my-deployment</code>修改。</p>
<h3 id="3-env">3. 环境变量（env）<a class="headerlink" href="#3-env" title="Permanent link">&para;</a></h3>
<p>举例：</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple-webapp-color</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple-webapp-color</span>
<span class="w">       </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple-webapp-color</span>
<span class="w">       </span><span class="nt">port</span><span class="p">:</span>
<span class="w">             </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">       </span><span class="nt">env</span><span class="p">:</span>
<span class="w">             </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_COLOR</span>
<span class="w">               </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pink</span>
</code></pre></div>
环境变量（<code>env</code>）可以由以下三种方法进行配置：</p>
<ol>
<li>纯键值对</li>
<li>从<code>ConfigMap</code>取值</li>
<li>从<code>Secret</code>取值</li>
</ol>
<p>第一种方法 <strong>纯键值对</strong> 使用方法如下：（其他两种方法下面会讲到）</p>
<div class="highlight"><pre><span></span><code><span class="nt">env</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_COLOR</span>
<span class="w">     </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pink</span>
</code></pre></div>
<h3 id="4-configmap">4. ConfigMap<a class="headerlink" href="#4-configmap" title="Permanent link">&para;</a></h3>
<h4 id="configmap">ConfigMap的使用<a class="headerlink" href="#configmap" title="Permanent link">&para;</a></h4>
<p>使用<code>ConfigMap</code>中所有的键值对：</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">configMapRef</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span><span class="w">    </span><span class="c1"># ConfigMap的名字</span>
</code></pre></div>
只使用<code>ConfigMap</code>中的一个或几个值：</p>
<div class="highlight"><pre><span></span><code><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_COLOR</span><span class="w">           </span><span class="c1"># 环境变量的名字</span>
<span class="w">      </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span><span class="w">    </span><span class="c1"># ConfigMap的名字</span>
<span class="w">            </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_COLOR</span><span class="w">      </span><span class="c1"># ConfigMap中对应的环境变量的名字</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">记忆点</p>
<p><code>...From</code> + <code>...Ref</code></p>
</div>
<p>将<code>ConfigMap</code>作为一个文件写入容器的<code>volume</code>里面。这个操作会在<code>volume</code>里面为每一个键值对建一个文件，以“键”为文件名，“值”为文件内容。（比如有两个文件，<code>APP_COLOR</code>文件内容是APP_COLOR的值，比如"green"，<code>APP_MODE</code>文件内容是"prod"）</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config-volume</span><span class="w">           </span><span class="c1"># volume 的名字</span>
<span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span><span class="w">                    </span><span class="c1"># ConfigMap 的名字</span>
</code></pre></div>
<h4 id="configmap_1">ConfigMap的创建<a class="headerlink" href="#configmap_1" title="Permanent link">&para;</a></h4>
<p>以下是创建<code>ConfigMap</code>（缩写为<code>cm</code>）的方法：</p>
<h5 id="k">用<code>k</code>命令创建<a class="headerlink" href="#k" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="c1"># 从纯键值对取值：</span>
kubectl<span class="w"> </span>create<span class="w"> </span>configmap<span class="w"> </span>&lt;configMapName&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--from-literal<span class="o">=</span>&lt;key1&gt;<span class="o">=</span>&lt;value1&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--from-literal<span class="o">=</span>&lt;key2&gt;<span class="o">=</span>&lt;value2&gt;

<span class="c1"># 或者，从文件取值：</span>
kubectl<span class="w"> </span>create<span class="w"> </span>configmap<span class="w"> </span>&lt;configMapName&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--from-file<span class="o">=</span>&lt;pathToFile1&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--from-file<span class="o">=</span>&lt;pathToFile2&gt;
</code></pre></div>
<h5 id="yaml">用<code>*.yaml</code>定义<a class="headerlink" href="#yaml" title="Permanent link">&para;</a></h5>
<p><div class="highlight"><pre><span></span><code><span class="c1"># configmap.yml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-config</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">APP_COLOR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blue</span>
<span class="w">  </span><span class="nt">APP_MODE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span>
</code></pre></div>
<em>⚠️ 之前我们看到的yaml文件都有4个根属性（<code>apiVersion</code>, <code>kind</code>, <code>metadata</code>, <code>spec</code>），这次没有<code>spec</code>了，换成了<code>data</code>！</em></p>
<p>然后创建所定义的<code>configmap.yml</code></p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>configmap.yml
</code></pre></div>
<h3 id="5-secret">5. Secret<a class="headerlink" href="#5-secret" title="Permanent link">&para;</a></h3>
<h4 id="secret">Secret的使用<a class="headerlink" href="#secret" title="Permanent link">&para;</a></h4>
<p><code>Secrets</code>用来存储不应该被暴露的数据，和<code>ConfigMap</code>的唯一区别就是<code>Secrets</code>是加密的。
使用<code>Secret</code>中所有的键值对：</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-secret</span><span class="w">    </span><span class="c1"># 创建的Secret的名字</span>
</code></pre></div>
只使用<code>Secret</code>中的一个或几个值：</p>
<div class="highlight"><pre><span></span><code><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_Host</span><span class="w">     </span><span class="c1"># 环境变量的名字</span>
<span class="w">      </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w"> </span>
<span class="w">        </span><span class="nt">secretKeyRef</span><span class="p">:</span><span class="w"> </span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-secret</span><span class="w">    </span><span class="c1"># Secret的名字</span>
<span class="w">            </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_Host</span><span class="w">        </span><span class="c1"># Secret中对应的环境变量的名字</span>
</code></pre></div>
<p>将<code>Secret</code>作为一个文件写入容器的<code>volume</code>里面：</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-secret-volume</span><span class="w">       </span><span class="c1"># volume的名字</span>
<span class="w">          </span><span class="nt">secret</span><span class="p">:</span>
<span class="w">            </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-secret</span><span class="w">  </span><span class="c1"># secret的名字 --&gt; 注意是 secretName 不是 name</span>
</code></pre></div>
<h4 id="secret_1">Secret的创建<a class="headerlink" href="#secret_1" title="Permanent link">&para;</a></h4>
<h5 id="k_1">用<code>k</code>命令创建<a class="headerlink" href="#k_1" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="c1"># 从纯键值对取值：</span>
<span class="c1"># 这里的“generic”是secret的类型，是必须给的值，不然会报错！！我们之后会讲到</span>
kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>&lt;SecretName&gt;<span class="w"> </span>--from-literal<span class="o">=</span>&lt;key&gt;<span class="o">=</span>&lt;value&gt;

<span class="c1"># 或者，从文件取值：</span>
kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>&lt;SecretName&gt;<span class="w"> </span>--from-file<span class="o">=</span>&lt;pathToFile&gt;
</code></pre></div>
<h5 id="yaml_1">用<code>*.yaml</code>定义<a class="headerlink" href="#yaml_1" title="Permanent link">&para;</a></h5>
<p><strong>纯文本版本（不推荐）：</strong></p>
<p><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-secret</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">    </span><span class="nt">DB_Host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">    </span><span class="nt">DB_User</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">DB_Password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">paswrd</span>
</code></pre></div>
<strong>加密版本：</strong>
先用<code>base64</code>对信息进行加密：</p>
<p><div class="highlight"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;mysql&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64
</code></pre></div>
然后再将加密后的文字放到yaml文件中。可能长这样：</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">    </span><span class="nt">DB_Host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bXlzcWw=</span>
<span class="w">    </span><span class="nt">DB_User</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cm9vdA==</span>
<span class="w">    </span><span class="nt">DB_Password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cGFzd3Jk</span>
</code></pre></div>
<h4 id="secret_2">Secret的加密<a class="headerlink" href="#secret_2" title="Permanent link">&para;</a></h4>
<p>之前我们将<code>Secret</code>以 <strong>base64</strong> 格式对数据进行编码。 任何拥有 <strong>base64</strong> 编码密码的人都可以轻松解码，因此并不是很安全。那为什么说<code>Secret</code>比<code>ConfigMap</code>更安全呢？因为k8s对<code>Secret</code>的处理形式。</p>
<ul>
<li><code>Secret</code>文件不上传到版本控制系统（比如git）</li>
<li>仅当<code>Pod</code>需要时，才会将<code>Secret</code>发送到该<code>Pod</code>所在的节点</li>
<li>Kubelet 将<code>Secret</code>存储到 tmpfs 中，这样<code>Secret</code>就不会写入磁盘存储</li>
</ul>
<div class="admonition note">
<p class="admonition-title"><code>tmpfs</code> </p>
<pre><code>**Temporary File System**是类Unix系统上的暂存档存储空间。所有在`tmpfs`上存储的资料在理论上都是暂时借放的，那也表示说，文件不会创建在硬盘上面。一旦重启，所有在`tmpfs`里面的资料都会消失不见。

`tmpfs` 和`RAM disk`的概念近似，但后者会呈现出 *具有完整文件系统* 的虚拟磁盘。
</code></pre>
</div>
<h4 id="secret_3">Secret的类型<a class="headerlink" href="#secret_3" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th style="text-align: left;">类型</th>
<th style="text-align: left;">描述</th>
<th style="text-align: left;"><div style="width:350px">举例</div></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>docker-registry</code></td>
<td style="text-align: left;">给Docker registry用的<code>Secret</code></td>
<td style="text-align: left;"><code>k create secret docker-registry my-secret \</code> <br/> <code>--docker-email=tiger@acme.example \</code> <br/> <code>--docker-username=tiger \</code> <br/> <code>--docker-password=pass1234 \</code> <br/> <code>--docker-server=my-registry.example:5000</code> <br/></td>
</tr>
<tr>
<td style="text-align: left;"><code>generic</code></td>
<td style="text-align: left;">从本地文件或者<br/>直接输入生成<code>Secret</code><br/>（即默认的Opaque类型）</td>
<td style="text-align: left;"><code>k create secret generic my-secret \</code><br/><code>--from-literal=username=prod_user</code> <br/> <code>--from-literal=password=top_secret</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>tls</code></td>
<td style="text-align: left;">用于存储certificate以及与之相关联的key</td>
<td style="text-align: left;"><code>k create secret tls my-tls-secret \</code> <br /><code>--cert=path/to/cert/file \</code> <br /><code>--key=path/to/key/file</code> <br /></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">TLS (Transport Layer Security)</p>
<p>是一种加密协议，用于保护 Internet 上的通信。 它是 SSL（安全套接字层）的继承者，为两台计算机提供了一种安全地相互通信的方式。</p>
</div>
<h3 id="6-dockersecuritycontext">6. Docker的安全性（SecurityContext）<a class="headerlink" href="#6-dockersecuritycontext" title="Permanent link">&para;</a></h3>
<h4 id="process-isolation">Process isolation<a class="headerlink" href="#process-isolation" title="Permanent link">&para;</a></h4>
<p>当某个<strong>主机/电脑</strong>运行Docker时，Docker是以一个单独的进程（process）的形式存在的。你可以通过命令<code>ps aux</code>或者进程监视器（如下图）看到该Docker进程。</p>
<p><code>ps aux</code>意味着<code>process all user x</code>, <code>x</code>表示任意用户
<img src="../ckad-2/6ea1d90d0779485ab8f3679229b2a8d6.png" width=600 /></p>
<div class="admonition note">
<p class="admonition-title">容器</p>
<p>不同于虚拟机，容器并<strong>不是完全</strong>与主机本身分离的。容器用了Linux中的<strong>命名空间</strong>（Namespace）进行分离，主机本身有一个命名空间，容器自己有它的命名空间。所有的容器其实还是在主机上，但是在自己的命名空间中跑。</p>
</div>
<p>如图所示：</p>
<ul>
<li>主机（Host）可以看到的Process包括：1，2，3，3.1，3.2</li>
<li>容器（Container）可以看到的Process包括：3.1，3.2</li>
</ul>
<p><img src="../ckad-2/a9fcca186e934554ae8e136711f0c0e2.png" width=500 /></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>尽管 <strong>主机视角</strong> 和 <strong>容器视角</strong> 都能看到3.1（<code>sleep 3000</code>）和3.2（<code>ls</code>）两个进程，他们在两个视角中显示的<strong>进程ID</strong>是不一样的！这是因为进程在不同的<strong>命名空间</strong>中可以有不同的进程 ID，这就是 Docker 在系统中 <strong>隔离容器</strong> 的方式！</p>
</div>
<h4 id="users">安全角度的Users<a class="headerlink" href="#users" title="Permanent link">&para;</a></h4>
<p>用<code>docker run ubuntu sleep 3600</code> 运行一个容器，当我们用<code>ps aux</code>查看进程时，你会得到如下结果：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ps aux</span>
USER<span class="w">       </span>PID<span class="w"> </span>%CPU<span class="w"> </span>%MEM<span class="w">    </span>VSZ<span class="w">   </span>RSS<span class="w"> </span>TTY<span class="w">      </span>STAT<span class="w"> </span>START<span class="w">   </span>TIME<span class="w"> </span>COMMAND
root<span class="w">         </span><span class="m">1</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w">   </span><span class="m">2788</span><span class="w">  </span><span class="m">1116</span><span class="w"> </span>?<span class="w">        </span>Ss<span class="w">   </span><span class="m">07</span>:55<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>sleep<span class="w"> </span><span class="m">3600</span>
root<span class="w">         </span><span class="m">7</span><span class="w">  </span><span class="m">0</span>.1<span class="w">  </span><span class="m">0</span>.0<span class="w">   </span><span class="m">2888</span><span class="w">   </span><span class="m">984</span><span class="w"> </span>pts/0<span class="w">    </span>Ss<span class="w">   </span><span class="m">08</span>:39<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>/bin/sh
root<span class="w">        </span><span class="m">13</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w">   </span><span class="m">7060</span><span class="w">  </span><span class="m">1596</span><span class="w"> </span>pts/0<span class="w">    </span>R+<span class="w">   </span><span class="m">08</span>:39<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>ps<span class="w"> </span>aux
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Linux用户类型</p>
<p>我们可以将Linux中的用户分为两类：</p>
<ol>
<li><strong>root用户</strong>：也叫 superuser 或者 administrator</li>
<li><strong>非root用户</strong>：通常，在 Linux 系统上创建的第一个非root用户的 UID 为 1000，第二个用户帐户分配的 UID 为 1001，依此类推。<code>UID &gt;= 1000</code> 的用户都是非root用户</li>
</ol>
</div>
<h5 id="root-vs-root">容器root VS 主机root<a class="headerlink" href="#root-vs-root" title="Permanent link">&para;</a></h5>
<table>
<thead>
<tr>
<th>特性</th>
<th>容器 root 用户</th>
<th>主机 root 用户</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>UID</strong></td>
<td>容器内部的 root UID 通常为 <code>0</code>，但可以映射到主机普通用户。</td>
<td>主机 root 的 UID 始终为 <code>0</code>，并对应系统的超级用户权限。</td>
</tr>
<tr>
<td><strong>权限范围</strong></td>
<td>默认仅限于容器内部，无法直接操作主机资源。</td>
<td>对整个主机系统拥有完全的权限，可修改任何系统资源。</td>
</tr>
<tr>
<td><strong>网络权限</strong></td>
<td>网络权限受容器网络命名空间（Network Namespace）限制。</td>
<td>拥有对主机网络接口的完全控制权。</td>
</tr>
<tr>
<td><strong>特权模式影响</strong></td>
<td>在默认模式下权限有限，但启用 <code>--privileged</code> 会获取主机权限。</td>
<td>不受限制，默认拥有所有特权。</td>
</tr>
</tbody>
</table>
<p><strong>主机root用户</strong> 是Linux系统中最强大的用户，基本什么都能干（具体能干什么的列表在<code>usr/include/linux/capability.h</code>）。而 <strong>容器root用户</strong> 是设限的，这里列举一些:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">命令</th>
<th style="text-align: left;">用途</th>
<th style="text-align: left;"><strong>主机root用户</strong></th>
<th style="text-align: left;"><strong>容器root用户</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>chown</code></td>
<td style="text-align: left;">授权</td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>dac</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>kill</code></td>
<td style="text-align: left;">杀死进程</td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>setfcap</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>setpcap</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>setgid</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>setuid</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>net_bind</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>net_raw</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>mac_admin</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">❌</td>
</tr>
<tr>
<td style="text-align: left;"><code>broadcast</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">❌</td>
</tr>
<tr>
<td style="text-align: left;"><code>net_admin</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">❌</td>
</tr>
<tr>
<td style="text-align: left;"><code>sys_admin</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">❌</td>
</tr>
<tr>
<td style="text-align: left;"><code>sys_chroot</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;"><code>audit_write</code></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">✓</td>
</tr>
<tr>
<td style="text-align: left;">其他</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">✓</td>
<td style="text-align: left;">❌</td>
</tr>
</tbody>
</table>
<p>以上列出的是默认的权限，当然，你也可以手动地给<strong>容器的用户</strong>添加或者删减权限：</p>
<ul>
<li>增加<ul>
<li>为容器<code>ubuntu</code>增加一个<code>MAC_ADMIN</code>的权限： 
    <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--cap-add<span class="w"> </span>MAC_ADMIN<span class="w"> </span>ubuntu
</code></pre></div></li>
<li>为容器<code>ubuntu</code>开放<strong>所有</strong>权限： 
    <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>ubuntu
</code></pre></div></li>
</ul>
</li>
<li>删减：
    <div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--cap-drop<span class="w"> </span>KILL<span class="w"> </span>ubuntu
</code></pre></div></li>
</ul>
<h5 id="_1">修改容器用户<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h5>
<p>如果我们想要使用<strong>非root用户</strong>运行（因为这样更安全），可以通过以下方式修改：</p>
<p><strong>方法一：创建容器时加上参数<code>--user</code></strong></p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>--user<span class="o">=</span><span class="m">1000</span><span class="w"> </span>ubuntu<span class="w"> </span>sleep<span class="w"> </span><span class="m">3600</span>
</code></pre></div>
<!-- TODO: linux 用户数字代表什么 -->

<p><strong>方法二：在使用镜像之前，在定义镜像的Dockerfile中修改用户</strong>
用ubuntu作为基础镜像，创建一个给自定义镜像的Dockerfile：</p>
<p><div class="highlight"><pre><span></span><code><span class="n">FROM</span> <span class="n">ubuntu</span>
<span class="n">USER</span> <span class="mi">1000</span>
</code></pre></div>
基于该Dockerfile创建镜像<code>my-ubuntu</code>：</p>
<p><div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-ubuntu<span class="w"> </span>.
</code></pre></div>
创建容器</p>
<p><div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>my-ubuntu<span class="w"> </span>sleep<span class="w"> </span><span class="m">3600</span>
</code></pre></div>
再次用<code>ps aux</code>查看进程时，你会得到如下结果：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ps aux</span>
USER<span class="w">       </span>PID<span class="w"> </span>%CPU<span class="w"> </span>%MEM<span class="w">    </span>VSZ<span class="w">   </span>RSS<span class="w"> </span>TTY<span class="w">      </span>STAT<span class="w"> </span>START<span class="w">   </span>TIME<span class="w"> </span>COMMAND
<span class="m">1000</span><span class="w">         </span><span class="m">1</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w">   </span><span class="m">2788</span><span class="w">  </span><span class="m">1116</span><span class="w"> </span>?<span class="w">        </span>Ss<span class="w">   </span><span class="m">07</span>:55<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>sleep<span class="w"> </span><span class="m">3600</span>
</code></pre></div>
<h3 id="7-k8ssecuritycontext">7. k8s的安全性（SecurityContext）<a class="headerlink" href="#7-k8ssecuritycontext" title="Permanent link">&para;</a></h3>
<p>上一章我们讨论了Docker的安全性。同样的设置在k8s中也有，而且可以选择范畴：</p>
<ul>
<li><code>Pod</code>级别的安全配置</li>
<li><code>Container</code>级别的安全配置</li>
</ul>
<p>我们可以查看当前容器的用户类型：
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>ubuntu-sleeper<span class="w"> </span>--<span class="w"> </span>whoami
</code></pre></div></p>
<p>使用规则和优先级如下：</p>
<ul>
<li><code>Pod</code>的配置会自动应用到在该<code>Pod</code>上的所有<code>Container</code>中</li>
<li><code>Container</code>的安全配置 会覆写所在的 <code>Pod</code>上的 的安全配置： <code>Container</code> &gt; <code>Pod</code></li>
</ul>
<p>⚠️ 只有<code>Container</code>级别的安全配置才可以添加<code>capabilities</code>（权限）属性。举例：增加某个<code>capabilities</code>：</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># ---------- Pod级别 ----------</span>
<span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>

<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sleep&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;3600&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="c1"># ---------- Container级别 ----------</span>
<span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">                </span><span class="nt">add</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;MAC_ADMIN&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;SYS_TIME&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>举例：删除某个<code>capabilities</code>：</p>
<div class="highlight"><pre><span></span><code><span class="nn">...</span>
<span class="w">            </span><span class="c1"># ---------- Container级别 ----------</span>
<span class="w">            </span><span class="nt">securityContext</span><span class="p">:</span>
<span class="w">                </span><span class="nt">capabilities</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">drop</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;MAC_ADMIN&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;SYS_TIME&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<pre><code>如果要用root用户，则直接删除`runAsUser: xxxx`即可！
</code></pre>
</div>
<h3 id="8-serviceaccount">8. ServiceAccount<a class="headerlink" href="#8-serviceaccount" title="Permanent link">&para;</a></h3>
<p>在k8s中，有两类账号：</p>
<ul>
<li>用户账号（UserAccount）：给人的，包括但不限于Admin，Developer等</li>
<li>
<p>服务账号（ServiceAccount）：给App的，用于App与k8s的交互。服务账号提供了身份信息，常见的使用案例有：</p>
<ul>
<li>与APIServer的交流</li>
<li>与外部服务的交流</li>
<li>取得私有的镜像数据库（private image registry）认证</li>
<li>第三方软件使用SA来识别Pods</li>
</ul>
</li>
</ul>
<p>创建<code>ServiceAccount</code>的时候，也会自动创建一个相对应的<strong>静态 Token</strong>。该令牌会被放在一个 <strong>自动生成的<code>Secret</code>对象</strong> 中。用以下命令可以看到生成的令牌的名字：</p>
<p><div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>serviceaccount<span class="w"> </span>&lt;ServiceAccountName&gt;
</code></pre></div>
你会看到：</p>
<p><img src="../ckad-2/describe_sa.png" width=400 /></p>
<div class="admonition note">
<p class="admonition-title">动态 Token</p>
<p>也可以为 Kubernetes 服务账户（ServiceAccount）生成短期的身份认证 Token，通常用于 API 访问或其他需要身份验证的场景：
<div class="highlight"><pre><span></span><code><span class="c1"># 为 SA 生成 动态 Token</span>
kubectl<span class="w"> </span>create<span class="w"> </span>token<span class="w">  </span>&lt;ServiceAccountName&gt;<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--duration<span class="o">=</span>10m<span class="w">  </span><span class="c1"># 默认 Token 有效期通常为 1 小时</span>
</code></pre></div>
命令会返回一个类似以下的 Token（JWT 格式）：
<div class="highlight"><pre><span></span><code>eyJhbGciOiJSUzI1NiIsImtpZCI6Il9oYXZlX3NvbWVfZnVuIn0.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tN3h2cXoiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjEyMzQ1NiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.abcdef...
</code></pre></div></p>
</div>
<p>查看Pod的<code>ServiceAccount</code>放在哪里：</p>
<p><div class="highlight"><pre><span></span><code>k<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>&lt;PodName&gt;
</code></pre></div>
<img src="../ckad-2/7a02817007cb40a694c3ee35cb5d5a96.png" width=700 /></p>
<h4 id="_2">使用<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<h5 id="sa">从集群外使用sa<a class="headerlink" href="#sa" title="Permanent link">&para;</a></h5>
<p><strong>令牌</strong>被导出到外部应用程序，在向 Kubernetes API 发送请求的时候用该令牌进行身份验证。比如：</p>
<p><div class="highlight"><pre><span></span><code>curl<span class="w"> </span>https://192.168.56.70:6443/api<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-insecure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer eyJhxxB...&quot;</span>
</code></pre></div>
⚠️ <code>eyJhxxB...</code>即令牌的内容。</p>
<p><img src="../ckad-2/service_account.png" width=800 /></p>
<h5 id="sa_1">从集群内使用sa<a class="headerlink" href="#sa_1" title="Permanent link">&para;</a></h5>
<p>假如该应用程序运行于集群的某个<code>Pod</code>上，则自动生成的<strong>令牌</strong>会被写入该<code>Pod</code>的<code>Volume</code>中，无需“导出”。</p>
<p><img src="../ckad-2/service_account_2.png" width=600 /></p>
<h4 id="default-sa"><code>default</code> sa<a class="headerlink" href="#default-sa" title="Permanent link">&para;</a></h4>
<p>k8s系统自动为每一个<code>Namespace</code>生成一个名为<code>default</code>的SA，该SA拥有特定的API权限。</p>
<p>在这个 Namespace 中创建的 每个 <code>Pod</code>，如果没有指定其他服务账户，都会自动使用这个 <code>default</code> 服务账户。Kubernetes 会把 default 服务账户关联的认证信息（Token、CA 证书等）自动挂载到 <code>Pod</code> 里的固定路径中:
<div class="highlight"><pre><span></span><code>/var/run/secrets/kubernetes.io/serviceaccount
</code></pre></div>
这样，Pod 里的应用就能直接使用这些凭证访问 Kubernetes API。</p>
<p>我们可以用<code>k describe pod xxx</code>查看<code>Volumes</code> 。也可以去看Secret本身：
<img src="../ckad-2/7afa5468dbfb4aaa92f391cee3baff5a.png" width=700 /></p>
<p>我们用<code>k exec -it xxx ls /var/run/secrets/kubernetes.io/serviceaccount</code>进到某个Pod的终端，能看到三个文件：</p>
<ul>
<li>ca.crt</li>
<li>namespace</li>
<li>token: 真正存了<strong>令牌</strong>的文件，用于访问 Kubernetes API。</li>
</ul>
<h4 id="default-sa_1">叫停默认<code>default</code> sa的挂载<a class="headerlink" href="#default-sa_1" title="Permanent link">&para;</a></h4>
<p>我们也可以叫停<code>default</code>ServiceAccount的自动挂载（可以在 Pod 或者 Deployment 的定义文件中进行修改）：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ---------------Pod--------------</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">    </span><span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">             </span><span class="c1"># 叫停`default`ServiceAccount的自动挂载</span>

<span class="c1"># ---------------Deployment--------------</span>
<span class="nt">.spec.template.spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">automountServiceAccountToken</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">     </span><span class="c1"># 叫停`default`ServiceAccount的自动挂载</span>
</code></pre></div>
<h4 id="poddeploymentsa">修改Pod/Deployment使用的sa<a class="headerlink" href="#poddeploymentsa" title="Permanent link">&para;</a></h4>
<p><code>default</code> ServiceAccount只提供了最基础的 Kubernetes API访问权限，我们可以给Pod添加自定义的ServiceAccount以提供更多其他权限： 删掉旧的Pod，用new-pod.yml新建一个Pod（或者直接修改包含该Pod的Deployment）</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ---------------Pod--------------</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">    </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">robot</span><span class="w">       </span><span class="c1"># 使用另一个名为`robot`的ServiceAccount</span>

<span class="c1"># ---------------Deployment--------------</span>
<span class="nt">.spec.template.spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">robot</span><span class="w">       </span><span class="c1"># 使用另一个名为`robot`的ServiceAccount</span>
</code></pre></div>
<h3 id="9-resource-requirements">9. 资源需求（Resource Requirements）<a class="headerlink" href="#9-resource-requirements" title="Permanent link">&para;</a></h3>
<h4 id="container">Container的资源配置<a class="headerlink" href="#container" title="Permanent link">&para;</a></h4>
<h5 id="_3">资源的默认值<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h5>
<p>默认情况下，k8s cluster上资源的使用是没有限制的。但我们可以通过<code>LimitRange</code>设置默认值，比如默认一个新<code>Container</code>初始化时至少<strong>0.5 CPU</strong>和<strong>256 Mi</strong>的内存（memory）。<code>LimitRange</code> 应用于整个命名空间（<code>Namespace</code>）。举例：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 默认内存：</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LimitRange</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mem-limit-range</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">default</span><span class="p">:</span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
<span class="w">    </span><span class="nt">defaultRequest</span><span class="p">:</span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256Mi</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Container</span>
</code></pre></div>
<blockquote>
<p><code>.spec.limits.type</code> 的可能值有: <code>Container</code>, <code>Pod</code>, <code>PersistentVolumeClaim</code></p>
</blockquote>
<div class="admonition warning">
<p class="admonition-title">ResourceQuotas vs LimitRange</p>
<ul>
<li><code>ResourceQuotas</code> 对一个NS中的总资源设限</li>
<li><code>LimitRange</code> 对NS中，单个 Pod/Container 使用的资源设限，目的是避免单个 Pod 或容器过度使用资源。</li>
</ul>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># 默认CPU：</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LimitRange</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mem-limit-range</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">default</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">defaultRequest</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Container</span>
</code></pre></div>
<h5 id="pod_1">Pod资源配置<a class="headerlink" href="#pod_1" title="Permanent link">&para;</a></h5>
<p>如果你的<code>Container</code>需要更多的资源，你可以在<code>Pod</code>/<code>Deployment</code>的定义文件中修改<code>Container</code>的资源属性，它会覆写 <code>LimitRange</code> 中的默认值。</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span><span class="w">    </span><span class="c1"># 资源都是相对Container来说的，不是整一个Pod</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">            </span><span class="nt">requests</span><span class="p">:</span><span class="w">           </span><span class="c1"># 自定义所需资源的大小</span>
<span class="w">                </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1Gi&quot;</span>
<span class="w">                </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">limits</span><span class="p">:</span><span class="w">             </span><span class="c1"># 自定义可用资源上限</span>
<span class="w">                </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span>
<span class="w">                </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</code></pre></div>
<ul>
<li><code>requests</code>：保证的最少资源数量</li>
<li><code>limits</code>：最大资源数量，<code>Container</code>不可以使用超出该范围的资源！</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<pre><code>如果给某个Container自定义了`requests`，最好也自定义它的`limits`，否则可能报错:&lt;br/&gt; `自定义requests &gt; LimitRange 中默认的limits`
</code></pre>
</div>
<p>k8s会根据<strong>资源需求</strong>去找有资源空闲的Node，然后把新Pod放到Node里面：</p>
<p><img src="../ckad-2/pod_in_node.png" width=900 /></p>
<h4 id="pod_2">当Pod对资源的使用超出限制时<a class="headerlink" href="#pod_2" title="Permanent link">&para;</a></h4>
<p>当某个<code>Container</code>的资源使用超出限制时，k8s会这样处理：</p>
<ul>
<li>CPU使用过多：Kubernetes 会限制 CPU，使其不会超出指定的限制。<code>Container</code>不能使用超过其限制的 CPU 资源。</li>
<li>Memory使用过多：理论上，<code>Container</code>可以使用比其限制更多的内存资源。但是，如果一个<code>Pod</code>不断尝试消耗超过其限制的Memory，则该<code>Pod</code>将被终止。</li>
</ul>
<div class="admonition info">
<p class="admonition-title">CPU单位</p>
<ul>
<li>浮点数，1CPU=1000m（m=millicpu），最小的CPU可以是1m</li>
<li>1 CPU = 1 vCPU，可以是：AWS的1 vCPU；GCP的1Core；Azure的1Core；1 Hyperthred</li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">Memory单位</p>
<ul>
<li>1 G（Gigabyte）= 1,000,000,000 bytes</li>
<li>1 M（Megabyte）= 1,000,000 bytes</li>
<li>1 K（Kilogabyte）= 1,000 bytes</li>
<li><strong>1 Gi</strong>（Gibibyte）= 2^30 =1,073,741,824 bytes</li>
<li><strong>1 Mi</strong>（Mebibyte）= 2^20 = 1,048,576 bytes</li>
<li><strong>1 Ki</strong>（Kibibyte）= 2^10 = 1,024 bytes</li>
</ul>
</div>
<h3 id="10-podnode">10. Pod和Node的关系<a class="headerlink" href="#10-podnode" title="Permanent link">&para;</a></h3>
<blockquote>
<p>如何保证某个<code>Pod</code>一定会放到某个<code>Node</code>上?</p>
</blockquote>
<h4 id="taints-toleration">Taints 和 Toleration<a class="headerlink" href="#taints-toleration" title="Permanent link">&para;</a></h4>
<p>我要去野营，为了防止虫子随便停在我身上，我需要防虫喷雾。<code>Taints</code>相当于杀虫剂，某个<code>Taint</code>针对虫子A，但是虫子B不怕这种杀虫剂，所以虫子B有<code>Tolerant</code>。所以决定了虫子是否会落到我的身上，有两个因素：</p>
<ol>
<li>我喷的<code>Taint</code></li>
<li>虫子的<code>Toleration</code></li>
</ol>
<p>假设我（人）是个<code>Node</code>，虫子是<code>Pod</code>。<code>Taints</code> 和 <code>Toleration</code>两个概念与安全无关，完全只是限制什么<code>Pod</code>放在什么<code>Node</code>中的一个规则。当完全没有规则定义的时候，k8s的<code>Scheduler</code>对<code>Pod</code>进行平均分配。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>Taint</code> 和<code>Toleration</code>只是为了将某些<code>Pod</code>排除在某个<code>Node</code>之外，它无法保证特殊的<code>Pod</code>一定会放在适合它们的<code>Node</code>上（这个由<strong>Node Affinity</strong>实现）。因为其他<code>Node</code>可能没有设<code>Taint</code>。</p>
<p>相反，<code>Taint</code> 和<code>Toleration</code>告诉<code>Node</code>只接受具有某些 <code>Toleration</code> 的  <code>pod</code> --&gt; 只保证Node的纯净度</p>
</div>
<h5 id="1-nodetaint">1. 给<code>Node</code>加上<code>Taint</code>：<a class="headerlink" href="#1-nodetaint" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="c1"># taint本身其实就是一个键值对，所以 “&lt;key&gt;=&lt;value&gt;” 就够了</span>
kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>&lt;NodeName&gt;<span class="w"> </span>&lt;key&gt;&lt;operator&gt;&lt;value&gt;:&lt;TaintEffect&gt;
<span class="c1"># 举例：</span>
kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>node1<span class="w"> </span><span class="nv">app</span><span class="o">=</span>blue:NoSchedule
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">OpenShift 也有这个mechanism，但需要adm</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>adm<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>node1<span class="w"> </span><span class="nv">app</span><span class="o">=</span>blue:NoSchedule
</code></pre></div>
</div>
<p>其中的<code>TaintEffect</code> 属性决定了如果 <code>Pod</code> 没有对应的 <code>Toleration</code> 会发生什么，从严格到宽松共有3个Effect：</p>
<ol>
<li><code>NoExecute</code>：不再接受新的<code>Pod</code>，驱逐有已存在，但并没有<code>Toleration</code>的<code>Pod</code></li>
<li><code>NoSchedule</code>：没有<code>Toleration</code>的<code>Pod</code>不会放在有<code>Taint</code>的<code>Node</code>上</li>
<li><code>PreferNoSchedule</code>：尽量避免，但是不保证</li>
</ol>
<h5 id="2-podtoleration">2. 给所属的<code>Pod</code>加上<code>Toleration</code><a class="headerlink" href="#2-podtoleration" title="Permanent link">&para;</a></h5>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>

<span class="w">    </span><span class="nt">tolerations</span><span class="p">:</span><span class="w">    </span><span class="c1"># 四个属性，分别对应taint中的 “app=blue:NoSchedule”</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
<span class="w">          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Equal</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">blue</span>
<span class="w">          </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<pre><code>`tolerations`中包含的是一个数组，别忘了这个符号：`-`
</code></pre>
</div>
<div class="admonition info">
<p class="admonition-title">Best Practise</p>
<p>一般我们先用<code>--dry-run=client</code>生成<code>*.yaml</code>文件，再在文件中加上<code>tolerations</code>！</p>
</div>
<div class="admonition note">
<p class="admonition-title">Namespace 和 Node</p>
<pre><code>- Namespace是一种将集群逻辑分区为虚拟子集群的方法。--&gt; logical partition, only for conveniency
- Node则是可分可数的物理机或虚拟机。--&gt; physical partition, it REALLY exists
</code></pre>
</div>
<p><strong>Master Node</strong></p>
<p>还记得k8s的Node有两种类型吗？ Master node其实就比Worker node多了一些管理功能。但是我们发现，Kubernetes的<code>Scheduler</code>从来不往Master Node上面放<code>Pod</code>。
这是因为当k8s的集群被初始化时，Master node上自动加了<code>Taint</code>，用来排除所有<code>Pod</code>（这个设定是可以修改的，但我们一般不修改）。</p>
<p>这个Taint可以这样查看：
<div class="highlight"><pre><span></span><code>k<span class="w"> </span>get<span class="w"> </span>nodes
k<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>&lt;MasterNodeName&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Taint
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<pre><code>**Master Node**即名为 "control-plane"的Node，叫法不同而已
</code></pre>
</div>
<h4 id="node-selectors-node-affinity">节点选择器和节点关联性（Node Selectors &amp; Node Affinity）<a class="headerlink" href="#node-selectors-node-affinity" title="Permanent link">&para;</a></h4>
<p>我们已知Taint和Toleration没有办法保证某个<code>Pod</code>放到有特定资源的<code>Node</code>上去。为了确保某<code>Pod</code>托管在特定<code>Node</code>上，k8s提供了两种机制，让<code>Pod</code>对 <code>Node</code>进行筛选：</p>
<ol>
<li>Node Selector</li>
<li>Node Affinity</li>
</ol>
<p>两者都以<code>Node</code>的<code>label</code>为基础，在Pod的定义文件中添加删选条件。</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>&lt;NodeName&gt;<span class="w"> </span>&lt;labelKey&gt;<span class="o">=</span>&lt;labelValue&gt;<span class="w">  </span><span class="c1"># 给Node添加一个标签</span>

kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>node01<span class="w"> </span><span class="nv">size</span><span class="o">=</span>Large<span class="w">       </span><span class="c1"># 举例</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<pre><code>k8s中的 `labels` 是区分大小写的！
</code></pre>
</div>
<h5 id="node-selector">方法一：Node Selector<a class="headerlink" href="#node-selector" title="Permanent link">&para;</a></h5>
<p>然后给<code>Pod</code>加上节点选择器：</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">    </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">       </span><span class="c1"># 添加 nodeSelector，这里的键值对其实是Node的label</span>
<span class="w">        </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Large</span>
</code></pre></div>
<ul>
<li><strong>优点：</strong> 简单</li>
<li><strong>缺点：</strong> 只支持非常简单的逻辑。更复杂的逻辑比如 “<code>size=Large</code> or <code>size=Medium</code>” 是无法通过<code>nodeSelector</code>实现的</li>
</ul>
<h5 id="node-affinity">方法二： Node Affinity<a class="headerlink" href="#node-affinity" title="Permanent link">&para;</a></h5>
<p>Node Selector没有办法提供<code>not</code>或者<code>or</code>等复杂判断，Node Affinity可以！</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">    </span><span class="nt">affinity</span><span class="p">:</span><span class="w">                                           </span><span class="c1"># 添加 nodeAffinity</span>
<span class="w">        </span><span class="nt">nodeAffinity</span><span class="p">:</span>
<span class="w">            </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
<span class="w">                </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span>
<span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">     </span><span class="c1"># 接下来的内容是个数组</span>
<span class="w">                        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">size</span>
<span class="w">                          </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<span class="w">                          </span><span class="nt">values</span><span class="p">:</span>
<span class="w">                            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Large</span>
<span class="w">                            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Medium</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<pre><code>如果是一个`Deployment`，`affinity`应该放在`.spec.template.spec.affinity`中！
</code></pre>
</div>
<p><strong>其他可用的 operator</strong>:</p>
<ul>
<li><code>NotIn</code>：与<code>In</code>相反，不在<code>values</code>中的值</li>
<li><code>Exists</code>：只要存在某个<code>key</code>即满足条件，无论<code>values</code>中包含什么值：
<div class="highlight"><pre><span></span><code><span class="c1"># 比如：当Node的label是`size=`的时候，这个时候只有key，没有value，就可以用`Exists`</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">size</span>
<span class="w">      </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exists</span>
</code></pre></div></li>
<li><code>DoesNotExist</code>：与<code>Exists</code>相反</li>
<li><code>Gt</code> = greater than</li>
<li><code>Lt</code> = less than</li>
</ul>
<p><strong>Affinity类型</strong>
定义了<code>Scheduler</code>在Node Affinity的行为以及 Pod 生命周期中的阶段。</p>
<ul>
<li><code>requiredDuringSchedulingIgnoredDuringExecution</code></li>
<li><code>preferredDuringSchedulingIgnoredDuringExecution</code></li>
<li><code>requiredDuringSchedulingRequiredDuringExecution</code>：还在开发中</li>
</ul>
<p>Pod有两个生命周期</p>
<table>
<thead>
<tr>
<th style="text-align: left;"></th>
<th style="text-align: left;">DuringScheduling</th>
<th style="text-align: left;">DuringExecution</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"></td>
<td style="text-align: left;">...指Pod 从不存在到首次创建的状态</td>
<td style="text-align: left;">...指Pod已经在运行了，但可能环境中有新的更改（例如节点标签的更改）</td>
</tr>
<tr>
<td style="text-align: left;"><code>requiredDuringScheduling</code><br/>&nbsp;&nbsp;<code>IgnoredDuringExecution</code></td>
<td style="text-align: left;"><strong>Required.</strong></td>
<td style="text-align: left;"><strong>Ignored.</strong> <br/>不做任何改变</td>
</tr>
<tr>
<td style="text-align: left;"><code>preferredDuringScheduling</code><br/>&nbsp;&nbsp;<code>IgnoredDuringExecution</code></td>
<td style="text-align: left;"><strong>Preferred.</strong> <br/>尝试Pod 放在正确的Node上。<br/>如果找不到正确的，就随便找一个Node放。</td>
<td style="text-align: left;"><strong>Ignored.</strong> <br/>不做任何改变</td>
</tr>
<tr>
<td style="text-align: left;"><code>requiredDuringScheduling</code><br/>&nbsp;&nbsp;<code>RequiredDuringExecution</code></td>
<td style="text-align: left;"><strong>Required.</strong></td>
<td style="text-align: left;"><strong>Required.</strong> <br/>驱逐/终止Node上不符合规则的Pod。</td>
</tr>
</tbody>
</table>
<h4 id="taints-toleration-node-affinity">组合拳：Taints Toleration 和 Node Affinity<a class="headerlink" href="#taints-toleration-node-affinity" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Taints Toleration：</strong> 特殊的<code>Node</code>上只有特殊的<code>Pod</code>，但不保证特殊的<code>Pod</code>一定能放到特殊的<code>Node</code>上 <br/> -&gt; 优先满足Node需求</li>
<li><strong>Node Affiniity：</strong> 特殊的<code>Pod</code>一定在特殊的<code>Node</code>上，但不保证特殊的<code>Node</code>上<strong>只有</strong>特殊的<code>Pod</code> <br/> -&gt; 优先满足Pod需求</li>
<li><strong>Taints Toleration + Node Affiniity组合拳：</strong> 特殊的<code>Node</code>上<strong>有且只有</strong>特殊的<code>Node</code> <br/> -&gt; 两者需求都满足</li>
</ul>
<h4 id="_4">小结<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th></th>
<th><code>Node</code></th>
<th><code>Pod</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Taint &amp; Toleration</td>
<td>动词 <strong>taint</strong> <br /><code>k taint node my-node color=green:NoSchedule</code></td>
<td>在Pod的定义文件中添加<code>.spec.tolerations</code></td>
</tr>
<tr>
<td>Node Selector</td>
<td>动词 <strong>label</strong> <br /><code>k label node my-node color=green</code></td>
<td>在Pod的定义文件中添加<code>.spec.nodeSelector</code></td>
</tr>
<tr>
<td>Node Affinity</td>
<td>动词 <strong>label</strong> <br /><code>k label node my-node color=green</code></td>
<td>在Pod的定义文件中添加<code>.spec.affinity.nodeAffinity</code></td>
</tr>
</tbody>
</table>
<h3 id="kubectl">&gt;&gt;&gt;  本章kubectl命令整理<a class="headerlink" href="#kubectl" title="Permanent link">&para;</a></h3>
<p><strong>Docker命令</strong></p>
<p><code>docker run &lt;ImageName&gt; --entrypoint &lt;EntryPointCMD&gt; --user=&lt;UserID&gt;</code> 用镜像建一个容器，<code>--user</code>可以是<code>root</code>或者<code>1010</code>等</p>
<p><code>docker build -t &lt;NewImageName&gt;</code> 用Dockerfile新建一个名为<code>NewImageName</code>的镜像</p>
<hr />
<p><strong>Docker 用户权限相关</strong></p>
<p><code>docker run --cap-add MAC_ADMIN &lt;ContainerName&gt;</code> 给容器的用户增加一个权限<code>MAC_ADMIN</code></p>
<p><code>docker run --privileged &lt;ContainerName&gt;</code> 给容器的用户所有权限！ </p>
<p><code>docker run --cap-drop MAC_ADMIN &lt;ContainerName&gt;</code>  给容器的用户删减权限<code>MAC_ADMIN</code></p>
<hr />
<p><strong>Pod相关</strong></p>
<p><code>k get pod xxx -o yaml &gt; xxx.yml</code> 查看Pod的更多信息，包括volumes（其中有ServiceAccount），可以导出到yml文件里</p>
<ul>
<li>大多数的Pod属性是不能通过<code>k edit pod xxx</code>来修改的，如果需要修改，那可以把旧的Pod定义导出成yml文件，删掉旧的Pod，重建新的Pod</li>
<li>很多需要改的属性可以去改Deployment</li>
</ul>
<p><code>k get pod -o wide</code>可以看到Pod跑在哪个<code>Node</code>上，用了哪个IP地址</p>
<p><code>k describe pod xxx</code> 获取Pod更详细的信息</p>
<hr />
<p><strong>Node相关</strong></p>
<p><code>k get nodes</code> </p>
<p><code>k describe node xxx</code> 关于Node的信息，比如上面跑了什么Pod</p>
<hr />
<p><strong>Deployment相关</strong></p>
<p><code>k edit deployment xxx</code> 修改Deployment</p>
<hr />
<p><strong>ConfigMap相关</strong></p>
<p><code>k get configmaps</code> 列出所有的configmaps</p>
<p><code>k describe configmaps/xxx</code> 获取某configmap更详细的信息</p>
<p><code>k create configmap &lt;configMapName&gt; --from-literal=&lt;key1&gt;=&lt;value1&gt;</code> 用键值对新建configmap（⚠️ 多个键值对使用多个<code>--from-literal=</code>）</p>
<p><code>k create configmap &lt;configMapName&gt; --from-file=&lt;pathToFile1&gt;</code>用文件新建configmap</p>
<hr />
<p><strong>Secret相关</strong></p>
<p><code>k get secrets</code>列出所有的secrets</p>
<p><code>k describe secret/xxx -o yaml</code>获取某secret更详细的信息</p>
<p><code>k create secret generic &lt;SecretName&gt; --from-literal=&lt;key&gt;=&lt;value&gt;</code> 用键值对新建secret（⚠️ <code>generic</code>是Secret类型，这个类型属性一定不能少，不然会报错）</p>
<p><code>k create secret generic &lt;SecretName&gt; --from-file=&lt;pathToFile&gt;</code>用文件新建secret</p>
<hr />
<p><strong>安全（user）相关</strong></p>
<p><code>k exec &lt;PodName&gt; -- whoami</code>查看Pod中使用的用户是什么类型（root还是非root）</p>
<hr />
<p><strong>ServiceAccount相关</strong></p>
<p><code>k get serviceaccount</code>列出所有的serviceaccount</p>
<p><code>k create serviceaccount &lt;ServiceAccountName&gt;</code>新建serviceaccount</p>
<p><code>k describe serviceaccount &lt;ServiceAccountName&gt;</code> 获取某serviceaccount更详细的信息</p>
<p><code>k create token  &lt;ServiceAccountName&gt;</code>为serviceaccount生成token</p>
<hr />
<p><strong>Taint相关</strong></p>
<p><code>k taint nodes &lt;NodeName&gt; &lt;key&gt;&lt;operator&gt;&lt;value&gt;:&lt;TaintEffect&gt;</code> 添加Taint</p>
<p><code>k taint nodes &lt;NodeName&gt; &lt;key&gt;&lt;operator&gt;&lt;value&gt;:&lt;TaintEffect&gt;-</code> 删除Taint</p>
<ul>
<li>⚠️ 注意：最后有个➖号，意味着“remove”</li>
<li>⚠️ 注意：减号前面没有空格！</li>
</ul>
<p><code>k describe node &lt;NodeName&gt; | grep -i Taint</code> 查看Node的Taint</p>
<p><code>k describe node kubemaster | grep -i Taint</code> 查看Master Node的Taint</p>
<hr />
<p><strong>Node的Label</strong></p>
<p><code>k label nodes &lt;NodeName&gt; &lt;labelKey&gt;=&lt;labelValue&gt;</code>给Node加Selector --&gt; 更高级的Node Affinity只能通过改node.yml来添加 </p>
<hr />
<p><strong>DRY RUN</strong></p>
<p><code>k run xxx --image=yyy --restart=Never --dry-run=client -o yaml &gt; pod.yaml</code></p>
<hr />
<p><strong>帮助</strong></p>
<p><code>k explain pods --recursive | grep envFrom -A3</code> ⚠️⚠️⚠️ 有用！！！查找envFrom的使用方法。</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">envFrom &lt;[]Object&gt;</span><span class="w">                 </span><span class="c1"># 方括号代表接下来的内容是一个Object的数组</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">configMapRef &lt;Object&gt;</span><span class="w">           </span><span class="c1"># Object：</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">name &lt;string&gt;</span><span class="w">                   </span><span class="c1"># 字符串类型</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">optional &lt;boolean&gt;</span><span class="w">              </span><span class="c1"># 布尔类型</span>
</code></pre></div>
<hr />
<p><strong>Bash</strong></p>
<p><code>ps aux</code> 查看进程</p>
<p><code>echo -n 'user' | base64</code> 加密</p>
<p><code>echo -n 'user' | base64 --decode</code> 解密 </p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.tabs.link", "navigation.prunes"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>