
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ckad-6/">
      
      
        <link rel="next" href="../ckad-8/">
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.5">
    
    
      
        <title>7.容器数据的可持久化 - Chuying's notebook</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7a7fce14.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-volume" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Chuying&#39;s notebook" class="md-header__button md-logo" aria-label="Chuying's notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chuying's notebook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              7.容器数据的可持久化
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Chuying&#39;s notebook" class="md-nav__button md-logo" aria-label="Chuying's notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Chuying's notebook
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Administrator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Administrator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          Hardware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/hardware/disk/" class="md-nav__link">
        Disk
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/linux/" class="md-nav__link">
        Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/infrastructure/" class="md-nav__link">
        Infrastructure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Architect
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Architect
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/architectural_thinking/" class="md-nav__link">
        Architectural Thinking
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          AWS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          AWS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/cp/" class="md-nav__link">
        Cloud Practitioner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/saa/" class="md-nav__link">
        Solution Architect Associate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/sap/" class="md-nav__link">
        Solution Architect Professional
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          IBM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          IBM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/ibm/security/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/ibm/storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Guide from MemiLavi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Guide from MemiLavi
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-1/" class="md-nav__link">
        1. Welcome
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-2/" class="md-nav__link">
        2. What is a Software Architect
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-3/" class="md-nav__link">
        3. The Architect's Mindset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-4/" class="md-nav__link">
        4. The Architecture Process
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-5/" class="md-nav__link">
        5. Working with System Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-6/" class="md-nav__link">
        6. Types of Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-7/" class="md-nav__link">
        7. Selecting Technology Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-8/" class="md-nav__link">
        8. Meet the *-ilities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-9/" class="md-nav__link">
        9. Components' Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-10/" class="md-nav__link">
        10. Design Patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-11/" class="md-nav__link">
        11. System Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-12/" class="md-nav__link">
        12. Additional Considerations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-13/" class="md-nav__link">
        13. Architecture Document
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-14/" class="md-nav__link">
        14. Case Study
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-15/" class="md-nav__link">
        15. Advanced Architecture Topics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-16/" class="md-nav__link">
        16. Soft Skills
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Design Patterns (DP)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Design Patterns (DP)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/1_intro/" class="md-nav__link">
        1. Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/2_creational/" class="md-nav__link">
        2. Creational DP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/3_structural/" class="md-nav__link">
        3. Structural DP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/4_behavioral/" class="md-nav__link">
        4. Behavioral DP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          GCP PCAC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          GCP PCAC
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/gcp/1.preparation/" class="md-nav__link">
        1. Preparation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Automation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Automation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/ansible/" class="md-nav__link">
        Ansible
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/argocd/" class="md-nav__link">
        ArgoCD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/benthos/" class="md-nav__link">
        Benthos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
          Instana
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Instana
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/clis/" class="md-nav__link">
        CLIs, Namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/1.jargons/" class="md-nav__link">
        Jargons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/2.agent_sensor/" class="md-nav__link">
        Agent, Sensor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/3.trace/" class="md-nav__link">
        Trace, Call, Span
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/4.event/" class="md-nav__link">
        Event, Alert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/5.api/" class="md-nav__link">
        Integration, SKD, API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/6.ui/" class="md-nav__link">
        UI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/n8n/" class="md-nav__link">
        n8n
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/nodered/intro/" class="md-nav__link">
        NodeRed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/icalBuddy/" class="md-nav__link">
        iCalBuddy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Bash Script
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Bash Script
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../bash_script/" class="md-nav__link">
        Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../bash_script/exercises/" class="md-nav__link">
        Exercises
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Cloud
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Cloud
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../helm/helm-1/" class="md-nav__link">
        Helm
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_6_3_1" id="__nav_6_3_1_label" tabindex="0">
          CKA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3_1">
          <span class="md-nav__icon md-icon"></span>
          CKA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-0/" class="md-nav__link">
        Read before exam
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-1/" class="md-nav__link">
        cka-1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-3/" class="md-nav__link">
        cka-3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-4/" class="md-nav__link">
        cka-4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-5/" class="md-nav__link">
        cka-5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-6/" class="md-nav__link">
        cka-6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-7/" class="md-nav__link">
        cka-7
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-8/" class="md-nav__link">
        8.Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-9/" class="md-nav__link">
        cka-9
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-10/" class="md-nav__link">
        cka-10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-11/" class="md-nav__link">
        cka-11
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-12/" class="md-nav__link">
        cka-12
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-13/" class="md-nav__link">
        cka-13
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-14/" class="md-nav__link">
        cka-14
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-15/" class="md-nav__link">
        cka-15
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-16/" class="md-nav__link">
        cka-16
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6_3_2" id="__nav_6_3_2_label" tabindex="0">
          CKAD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_3_2">
          <span class="md-nav__icon md-icon"></span>
          CKAD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-0/" class="md-nav__link">
        Read before exam
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-1/" class="md-nav__link">
        1.核心概念介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-2/" class="md-nav__link">
        2.配置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-3/" class="md-nav__link">
        3.多容器Pod
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-4/" class="md-nav__link">
        4.容器状态监测
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-5/" class="md-nav__link">
        5.Pod设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-6/" class="md-nav__link">
        6.服务与网络
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          7.容器数据的可持久化
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        7.容器数据的可持久化
      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Table of Contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-volume" class="md-nav__link">
    1. 卷（Volume）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-persistentvolume-pv" class="md-nav__link">
    2. 持久卷（PersistentVolume / PV）
  </a>
  
    <nav class="md-nav" aria-label="2. 持久卷（PersistentVolume / PV）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    持久卷的类型
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-persistentvolumeclaimpvc" class="md-nav__link">
    3. 持久卷申领（PersistentVolumeClaim，PVC）
  </a>
  
    <nav class="md-nav" aria-label="3. 持久卷申领（PersistentVolumeClaim，PVC）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pvcpv-binding" class="md-nav__link">
    PVC如何选择PV (Binding)
  </a>
  
    <nav class="md-nav" aria-label="PVC如何选择PV (Binding)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 根据属性自动绑定
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-selectorslabels" class="md-nav__link">
    2. 根据selectors和labels选择
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-pvc-volumename" class="md-nav__link">
    3. pvc 的 volumeName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    特例
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pvpvc" class="md-nav__link">
    没有可用的PV时，PVC的行为
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-pvc" class="md-nav__link">
    4. 删除PVC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-storageclasses" class="md-nav__link">
    5. 存储类 / StorageClasses
  </a>
  
    <nav class="md-nav" aria-label="5. 存储类 / StorageClasses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-provisioning" class="md-nav__link">
    Static Provisioning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-provisioning" class="md-nav__link">
    Dynamic Provisioning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    区别
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-statefulset" class="md-nav__link">
    6. StatefulSet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#headless-service" class="md-nav__link">
    Headless Service
  </a>
  
    <nav class="md-nav" aria-label="Headless Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-pod" class="md-nav__link">
    1. 手动创建Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-statefulsetpod" class="md-nav__link">
    2. 通过StatefulSet创建Pod
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubectl" class="md-nav__link">
    &gt;&gt;&gt;  本章kubectl命令整理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    图片来源
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-8/" class="md-nav__link">
        8.2021更新的考试内容
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-9/" class="md-nav__link">
        其他
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          OpenShift
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          OpenShift
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/deployment/" class="md-nav__link">
        App Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_2" id="__nav_6_4_2_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/" class="md-nav__link">
        Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/ipi/" class="md-nav__link">
        IPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/upi/" class="md-nav__link">
        UPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/mirror_registry/" class="md-nav__link">
        Mirror Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/network/" class="md-nav__link">
        Network
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/internal_registry/" class="md-nav__link">
        Internal Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/operator/" class="md-nav__link">
        Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/pipeline/" class="md-nav__link">
        Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_6" id="__nav_6_4_6_label" tabindex="0">
          DO288
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_6">
          <span class="md-nav__icon md-icon"></span>
          DO288
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/01_deploy_app/" class="md-nav__link">
        Deploying and Managing Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/02/" class="md-nav__link">
        2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/03/" class="md-nav__link">
        3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/04/" class="md-nav__link">
        4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/05/" class="md-nav__link">
        5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/06/" class="md-nav__link">
        6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/07/" class="md-nav__link">
        7
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/08/" class="md-nav__link">
        8
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_7" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_7" id="__nav_6_4_7_label" tabindex="0">
          DO280
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_7">
          <span class="md-nav__icon md-icon"></span>
          DO280
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/01_manifest_kustimize/" class="md-nav__link">
        1. Manifest & Kustomize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/02_template_helm/" class="md-nav__link">
        2. OC Template & Helm Chart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/03_auth/" class="md-nav__link">
        3. Authentication and Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/04_network_security/" class="md-nav__link">
        4. Network Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/05_expose_sni_app/" class="md-nav__link">
        5. Expose SNI Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/06_developer_self_service/" class="md-nav__link">
        6. Enable Developer Self-Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/07_kubernetes_operator/" class="md-nav__link">
        7. Kubernetes Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/08_application_security/" class="md-nav__link">
        8. Application Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/09_oc_updates/" class="md-nav__link">
        9. Openshift Updates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/10/" class="md-nav__link">
        10
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4_8" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4_8" id="__nav_6_4_8_label" tabindex="0">
          DO322
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_4_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4_8">
          <span class="md-nav__icon md-icon"></span>
          DO322
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/01/" class="md-nav__link">
        1. Intro to OpenShift Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/02/" class="md-nav__link">
        2. IPI on Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/03/" class="md-nav__link">
        3. IPI & UPI on Virtual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/04/" class="md-nav__link">
        4. UPI without Infrastructure Provider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/05/" class="md-nav__link">
        5. Operations & Maintainance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Data Scientist
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Data Scientist
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_scientist/embedding/" class="md-nav__link">
        Embedding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_scientist/elastic_search/" class="md-nav__link">
        ElasticSearch
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../design_thinking/" class="md-nav__link">
        Design Thinking
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          DevOps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          DevOps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/observability/" class="md-nav__link">
        Observability
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          Ecommerce
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Ecommerce
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ecommerce/wordpress/" class="md-nav__link">
        Wordpress
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
      
      
      
        <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
          Frontend
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Frontend
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_1" >
      
      
      
        <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
          CSS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11_1">
          <span class="md-nav__icon md-icon"></span>
          CSS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/css/css-in-depth/" class="md-nav__link">
        CSS In Depth
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/css/shapes/" class="md-nav__link">
        Shape
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/cra/" class="md-nav__link">
        CRA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/gsap/" class="md-nav__link">
        GSAP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/js/" class="md-nav__link">
        JavaScript
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_6" >
      
      
      
        <label class="md-nav__link" for="__nav_11_6" id="__nav_11_6_label" tabindex="0">
          React
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11_6">
          <span class="md-nav__icon md-icon"></span>
          React
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/hooks/" class="md-nav__link">
        Hooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/basics/" class="md-nav__link">
        Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/bugs/" class="md-nav__link">
        Bugs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/oblivion/" class="md-nav__link">
        Oblivion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/web_design/" class="md-nav__link">
        Web Design
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../ffmpeg/" class="md-nav__link">
        ffmpeg
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
      
      
      
        <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
          IDEs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          IDEs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ide/vscode/" class="md-nav__link">
        VSCode
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
      
      
      
        <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
          Network
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/ip/" class="md-nav__link">
        IP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/loadbalancer/" class="md-nav__link">
        LoadBalancer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/protocols/" class="md-nav__link">
        Protocols
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
      
      
      
        <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
          Project Mgmt
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          Project Mgmt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/agile/" class="md-nav__link">
        Agile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/ibm_internal/" class="md-nav__link">
        IBM PM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
      
      
      
        <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/grammars/" class="md-nav__link">
        Grammars
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/fastapi/" class="md-nav__link">
        FastAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/oblivion/" class="md-nav__link">
        Oblivion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/dependencies/" class="md-nav__link">
        Use dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/build_dependency/" class="md-nav__link">
        Build Own Dependency
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/virtual_env/" class="md-nav__link">
        Virtual environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../regex/" class="md-nav__link">
        Regex
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18" >
      
      
      
        <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
          Sketch
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_18">
          <span class="md-nav__icon md-icon"></span>
          Sketch
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../sketch/procreate/" class="md-nav__link">
        Procreate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19" >
      
      
      
        <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
          Working Notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_19">
          <span class="md-nav__icon md-icon"></span>
          Working Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../working_notes/01_2025/" class="md-nav__link">
        202501
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Table of Contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-volume" class="md-nav__link">
    1. 卷（Volume）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-persistentvolume-pv" class="md-nav__link">
    2. 持久卷（PersistentVolume / PV）
  </a>
  
    <nav class="md-nav" aria-label="2. 持久卷（PersistentVolume / PV）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    持久卷的类型
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-persistentvolumeclaimpvc" class="md-nav__link">
    3. 持久卷申领（PersistentVolumeClaim，PVC）
  </a>
  
    <nav class="md-nav" aria-label="3. 持久卷申领（PersistentVolumeClaim，PVC）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pvcpv-binding" class="md-nav__link">
    PVC如何选择PV (Binding)
  </a>
  
    <nav class="md-nav" aria-label="PVC如何选择PV (Binding)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1. 根据属性自动绑定
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-selectorslabels" class="md-nav__link">
    2. 根据selectors和labels选择
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-pvc-volumename" class="md-nav__link">
    3. pvc 的 volumeName
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    特例
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pvpvc" class="md-nav__link">
    没有可用的PV时，PVC的行为
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-pvc" class="md-nav__link">
    4. 删除PVC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-storageclasses" class="md-nav__link">
    5. 存储类 / StorageClasses
  </a>
  
    <nav class="md-nav" aria-label="5. 存储类 / StorageClasses">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#static-provisioning" class="md-nav__link">
    Static Provisioning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-provisioning" class="md-nav__link">
    Dynamic Provisioning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    区别
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-statefulset" class="md-nav__link">
    6. StatefulSet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#headless-service" class="md-nav__link">
    Headless Service
  </a>
  
    <nav class="md-nav" aria-label="Headless Service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-pod" class="md-nav__link">
    1. 手动创建Pod
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-statefulsetpod" class="md-nav__link">
    2. 通过StatefulSet创建Pod
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubectl" class="md-nav__link">
    &gt;&gt;&gt;  本章kubectl命令整理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    图片来源
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>7.容器数据的可持久化</h1>

<h3 id="1-volume">1. 卷（Volume）<a class="headerlink" href="#1-volume" title="Permanent link">&para;</a></h3>
<p>Docker 容器本质上是 <strong>瞬态（transient）</strong>  的。 这意味着它们只能持续很短的时间。它们在App被创建时被调用，容器被销毁时，数据与容器一起被销毁。</p>
<p>为了使容器的数据<strong>持久化</strong>，我们将<strong>容器</strong>所在的 <strong>Pod</strong> 连接到<strong>卷</strong>。 容器中的数据放在该<strong>卷</strong>中，即使容器被删除，数据会仍然存在。</p>
<p>下面的yaml文件为<strong>Pod</strong>创建并连接<strong>卷</strong>：</p>
<ul>
<li><strong>Container</strong>：其中的App随机生成一个0-100之间的数，并存到文件夹 <code>/opt</code> 中</li>
<li><strong>Volume</strong>：该<strong>卷</strong>名为<code>data-volume</code>，实际上是当前Node上的一个文件夹<code>/data</code>。所有用卷<code>data-volume</code>存储的信息，最后都会被放在Node的<code>/data</code>文件夹下</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="c1"># pod.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple-webapp</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple-webapp</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">simple-webapp</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;/bin/sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;shuf</span><span class="nv"> </span><span class="s">-i</span><span class="nv"> </span><span class="s">0-100</span><span class="nv"> </span><span class="s">-n</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">&gt;&gt;</span><span class="nv"> </span><span class="s">/opt/number.out;&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">       </span><span class="c1"># (1) 将容器文件夹`/opt`挂载到名为data-volume的卷上</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt</span><span class="w">     </span><span class="c1"># Container内部文件系统中的文件夹名</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-volume</span><span class="w">   </span><span class="c1"># Volume的名字</span>

<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span><span class="w">              </span><span class="c1"># (2) 创建卷：这里申明了一个在Node上的文件夹，也可以使用其他存储方式，比如引用（PVC）</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-volume</span><span class="w">     </span><span class="c1"># Volume的名字</span>
<span class="w">    </span><span class="nt">hostPath</span><span class="p">:</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Directory</span>
</code></pre></div>
卷的使用确保了<strong>Pod</strong>被删除后，该<strong>Pod</strong>所产生的数据还被保留在所在的<strong>Node</strong>上，如图：
<img src="../ckad-7/volume.png" width=550 /></p>
<p>上面图中的的挂载方法只适用于单Node的集群。如果是多个<strong>Node</strong>，每个Node上的数据都是不一样的：
<img src="../ckad-7/multi_node.png" width=800 /></p>
<div class="admonition warning">
<p class="admonition-title">Volume的缺点</p>
<ul>
<li><strong>卷</strong>与<strong>Pod</strong>相连 -&gt; 每次新建一个需要存储空间的<strong>Pod</strong>，都需要手动配置卷</li>
<li><strong>卷</strong>存在于<strong>Node服务器</strong>上 -&gt; 分布在不同<strong>Node</strong>上的App无法访问到同一个的<strong>卷</strong></li>
<li>卷的这两个特性导致管理困难，而且也不利于扩大应用规模，因为无法支持多Node的应用，而<strong>持久卷</strong>能解决该问题</li>
</ul>
</div>
<!--
## 常见的 volume 的类型
|Volume|`hostPath` |云储存|
|:-|:-|:-|
|**级别**| Pod级别的volume| 比如`awsElasticBlockStore`，数据相对Node和App独立，分布在不同Node上的应用都统一访问云存储的空间|
|**多Node应用**|不支持|支持|
|**yaml<br />举例**|<img src="../ckad-7/eb458cc117a449d39469c0ae5ebf212c.png" />|<img src="../ckad-7/664c8abed12a4d8aafd66763d6e23d54.png" />|
|||<img src="../ckad-7/cc7ff739460d481588c53b3c6fd81fd7.png" width=1200 />|

# TODO：比较hostPath和emptyDir
|Volume|`hostPath`|`emptyDir` |云储存|
|:-|:-|:-|:-|
|**级别**| Pod级别的volume| `emptyDir`在Pod被分配到一个Node上时自动生成，初始化后没有任何内容。是零时卷，是Pod级别的volume，与该volume相关联的Pod的所有Container都能访问到volume中的内容。当 Pod 因任何原因从节点中移除时，emptyDir 中的数据将被永久删除。| 比如`awsElasticBlockStore`，数据相对Node和App独立，分布在不同Node上的应用都统一访问云存储的空间|
|**多Node应用**|不支持|不支持|支持|
|**yaml举例**|<img src="../ckad-7/eb458cc117a449d39469c0ae5ebf212c.png" />|<img src="../ckad-7/605e97f2c9f94fe496b014ae7c7e7da3.png" />|<img src="../ckad-7/664c8abed12a4d8aafd66763d6e23d54.png" />|
**更多卷（`volume`）的类型见[这里](https://kubernetes.io/docs/concepts/storage/volumes/#awselasticblockstore)。*
-->

<h3 id="2-persistentvolume-pv">2. 持久卷（PersistentVolume / PV）<a class="headerlink" href="#2-persistentvolume-pv" title="Permanent link">&para;</a></h3>
<p>我们想要一个 <span style="background-color: #ccd1f0">更中心化</span> 的解决方法，如有某个<strong>多Node的应用</strong>需要修改存储空间，管理员（Administrator）可以统一对其进行管理。<strong>持久卷池</strong>可以帮我们解决这个问题。</p>
<p>持久卷是<strong>Cluster</strong>层级的，放满 <strong>存储卷</strong> 的池子（Pool），由集群的管理员进行管理和配置。然后由Pod根据自己的需求发送 <strong>存储卷请求（PersistentVolumeClaim / PVC）</strong>。</p>
<p>⚠️ 一个PV本身是不可分割的单位，而管理员管理的是一堆存储容量大小各异的PV
<div class="highlight"><pre><span></span><code><span class="c1"># 持久卷（PersistentVolume）的定义</span>
<span class="c1"># my-pv.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pv-volume</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">          </span><span class="c1"># 可能的mode： ReadOnlyMany, ReadWriteOnce 和 ReadWriteMany</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">capacity</span><span class="p">:</span><span class="w">             </span><span class="c1"># 所需的存储空间的大小</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">             </span><span class="c1"># 卷的类型：Node（主机）上的文件夹 - 不推荐</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/data</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w">  </span><span class="c1"># SC</span>
</code></pre></div>
生成持久卷：</p>
<p><div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>my-pc.yaml
</code></pre></div>
查看已有的持久卷：
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>persistentvolume
</code></pre></div></p>
<h4 id="_1">持久卷的类型<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<p>当我们在<code>pod.yaml</code>中定义<code>volumes</code>属性时，有很多不同选择。比如：NFS、ClusterFS、Flocker、FibreChannel、CephFS、ScaleIO 或公共云解决方案，如AWS EBS， Azure， Google Persistent Disk，或者AWS Elastic Block Store。比如：</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">volumes</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-volume</span>
<span class="w">  </span><span class="nt">awsElasticBlockStore</span><span class="p">:</span>
<span class="w">    </span><span class="nt">volumeID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;volume-id&gt;</span>
<span class="w">    </span><span class="nt">fsType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ext4</span>
</code></pre></div>
还有其他更多<strong>持久卷</strong>的类型：</p>
<ul>
<li><code>awsElasticBlockStore</code>：AWS Elastic Block Store (EBS)</li>
<li><code>azureDisk</code>：Azure Disk</li>
<li><code>azureFile</code>：Azure File</li>
<li><code>cephfs</code>：CephFS volume</li>
<li><code>csi</code>：Container Storage Interface (CSI)</li>
<li><code>fc</code>：Fibre Channel (FC) storage</li>
<li><code>gcePersistentDisk</code>：GCE Persistent Disk</li>
<li><code>glusterfs</code>：Glusterfs volume</li>
<li><code>hostPath</code>：HostPath volume (for single node testing only; WILL NOT WORK in a multi-node cluster; consider using local volume instead)</li>
<li><code>iscsi</code>：iSCSI (SCSI over IP) storage</li>
<li><code>local</code>：local storage devices mounted on nodes.</li>
<li><code>nfs</code>：Network File System (NFS) storage</li>
<li><code>portworxVolume</code>：Portworx volume</li>
<li><code>rbd</code>：Rados Block Device (RBD) volume</li>
<li><code>vsphereVolume</code>：vSphere VMDK volume</li>
</ul>
<h3 id="3-persistentvolumeclaimpvc">3. 持久卷申领（PersistentVolumeClaim，PVC）<a class="headerlink" href="#3-persistentvolumeclaimpvc" title="Permanent link">&para;</a></h3>
<p>在定义了Cluster上的<strong>PersistentVolume</strong>之后。<strong>Pod</strong>需要发送PVC请求，以拿到试用PV的许可</p>
<div class="admonition note">
<p class="admonition-title">概念整理</p>
<ul>
<li><strong>PV</strong>：由 <strong>管理者（Administrator）</strong> 配置的存储空间</li>
<li><strong>PVC</strong>：由Pod的 <strong>用户（User of Pod）</strong> 发出的“想要使用一部分存储空间“的请求</li>
</ul>
</div>
<p><div class="highlight"><pre><span></span><code><span class="c1"># my-pvc.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-claim</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">        </span><span class="c1"># 所需资源</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500Mi</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
</code></pre></div>
生成PVC：
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>my-pvc.yaml
</code></pre></div>
查看已有PVC：
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>persistentvolumeclaim
</code></pre></div>
PVC在Pod中的使用：
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myfrontend</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/var/www/html&quot;</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypd</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypd</span>
<span class="w">      </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">  </span><span class="c1"># 使用PVC</span>
<span class="w">        </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myclaim</span>
</code></pre></div>
⚠️ 在Pod中添加PVC之后，ReplicaSets 和 Deployments中也会自动添加相对应的PVC定义！</p>
<h4 id="pvcpv-binding">PVC如何选择PV (Binding)<a class="headerlink" href="#pvcpv-binding" title="Permanent link">&para;</a></h4>
<h5 id="1">1. 根据属性自动绑定<a class="headerlink" href="#1" title="Permanent link">&para;</a></h5>
<p>Kubernetes 尝试根据<strong>PVC的要求</strong>找到具有足够容量的PV。<strong>PVC</strong>可以定义存储容量（<code>sufficient capacity</code>），访问模式（<code>access modes</code>）、卷模式（<code>volume modes</code>）、存储类（<code>StorageClass</code>）等属性。如果有多个PV符合PVC的要求，则随机选择一个PV。</p>
<table>
<thead>
<tr>
<th align="left">条件</th>
<th align="left">PVC 和 PV 必须一致</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">storage</td>
<td align="left">PVC 请求的 ≤ PV 提供的</td>
</tr>
<tr>
<td align="left">accessModes</td>
<td align="left">PVC 请求的 ⊆ PV 支持的</td>
</tr>
<tr>
<td align="left">storageClassName</td>
<td align="left">必须匹配（或者都为空）</td>
</tr>
<tr>
<td align="left">状态</td>
<td align="left">PV 处于 Available 状态</td>
</tr>
</tbody>
</table>
<h5 id="2-selectorslabels">2. 根据selectors和labels选择<a class="headerlink" href="#2-selectorslabels" title="Permanent link">&para;</a></h5>
<p>如果你想指定 PVC 使用哪个 PV, 也可以利用 PVC 的<code>labels</code>和<code>selectors</code>来定位到正确的PV。比如：</p>
<ol>
<li>PVC中添加<code>selectors</code>属性
<div class="highlight"><pre><span></span><code><span class="c1"># pvc.yaml</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-pv</span>
</code></pre></div></li>
<li>在PV中添加<code>labels</code>属性</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># pv.yaml</span>
<span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-pv</span>
</code></pre></div>
<h5 id="3-pvc-volumename">3. pvc 的 volumeName<a class="headerlink" href="#3-pvc-volumename" title="Permanent link">&para;</a></h5>
<p>如果你想指定 PVC 使用哪个 PV，可以提前给它设置 <code>volumeName</code>。 <code>volumeName</code> 是最直接的方式，但必须确保 PVC 的所有参数（如 <code>accessModes</code>、<code>storageClassName</code> 和 <code>size</code>）与该 PV 完全兼容。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># pvc.yaml</span>
apiVersion:<span class="w"> </span>v1
kind:<span class="w"> </span>PersistentVolumeClaim
metadata:
<span class="w">  </span>name:<span class="w"> </span>my-pvc
spec:
<span class="w">  </span>volumeName:<span class="w"> </span>my-pv<span class="w">  </span><span class="c1"># 手动指定绑定到名为 &quot;my-pv&quot; 的 PV</span>
<span class="w">  </span>accessModes:
<span class="w">    </span>-<span class="w"> </span>ReadWriteOnce
<span class="w">  </span>resources:
<span class="w">    </span>requests:
<span class="w">      </span>storage:<span class="w"> </span>10Gi
</code></pre></div>
<h5 id="_2">特例<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h5>
<p>最后，如果所有所有属性都匹配，且没有更好的选择，则较小的PVC最终可能会绑定比它要求更大的PV。<br/>
<strong> 这可能导致PV的浪费！</strong></p>
<p>假设我们有一个PVC和一个PV。PVC要求的存储空间是<code>500Mi</code>，而现在可用的PV只有一个，那么PVC只能绑定到剩下的PV。用<code>k get pvc</code>可用看到：
<div class="highlight"><pre><span></span><code>NAME<span class="w">     </span>STATUS<span class="w">    </span>VOLUME<span class="w">       </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>STORAGECLASS<span class="w">    </span>AGE
my-claim<span class="w"> </span>Bound<span class="w">     </span>my-volume<span class="w">    </span>1Gi<span class="w">        </span>RWO<span class="w">            </span>aws-xxx<span class="w">         </span>40m
</code></pre></div></p>
<h4 id="pvpvc">没有可用的PV时，PVC的行为<a class="headerlink" href="#pvpvc" title="Permanent link">&para;</a></h4>
<p>如果当前的Cluster中，没有可用的PV，那么发出的PVC会一直处于<code>Pending</code>的状态。这时用<code>k get pvc</code>会看到：
<div class="highlight"><pre><span></span><code>NAME<span class="w">     </span>STATUS<span class="w">    </span>VOLUME<span class="w">   </span>CAPACITY<span class="w">    </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>STORAGECLASS<span class="w">           </span>AGE
my-claim<span class="w"> </span>Pending<span class="w">                                       </span>vpc-block-1iops-tier<span class="w">   </span>35h
</code></pre></div>
当Administrator往Cluster中添加新的PV时，处于<code>Pending</code>状态的PVC会自动与新的PV完成绑定！</p>
<h3 id="4-pvc">4. 删除PVC<a class="headerlink" href="#4-pvc" title="Permanent link">&para;</a></h3>
<p>删除PVC：</p>
<p><div class="highlight"><pre><span></span><code>k<span class="w"> </span>delete<span class="w"> </span>pvc/my-claim
</code></pre></div>
当PVC被删除时，<strong>与之绑定的PV</strong> 可能的行为有以下几种：</p>
<ol>
<li><code>Retain</code>: 被绑定的PV会依旧存在，没有被删除，除非Administrator手动删除。但该PV也无法被其他PVC使用。此时PV的Status会是<code>“Released”</code>，而不是<code>“Available”</code>。</li>
<li><code>Delete</code>: 被绑定的PV也会自动被删除，由此，Cluster的整体<strong>存储池</strong>总体容量会变小</li>
<li><code>Recycle</code>: 被绑定的PV被回收利用，PV上的数据会被删除，且可供其他PVC使用，Cluster的整体<strong>存储池</strong>总体容量会不变</li>
</ol>
<p>你可以在YAML中定义：</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pv-volume</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
<span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
<span class="w">  </span><span class="nt">awsElasticBlockStore</span><span class="p">:</span>
<span class="w">    </span><span class="nt">volumeID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xxx</span>
<span class="w">    </span><span class="nt">fsType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ext4</span>
<span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recycle</span><span class="w">  </span><span class="c1"># 对PV的行为进行规定：&quot;Retain&quot;, &quot;Recycle&quot;, 或 &quot;Delete&quot;</span>
</code></pre></div>
⚠️ 对卷的绑定可以在Pod的定义文件中进行，也可以在Deployment或者ReplicaSet的定义文件中进行，效果是一样的</p>
<h3 id="5-storageclasses">5. 存储类 / StorageClasses<a class="headerlink" href="#5-storageclasses" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul>
<li>PV（PersistentVolume） 就像已经准备好出租的房子</li>
<li>PVC（PersistentVolumeClaim） 就像租客的租房需求</li>
<li>StorageClass 就像中介公司给的template，帮你根据需求 <strong>自动造房子</strong>（即动态 provision）</li>
</ul>
<p>PVC 是用户的存储需求，PV 是系统可用的存储资源，而 StorageClass 则是动态创建 PV 的“建房模板”，三者一起构成 Kubernetes 存储资源的分配与管理体系。</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><code>storageClassName: ""</code> 表示静态绑定</p>
</div>
<h4 id="static-provisioning">Static Provisioning<a class="headerlink" href="#static-provisioning" title="Permanent link">&para;</a></h4>
<p>假设我现在想使用GCE的存储空间，那么需要4个步骤：</p>
<ol>
<li>在GCE中新建存储空间</li>
<li>创建一个使用GCE空间的PV</li>
<li>创建一个PVC，对PV进行时使用</li>
<li>在Pod中使用引用PVC</li>
</ol>
<p>如图：</p>
<pre class="mermaid"><code>flowchart TD
  PV[PV: 10Gi Manual房] --&gt; Match
  PVC[PVC: 我要10Gi Manual房] --&gt; Match
  Match --&gt; Bind[绑定成功]</code></pre>
<!-- <img src="../ckad-7/static_Provisioning.png" width=800> -->

<p>这个过程被称作 <strong>Static Provisioning</strong>。</p>
<h4 id="dynamic-provisioning">Dynamic Provisioning<a class="headerlink" href="#dynamic-provisioning" title="Permanent link">&para;</a></h4>
<p>我们可以通过创建<strong>存储类 / StorageClass</strong>来自动化步骤（1）和（2），实现<strong>“Dynamic Provisioning”</strong> 。</p>
<ul>
<li>PVC通过<code>storageClassName</code>连接到StorageClass，StorageClass中的 <strong>配置器/provisioner</strong> 来配置新的GCE磁盘，并且自动生成一个相对应的PV</li>
<li>你不需要手动创建 PV，也不需要事先准备路径或磁盘挂载等工作</li>
</ul>
<p>如图：</p>
<pre class="mermaid"><code>flowchart TD
  PVC["PVC: 我要5Gi fast房，找StorageClass"] --&gt; SC["StorageClass: fast模板"]
  SC --&gt; PVNew["创建新PV: 5Gi"]
  PVNew --&gt; Bind["自动绑定"]</code></pre>
<!-- <img src="../ckad-7/dynamic_Provisioning.png" width=800> -->

<div class="admonition note">
<p class="admonition-title">StorageClass举例</p>
<div class="highlight"><pre><span></span><code><span class="c1"># my-sc.yaml</span>
<span class="nt">apiVerson</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">google-storage</span>

<span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/gce-pd</span><span class="w">   </span><span class="c1"># 🌈 配置器：不同供应商提供不同的配置器</span>
<span class="nt">VolumeBindingMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WaitForFirstConsumer</span>
<span class="nt">parameters</span><span class="p">:</span><span class="w">             </span><span class="c1"># 配置额外的参数</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pd-standard</span>
<span class="w">  </span><span class="nt">replication-type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
</code></pre></div>
<p><strong>provisioner</strong> <br/>
- k8s为每个云供应商都提供了不同的provisioner：比如<code>kubernetes.io/gce-pd</code>就是给 GoogleCloudEngine 的provisioner
- 是如果provisioner是<code>kubernetes.io/no-provisioner</code>，那么意味着该StorageClass不支持 dynamic provisioning</p>
<p><strong>VolumeBindingMode/绑定模式</strong> <br/>
可能的值有：<br/></p>
<ul>
<li><code>WaitForFirstConsumer</code>: 将延迟 PV 的绑定和配置，直到创建使用了对应 PVC 的 Pod <br/></li>
<li><code>Immediate</code></li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">Naming of 'StorageClass'</p>
<p>You can use different drive in different StorageClass, thats where the name come from:</p>
<p><img src="../ckad-7/storageclass.png" /></p>
</div>
<div class="admonition danger">
<p class="admonition-title">有可能 PVC 无法通过 StorageClass 自动生成 PV</p>
<p>比如集群中根本没有安装这个 CSI 插件。那么 StorageClass 就失去了它存在的意义，直接用 Static Provisioning，即PV + PVC更合理</p>
</div>
<h4 id="_3">区别<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>Static和Dynamic Provisioning的区别如图：</p>
<table>
<thead>
<tr>
<th align="left"><div style="width: 220px">Static Provisioning</div></th>
<th align="left"><div style="width: 220px">Dynamic Provisioning</div></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><pre><code>Pod -&gt; PVC -&gt; PV -&gt; GCE</code></pre></td>
<td align="left"><pre><code>Pod -&gt; PVC -&gt; SC(PV)</code></pre></td>
</tr>
</tbody>
</table>
<p><img src="../ckad-7/provisioning.png" width=500></p>
<h3 id="6-statefulset">6. StatefulSet<a class="headerlink" href="#6-statefulset" title="Permanent link">&para;</a></h3>
<p><strong>StatefulSet</strong> 类似于 <strong>Deployment</strong>，因为它们基于模板创建 Pod。 他们可以增加和减少Pod的数量。 也可以执行滚动更新和回滚，但存在差异：<br/></p>
<ul>
<li><strong>StatefulSet</strong> 中 <strong>Pod</strong> 是按顺序创建的。 </li>
<li>部署第一个 <strong>Pod</strong> 后，它必须处于运行和就绪状态，才能继续部署下一个 <strong>Pod</strong> 。 </li>
<li><strong>StatefulSet</strong>给每一个创建的<strong>Pod</strong>都按照生成顺序编号，并根据编号生成独一无二的名字，比如：<code>sql-1</code>，<code>sql-2</code></li>
</ul>
<div class="admonition note">
<p class="admonition-title">使用场景</p>
<ul>
<li>StatefulSet: 需要有状态、稳定身份的应用（如数据库、分布式系统），比如MySQL、Cassandra、Zookeeper、Kafka 等分布式系统 </li>
<li>Deployment: 无状态应用（如 Web 应用、API 服务），比如Nginx、前端服务、微服务应用       </li>
</ul>
</div>
<p><div class="highlight"><pre><span></span><code><span class="c1"># StatefulSet的定义文件和Deployment大同小异，主要把 kind的类型改了</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>

<span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span><span class="w">  </span><span class="c1"># 声明要使用的 Headless服务</span>
</code></pre></div>
生成StatefulSet：</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>my-ss.yaml
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>StatefulSet被删除时从后往前删</p>
</div>
<h3 id="headless-service">Headless Service<a class="headerlink" href="#headless-service" title="Permanent link">&para;</a></h3>
<p>不做loading balance，只提供DNS的服务。与StatefulSet一起使用时，为每一个Pod都提供一个DNS，格式为：<code>&lt;pod-name&gt;.&lt;headless-service-name&gt;.&lt;namespace&gt;.&lt;cluster-domain&gt;</code>比如：</p>
<ul>
<li><code>mysql-0.mysql-headless.default.svc.cluster.local</code></li>
<li><code>mysql-1.mysql-headless.default.svc.cluster.local</code></li>
<li><code>mysql-2.mysql-headless.default.svc.cluster.local</code></li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-headless</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="w">    </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">    </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span><span class="w">  </span><span class="c1"># Headless服务与其他服务区分开来的地方</span>
</code></pre></div>
现在我们有两条路：</p>
<ol>
<li>手动创建Pod</li>
<li>通过StatefulSet创建Pod</li>
</ol>
<h4 id="1-pod">1. 手动创建Pod<a class="headerlink" href="#1-pod" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp-pod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>

<span class="w">  </span><span class="nt">subdomain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-headless</span><span class="w">   </span><span class="c1"># 1. subdomain = 服务名字</span>
<span class="w">  </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-pod</span><span class="w">         </span><span class="c1"># 2. hostname 确保每个Pod都有各自的DNS</span>
</code></pre></div>
<h4 id="2-statefulsetpod">2. 通过StatefulSet创建Pod<a class="headerlink" href="#2-statefulsetpod" title="Permanent link">&para;</a></h4>
<p>如之前的例子所示，需要加一个<code>serviceName</code>即可</p>
<h3 id="kubectl">&gt;&gt;&gt;  本章kubectl命令整理<a class="headerlink" href="#kubectl" title="Permanent link">&para;</a></h3>
<p><strong>PersistentVolume相关</strong></p>
<p><code>k get pv</code></p>
<hr />
<p><strong>PersistentVolumeClaim相关</strong></p>
<p><code>k get pvc</code></p>
<p><code>k delete pvc/my-claim</code> 删除pvc</p>
<h3 id="_4">图片来源<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p><a href="https://www.flaticon.com/free-icons/database" title="database icons">Database icons created by phatplus - Flaticon</a>
<a href="https://www.flaticon.com/free-icons/folder" title="folder icons">Folder icons created by Good Ware - Flaticon</a></p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.tabs.link", "navigation.prunes"], "search": "../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.407015b8.min.js"></script>
      
    
  </body>
</html>