
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ckad-5/">
      
      
        <link rel="next" href="../ckad-7/">
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.5">
    
    
      
        <title>6.服务与网络 - Chuying's notebook</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7a7fce14.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-service" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Chuying&#39;s notebook" class="md-header__button md-logo" aria-label="Chuying's notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chuying's notebook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6.服务与网络
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Chuying&#39;s notebook" class="md-nav__button md-logo" aria-label="Chuying's notebook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Chuying's notebook
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Administrator
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Administrator
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          Hardware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/hardware/disk/" class="md-nav__link">
        Disk
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/linux/" class="md-nav__link">
        Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrator/infrastructure/" class="md-nav__link">
        Infrastructure
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Architect
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Architect
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/architectural_thinking/" class="md-nav__link">
        Architectural Thinking
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          AWS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          AWS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/cp/" class="md-nav__link">
        Cloud Practitioner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/saa/" class="md-nav__link">
        Solution Architect Associate
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/aws/sap/" class="md-nav__link">
        Solution Architect Professional
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          IBM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          IBM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/ibm/security/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/ibm/storage/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
      
      
      
        <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
          Guide from MemiLavi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Guide from MemiLavi
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-1/" class="md-nav__link">
        1. Welcome
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-2/" class="md-nav__link">
        2. What is a Software Architect
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-3/" class="md-nav__link">
        3. The Architect's Mindset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-4/" class="md-nav__link">
        4. The Architecture Process
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-5/" class="md-nav__link">
        5. Working with System Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-6/" class="md-nav__link">
        6. Types of Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-7/" class="md-nav__link">
        7. Selecting Technology Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-8/" class="md-nav__link">
        8. Meet the *-ilities
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-9/" class="md-nav__link">
        9. Components' Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-10/" class="md-nav__link">
        10. Design Patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-11/" class="md-nav__link">
        11. System Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-12/" class="md-nav__link">
        12. Additional Considerations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-13/" class="md-nav__link">
        13. Architecture Document
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-14/" class="md-nav__link">
        14. Case Study
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-15/" class="md-nav__link">
        15. Advanced Architecture Topics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/memi/memi-16/" class="md-nav__link">
        16. Soft Skills
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          Design Patterns (DP)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Design Patterns (DP)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/1_intro/" class="md-nav__link">
        1. Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/2_creational/" class="md-nav__link">
        2. Creational DP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/3_structural/" class="md-nav__link">
        3. Structural DP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/design_patterns/4_behavioral/" class="md-nav__link">
        4. Behavioral DP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          GCP PCAC
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          GCP PCAC
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../architect/gcp/1.preparation/" class="md-nav__link">
        1. Preparation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Automation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Automation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/ansible/" class="md-nav__link">
        Ansible
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/argocd/" class="md-nav__link">
        ArgoCD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/benthos/" class="md-nav__link">
        Benthos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/helm/" class="md-nav__link">
        Helm
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
          Instana
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Instana
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/clis/" class="md-nav__link">
        CLIs, Namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/1.jargons/" class="md-nav__link">
        Jargons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/2.agent_sensor/" class="md-nav__link">
        Agent, Sensor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/3.trace/" class="md-nav__link">
        Trace, Call, Span
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/4.event/" class="md-nav__link">
        Event, Alert
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/5.api/" class="md-nav__link">
        Integration, SKD, API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/instana/theory/6.ui/" class="md-nav__link">
        UI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/n8n/" class="md-nav__link">
        n8n
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/nodered/intro/" class="md-nav__link">
        NodeRed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../automation/icalBuddy/" class="md-nav__link">
        iCalBuddy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Bash Script
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Bash Script
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../bash_script/" class="md-nav__link">
        Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../bash_script/exercises/" class="md-nav__link">
        Exercises
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Cloud
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Cloud
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../helm/helm-1/" class="md-nav__link">
        Helm
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_6_3_1" id="__nav_6_3_1_label" tabindex="0">
          CKA
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_3_1">
          <span class="md-nav__icon md-icon"></span>
          CKA
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-0/" class="md-nav__link">
        Read before exam
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-1/" class="md-nav__link">
        cka-1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-3/" class="md-nav__link">
        cka-3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-4/" class="md-nav__link">
        cka-4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-5/" class="md-nav__link">
        cka-5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-6/" class="md-nav__link">
        cka-6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-7/" class="md-nav__link">
        cka-7
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-8/" class="md-nav__link">
        8.Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-9/" class="md-nav__link">
        cka-9
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-10/" class="md-nav__link">
        cka-10
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-11/" class="md-nav__link">
        cka-11
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-12/" class="md-nav__link">
        cka-12
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-13/" class="md-nav__link">
        cka-13
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-14/" class="md-nav__link">
        cka-14
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-15/" class="md-nav__link">
        cka-15
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cka/cka-16/" class="md-nav__link">
        cka-16
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6_3_2" id="__nav_6_3_2_label" tabindex="0">
          CKAD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_3_2">
          <span class="md-nav__icon md-icon"></span>
          CKAD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-0/" class="md-nav__link">
        Read before exam
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-1/" class="md-nav__link">
        1.核心概念介绍
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-2/" class="md-nav__link">
        2.配置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-3/" class="md-nav__link">
        3.多容器Pod
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-4/" class="md-nav__link">
        4.容器状态监测
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-5/" class="md-nav__link">
        5.Pod设计
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          6.服务与网络
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        6.服务与网络
      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Table of Contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-service" class="md-nav__link">
    1. 服务（Service）
  </a>
  
    <nav class="md-nav" aria-label="1. 服务（Service）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service" class="md-nav__link">
    为什么需要Service？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ports" class="md-nav__link">
    语法：三个ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    IP地址类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    服务类型
  </a>
  
    <nav class="md-nav" aria-label="服务类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1clusterip" class="md-nav__link">
    （1）ClusterIP类 服务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2nodeport" class="md-nav__link">
    （2）NodePort类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3headless" class="md-nav__link">
    （3）Headless类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4loadbalancer" class="md-nav__link">
    （4）LoadBalancer类
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service_1" class="md-nav__link">
    创建服务（Service）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ingress" class="md-nav__link">
    2. Ingress
  </a>
  
    <nav class="md-nav" aria-label="2. Ingress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    背景
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress" class="md-nav__link">
    救星Ingress
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress_1" class="md-nav__link">
    Ingress组成
  </a>
  
    <nav class="md-nav" aria-label="Ingress组成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ingress-controller" class="md-nav__link">
    (1) Ingress Controller
  </a>
  
    <nav class="md-nav" aria-label="(1) Ingress Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.一个负载均衡器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2configmap" class="md-nav__link">
    2.一个ConfigMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3nodeportservice" class="md-nav__link">
    3.一个NodePort类型的Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4serviceaccount" class="md-nav__link">
    4.一个ServiceAccount
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ingress-resource" class="md-nav__link">
    (2) Ingress Resource
  </a>
  
    <nav class="md-nav" aria-label="(2) Ingress Resource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    设置默认backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite-target" class="md-nav__link">
    rewrite-target
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress_2" class="md-nav__link">
    Ingress规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bug-debug" class="md-nav__link">
    Bug &amp; Debug
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-networkpolicy" class="md-nav__link">
    3. NetworkPolicy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-labels-selectors" class="md-nav__link">
    4. 标签&amp;选择器（Labels &amp; Selectors）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubectl" class="md-nav__link">
    &gt;&gt;&gt;  本章kubectl命令整理
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-7/" class="md-nav__link">
        7.容器数据的可持久化
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-8/" class="md-nav__link">
        8.2021更新的考试内容
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ckad-9/" class="md-nav__link">
        其他
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../podman/" class="md-nav__link">
        Podman
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
          OpenShift
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          OpenShift
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/deployment/" class="md-nav__link">
        App Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5_2" id="__nav_6_5_2_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/" class="md-nav__link">
        Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/ipi/" class="md-nav__link">
        IPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/upi/" class="md-nav__link">
        UPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/mirror_registry/" class="md-nav__link">
        Mirror Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/installation/network/" class="md-nav__link">
        Network
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/internal_registry/" class="md-nav__link">
        Internal Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/monitoring_stack/" class="md-nav__link">
        Monitoring Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/operator/" class="md-nav__link">
        Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/pipeline/" class="md-nav__link">
        Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_7" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5_7" id="__nav_6_5_7_label" tabindex="0">
          DO288
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_5_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5_7">
          <span class="md-nav__icon md-icon"></span>
          DO288
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/01_deploy_app/" class="md-nav__link">
        Deploying and Managing Applications
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/02/" class="md-nav__link">
        2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/03/" class="md-nav__link">
        3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/04/" class="md-nav__link">
        4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/05/" class="md-nav__link">
        5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/06/" class="md-nav__link">
        6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/07/" class="md-nav__link">
        7
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do288/08/" class="md-nav__link">
        8
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_8" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5_8" id="__nav_6_5_8_label" tabindex="0">
          DO280
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_5_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5_8">
          <span class="md-nav__icon md-icon"></span>
          DO280
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/01_manifest_kustimize/" class="md-nav__link">
        1. Manifest & Kustomize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/02_template_helm/" class="md-nav__link">
        2. OC Template & Helm Chart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/03_auth/" class="md-nav__link">
        3. Authentication and Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/04_network_security/" class="md-nav__link">
        4. Network Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/05_expose_sni_app/" class="md-nav__link">
        5. Expose SNI Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/06_developer_self_service/" class="md-nav__link">
        6. Enable Developer Self-Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/07_kubernetes_operator/" class="md-nav__link">
        7. Kubernetes Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/08_application_security/" class="md-nav__link">
        8. Application Security
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/09_oc_updates/" class="md-nav__link">
        9. Openshift Updates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do280/10/" class="md-nav__link">
        10
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5_9" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5_9" id="__nav_6_5_9_label" tabindex="0">
          DO322
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_5_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5_9">
          <span class="md-nav__icon md-icon"></span>
          DO322
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/01/" class="md-nav__link">
        1. Intro to OpenShift Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/02/" class="md-nav__link">
        2. IPI on Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/03/" class="md-nav__link">
        3. IPI & UPI on Virtual
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/04/" class="md-nav__link">
        4. UPI without Infrastructure Provider
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../openshift/do322/05/" class="md-nav__link">
        5. Operations & Maintainance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Data Scientist
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Data Scientist
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_scientist/embedding/" class="md-nav__link">
        Embedding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../data_scientist/elastic_search/" class="md-nav__link">
        ElasticSearch
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../design_thinking/" class="md-nav__link">
        Design Thinking
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          DevOps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          DevOps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dev_ops/observability/" class="md-nav__link">
        Observability
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
      
      
      
        <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
          Ecommerce
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Ecommerce
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ecommerce/wordpress/" class="md-nav__link">
        Wordpress
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
      
      
      
        <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
          Frontend
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Frontend
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_1" >
      
      
      
        <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
          CSS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11_1">
          <span class="md-nav__icon md-icon"></span>
          CSS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/css/css-in-depth/" class="md-nav__link">
        CSS In Depth
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/css/shapes/" class="md-nav__link">
        Shape
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/cra/" class="md-nav__link">
        CRA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/gsap/" class="md-nav__link">
        GSAP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/js/" class="md-nav__link">
        JavaScript
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/nginx/" class="md-nav__link">
        Nginx
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_6" >
      
      
      
        <label class="md-nav__link" for="__nav_11_6" id="__nav_11_6_label" tabindex="0">
          React
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11_6">
          <span class="md-nav__icon md-icon"></span>
          React
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/hooks/" class="md-nav__link">
        Hooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/basics/" class="md-nav__link">
        Basics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/bugs/" class="md-nav__link">
        Bugs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/oblivion/" class="md-nav__link">
        Oblivion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/react/resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../frontend/web_design/" class="md-nav__link">
        Web Design
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../ffmpeg/" class="md-nav__link">
        ffmpeg
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
      
      
      
        <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
          IDEs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          IDEs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ide/vscode/" class="md-nav__link">
        VSCode
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
      
      
      
        <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
          Monitoring
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_14">
          <span class="md-nav__icon md-icon"></span>
          Monitoring
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../monitoring/grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../monitoring/prometheus/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
      
      
      
        <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
          Network
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_15">
          <span class="md-nav__icon md-icon"></span>
          Network
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/ip/" class="md-nav__link">
        IP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/loadbalancer/" class="md-nav__link">
        LoadBalancer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../network/protocols/" class="md-nav__link">
        Protocols
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
      
      
      
        <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
          Project Mgmt
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_16">
          <span class="md-nav__icon md-icon"></span>
          Project Mgmt
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/agile/" class="md-nav__link">
        Agile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/git/" class="md-nav__link">
        Git
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../project_mgmt/ibm_internal/" class="md-nav__link">
        IBM PM
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17" >
      
      
      
        <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_17">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/grammars/" class="md-nav__link">
        Grammars
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/fastapi/" class="md-nav__link">
        FastAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/oblivion/" class="md-nav__link">
        Oblivion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/dependencies/" class="md-nav__link">
        Use dependencies
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/build_dependency/" class="md-nav__link">
        Build Own Dependency
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../python/virtual_env/" class="md-nav__link">
        Virtual environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../regex/" class="md-nav__link">
        Regex
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19" >
      
      
      
        <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
          Sketch
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_19">
          <span class="md-nav__icon md-icon"></span>
          Sketch
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../sketch/procreate/" class="md-nav__link">
        Procreate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_20" >
      
      
      
        <label class="md-nav__link" for="__nav_20" id="__nav_20_label" tabindex="0">
          Working Notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_20_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_20">
          <span class="md-nav__icon md-icon"></span>
          Working Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../working_notes/01_2025/" class="md-nav__link">
        202501
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Table of Contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-service" class="md-nav__link">
    1. 服务（Service）
  </a>
  
    <nav class="md-nav" aria-label="1. 服务（Service）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#service" class="md-nav__link">
    为什么需要Service？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ports" class="md-nav__link">
    语法：三个ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip" class="md-nav__link">
    IP地址类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    服务类型
  </a>
  
    <nav class="md-nav" aria-label="服务类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1clusterip" class="md-nav__link">
    （1）ClusterIP类 服务
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2nodeport" class="md-nav__link">
    （2）NodePort类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3headless" class="md-nav__link">
    （3）Headless类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4loadbalancer" class="md-nav__link">
    （4）LoadBalancer类
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service_1" class="md-nav__link">
    创建服务（Service）
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ingress" class="md-nav__link">
    2. Ingress
  </a>
  
    <nav class="md-nav" aria-label="2. Ingress">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    背景
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress" class="md-nav__link">
    救星Ingress
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress_1" class="md-nav__link">
    Ingress组成
  </a>
  
    <nav class="md-nav" aria-label="Ingress组成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ingress-controller" class="md-nav__link">
    (1) Ingress Controller
  </a>
  
    <nav class="md-nav" aria-label="(1) Ingress Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.一个负载均衡器
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2configmap" class="md-nav__link">
    2.一个ConfigMap
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3nodeportservice" class="md-nav__link">
    3.一个NodePort类型的Service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4serviceaccount" class="md-nav__link">
    4.一个ServiceAccount
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ingress-resource" class="md-nav__link">
    (2) Ingress Resource
  </a>
  
    <nav class="md-nav" aria-label="(2) Ingress Resource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend" class="md-nav__link">
    设置默认backend
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rewrite-target" class="md-nav__link">
    rewrite-target
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress_2" class="md-nav__link">
    Ingress规则
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bug-debug" class="md-nav__link">
    Bug &amp; Debug
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-networkpolicy" class="md-nav__link">
    3. NetworkPolicy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-labels-selectors" class="md-nav__link">
    4. 标签&amp;选择器（Labels &amp; Selectors）
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubectl" class="md-nav__link">
    &gt;&gt;&gt;  本章kubectl命令整理
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>6.服务与网络</h1>

<h3 id="1-service">1. 服务（<code>Service</code>）<a class="headerlink" href="#1-service" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Service vs Route</p>
<p>The <code>Service</code> will expose your application internally within the cluster, and the <strong>Route</strong> will create a publicly accessible URL for external access.</p>
</div>
<h4 id="service">为什么需要Service？<a class="headerlink" href="#service" title="Permanent link">&para;</a></h4>
<p>Kubernetes中的每个<code>Pod</code>都有它自己的IP地址，但<code>Pod</code>经常会因为各种原因而挂掉，如果我们用<code>Pod</code>的IP地址来访问该<code>Pod</code>，会常出现IP地址无效的情况，我们用 <strong>服务（<code>Service</code>）</strong>  解决这个问题。<strong>服务（<code>Service</code>）</strong>提供了稳定的IP地址，我们永远可以找到<strong>服务（<code>Service</code>）</strong>的IP地址，然后通过该<strong>服务（<code>Service</code>）</strong>访问到想要找的应用Pod。</p>
<div style="background-color: #4051b5; color: white; font-weight: 600;">服务不存在时：</div>
<p>为了更好的理解，我们看一下如果 <strong>服务不存在</strong> ，用户可以怎么访问Pod中的应用：<br /> <strong>方法一：</strong> 如果用户本身在Cluster内部，可以直接通过<code>curl http:10.244.0.2</code>访问应用<br />  <strong>方法二：</strong> 如果在Cluster外部，可以通过 <strong>ssh</strong> 来访问<code>curl http:10.244.0.2</code></p>
<p><img src="../ckad-6/76a2876bc5f44e90b058f67b1017e627.png" width=600 /></p>
<div style="background-color: #4051b5; color: white; font-weight: 600;">有了服务之后：</div>
<p>Cluster外部对应用的访问会更方便。服务（<code>Service</code>）相当于一个虚拟服务器，有自己的IP地址（这里是<code>10.106.127.123</code>）。<br /> 这里我们不再需要 <strong>ssh</strong> ，而是直接访问Node所在的ip地址<code>192.168.1.2</code><small>（⚠️用户本身的电脑IP和Node的IP是在同一个网络里面的，即IP地址中的前三部分时相同的，所以我们才能直接访问到Node得IP）</small>，<br /> 入口则使用Service提供的端口（<code>30080</code>），比如使用<code>curl 192.168.1.2:30080</code>
<img src="../ckad-6/3c7937f3bc754e5689a79e9f06fc360d.png"  width=600 /></p>
<p>查看服务：
<div class="highlight"><pre><span></span><code>k<span class="w"> </span>get<span class="w"> </span>services
<span class="c1"># 或</span>
k<span class="w"> </span>get<span class="w"> </span>svc
</code></pre></div>
结果如下：
<div class="highlight"><pre><span></span><code>NAME<span class="w">            </span>TYPE<span class="w">        </span>CLUSTER-IP<span class="w">      </span>EXTERNAL-IP<span class="w">     </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">         </span>AGE
kubernetes<span class="w">      </span>ClusterIP<span class="w">   </span><span class="m">10</span>.43.0.1<span class="w">       </span>&lt;None&gt;<span class="w">          </span><span class="m">443</span>/TCP<span class="w">         </span>7m30s
myapp-service<span class="w">   </span>NodePort<span class="w">    </span><span class="m">10</span>.106.127.123<span class="w">  </span>&lt;None&gt;<span class="w">          </span><span class="m">80</span>:30008/TCP<span class="w">    </span>30s
</code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<ul>
<li><code>kubernetes</code> 服务是k8s在启动时创建的默认服务。<code>myapp-service</code>服务是我们创建的，现在作为用户可以通过<code>curl http://192.168.1.2:30008</code>直接访问到前端App了！</li>
<li>PORT(S)中代表的是：<code>&lt;ServicePort&gt;:&lt;NodePort&gt;/&lt;Protocol&gt;</code></li>
<li><code>targetPort</code> 不会显示在 <code>oc get svc</code> 结果中</li>
<li><code>ClusterIP</code>（集群内的虚拟 IP），集群内的 Pod 通过此 IP 访问 Service</li>
</ul>
</div>
<h4 id="ports">语法：三个ports<a class="headerlink" href="#ports" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="c1"># Service with NodePort</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-nodeport-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30007</span>
</code></pre></div>
YAML文件中共有三个端口：</p>
<ol>
<li><code>port</code> - Service 自己的 Port <br/> <ul>
<li>服务本身的端口</li>
<li>服务自己的port就简单地叫<code>port</code></li>
<li>✅ 必写，否则会报错</li>
</ul>
</li>
<li><code>targetPort</code> <br/> <ul>
<li>应用程序的实际端口（Pod的端口） </li>
<li>是服务的目标，所以叫<code>target</code></li>
<li>🚫 可选，如不写明，默认与<code>port</code>值相同</li>
</ul>
</li>
<li><code>nodePort</code> <br/><ul>
<li>Node的端口，是外部访问服务的端口（集群外）</li>
<li>🚫 可选，如不写明，k8s会提供任意一个在 <strong>[30000, 32767]</strong> 范围内可用的端口</li>
</ul>
</li>
</ol>
<p><img src="../ckad-6/nodeport.png" width=500 /></p>
<p>如图，外部的访问者只需要知道Node的IP地址（<code>192.168.1.2</code>），和Node开放的Port（<code>30007</code>）就行了</p>
<div class="admonition note">
<p class="admonition-title"><code>service.spec.ports</code></p>
<p><code>.spec.ports</code>容纳的是一个数组，意味着一个服务可开放 <strong>多个端口</strong>，用于与不同的App进行沟通</p>
<ul>
<li>⚠️ 注意：如果有多个端口开放，那么<code>Service</code>的每个端口都必须有一个名称</li>
</ul>
<p>使用场景: </p>
<ol>
<li>多协议服务（如 HTTP + gRPC）- L7 应用层协议<br/>
    这里的 HTTP 和 gRPC 都是基于 TCP 的应用层协议。它们 使用不同的端口，但都是 TCP，例如：
    <div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grpc</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50051</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">targetPort</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50051</span>
</code></pre></div></li>
<li>TCP + UDP - 例如DNS服务 - L4 传输层协议<br/>
    这里涉及 不同的传输层协议，即 TCP 和 UDP，所以必须分开声明
    <div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dns-tcp</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
<span class="w">        </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dns-udp</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
<span class="w">        </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">53</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</code></pre></div></li>
<li>同时提供多个版本的 API
    <div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-v1</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-v2</span>
<span class="w">        </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
<span class="w">        </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
</code></pre></div></li>
<li>Service 代理多个不同的 Backend 端口. 一个 Pod 运行多个进程，每个进程监听不同端口（如 Web + Metrics）。
    <div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metrics</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9090</span>
</code></pre></div></li>
</ol>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<ul>
<li><code>.spec.selector</code> 指定<code>targetPort</code>属于哪一个Pod，上面例子中绑定了一个<code>labels</code>中有<code>app=myapp</code>的Pod。<ul>
<li>很多情况下，一个前端App会有多个replicas，但因为他们都有相同的<code>labels</code>，他们会自动被service找到！</li>
</ul>
</li>
<li><code>targetPort</code>是Pod而不是Container！因为Pod中的所有Container是共享网络的，所以用同一个Pod端口</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">服务的端点（Endpoint）</p>
<p><code>Service</code>中有一个<code>Endpoint</code>，这个<code>Endpoint</code>是 该<code>Service</code> 指向的 真正的 Pod IP 地址和端口</p>
<p>查看<code>Service</code>细节:</p>
<div class="highlight"><pre><span></span><code>k<span class="w"> </span>describe<span class="w"> </span>svc<span class="w"> </span>&lt;ServiceName&gt;
</code></pre></div>
<p><img src="../ckad-6/endpoint.png" width=400/></p>
<ul>
<li><code>IP</code>：Cluster给 service 分配的虚拟IP</li>
<li><code>Endpoints</code>：service指向的 Pod 真正的IP， 并非虚拟！</li>
</ul>
</div>
<h4 id="ip">IP地址类型<a class="headerlink" href="#ip" title="Permanent link">&para;</a></h4>
<p>有两种类型：<strong>外部IP地址（external/public）</strong> 和 <strong>内部IP地址（internal/private）</strong>。一般来说，每个设备都有自己的 <strong>外部IP</strong> 和 <strong>内部IP</strong>，且一般两者不同。</p>
<ul>
<li>
<p><strong>外部IP</strong>：由你的网络供应商提供，你访问一个网页时（比如百度），百度可以看到你的外部IP地址，知道你是从哪儿来的。<br/>
    <pre><code>
    # ifconfig=InterFace config
    curl <span style="background-color: #ccd1f0">if</span>config.me
    </code></pre></p>
</li>
<li>
<p><strong>内部IP</strong>：是自动生成的。人如其名，只做内部使用。比如，用于在家庭网络中识别你的身份信息。<br/>
    <pre><code>
    # ipconfig=Internet Protocol configuration
    <span style="background-color: #ccd1f0">ip</span>config getifaddr en0
    </code></pre></p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>当你使用VPN（Virtual Private Network）的时候，你的 <strong>网络地址</strong> 是被隐藏的</p>
</div>
<p><img src="../ckad-6/28a6f7c5d63b4ccb836b22f3990464fb.png" width=500 title="source: https://www.avast.com/c-what-is-an-ip-address" /></p>
<h4 id="_1">服务类型<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h4>
<table style='font-size: 10px'>
    <tr>
        <th style="width:3%">服务类型</th>
        <th style="width:40%">描述</th>
        <th style="width:20%">比喻</th>
        <th>YAML</th>
    </tr>
    <tr>
        <td><code>ClusterIP</code> <br/>❗默认类型</td>
        <td>默认类型，仅能在集群内部访问。比如：Frontend访问Backend<br/><br/><b>适用于</b>：集群内部服务间通信。</td>
        <td>公司内部的内线电话，外部无法拨打。</td>
        <td>
<pre><code>
spec:
    type: ClusterIP
</code></pre>
        </td>
    </tr>
    <tr>
        <td><code>NodePort</code></td>
        <td>暴露服务到每个节点的固定端口上，通过 <code>[NodeIP]:[NodePort]</code> 访问。<br/><br/><b>适用于</b>：测试环境，或快速暴露服务 - 用于外部访问。</td>
        <td>企业大门的访客入口，每个门有固定门牌号。</td>
        <td>
<pre><code>
spec:
    type: NodePort
    ports:
        - nodePort: 30007
</code></pre>
        </td>
    </tr>
    <tr>
        <td><code>Headless</code></td>
        <td>一种特殊的 <code>ClusterIP</code> 配置，无负载均衡，不会分配虚拟的 ClusterIP（`clusterIP: None`），而是直接暴露后端 Pod 的真实 IP！<br/><br/><b>适用于</b>：直接访问 Pod 的场景，例如 StatefulSet 应用（如数据库）。</td>
        <td>给客户直接提供员工手机号码，而非总机转接。</td>
        <td>
<pre><code>
spec:
    clusterIP: None
</code></pre>
        </td>
    </tr>
    <tr>
        <td><code>LoadBalancer</code></td>
        <td>通过云平台创建一个 **外部负载均衡器**， 并分配公共 IP。<br/><br/><b>适用于</b>：Production环境中，那些需要直接对外暴露的服务。</td>
        <td>-</td>
        <td>
<pre><code>
spec:
    type: LoadBalancer
</code></pre>
        </td>
    </tr>
    <tr>
        <td><code>ExternalName</code></td>
        <td>将服务映射到外部的 DNS 名称，无需代理流量。<br/><br/><b>适用于</b>：使用外部资源（如外部数据库或 API）。</td>
        <td>-</td>
        <td>
<pre><code>
spec:
    type: ExternalName
    externalName: example.com
</code></pre>
        </td>
    </tr>
</table>

<h5 id="1clusterip">（1）ClusterIP类 服务<a class="headerlink" href="#1clusterip" title="Permanent link">&para;</a></h5>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The name "ClusterIP" refers to the fact that this service provides a virtual IP address (ClusterIP) that is accessible only within the cluster.</p>
<p>💡 <code>ClusterIP</code><br/>
Cluster 给 Service 分配的那个虚拟 IP 就叫做 <code>ClusterIP</code></p>
<p>💡 可以分配给 Service 的 <code>ClusterIP</code>范围 在 OpenShift Cluster安装时就已经在 <code>install-config.yaml</code> 的 <code>networking.serviceNetwork</code> 被定义了。</p>
</div>
<p>默认类型，仅能在集群内部访问。比如：Frontend访问Backend</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">clusterip-service</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>问：假设现在有前端后端组成的程序，而前端和后端各有自己的<code>Replicas</code>（复制品，为了处理较大的用户访问而存在）。访问前端1的时候，前端1的API是发送给后端的哪一个<code>replica</code>的呢？</p>
<p>答：Kubernetes的 <strong>ClusterIP服务</strong> 可以帮助我们将 <code>Pod</code> 分组在一起（所有的前端<code>replicas</code>为一组，后端<code>replicas</code>为另一组），并提供单个接口（即<code>Service</code>）来访问组中的 <code>Pod</code>。<code>Pod</code>会因为各种bug生生死死，每次重生之后拿到的IP地址还不一样，所以我们没有办法直接用<code>Pod</code>，因为我们不知道该去哪个IP地址找，而<code>Service</code>提供了稳定的IP地址。如图：</p>
<p><img src="../ckad-6/6c0afcac50c4444a96129c530c4da11f.png"  /></p>
</div>
<h5 id="2nodeport">（2）NodePort类<a class="headerlink" href="#2nodeport" title="Permanent link">&para;</a></h5>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The name "NodePort" refers to the fact that the service opens a specific port on each cluster node, making it accessible from outside the cluster via the node's IP and the exposed port.</p>
</div>
<p>暴露服务到每个节点的固定端口上，External clients can access it via <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>.</p>
<p>NodePort 服务例子：
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-nodeport-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
<span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30007</span>
</code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">多Node</p>
<p>当Pod的replicas分布在不同的Node上时，Service会自动扩展到多个Node上，我们不需要做任何多余的操作。
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>http://192.168.1.2:30008
curl<span class="w"> </span>http://192.168.1.3:30008
</code></pre></div>
<img src="../ckad-6/a2d56d9a1dfa4a8a8e93316212828006.png" width=700 /></p>
</div>
<h5 id="3headless">（3）Headless类<a class="headerlink" href="#3headless" title="Permanent link">&para;</a></h5>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The term "headless" implies that the service does not have a "head" or a centralized virtual IP address (ClusterIP). -&gt; Instead, it directly exposes the backend pod IPs to clients.</p>
<p>TODO：Headless类 Service 是如何expose Pod的？</p>
</div>
<p>当我们想要访问指定的Pod时，例如 StatefulSet 应用（如数据库）。只要将<code>.spec.clusterIP</code>设置为<code>None</code>即可：</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">headless-service</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">None</span><span class="w">  </span><span class="c1"># Specifies headless</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9042</span><span class="w">  </span><span class="c1"># Cassandra default port</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cql</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>大多数Stateful 的应用（比如数据库）来说，<code>Pod</code>的<code>Replicas</code>之间是有区别的。</p>
<p>比如一个MySQL的应用可以分为<code>Master Pod</code>和<code>Worker Pod</code>：</p>
<ul>
<li>只有<code>Master Pod</code>可以向数据库写入数据</li>
<li><code>Worker Pod</code>只负责同步和读取数据。</li>
</ul>
</div>
<div class="admonition info">
<p class="admonition-title">那么如何才能访问到指定的Pod呢？</p>
<p>the headless service (defined with <code>clusterIP: None</code>) is responsible for creating DNS records for each individual pod in a StatefulSet. In our case we have a stateful app <code>Cassandra</code>:
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span><span class="w">  </span><span class="c1"># Headless service name</span>
<span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra:4.0</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9042</span><span class="w">  </span><span class="c1"># Cassandra query language (CQL) port</span>
<span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra-data</span>
<span class="w">            </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/cassandra</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_CLUSTER_NAME</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CassandraCluster&quot;</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CASSANDRA_SEEDS</span>
<span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cassandra-0.cassandra.default.svc.cluster.local&quot;</span>
<span class="nt">volumeClaimTemplates</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cassandra-data</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">        </span><span class="nt">accessModes</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ReadWriteOnce&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">        </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">            </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5Gi</span>
</code></pre></div></p>
<p>the Service auto-generated these <code>DNS</code> for each pods:
<div class="highlight"><pre><span></span><code>cassandra-0.cassandra.default.svc.cluster.local
cassandra-1.cassandra.default.svc.cluster.local
cassandra-2.cassandra.default.svc.cluster.local
</code></pre></div></p>
</div>
<h5 id="4loadbalancer">（4）LoadBalancer类<a class="headerlink" href="#4loadbalancer" title="Permanent link">&para;</a></h5>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The name "LoadBalancer" signifies that this service type integrates with an external load balancer to distribute incoming traffic across the pods</p>
</div>
<p><code>LoadBalancer</code>类Service = <code>NodePort</code>类Service + 发送一个 <strong>添加负载均衡器（Load Balancer）</strong> 的请求</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loadbalancer-service</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-app</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</code></pre></div>
<h4 id="service_1">创建服务（<code>Service</code>）<a class="headerlink" href="#service_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># 方法一：用yaml文件定义</span>
k<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>my_service.yaml

<span class="c1"># 方法二：生成service</span>
<span class="c1"># - port:TargetPort=8080:8080</span>
<span class="c1"># - 需要手动往YAML中修改`.spec.selector`</span>
<span class="c1"># - 自动生成了`.spec.ports.name`</span>
k<span class="w"> </span>create<span class="w"> </span>service<span class="w"> </span>nodeport<span class="w"> </span><span class="o">[</span>ServiceName<span class="o">]</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--tcp<span class="o">=</span><span class="m">8080</span>:8080<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dry-run<span class="o">=</span>client<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-o<span class="w"> </span>yaml<span class="w"> </span>&gt;<span class="w"> </span>service.yaml

<span class="c1"># 方法三：暴露deployment（以生成service）</span>
<span class="c1"># - 需要手动往YAML中添加`.metadata.labels`</span>
k<span class="w"> </span>expose<span class="w"> </span>deployment/<span class="o">[</span>DeploymentName<span class="o">]</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="o">=[</span>ServiceName<span class="o">]</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--port<span class="o">=</span><span class="m">8080</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--target-port<span class="o">=</span><span class="m">8080</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--type<span class="o">=</span>NodePort<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dry-run<span class="o">=</span>client<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>&gt;<span class="w"> </span>service.yaml
</code></pre></div>
<!-- TODO：截屏 -->

<h3 id="2-ingress">2. Ingress<a class="headerlink" href="#2-ingress" title="Permanent link">&para;</a></h3>
<!--
    TODO

### Openshift的Route vs Kubernetes的Ingress
Openshift的`Route`诞生于k8s的`Ingress`之前，红帽作为k8s的主要贡献者之一，在很大程度上影响了`Ingress`的设计，可以说`Ingress`借鉴了`Route`的功能。
在k8s创建了`Ingress`之后，红帽为Openshift也设置了相关命令，现在在Openshift会监视`Ingress`对象，并创建一个或多个`Route`以满足`Ingress`指定的条件。
➡️ 如果在Openshift中创建`Ingress`对象，则无需再担心`Route`，因为在这种情况下，对应的`Route`会自动生成。
-->

<h4 id="_2">背景<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h4>
<p><strong>🤔 当App在本地服务器上时，如何实现用域名 <code>http://www.my-shop.com</code>访问到<code>192.168.1.2:30008</code> 呢？</strong></p>
<ul>
<li>-&gt; NodePort类的Service暴露 Node端口 30080</li>
<li>-&gt; 192.168.1.2:30008 </li>
<li>-&gt; 配置DNS服务器</li>
<li>-&gt; http://www.my-shop.com:30080 </li>
<li>-&gt; 添加代理服务器 / Proxy Server</li>
<li>-&gt; http://www.my-shop.com </li>
<li>-&gt; Done!</li>
</ul>
<p><strong>🤔 当App在云服务器上时（比如Google Cloud Platform），如何实现呢？</strong></p>
<ul>
<li>-&gt; <code>LoadBalancer</code>类的Service，不仅拥有<code>NodePort</code>类的功能，还向云服务器发送了一个 <strong>添加负载均衡器(<code>LoadBalancer</code>)</strong> 的请求</li>
<li>-&gt; 云服务器自动配置一个负载均衡器（⚠️ <strong>负载均衡器</strong> 的价格是按“个”计算的！）</li>
<li>-&gt; 该<strong>负载均衡器</strong>会发布一个可供外部访问的IP（我们叫他<code>LoadBalancerIP</code>）</li>
<li>-&gt; 配置DNS服务器，指向<code>LoadBalancerIP</code></li>
<li>-&gt; <code>http://www.my-shop.com</code></li>
</ul>
<p>⚠️<strong>负载均衡器</strong> 可嵌套，比如对一个主域名下的子域名进行配置：</p>
<p><img alt="请添加图片描述" src="../ckad-6/946b9dbbe3d2414f95462e338985f943.png" /></p>
<p>这些步骤都完成以后，配置<code>SSL</code>以使用<code>https</code>（而不是<code>http</code>）。对<code>SSL</code>的配置可以在多个位置实现：</p>
<ul>
<li>App本身层面</li>
<li>负载均衡器层面</li>
<li>代理服务器层面</li>
</ul>
<p>上述三种配置方法，均可实现同样的功能。</p>
<h4 id="ingress">救星Ingress<a class="headerlink" href="#ingress" title="Permanent link">&para;</a></h4>
<p>各种各样的配置，你的头现在多大了呢？Ingress就是用来帮忙解决这个令人头疼的问题的！它包括但不限于路由（包括引流到不同App，比如<code>/shopping</code> 和<code>/game</code>）和<code>SSL</code>配置。</p>
<p><img src="../ckad-6/37c75713b9714222a1190665d0d83e57.png" width=800 /></p>
<h4 id="ingress_1">Ingress组成<a class="headerlink" href="#ingress_1" title="Permanent link">&para;</a></h4>
<p>把Ingress分为两个组件：<strong>Ingress Controller</strong>和<strong>Ingress Resource</strong>。一般两者分别在不同的namespace中，特别是<strong>Ingress Controller</strong>，做为与应用无关的资源，应该被放到单独的Namespace中！</p>
<!-- TODO： draw this pic better: ingress-controller-space & app-space -->
<p><img src="../ckad-6/ingress.png" width=700 /></p>
<h5 id="1-ingress-controller">(1) Ingress Controller<a class="headerlink" href="#1-ingress-controller" title="Permanent link">&para;</a></h5>
<p>Ingress控制器由四个资源组成：</p>
<ol>
<li>负载均衡器（以Deployment的形式存在）</li>
<li>ConfigMap</li>
<li>NodePort类的服务</li>
<li>ServiceAccount</li>
</ol>
<h6 id="1"><strong>1.一个负载均衡器</strong><a class="headerlink" href="#1" title="Permanent link">&para;</a></h6>
<p>以一个单独软件的形式deploy到当前的cluster上。较为流行的有<code>GCE HTTPS LoadBalancer（谷歌）</code>，<code>Nginx</code>，<code>Contour</code>，<code>HaProxy</code>，<code>taefik</code>和<code>Istio</code>。其中<code>GCE HTTPS LoadBalancer（谷歌的）</code>和<code>Nginx</code>由Kubernetes管理。</p>
<p>我们这里以<code>Nginx</code>为例：命名该Deployment为<code>nginx-ingree-controller</code>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingree-controller</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress</span>
<span class="w">    </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">            </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress</span>
<span class="w">        </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">            </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-controller</span>
<span class="w">                  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.21.0</span>
<span class="w">            </span><span class="nt">args</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/nginx-ingress-controller</span><span class="w">     </span><span class="c1"># nginx程序存储在该文件夹下，所以要在运行时进入文件夹</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--configmap=${POD_NAMESPACE}/nginx-configuration</span><span class="w">  </span><span class="c1"># 使用CM存nginx设置，而不是直接写在当前的Deployment里面</span>
<span class="w">            </span><span class="nt">env</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POD_NAME</span>
<span class="w">                  </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">fieldRef</span><span class="p">:</span><span class="w"> </span>
<span class="w">                        </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metadata.name</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POD_NAMESPACE</span>
<span class="w">                  </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">fieldRef</span><span class="p">:</span><span class="w"> </span>
<span class="w">                        </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metadata.namespace</span>
<span class="w">            </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">                  </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">                  </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>所使用的镜像是一个专门用来做Ingress的nginx镜像，可以在<a href="https://quay.io/repository/kubernetes-ingress-controller/nginx-ingress-controller">这里</a>找到。</p>
</div>
<h6 id="2configmap"><strong>2.一个ConfigMap</strong><a class="headerlink" href="#2configmap" title="Permanent link">&para;</a></h6>
<p>这里命名为<code>nginx-configuration</code>，该ConfigMap被1中的Deployment使用，用来存储和修改<code>nginx</code>配置，比如存储日志的路径，SSL 设置，最长等待时间等。
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-configuration</span>
<span class="nn">...</span>
</code></pre></div></p>
<h6 id="3nodeportservice"><strong>3.一个NodePort类型的Service</strong><a class="headerlink" href="#3nodeportservice" title="Permanent link">&para;</a></h6>
<p>使Deployment <code>nginx-ingree-controller</code>可供外部访问
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-service</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">          </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
<span class="w">    </span><span class="nt">selectors</span><span class="p">:</span>
<span class="w">        </span><span class="c1"># 对应Deployment的Label</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress</span>
</code></pre></div></p>
<h6 id="4serviceaccount"><strong>4.一个ServiceAccount</strong><a class="headerlink" href="#4serviceaccount" title="Permanent link">&para;</a></h6>
<p><code>nginx</code> Ingress还提供了额外的功能，比如监控从集群外部来的访问，并实时修改nginx配置。该操作需要正确的权限，所以我们需要一个ServiceAccount，并在Deployment中使用该SA
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress-serviceaccount</span>
<span class="c1"># Roles, ClusterRoles, RoleBindings...</span>
</code></pre></div></p>
<h5 id="2-ingress-resource">(2) Ingress Resource<a class="headerlink" href="#2-ingress-resource" title="Permanent link">&para;</a></h5>
<p>Ingress Resource是应用于Ingress Controller的<strong>一组规则和配置</strong>。比如：</p>
<ul>
<li>对<code>www.my-shop.com/shopping</code>的访问流入到<code>Shopping App</code>应用中，而对<code>www.my-shop.com/game</code>的访问流入到<code>Game App</code>应用中</li>
<li>或者直接从domain就开始区分，比如常见的地域区分：<code>www.apple.cn</code>和<code>www.apple.de</code></li>
</ul>
<p>我们用yaml文件定义一个Ingress Resource。比如，下面这个最简单的例子，会将所有访问都导入到名为<code>shopping-service</code>的Service中去
<div class="highlight"><pre><span></span><code><span class="c1"># ingress_resource.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span><span class="w"> </span><span class="c1"># 注意是Ingress类型</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-rule</span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">        </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shopping-service</span>
<span class="w">        </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></p>
<p>生成Ingress Resource：
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>ingress_rule.yaml
</code></pre></div>
查看生成的Ingress Resource：
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>ingress
</code></pre></div></p>
<h6 id="backend">设置默认backend<a class="headerlink" href="#backend" title="Permanent link">&para;</a></h6>
<p><code>k describe ingress/ingress-rule</code> 可以看到一个<code>Default backend</code>。这个名为<code>default-http-backend</code>的服务是当用户输入的DNS地址（即网址）和规则中任意一条都不相符的时候会被访问！所以可以手动建一个这个名字的服务，然后访问一个自定义的，更加友好的404页面<br />
<img alt="请添加图片描述" src="../ckad-6/d5c34e0f5b2444d8977839d2de1e2c0e.png" /></p>
<p>这时查看Yaml文件，该ingress大概长这样：
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-resource-backend</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">defaultBackend</span><span class="p">:</span><span class="w">   </span><span class="c1"># 默认服务</span>
<span class="w">    </span><span class="nt">resource</span><span class="p">:</span>
<span class="w">      </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.example.com</span>
<span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StorageBucket</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">static-assets</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w">                    </span><span class="c1"># 规则</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div></p>
<h6 id="rewrite-target">rewrite-target<a class="headerlink" href="#rewrite-target" title="Permanent link">&para;</a></h6>
<div class="highlight"><pre><span></span><code><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># the `/` is the path that replaces the original path</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/rewrite-target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">举例<p>当某个Ingress提供对多个应用的访问，比如：</p>
<ul>
<li><code>/frontend</code> -&gt; <code>frontend-service</code> -&gt; <code>frontend-react-app</code></li>
<li><code>/dashboard</code> -&gt; <code>dashboard-service</code> -&gt; <code>dashboard-power-bi-app</code></li>
</ul>
<p><code>http://example.com/frontend/home</code>会被重新成<code>http://example.com/home</code>。</p>
<p>而<code>frontend-react-app</code>软件本身提供的页面是没有子域名的，也就是说，如果我在本地跑react软件，能访问到的页面是<code>localhost:3000</code>而不是<code>localhost:3000/frontend</code>，所以需要“rewrite”</p>
</p>
</div>
<h6 id="ingress_2">Ingress规则<a class="headerlink" href="#ingress_2" title="Permanent link">&para;</a></h6>
<div class="admonition info">
<p class="admonition-title">例1：同一个域名，不同子路径</p>
<p>假设我们想要实现一个分流，所有访问<code>www.my-shop.com/shopping</code>都将访问导入到名为<code>shopping-service</code>的Service，当个用户访问<code>www.my-shop.com/game</code>时，访问另一个名为<code>game-service</code>的Service。我们可以在Ingress Resource的yaml文件中写规则（rule），举例：
<div class="highlight"><pre><span></span><code><span class="c1"># my_ingress_with_path.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-rule</span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># 这里host是可选的，如不指定，则该规则适用于通过指定 IP 地址的所有入站 HTTP 通信</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.my-shop.com</span>
<span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/shopping</span>
<span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">            </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">shopping-service</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span>
<span class="w">                    </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/game</span>
<span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">            </span><span class="nt">service</span><span class="p">:</span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">game-service</span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span>
<span class="w">                    </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
此外，也可以用<code>k</code>命令直接生成Ingress：
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>ingress<span class="w"> </span>ingress-rule<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rule<span class="o">=</span><span class="s2">&quot;www.my-shop.com/shopping*=shopping-service:80&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--rule<span class="o">=</span><span class="s2">&quot;www.my-shop.com/game*=game-service:80&quot;</span>
</code></pre></div></p>
</div>
<div class="admonition info">
<p class="admonition-title">例1：不同域名</p>
<div class="highlight"><pre><span></span><code><span class="c1"># my_ingress_with_host.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-rule</span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span>
<span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.my-shop.cn</span>
<span class="w">        </span><span class="nt">http</span><span class="p">:</span>
<span class="w">            </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">                </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-shop-cn</span>
<span class="w">                </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www.my-shop.de</span>
<span class="w">        </span><span class="nt">http</span><span class="p">:</span>
<span class="w">            </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<span class="w">                </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-shop-de</span>
<span class="w">                </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div>
</div>
<!-- ![请添加图片描述](../ckad-6/1a71f7d2c32d462c8a9ae149a739bea6.png) -->

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Ingress默认只访问当前Namespace中的服务，但也可以有例外：</p>
<p>Alternatively there is way to achieve ingress in one namespace and service in another namespace via externalName.Checkout Kubernetes Cross Namespace Ingress Network：
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-service-1</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namespace-a</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ExternalName</span>
<span class="w">    </span><span class="nt">externalName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-service-2.namespace-b.svc.cluster.local</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></p>
</div>
<h6 id="bug-debug">Bug &amp; Debug<a class="headerlink" href="#bug-debug" title="Permanent link">&para;</a></h6>
<p>很多时候Ingress出问题是因为它的annotations中缺少了一些东西。我们可以通过查看它所指向的Pod的log，或者ingress controller的log查看具体问题出在哪儿：
<div class="highlight"><pre><span></span><code><span class="c1"># 查看Ingress所指向的某个App 的 log</span>
k<span class="w"> </span>logs<span class="w"> </span>webapp-wear-658fc8dbb4-4m6gs<span class="w"> </span>-n<span class="w"> </span>app-space<span class="w"> </span>

<span class="c1"># 查看Ingress controller 的 log</span>
k<span class="w"> </span>logs<span class="w"> </span>ingress-nginx-controller-ffc6b494b-b7vms<span class="w"> </span>-n<span class="w"> </span>ingress-nginx<span class="w"> </span>
</code></pre></div></p>
<p>常见问题：</p>
<div class="admonition warning">
<p class="admonition-title">503 Service Temporarily Unavailable<p><code>pathType: Exact</code> which should be <code>pathType: Prefix</code></p>
</p>
</div>
<div class="admonition warning">
<p class="admonition-title">301 too many redirect<p>missing this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/ssl-redirect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span>
</code></pre></div>
<p>By default the controller redirects (301) to HTTPS if TLS is enabled for that Ingress. If you want to disable that behavior, you can use the nginx.ingress.kubernetes.io/ssl-redirect: "false" annotation.</p>
<p>And in the lab, we manage the HTTPS from our side, not from the ingress. So, you should add annotation nginx.ingress.kubernetes.io/ssl-redirect: "false"</p>
</p>
</div>
<div class="admonition warning">
<p class="admonition-title">svc didnt reach the correct one<p>missing this
<div class="highlight"><pre><span></span><code><span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">nginx.ingress.kubernetes.io/rewrite-target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</code></pre></div></p>
</p>
</div>
<h3 id="3-networkpolicy">3. NetworkPolicy<a class="headerlink" href="#3-networkpolicy" title="Permanent link">&para;</a></h3>
<p><img src="../ckad-6/6ada1cda6fbf42439357ee2a4d31445b.png" width=200 /></p>
<p>NetworkPolicy（<code>netpol</code>） 是 Kubernetes 中用于控制 Pod 网络流量的规则。通过 Network Policies，可以定义哪些流量（入站和/或出站）可以到达 Pod 或从 Pod 发出。</p>
<div class="admonition info">
<p class="admonition-title">理论</p>
<ul>
<li><strong>概念：</strong> ingress和egress都是 <strong>相对</strong> 的概念，收到的请求叫ingress，发出的叫egress</li>
<li><strong>背景：</strong> 理论上一个cluster上所有的<code>Pod</code>之间都能通过<code>Service</code>互相沟通，但如图，我们可能不需要也不想要 Frontend 和 Database 之间直接进行沟通，我们可以通过 <strong>Network Policies</strong> 对某个<code>Pod</code>的traffic设限</li>
<li><strong>Network Policies</strong>：通过<code>label</code>和<code>selectors</code>将 <strong>Network Policies</strong> 连接到<code>Pod</code>上去</li>
</ul>
</div>
<p>NetworkPolicy举例：YAML中的<code>.spec.podSelector.matchLabels.name</code>指定了 <strong>目标 Pod 标签</strong>。
<div class="highlight"><pre><span></span><code><span class="c1"># policy-definition.yaml</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db-policy</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nt">podSelector</span><span class="p">:</span>
<span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">            </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span><span class="w">        </span><span class="c1"># 说明此NetPol用在有“role: db”标签的pod上</span>
<span class="w">    </span><span class="nt">policyTypes</span><span class="p">:</span><span class="w">            </span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span><span class="w">           </span><span class="c1"># 这里写明了规则是限制了Ingress还是Egress还是两者都，这里两个都限制了</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Egress</span>
<span class="w">    </span><span class="nt">ingress</span><span class="p">:</span><span class="w">                </span><span class="c1"># 对ingress的规则：</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">podSelector</span><span class="p">:</span><span class="w">              </span><span class="c1"># 元素1</span>
<span class="w">                </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">role</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-pod</span>
<span class="w">              </span><span class="nt">namespaceSelector</span><span class="p">:</span><span class="w">        </span><span class="c1"># 可选项目：如果api-pod不在当前的namespace，则需要注明selector</span>
<span class="w">                </span><span class="nt">matchlabels</span><span class="p">:</span>
<span class="w">                    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span><span class="w">                  </span><span class="c1"># 元素2：与元素1之前是“或”的关系</span>
<span class="w">                </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.5.12/32</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
<span class="w">    </span><span class="nt">egress</span><span class="p">:</span><span class="w">                 </span><span class="c1"># 对egress的规则：</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ipBlock</span><span class="p">:</span>
<span class="w">                </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.5.12/32</span>
<span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>.spec.podSelector: {}</code> 意思是该规则应用到当前 namespace 所有 Pod 上</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>无论是 ingress 还是 egress的规则，都由两部分组成：</p>
<ol>
<li><code>ingress.from</code>规定了通信的来源 （<code>egress.to</code> 规定了通信的目的地）</li>
<li><code>ports</code>规定了使用当前Pod的哪个端口进行通信。</li>
</ol>
<p>⚠️ 如果只有<code>namespaceSelector</code>，没有<code>podSelector</code>，则表示该规则适用于某namespace上的所有Pod <br/>
⚠️ <code>ipBlock</code>：假设规则想要应用到某个不在当前<code>Cluster</code> 上的App，则可使用它</p>
</div>
<div class="admonition note">
<p class="admonition-title"><code>cidr</code></p>
<p>CIDR（Classless Inter-Domain Routing）表示法用于定义 IP 地址范围，格式为：</p>
<div class="highlight"><pre><span></span><code>&lt;IP地址&gt;/&lt;前缀长度&gt;
</code></pre></div>
<p>举例：</p>
<ul>
<li><code>192.168.5.12/32</code>：表示 单个 IP 地址（<code>192.168.5.12</code>），因为 /32 表示网络掩码 <code>255.255.255.255</code>，即仅匹配这一个 IP。</li>
<li><code>192.168.5.0/24</code>：表示 <code>192.168.5.0</code> 到 <code>192.168.5.255</code> 的所有 IP。</li>
<li><code>10.0.0.0/8</code>：表示 <code>10.0.0.0</code> 到 <code>10.255.255.255</code> 的所有 IP。</li>
</ul>
</div>
<p>创建Network Policies：</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>policy-definition.yaml
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">AND vs OR</p>
<p><code>from</code>中包含的内容是否作为数组的元素存在很重要！如下：</p>
<table>
<thead>
<tr>
<th>As combined item</th>
<th>As separated items in list</th>
</tr>
</thead>
<tbody>
<tr>
<td>For example, <code>namespaceSelector</code> AND <code>podSelector</code> <br/> <img src="../ckad-6/c00298c19d8b4c8c992d5f4cc135859a.png" /></td>
<td>For example, <code>namespaceSelector</code> OR <code>podSelector</code> <br/>  <img src="../ckad-6/8cae9a4ae09c4c919f8ae201159ee3be.png" /></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition warning">
<p class="admonition-title">more than one <code>netpol</code></p>
<p>If a pod is matched by selectors in one or more <code>netpol</code>s, then the pod accepts only connections that at least one of those <code>netpol</code> allows.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If a pod does not match any <code>netpol</code>, then OpenShift does NOT restrict traffic to that pod.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Where does <code>netpol</code> apply?</p>
<p>Network policies control only <strong>internal traffic</strong> from pods that do not use <strong>host networking</strong>.</p>
<p>网络策略只适用于 使用 Kubernetes 虚拟网络的 Pod 的内部流量，即 Pod 之间通过集群网络通信的流量。对于那些配置了 主机网络（host networking） 的 Pod，由于它们直接使用主机的网络栈，因此网络策略对它们的流量 不起作用:</p>
<ul>
<li><strong>Internal Traffic（内部流量）</strong>：指 Pod 之间通过 Kubernetes 虚拟网络进行的通信。Pod A 通过服务（Service）访问 Pod B，例如 <code>backend-service.default.svc.cluster.local</code>。</li>
<li><strong>Host Networking（主机网络）</strong>：指 Pod 不再有一个独立的 Pod IP，而是会直接使用 Node 的 IP。不再使用 Kubernetes 分配给Pod的虚拟网络，此时网络策略对流量无效。即，如果 Pod 配置了 <code>hostNetwork: true</code>：
    <pre><code>
    apiVersion: v1
    kind: Pod
    metadata:
        name: host-network-example
        namespace: default
    spec:
        <span style="background-color: #ccd1f0">hostNetwork: true</span>
        containers:
        - name: nginx
            image: nginx:latest
            ports:
            - containerPort: 80
    </pre></code></li>
</ul>
</div>
<h3 id="4-labels-selectors">4. 标签&amp;选择器（Labels &amp; Selectors）<a class="headerlink" href="#4-labels-selectors" title="Permanent link">&para;</a></h3>
<p>k8s中大量地使用了标签&amp;选择器。比如：Service通过选择器（selector）找到拥有正确标签（labels）的Pod。
<div class="highlight"><pre><span></span><code><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Pod要满足<code>selector</code>中所有的标签才可以！<code>app==myapp</code> 和 <code>tier=frontend</code>两个标签都要有。下面这个Pod就不满足条件：</p>
<div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myPod</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</code></pre></div>
</div>
<h3 id="kubectl">&gt;&gt;&gt;  本章kubectl命令整理<a class="headerlink" href="#kubectl" title="Permanent link">&para;</a></h3>
<p><strong>IP</strong></p>
<ul>
<li><code>curl ifconfig.me</code> 查看外部IP</li>
<li><code>ipconfig getifaddr en0</code> 查看内部IP</li>
</ul>
<p><strong>服务（<code>Service</code>）</strong></p>
<ul>
<li><code>k get service</code></li>
<li><code>k create service nodeport [ServiceName] --tcp=8080:8080</code></li>
<li><code>k expose deployment/[DeploymentName] \
    --name=[ServiceName] \
    --port=8080 \
    --target-port=8080 \
    --type=NodePort</code></li>
</ul>
<p><strong>Ingress</strong></p>
<ul>
<li><code>k get ingress</code></li>
<li><code>k describe ingress/ingress-rule</code></li>
<li><code>k create ingress ingress-rule \
        --rule="www.my-shop.com/shopping*=shopping-service:80"
        --rule="www.my-shop.com/game*=game-service:80"</code></li>
</ul>
<p><strong>Network Policies</strong></p>
<ul>
<li><code>k get networkpolicies</code></li>
<li><code>k get netpol</code></li>
</ul>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.tabs.link", "navigation.prunes"], "search": "../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.407015b8.min.js"></script>
      
    
  </body>
</html>